<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SpringCloud | ZZMR</title><meta name="keywords" content="SpringCloud"><meta name="author" content="Jimmy"><meta name="copyright" content="Jimmy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SpringCloud"><meta name="application-name" content="SpringCloud"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SpringCloud"><meta property="og:url" content="https://jimmy66886.github.io/posts/96a41905.html"><meta property="og:site_name" content="ZZMR"><meta property="og:description" content="å•Šæ“"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img01.zzmr.club/img/springcloud.png"><meta property="article:author" content="Jimmy"><meta property="article:tag" content="ä¸ªäººåšå®¢"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img01.zzmr.club/img/springcloud.png"><meta name="description" content="å•Šæ“"><link rel="shortcut icon" href="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg"><link rel="canonical" href="https://jimmy66886.github.io/posts/96a41905"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//hm.baidu.com"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3e49559454d4932941707cbfc1458970";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"404 Not Found","backTitle":"500 Internal Server Error"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo.zzmr.club/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: {"appId":"F9JLPTATA5","apiKey":"59b226541195bbf63bef817349ad87b5","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"è¾“å…¥å…³é”®è¯åæŒ‰ä¸‹å›è½¦æŸ¥æ‰¾","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€","rightMenuMsgToTraditionalChinese":"è½¬ä¸ºç¹ä½“","rightMenuMsgToSimplifiedChinese":"è½¬ä¸ºç®€ä½“"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"ä½œè€…: Jimmy","link":"é“¾æ¥: ","source":"æ¥æº: ZZMR","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","copySuccess":"å¤åˆ¶æˆåŠŸï¼Œå¤åˆ¶å’Œè½¬è½½è¯·æ ‡æ³¨æœ¬æ–‡åœ°å€"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZZMR',
  title: 'SpringCloud',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-10-07 22:52:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/about-tag.css"><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="åŠ è½½å¤´åƒ" src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">ç½‘é¡µ</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://index.zzmr.club/" title="ä¸ªäººä¸»é¡µ"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/HOMEMESSAGE.png" alt="ä¸ªäººä¸»é¡µ"/><span class="back-menu-item-text">ä¸ªäººä¸»é¡µ</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.zzmr.club/" title="åšå®¢"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="åšå®¢"/><span class="back-menu-item-text">åšå®¢</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">å·¥å…·</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://tools.zzmr.club/" title="å›¾åºŠå®¹é‡"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/github-alt.png" alt="å›¾åºŠå®¹é‡"/><span class="back-menu-item-text">å›¾åºŠå®¹é‡</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">ZZMR</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> éš§é“</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æˆ‘çš„</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/maps/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> å¯¼èˆª</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> æ¸¸æˆäººç”Ÿ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> ç›¸å†Œé›†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/staticIndex/test.html"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> èˆ”ç‹—æ—¥è®°</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºå‰å¾€ä¸€ä¸ªæ–‡ç« " href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="æœç´¢ğŸ”" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> æœç´¢</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="ä¸­æ§å°" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://img01.zzmr.club/img/chatpay.jpg" target="_blank"><img class="post-qr-code-img" alt="å¾®ä¿¡" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/chatpay.jpg"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://img01.zzmr.club/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="æ”¯ä»˜å®" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/alipay.jpg"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">äº’åŠ¨</div><span class="author-content-item-title"> <span>æœ€æ–°è¯„è®º</span></span></div><div class="aside-list"><span>æ­£åœ¨åŠ è½½ä¸­...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">å…´è¶£ç‚¹</div><span class="author-content-item-title">å¯»æ‰¾ä½ æ„Ÿå…´è¶£çš„é¢†åŸŸ</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOP/" style="font-size: 1.05rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 1.05rem;">Ajax<sup>1</sup></a><a href="/tags/Algolia/" style="font-size: 1.05rem;">Algolia<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 1.05rem;">Axios<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/JVM/" style="font-size: 1.05rem;">JVM<sup>1</sup></a><a href="/tags/MySql/" style="font-size: 1.05rem;">MySql<sup>2</sup></a><a href="/tags/Promise/" style="font-size: 1.05rem;">Promise<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 1.05rem;">SSM<sup>3</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>1</sup></a><a href="/tags/SpingBoot/" style="font-size: 1.05rem;">SpingBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 1.05rem;">SpringCloud<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 1.05rem;">VsCode<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>1</sup></a><a href="/tags/mag68/" style="font-size: 1.05rem;">mag68<sup>1</sup></a><a href="/tags/maven/" style="font-size: 1.05rem;">maven<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.05rem;">ä¸»ä»å¤åˆ¶<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 1.05rem;">å›¾åºŠ<sup>1</sup></a><a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 1.05rem;">åŸŸå<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">å¹´åº¦æ€»ç»“<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">å¼€å‘<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 1.05rem;">æ—…è¡Œ<sup>5</sup></a><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 1.05rem;">æ‚è°ˆ<sup>1</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE%E5%A4%96%E6%8C%82/" style="font-size: 1.05rem;">æ ‡ç­¾å¤–æŒ‚<sup>1</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">çº¿ç¨‹<sup>1</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 1.05rem;">ç¾åŒ–<sup>1</sup></a><a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" style="font-size: 1.05rem;">è‹ç©¹å¤–å–<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">é¢è¯•<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>æ–‡ç« </span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>å½’æ¡£</span><a class="card-more-btn" href="/archives/" title="æŸ¥çœ‹æ›´å¤š">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">åä¸€æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">åæœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">ä¹æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">å…«æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">å…­æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">äº”æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">å››æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">ä¸‰æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" onclick="anzhiyu.switchDarkMode()" title="æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="è¾¹æ æ˜¾ç¤ºæ§åˆ¶"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="çƒ­è¯„å¼€å…³"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="éŸ³ä¹å¼€å…³"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">åŸåˆ›</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/JAVA/" itemprop="url">JAVA</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/SpringCloud/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SpringCloud</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SpringCloud</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-16T01:23:39.000Z" title="å‘è¡¨äº 2023-08-16 09:23:39">2023-08-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-10-07T14:52:34.416Z" title="æ›´æ–°äº 2023-10-07 22:52:34">2023-10-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span id="" data-flag-title="SpringCloud"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="é˜…è¯»é‡">é˜…è¯»é‡:</span><span id="twikoo_visitors" title="è®¿é—®é‡"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="ä½œè€…IPå±åœ°ä¸ºæ±‰ä¸­"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>æ±‰ä¸­</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img01.zzmr.club/img/springcloud.png"></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://jimmy66886.github.io/posts/96a41905.html"><header><a class="post-meta-categories" href="/categories/JAVA/" itemprop="url">JAVA</a><a href="/tags/SpringCloud/" tabindex="-1" itemprop="url">SpringCloud</a><h1 id="CrawlerTitle" itemprop="name headline">SpringCloud</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Jimmy</span><time itemprop="dateCreated datePublished" datetime="2023-08-16T01:23:39.000Z" title="å‘è¡¨äº 2023-08-16 09:23:39">2023-08-16</time><time itemprop="dateCreated datePublished" datetime="2023-10-07T14:52:34.416Z" title="æ›´æ–°äº 2023-10-07 22:52:34">2023-10-07</time></header><p>2023å¹´3æœˆ15æ—¥ 20ç‚¹02åˆ†</p>
<h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><p>å¼€å§‹SpringCloudçš„å­¦ä¹ </p>
<p>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„?<br>æ‰€ä»¥è¯´å­¦è¿™ä¸ªä¸€å®šè¦æ‡‚å¾—SpringBoot</p>
<p>æŠ€æœ¯è¦æ±‚:<br>java8+maven+git,github+<strong>Nginx+RabbitMQ</strong>+SpringBoot2.0</p>
<p>å®Œäº†,ä¸¤ä¸ªæ²¡å­¦</p>
<p>é‚£ç®—äº†,å…ˆæŠŠNginxå’ŒRabbitMQå­¦å®Œå†æ¥äº†</p>
<p>bye</p>
<p>2023å¹´3æœˆ26æ—¥ 11ç‚¹58åˆ†</p>
<p>èŠ±äº†11å¤©,æ‰æŠŠRabbitMQçœ‹å®Œ,åé¢çš„Nginxç”¨åˆ°çš„æ—¶å€™å†ç°å­¦å§</p>
<p>ç»äº†,é˜³å“¥å»ºè®®å…³å¼¹å¹•å­¦ä¹ å“ˆå“ˆå“ˆå“ˆ,å¼¹å¹•è¿˜æ˜¯å¤ªæ‚äº†</p>
<blockquote>
<p><strong>ä¸åœ¨èƒ½çŸ¥,ä¹ƒåœ¨èƒ½è¡Œ</strong></p>
</blockquote>
<h2 id="1-å¾®æœåŠ¡æ¶æ„ä¸SpringCloud"><a href="#1-å¾®æœåŠ¡æ¶æ„ä¸SpringCloud" class="headerlink" title="1 å¾®æœåŠ¡æ¶æ„ä¸SpringCloud"></a>1 å¾®æœåŠ¡æ¶æ„ä¸SpringCloud</h2><blockquote>
<p>å¾®æœåŠ¡æ¶æ„çš„æ¦‚å¿µ</p>
</blockquote>
<p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼,å®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡,æœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒ,äº’ç›¸é…åˆ,ä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼.æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­,æœåŠ¡ä¸æœåŠ¡ä¹‹é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶äº’ç›¸åä½œ(é€šå¸¸æ˜¯HTTPåè®®çš„RESTful API),æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“ä¸šåŠ¡è¿›è¡Œæ„å»º,å¹¶ä¸”èƒ½å¤Ÿè¢«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿæˆç¯å¢ƒ,ç±»ç”Ÿäº§ç¯å¢ƒç­‰.å¦å¤–,åº”å½“å°½é‡é¿å…ç»Ÿä¸€çš„,é›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶,å¯¹å…·ä½“ä¸€ä¸ªæœåŠ¡è€Œè¨€,åº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡,é€‰æ‹©åˆé€‚çš„è¯­è¨€,å·¥å…·å¯¹å…¶è¿›è¡Œæ„å»º.</p>
<blockquote>
<p>SpringCloudæ˜¯ä»€ä¹ˆ</p>
</blockquote>
<p>SpringCloud&#x3D;åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ,æ˜¯å¤šç§å¾®æœåŠ¡æ¶æ„è½åœ°æŠ€æœ¯çš„é›†åˆä½“,ä¿—ç§°å¾®æœåŠ¡å…¨å®¶æ¡¶</p>
<p>SpringCLoudçš„æŠ€æœ¯æ ˆ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731120315.png" alt="20230731120315"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731120510.png" alt="20230731120510"></p>
<h2 id="2-ä»2-2-xå’ŒHç‰ˆå¼€å§‹è¯´èµ·"><a href="#2-ä»2-2-xå’ŒHç‰ˆå¼€å§‹è¯´èµ·" class="headerlink" title="2 ä»2.2.xå’ŒHç‰ˆå¼€å§‹è¯´èµ·"></a>2 ä»2.2.xå’ŒHç‰ˆå¼€å§‹è¯´èµ·</h2><blockquote>
<p>ä¸Šç¯‡å’Œä¸‹ç¯‡</p>
</blockquote>
<ul>
<li>ä¸Šç¯‡:SpringBoot2.Xç‰ˆå’ŒSpringCloud Hç‰ˆ</li>
<li>ä¸‹ç¯‡:SpringCloud Alibaba</li>
</ul>
<p><strong>SpringCloudå’ŒSpringBootä¹‹é—´çš„ä¾èµ–å…³ç³»</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731122342.png" alt="20230731122342"></p>
<p><em>æ‰€ä»¥æˆ‘ä»¬çš„Hè¦é…ä¸Š2.2.x, 2.3.x</em></p>
<p><strong>æˆ–è€…å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¥å£æ¥æŸ¥è¯¢è¿™äº›ä¿¡æ¯</strong>:<a target="_blank" rel="noopener" href="https://start.spring.io/actuator/info">æŸ¥è¯¢é“¾æ¥</a><br>ä½†æ˜¯ç°åœ¨çœ‹,åªæœ‰æœ€æ–°ç‰ˆçš„ä¿¡æ¯äº†:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;spring-cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;2021.0.8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;2022.0.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>è€å¸ˆç»™çš„ç‰ˆæœ¬:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731122852.png" alt="20230731122852"></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé€‰ç‰ˆæœ¬?ä¸èƒ½ç›´æ¥é€‰æœ€æ–°ç‰ˆ?</p>
</blockquote>
<ol>
<li>åªç”¨boot,ç›´æ¥ç”¨æœ€æ–°</li>
<li>åŒæ—¶ç”¨bootå’Œcloud,éœ€è¦ç…§é¡¾cloud,ç”±cloudå†³å®šbootç‰ˆæœ¬</li>
</ol>
<h2 id="3-å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´-x2F-å‡çº§-x2F-æ›¿æ¢"><a href="#3-å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´-x2F-å‡çº§-x2F-æ›¿æ¢" class="headerlink" title="3 å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´&#x2F;å‡çº§&#x2F;æ›¿æ¢"></a>3 å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´&#x2F;å‡çº§&#x2F;æ›¿æ¢</h2><p><em>æŠ€æœ¯å¥½å¤š,å„ä¸ªéƒ¨åˆ†éƒ½æ˜¯æŠ€æœ¯æŠ€æœ¯æŠ€æœ¯</em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731125207.png" alt="20230731125207"></p>
<h2 id="4-å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º"><a href="#4-å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º" class="headerlink" title="4 å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º"></a>4 å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</h2><h3 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h3><p>å»ºçˆ¶å·¥ç¨‹,è¿™è€å¸ˆå¥½æ­£ç»å•Š<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731130457.png" alt="20230731130457"></p>
<p>çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzmr.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç»Ÿä¸€ç®¡ç†jaråŒ…ç‰ˆæœ¬ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬+å­modlueä¸ç”¨å†™groupIdå’Œversion  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Mavenä¸­çš„DependencyManagementå’ŒDependenciesçš„åŒºåˆ«</p>
<p><strong>é€šå¸¸ä¼šåœ¨ä¸€ä¸ªç»„ç»‡æˆ–è€…é¡¹ç›®çš„æœ€é¡¶å±‚çš„çˆ¶POMä¸­çœ‹åˆ°dependecyManagementå…ƒç´ </strong><br>ä½¿ç”¨pom.xmlä¸­çš„dependencyManagementå…ƒç´ èƒ½è®©æ‰€æœ‰åœ¨å­é¡¹ç›®ä¸­å¼•ç”¨çš„ä¾èµ–ä¸ç”¨æ˜¾ç¤ºçš„åˆ—å‡ºç‰ˆæœ¬å·,Mavenä¼šæ²¿ç€çˆ¶å­å±‚æ¬¡å‘ä¸Šèµ°,ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ‹¥æœ‰dependencyManagementå…ƒç´ çš„é¡¹ç›®,ç„¶åå®ƒå°±ä¼šä½¿ç”¨è¿™ä¸ªdependencyManagementå…ƒç´ ä¸­æŒ‡å®šçš„ç‰ˆæœ¬å·</p>
<p><strong>ä½†æ˜¯dependencyManagementé‡Œåªæ˜¯å£°æ˜ä¾èµ–,å¹¶ä¸å®ç°å¼•å…¥,å› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–</strong><br><strong>å¦‚æœä¸åœ¨å­é¡¹ç›®ä¸­å£°æ˜ä¾èµ–,æ˜¯ä¸ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿ä¸‹æ¥çš„,åªæœ‰åœ¨å­é¡¹ç›®ä¸­å†™äº†è¯¥ä¾èµ–é¡¹,å¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬,æ‰ä¼šä½¿ç”¨è¿™é‡Œçš„ä¾èµ–</strong></p>
<h3 id="å»ºç«‹å­æ¨¡å—"><a href="#å»ºç«‹å­æ¨¡å—" class="headerlink" title="å»ºç«‹å­æ¨¡å—"></a>å»ºç«‹å­æ¨¡å—</h3><ol>
<li>å»ºç«‹Module</li>
<li>æ”¹Pom</li>
<li>å†™YML</li>
<li>ä¸»å¯åŠ¨</li>
<li>ä¸šåŠ¡ç±»</li>
</ol>
<p><strong>cloud-provider-payment8001</strong>çš„pom:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzmr.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>æ­£å¼å†™ä¸šåŠ¡é€»è¾‘äº†,è€å¸ˆä¹Ÿæ˜¯ç»™äº†æ­¥éª¤:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731180735.png" alt="20230731180735"></p>
<p>â€¦</p>
<p>è¿˜æ˜¯é‚£äº›æ“ä½œ,å¹¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„,ä½†æ˜¯,è¯´å®è¯,å·²ç»å¿˜äº†å¥½å¤šä¸œè¥¿äº†.</p>
<p><em>çƒ­éƒ¨ç½²æˆ‘å°±ä¸ç”¨äº†,ç”µè„‘å¸¦ä¸åŠ¨</em></p>
<p><strong>cloud-consumer-order80</strong>,æ¶ˆè´¹è€…ä¸‹å•çš„æ¨¡å—,æ­¤æ¨¡å—åªæœ‰controller,è°ƒç”¨payment8001æ¨¡å—çš„å†…å®¹<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731214303.png" alt="20230731214303"></p>
<p>ä½†æ˜¯å¦‚ä½•è°ƒç”¨å‘¢?</p>
<p>è¦ç”¨åˆ°<code>RestTemplate</code>,è¯´å®è¯æ²¡å¬è¯´è¿‡.</p>
<p>å°±æ˜¯å¯ä»¥ä¸€ä¸ªcontrollerè°ƒç”¨å¦ä¸€ä¸ªcontroller?</p>
<p>ä¸€ä¸ªé…ç½®ç±»:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-07-31 21:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ˜¯controlleräº†:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-07-31 21:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥è°ƒç”¨åˆ°äº†?</p>
<p>è¿˜çœŸçš„å¯ä»¥äº†:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731220019.png" alt="20230731220019"></p>
<p>ä¹Ÿå°±æ˜¯è¯´,å½“è°ƒç”¨OrderControllerä¸­çš„getPaymentæ—¶,è¯¥Controllerä¼šå»è°ƒç”¨paymentä¸­çš„getPaymentById,è¿™æ ·å°±å®ç°äº†æœåŠ¡è°ƒç”¨?</p>
<p>è€Œè¿™ä¸ª<code>xxxForObject</code>çš„å‚æ•°åˆ†åˆ«æ˜¯</p>
<ol>
<li>URL(ç›®æ ‡è¯·æ±‚è·¯å¾„)</li>
<li>è¯·æ±‚å‚æ•°(getè¯·æ±‚å°±æ²¡æœ‰è¿™ä¸ªäº†)</li>
<li>è¯·æ±‚è¿”å›ç»“æœç±»å‹</li>
</ol>
<p>ä½†æ˜¯,é‚£ä¸ªcreateè¯·æ±‚,ä¹Ÿèƒ½è¿‡,æ˜¯ä¸ºä»€ä¹ˆå‘¢,æ ¹æœ¬æ²¡æœ‰å¾€è¯·æ±‚ä½“é‡Œæ”¾ä¸œè¥¿å•Š:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230731220644.png" alt="20230731220644"></p>
<p>æ‰€ä»¥æ˜¯è‡ªåŠ¨å°†è·¯å¾„ä¸­çš„å˜é‡å°è£…åˆ°è¯·æ±‚ä½“ä¸­äº†</p>
<h3 id="å·¥ç¨‹é‡æ„"><a href="#å·¥ç¨‹é‡æ„" class="headerlink" title="å·¥ç¨‹é‡æ„"></a>å·¥ç¨‹é‡æ„</h3><p>ç³»ç»Ÿä¸­æœ‰é‡å¤éƒ¨åˆ†,è¦è¿›è¡Œé‡æ„</p>
<p>æ–°å»ºä¸€ä¸ªæ¨¡å—:<code>cloud-api-commons</code>,å¼•å…¥ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°†entitiesæå–å‡ºæ¥,æ”¾åˆ°è¯¥æ¨¡å—ä¸‹,ç„¶åé‡æ–°å®‰è£…(clean,install)<br>æœ€ååœ¨80å’Œ8001ä¸¤ä¸ªæ¨¡å—çš„Pomæ–‡ä»¶ä¸­å¼•å…¥è¯¥æ¨¡å—:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzmr.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>gav</code>è¿™ä¸‰ä¸ªå°±è¡Œäº†</p>
<p><em>å¥¶å¥¶æ»´,ä¸ºä»€ä¹ˆè¿™ä¸ªedgeçœ‹bç«™è§†é¢‘,è¿™ä¹ˆå ç”¨CPU,å°±å¼€ä¸€ä¸ªæ ‡ç­¾,é£æ‰‡å°±ç‹‚è½¬,è€Œchromeæ²¡äº‹</em></p>
<h2 id="5-EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#5-EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="5 EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>5 EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h2><p>ä»ç°åœ¨å°±å¼€å§‹å°†å„ç§springcloudçš„å„ç§æŠ€æœ¯åŠ å…¥åˆ°è¿™å‡ ä¸ªæ¨¡å—ä¸­</p>
<p><code>Eureka</code>å¹´<code>[ju&#39;ri:ke]</code></p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†<br>Spring Cloudå°è£…äº†Netflixå…¬å¸å¼€å‘çš„Eurekaæ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†<br>åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­,ç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚,ç®¡ç†æ¯”è¾ƒå¤æ‚,æ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†,ç®¡ç†æœåŠ¡ä¸æœåŠ¡å™¨ä¹‹é—´çš„å…³ç³»,å¯ä»¥å®ç°æœåŠ¡è°ƒç”¨,è´Ÿè½½å‡è¡¡,å®¹é”™ç­‰,å®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œ</p>
</blockquote>
<hr>
<p>ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801113440.png" alt="20230801113440"><br><strong>ç³»ç»Ÿä¸­æ¯ä¸ªå¾®æœåŠ¡ä¸Eureka ServeræœåŠ¡æ³¨å†Œä¸­å¿ƒç»´æŒå¿ƒè·³è¿æ¥,æ¥è®©Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801113651.png" alt="20230801113651"></p>
<p><strong>EurekaåŒ…å«ä¸¤ä¸ªç»„ä»¶:Eureka Serverå’ŒEureka Client</strong></p>
<ol>
<li>Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡<ul>
<li>å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨å,ä¼šåœ¨EurekaServerä¸­è¿›è¡Œæ³¨å†Œ,è¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯,æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°</li>
</ul>
</li>
<li>Eureka Clienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®<ul>
<li>æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯,ç”¨äºç®€åŒ–EurekaServerçš„äº¤äº’,å®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„,ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨,åœ¨åº”ç”¨å¯åŠ¨å,å°†ä¼šåœ¨EurekaServerå‘é€å¿ƒè·³(é»˜è®¤å‘¨æœŸä¸º30ç§’),å¦‚æœEurekaServeråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³,EurekaServerå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤(é»˜è®¤90ç§’)</li>
</ul>
</li>
</ol>
<hr>
<h3 id="EurekaServeræœåŠ¡ç«¯å®‰è£…"><a href="#EurekaServeræœåŠ¡ç«¯å®‰è£…" class="headerlink" title="EurekaServeræœåŠ¡ç«¯å®‰è£…"></a>EurekaServeræœåŠ¡ç«¯å®‰è£…</h3><p>å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ ·å­:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801115023.png" alt="20230801115023"></p>
<ol>
<li>IDEAç”ŸæˆeurekaServerç«¯æœåŠ¡æ³¨å†Œä¸­å¿ƒ,ç±»ä¼¼ç‰©ä¸šå…¬å¸</li>
</ol>
<p>pom.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzmr.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-eureka-server7001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-eureka-server --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzmr.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--boot web actuator--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http:/$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿™ä¸ªæ”¯æŒæ³¨å†Œä¸­å¿ƒ,æ‰€ä»¥æœ¬èº«å¹¶æ²¡æœ‰ä¸šåŠ¡ç±»</p>
<p>ä½†æ˜¯å¯åŠ¨ç±»ä¸Šè¦åŠ ä¸Š@EnableEurekaServer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-01 12:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaMain7001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801125240.png" alt="20230801125240"></p>
<h3 id="å¾®æœåŠ¡8001å…¥ä½è¿›Eureka-Server"><a href="#å¾®æœåŠ¡8001å…¥ä½è¿›Eureka-Server" class="headerlink" title="å¾®æœåŠ¡8001å…¥ä½è¿›Eureka Server"></a>å¾®æœåŠ¡8001å…¥ä½è¿›Eureka Server</h3><p>EurekaClientç«¯cloud-provider-payment8001å°†æ³¨å†Œè¿›EurekaServeræˆä¸ºæœåŠ¡æä¾›è€…provider,ç±»ä¼¼å°šç¡…è°·å­¦æ ¡å¯¹å¤–æä¾›æˆè¯¾æœåŠ¡</p>
<ol>
<li>æ”¹Pom,æ·»åŠ ä¾èµ–:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>å†™YML<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure></li>
<li>ä¸»å¯åŠ¨<br>åŠ ä¸Š<code>@EnableEurekaClient</code></li>
<li>æµ‹è¯•<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801130232.png" alt="20230801130232"></li>
</ol>
<blockquote>
<p>æœåŠ¡åçš„ç»‘å®šå…³ç³»:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801130344.png" alt="20230801130344"></p>
</blockquote>
<h3 id="EurekeClientç«¯cloud-consumer-order80"><a href="#EurekeClientç«¯cloud-consumer-order80" class="headerlink" title="EurekeClientç«¯cloud-consumer-order80"></a>EurekeClientç«¯cloud-consumer-order80</h3><p>å°†æ³¨å†Œè¿›EurekaServeræˆä¸ºæœåŠ¡æ¶ˆè´¹è€…consumer,ç±»ä¼¼æ¥å°šç¡…è°·ä¸Šè¯¾æ¶ˆè´¹çš„å„ä½åŒå­¦</p>
<p>å°†è¯¥æ¨¡å—çš„pomä¿®æ”¹ä¸º:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span>  </span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ä¸Šé¢ä¸€æ ·çš„æ­¥éª¤,è¿™é‡Œä¸å†èµ˜è¿°<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801131013.png" alt="20230801131013"></p>
<h3 id="é›†ç¾¤é…ç½®"><a href="#é›†ç¾¤é…ç½®" class="headerlink" title="é›†ç¾¤é…ç½®"></a>é›†ç¾¤é…ç½®</h3><p>Eurekaé›†ç¾¤:<strong>äº’ç›¸æ³¨å†Œ,ç›¸äº’å®ˆæœ›</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801133213.png" alt="20230801133213"></p>
<p>æœåŠ¡æ³¨å†Œ:å°†æœåŠ¡ä¿¡æ¯æ³¨å†Œè¿›æ³¨å†Œä¸­å¿ƒ<br>æœåŠ¡å‘ç°:ä»æ³¨å†Œä¸­å¿ƒä¸Šè·å–æœåŠ¡ä¿¡æ¯<br>å®è´¨:å­˜keyæœåŠ¡å,å»valueè°ƒç”¨åœ°å€</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801131820.png" alt="20230801131820"></p>
<blockquote>
<p>é—®é¢˜:å¾®æœåŠ¡RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æœ€æ ¸å¿ƒçš„æ˜¯ä»€ä¹ˆ<br>æ˜¯é«˜å¯ç”¨,æ­å»ºEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤,å®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™</p>
</blockquote>
<ol>
<li><p>å‚è€ƒ7001æ–°å»ºæ¨¡å—7002</p>
</li>
<li><p>ä¿®æ”¹æ˜ å°„é…ç½®(æ¨¡æ‹Ÿå¤šå°æœºå™¨)<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801133937.png" alt="20230801133937"></p>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment"># eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801134626.png" alt="20230801134626"></p>
</li>
</ol>
<h4 id="è®¢å•æ”¯ä»˜ä¸¤å¾®æœåŠ¡æ³¨å†Œè¿›Eurekaé›†ç¾¤"><a href="#è®¢å•æ”¯ä»˜ä¸¤å¾®æœåŠ¡æ³¨å†Œè¿›Eurekaé›†ç¾¤" class="headerlink" title="è®¢å•æ”¯ä»˜ä¸¤å¾®æœåŠ¡æ³¨å†Œè¿›Eurekaé›†ç¾¤"></a>è®¢å•æ”¯ä»˜ä¸¤å¾®æœåŠ¡æ³¨å†Œè¿›Eurekaé›†ç¾¤</h4><p>ä¸»è¦æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line"><span class="comment">#      defaultZone: http://localhost:7001/eureka</span></span><br><span class="line">      <span class="comment"># é›†ç¾¤ç‰ˆ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯åŠ ä¸Šä¸¤ä¸ªåœ°å€å°±è¡Œäº†</p>
<p>?ä¸è¡Œå•Š,ä¸€ç›´æ˜¯åªèƒ½æœ‰ä¸€ä¸ªæœºå­èƒ½æ£€æµ‹åˆ°å¾®æœåŠ¡,è€Œä¸”æ˜¯è°åœ¨å,è°èƒ½æ£€æµ‹åˆ°,é—®é—®chatgptå§</p>
<p>å¥¶å¥¶æ»´,åŸæ¥æ˜¯é›†ç¾¤é‚£é…ç½®é”™äº†</p>
<p>é”™è¯¯:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>
<p>æ­£ç¡®:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯ä¸è¦ç”¨<code>$&#123;server.port&#125;</code>äº†,ç›´æ¥å†™ç›®æ ‡ç«¯å£å·</p>
<h4 id="æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤é…ç½®"><a href="#æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤é…ç½®" class="headerlink" title="æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤é…ç½®"></a>æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤é…ç½®</h4><p>å°±æ˜¯å¢åŠ å¤šä¸ª<code>cloud-provider-payment</code></p>
<p>å‚è€ƒ8001æ–°å»º8002</p>
<p>å…³é”®åœ¨äºè¦éœ€æ”¹8001&#x2F;8002çš„Controller</p>
<p>ä¿®æ”¹ä¹‹åçš„:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-07-31 18:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*****æ’å…¥ç»“æœï¼š&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æ•°æ®æˆåŠŸ,serverPort: &quot;</span> + serverPort, result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ’å…¥æ•°æ®åº“å¤±è´¥&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;******æŸ¥è¯¢æˆåŠŸ:&quot;</span> + payment);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ,serverPort&quot;</span> + serverPort, payment);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ²¡æœ‰å¯¹åº”æ•°æ®,æŸ¥è¯¢IDä¸º&quot;</span> + id, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¤æ—¶é€šè¿‡80è®¿é—®,ä»ç„¶è¿˜æ˜¯åªæœ‰8001æ¥æ”¶åˆ°è¯·æ±‚,é‚£æ˜¯å› ä¸ºconsumeræ¨¡å—ä¸­çš„Controlleræ˜¯å†™æ­»çš„:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>å‘é€è¯·æ±‚çš„è·¯å¾„åº”è¯¥ä¸ºæœåŠ¡å(8001å’Œ8002ä½œä¸ºæœåŠ¡æä¾›æ–¹çš„æœåŠ¡å)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-payment-service&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶åä¸€æµ‹è¯•,å‘ç°ç›´æ¥æŠ¥é”™äº†â€¦å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ,åŸå› æ˜¯å°‘ä¸ªæ³¨è§£<br><strong>è¦ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¤æ—¶é€šè¿‡80å†è®¿é—®,å°±æ˜¯ä¸€æ›¿ä¸€æ¬¡äº†(è½®è¯¢)</strong></p>
<h3 id="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h3><p>å°±æ˜¯åŠ åˆ«å</p>
<p>åŸæ¥çš„æ˜¯è¿™ç§:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801202320.png" alt="20230801202320"></p>
<p>æ˜¯ä¸»æœºåŠ æ¨¡å—å,æˆ‘ä»¬è¦è¿›è¡Œè‡ªå®šä¹‰:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">instance:</span></span><br><span class="line">  <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br></pre></td></tr></table></figure>
<p>åŠ ä¸Šè¿™ä¸ªå°±å¯ä»¥å®ç°æ­¤åŠŸèƒ½äº†:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801202536.png" alt="20230801202536"></p>
<p>åŠ ä¸Šè¿™ä¸ªå°±å¯ä»¥å®ç°<strong>æ˜¾ç¤ºipåœ°å€äº†</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">instance:</span><br><span class="line">  instance-id: payment8001</span><br><span class="line">  prefer-ip-address: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>åœ¨é¼ æ ‡æµ®åœ¨payment800xä¸Šå°±ä¼šæ˜¾ç¤ºipåœ°å€:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801202852.png" alt="20230801202852"></p>
<h3 id="æœåŠ¡å‘ç°Discovery"><a href="#æœåŠ¡å‘ç°Discovery" class="headerlink" title="æœåŠ¡å‘ç°Discovery"></a>æœåŠ¡å‘ç°Discovery</h3><p><em>æ´—æ¾¡å»,ä¸€ä¼šå†çœ‹</em></p>
<p><strong>ç®€å•æ¥è¯´,å°±æ˜¯æš´éœ²è‡ªå·±çš„æœåŠ¡ä¿¡æ¯</strong></p>
<ol>
<li>æ·»åŠ æ–°çš„å¯¹è±¡:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ æµ‹è¯•:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/discovery&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æœåŠ¡æ¸…å•åˆ—è¡¨</span></span><br><span class="line">    List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">    <span class="keyword">for</span> (String service : services) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;*****element: &quot;</span> + service);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹åº”å¾®æœåŠ¡åç§°å«æœ‰çš„å¾®æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;*****element: &quot;</span> + instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>å°±å®Œå·¥äº†</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801205614.png" alt="20230801205614"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801205638.png" alt="20230801205638"></p>
<h3 id="Eurekaè‡ªæˆ‘ä¿æŠ¤"><a href="#Eurekaè‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="Eurekaè‡ªæˆ‘ä¿æŠ¤"></a>Eurekaè‡ªæˆ‘ä¿æŠ¤</h3><p><strong>æ¦‚è¿°</strong><br>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤,<strong>ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼,EurekaServerå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯,ä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®,ä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡</strong></p>
<p><strong>å°±æ˜¯,æŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†,Eurekaä¸ä¼šç«‹åˆ»æ¸…ç†,ä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜</strong></p>
<hr>
<p>æ€ä¹ˆç¦æ­¢?</p>
<p>7001æ¨¡å—ä¸ŠåŠ </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230801211950.png" alt="20230801211950"></p>
<p>8001æ¨¡å—åŠ ä¸Š:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">instance:</span></span><br><span class="line">  <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">  <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”,å•ä½ä¸ºç§’,é»˜è®¤æ˜¯30s</span></span><br><span class="line">  <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å°±ä¼šéå¸¸çš„<code>æ— æƒ…</code></p>
<h2 id="6-ZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#6-ZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="6 ZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>6 ZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°</h2><p>SpringCloudæ•´åˆZookeeperä»£æ›¿Eureka-Eurekaå·²ç»åœæ­¢æ›´æ–°äº†</p>
<p><strong>æ³¨å†Œä¸­å¿ƒZookeeper</strong></p>
<ul>
<li>zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·,å¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½</li>
<li>å…³é—­LinuxæœåŠ¡å™¨é˜²ç«å¢™åå¯åŠ¨zookeeperæœåŠ¡å™¨</li>
<li>zookeeperæœåŠ¡å™¨å–ä»£EurekaæœåŠ¡å™¨,zkä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ</li>
</ul>
<p><strong>è¿™è€å¸ˆæ²¡è®²å¦‚ä½•å®‰è£…</strong></p>
<ol>
<li>ä¸‹è½½:<a target="_blank" rel="noopener" href="https://downloads.apache.org/zookeeper/zookeeper-3.5.10/">é“¾æ¥</a></li>
<li>è§£å‹:<code>tar -zxvf apache-zookeeper-3.5.10-bin.tar.gz</code></li>
<li>æ–°å»ºé…ç½®æ–‡ä»¶:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802100034.png" alt="20230802100034"></li>
</ol>
<p>è¿™æ ·å°±OKäº†</p>
<h3 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h3><p>æ–°å»ºä¸€ä¸ªmodule:<code>cloud-provider-payment8004</code></p>
<p>ä¸€ä¸ªæ–°çš„ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">192.168</span><span class="number">.168</span><span class="number">.101</span><span class="string">:2181</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ä½¿ç”¨zookeeper,å°±ä¸ä¼šå†ä½¿ç”¨eurekaçš„æ³¨è§£äº†:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8004</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentZk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;spring-cloud with zookeeper: &quot;</span> + serverPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è¿›è¡Œæµ‹è¯•,å…ˆå°†zookeeperå¯åŠ¨,ç„¶åå¯åŠ¨8004</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802100055.png" alt="20230802100055"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802100152.png" alt="20230802100152"></p>
<p>ç„¶åå°±è¿›å…¥åˆ°å®¢æˆ·ç«¯é‡Œäº†?<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802100235.png" alt="20230802100235"></p>
<p>æˆ‘çš„æ˜¯å¥½äº†,å› ä¸ºspringcloudé»˜è®¤å¸¦çš„æ˜¯3.5.3,æˆ‘è£…çš„æ˜¯3.5.10,æ‰€ä»¥èƒ½å…¼å®¹,ä½†æ˜¯è€å¸ˆçš„æ˜¯3.4.9,æ‰€ä»¥ä»–è¦è§£å†³ä¸€ä¸‹jaråŒ…å†²çªçš„é—®é¢˜:</p>
<p>è€å¸ˆæ¢æˆäº†:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶,ä»–ä¸‹é¢æ˜¯3.4.9,é‚£æˆ‘å°±3.5.10å‘—</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802101107.png" alt="20230802101107"></p>
<p>è¿™å°±è¯æ˜è¿ä¸Šäº†:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802101133.png" alt="20230802101133"></p>
<p>è®¿é—®æ¥å£ä¹Ÿæ˜¯æ²¡é—®é¢˜:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802101242.png" alt="20230802101242"></p>
<p>å±‚çº§é€’è¿›:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802101429.png" alt="20230802101429"></p>
<p>è€Œæ³¨å†Œä¿¡æ¯åœ¨è¿™:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloud-provider-payment&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2831e6f2-adc0-4056-9112-430c35849cad&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">8004</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sslPort&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.springframework.cloud.zookeeper.discovery.ZookeeperInstance&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloud-provider-payment&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;registrationTimeUTC&quot;</span><span class="punctuation">:</span> <span class="number">1690942240064</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serviceType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DYNAMIC&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uriSpec&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;parts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scheme&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;variable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;://&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;variable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;address&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;variable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;:&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;variable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;port&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;variable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¯æ˜æˆ‘ä»¬çš„å¾®æœåŠ¡æˆåŠŸå…¥ä½è¿›zookeeper</p>
<hr>
<p>é‚£ä¹ˆæœåŠ¡èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹è¿˜æ˜¯æŒä¹…èŠ‚ç‚¹</p>
<p>å½“8004æœåŠ¡å…³é—­æ—¶,è¿‡å‡ ç§’é’Ÿzookeeperå°±ä¼šå°†è¯¥æœåŠ¡åˆ å»</p>
<h3 id="è®¢å•æœåŠ¡æ³¨å†Œè¿›Zookeeper"><a href="#è®¢å•æœåŠ¡æ³¨å†Œè¿›Zookeeper" class="headerlink" title="è®¢å•æœåŠ¡æ³¨å†Œè¿›Zookeeper"></a>è®¢å•æœåŠ¡æ³¨å†Œè¿›Zookeeper</h3><p>æ–°å»ºä¸€ä¸ª<code>cloud-consumerzk-order80</code></p>
<p>ä¾èµ–å’Œä¹‹å‰çš„8004ä¸€æ ·</p>
<p>ymlä¹Ÿæ˜¯å·®ä¸å¤š,åªæ˜¯æŠŠç«¯å£å·æ”¹ä¸º80,æœåŠ¡åæ”¹ä¸ºæ¶ˆè´¹è€…çš„æœåŠ¡å</p>
<p>è¿˜æ˜¯è¦ç”¨åˆ°restTemplate,ç„¶åå†™ä¸€ä¸ªç®€å•çš„controlleræµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderZKController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/payment/zk&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802104142.png" alt="20230802104142"></p>
<p>æµ‹è¯•servicesä¸­å°±æœ‰äº†æ–°çš„æœåŠ¡:<code>cloud-consumerzk-order80</code></p>
<p>å†æµ‹è¯•æ¥å£:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802104244.png" alt="20230802104244"></p>
<p>è®¿é—®æˆåŠŸ,ä¹Ÿæ²¡é—®é¢˜</p>
<h2 id="7-ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#7-ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="7 ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>7 ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°</h2><p>Consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿ,Goè¯­è¨€å¼€å‘</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><a target="_blank" rel="noopener" href="https://developer.hashicorp.com/consul/downloads?product_intent=consul">å®‰è£…ç½‘ç«™</a></p>
<p>è§£å‹,åŒå‡»è¿è¡Œ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802214724.png" alt="20230802214724"></p>
<p>å¯åŠ¨:<code>consul agent -dev</code></p>
<p>è®¿é—®<code>localhost:8500</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802214930.png" alt="20230802214930"></p>
<h3 id="æœåŠ¡æä¾›è€…æ³¨å†Œ"><a href="#æœåŠ¡æä¾›è€…æ³¨å†Œ" class="headerlink" title="æœåŠ¡æä¾›è€…æ³¨å†Œ"></a>æœåŠ¡æä¾›è€…æ³¨å†Œ</h3><p>å»ºä¸€ä¸ª8006:å¾®æœåŠ¡æä¾›è€…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>yml:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ˜¯ç¼–å†™æ¥å£</p>
<p>å¥½äº†,å·²ç»æ³¨å†Œè¿›å»äº†:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802215943.png" alt="20230802215943"></p>
<p>æ¥å£ä¹Ÿæ³¨å†ŒæˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802220031.png" alt="20230802220031"></p>
<h3 id="æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œ"><a href="#æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œ"></a>æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œ</h3><p>è¿˜æ˜¯è¿™äº›æ­¥éª¤,</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consumer-order</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802220705.png" alt="20230802220705"></p>
<p>æµ‹è¯•ä¹Ÿæ˜¯æ²¡é—®é¢˜:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802220804.png" alt="20230802220804"></p>
<h3 id="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹"><a href="#ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹" class="headerlink" title="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹"></a>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230802221110.png" alt="20230802221110"></p>
<p>åˆ†ä¸ºCPå’ŒAP</p>
<p>AP:eureka<br>CP:Zookeeper&#x2F;consul</p>
<p>APæ¶æ„ä¸­,å½“ç½‘ç»œåˆ†åŒºå‡ºç°å,ä¸ºäº†ä¿è¯å¯ç”¨æ€§,ç³»ç»ŸBå¯ä»¥è¿”å›æ—§å€¼,ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§</p>
<p>ç»“è®º:è¿èƒŒäº†ä¸€æ‰§è¡ŒCçš„è¦æ±‚,åªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™,å³AP</p>
<p>CPæ¶æ„,ä¸ºäº†ä¿è¯ä¸€è‡´æ€§,å°±å¿…é¡»æ‹’æ¥è¯·æ±‚,å¦åˆ™æ— æ³•ä¿è¯ä¸€æ‰§è¡Œ</p>
<p>ç»“è®º:è¿èƒŒäº†å¯ç”¨æ€§Açš„è¦æ±‚,åªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™,å³CP</p>
<h2 id="8-Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨"><a href="#8-Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨" class="headerlink" title="8 Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨"></a>8 Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨</h2><blockquote>
<p>æ¦‚è¿°<br>ç®€å•æ¥è¯´,Ribbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®,ä¸»è¦åŠŸèƒ½æ˜¯æä¾›<strong>å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨</strong>,åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancer(ç®€ç§°LB)åé¢æ‰€æœ‰çš„æœºå™¨,Ribbonä¼šè‡ªåŠ¨å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™(ç®€å•è½®è¯¢,éšæœºè¿æ¥)å»è¿æ¥è¿™äº›æœºå™¨,æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•</p>
</blockquote>
<blockquote>
<p>LBè´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ<br>å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Š,è€Œè¾¾åˆ°ç³»ç»Ÿçš„HA(é«˜å¯ç”¨)<br>å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginx,LVS,ç¡¬ä»¶F5ç­‰</p>
</blockquote>
<p><strong>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«</strong><br>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡,å®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginx,ç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚,å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„<br>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡,åœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶,ä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°,ä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯</p>
<hr>
<p><strong>é›†ä¸­å¼LB</strong><br>å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½(å¯ä»¥æ˜¯ç¡¬ä»¶å¦‚F5,ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶,å¦‚nginx),ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹</p>
<p><strong>è¿›ç¨‹å†…LB</strong><br>å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹,æ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨,ç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨</p>
<p>Ribbonå°±å±äºè¿›ç¨‹å†…LB,å®ƒåªæ˜¯ä¸€ä¸ªç±»åº“,é›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹,æ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€</p>
<p><strong>æ€»ç»“</strong><br>Ribbonå…¶å®å°±æ˜¯ä¸€ä¸ªè½¯è´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯ç»„ä»¶,å®ƒå¯ä»¥å’Œå…¶ä»–æ‰€éœ€è¯·æ±‚çš„å®¢æˆ·ç«¯ç»“åˆä½¿ç”¨,å’Œeurekaç»“åˆåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®ä¾‹</p>
<p>Ribbonçš„å·¥ä½œæµç¨‹</p>
<ol>
<li>é€‰æ‹©EurekaServer,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€åŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server</li>
<li>æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥,ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€<br>å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥,æ¯”å¦‚è½®è¯¢,éšæœºå’Œæ ¹æ®ç›¸åº”æ—¶é—´åŠ æƒ</li>
</ol>
<hr>
<p>ä¹‹å‰å†™çš„80å¹¶æ²¡æœ‰å¼•å…¥spring-cloud-starter-ribbon,ä¹Ÿå¯ä»¥ä½¿ç”¨ribbon,é‚£æ˜¯å› ä¸ºeurekaä¸­åŒ…å«äº†ribbon<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803105612.png" alt="20230803105612"></p>
<h3 id="è¯¦è§£RestTemplate"><a href="#è¯¦è§£RestTemplate" class="headerlink" title="è¯¦è§£RestTemplate"></a>è¯¦è§£RestTemplate</h3><p>ä¸¤ç§æ–¹æ³•:</p>
<ol>
<li>xxxForObject<ul>
<li>è¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬æ¢æˆçš„å¯¹è±¡,åŸºæœ¬ä¸Šå°±æ˜¯json</li>
</ul>
</li>
<li>xxxForEntity<ul>
<li>è¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡,åŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯,æ¯”å¦‚å“åº”å¤´,å“åº”çŠ¶æ€ç ,å“åº”ä½“ç­‰<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803110122.png" alt="20230803110122"></li>
</ul>
</li>
</ol>
<p>æµ‹è¯•ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.getForEntity(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful())&#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>,<span class="string">&quot;æ“ä½œå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/postForEntity/create&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create2</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.postForEntity(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;æ“ä½œå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡é—®é¢˜:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803111235.png" alt="20230803111235"></p>
<p>å…¶å®å°±æ˜¯entityæ¯”objectè¿”å›çš„ç»“æœæ¯”è¾ƒå¤šä¸€äº›,ä½†æ˜¯è¿˜æ˜¯objectæ¯”è¾ƒå¸¸ç”¨</p>
<h3 id="Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™"><a href="#Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™" class="headerlink" title="Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™"></a>Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™</h3><p>IRule:æ ¹æ®ç‰¹å®šç®—æ³•ä¸­ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡</p>
<p>è¿™ä¸ªæ¥å£çš„å®ç°:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803205441.png" alt="20230803205441"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803205504.png" alt="20230803205504"></p>
<p><strong>è§„åˆ™æ›¿æ¢</strong></p>
<ol>
<li>ä¿®æ”¹cloud-consumer-order80<ul>
<li>å®˜æ–¹æ–‡æ¡£æ˜ç¡®ç»™å‡ºäº†è­¦å‘Š,è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“é’±åŒ…ä»¥åŠå­åŒ…ä¸‹,å¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«,è¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803210131.png" alt="20230803210131"></li>
</ul>
</li>
<li>é…ç½®ç±»:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfRule</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>(); <span class="comment">// è‡ªå®šä¹‰ä¸ºéšæœº        </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>åœ¨ä¸»æœºå¯åŠ¨ç±»ä¸ŠåŠ ä¸Š<code>@RibbonClient(name = &quot;CLOUD_PAYMENT_SERVICE&quot;, configuration = MySelfRule.class)</code></li>
</ol>
<p>å¯åŠ¨æœåŠ¡å³å¯</p>
<h3 id="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"></a>Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</h3><p><em>æ‰‹å†™ä¸€ä¸ª</em></p>
<p><strong>è´Ÿè½½å‡è¡¡ç®—æ³•: restæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° <code>%</code> æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ &#x3D; å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ,æ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹</strong></p>
<p>æ€»æœºå™¨æ•°æ˜¯2,é‚£ä¹ˆç¬¬ä¸€æ¬¡è¯·æ±‚1 å¯¹2å–ä½™,åˆ™ä¸‹æ ‡ä¸º1,åˆ™æ˜¯ç¬¬äºŒå°æœºå™¨<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803212755.png" alt="20230803212755"></p>
<p><em>å¥½åƒè¿˜æŒºç®€å•çš„,ä½†æ˜¯æ€ä¹ˆå®ç°å‘¢</em></p>
<p>æºç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lb == <span class="literal">null</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;no load balancer&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (server == <span class="literal">null</span> &amp;&amp; count++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br><span class="line">            List&lt;Server&gt; allServers = lb.getAllServers();</span><br><span class="line">            <span class="type">int</span> <span class="variable">upCount</span> <span class="operator">=</span> reachableServers.size();</span><br><span class="line">            <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allServers.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((upCount == <span class="number">0</span>) || (serverCount == <span class="number">0</span>)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;No up servers available from load balancer: &quot;</span> + lb);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">nextServerIndex</span> <span class="operator">=</span> incrementAndGetModulo(serverCount);</span><br><span class="line">            server = allServers.get(nextServerIndex);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">/* Transient. */</span></span><br><span class="line">                Thread.yield();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;</span><br><span class="line">                <span class="keyword">return</span> (server);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Next.</span></span><br><span class="line">            server = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span></span><br><span class="line">                    + lb);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å–ä¸‹æ ‡çš„æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Inspired by the implementation of &#123;<span class="doctag">@link</span> AtomicInteger#incrementAndGet()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modulo The modulo to bound the value of the counter.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The next value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">incrementAndGetModulo</span><span class="params">(<span class="type">int</span> modulo)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> nextServerCyclicCounter.get();</span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> (current + <span class="number">1</span>) % modulo;</span><br><span class="line">        <span class="keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next))</span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰‹å†™ä¸€ä¸ª"><a href="#æ‰‹å†™ä¸€ä¸ª" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª"></a>æ‰‹å†™ä¸€ä¸ª</h3><ol>
<li>æ”¹å†™8001&#x2F;8002çš„Controller<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/lb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPaymentLB</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ApplicationContextConfigä¸­å»æ‰<code>@LoadBalanced</code>æ³¨è§£</li>
<li>ç¼–å†™æ¥å£å’Œå®ç°ç±»:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.lb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-03 21:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line"></span><br><span class="line">    ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLB</span> <span class="keyword">implements</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> current;</span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            current = <span class="built_in">this</span>.atomicInteger.get();</span><br><span class="line">            next = current == <span class="number">2147483647</span> ? <span class="number">0</span> : current + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!<span class="built_in">this</span>.atomicInteger.compareAndSet(current, next));</span><br><span class="line">        System.out.println(<span class="string">&quot;****ç¬¬å‡ æ¬¡è®¿é—®,æ¬¡æ•°next:&quot;</span> + next);</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> getAndIncrement() % serviceInstances.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> serviceInstances.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>æ”¹å†™çš„controller:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/lb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPaymentLB</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (instances == <span class="literal">null</span> || instances.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æœåŠ¡ä¼ ç»™è´Ÿè´£è´Ÿè½½å‡è¡¡çš„é…ç½®</span></span><br><span class="line">    <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancer.instances(instances);</span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(uri + <span class="string">&quot;/payment/lb&quot;</span>, String.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>æµ‹è¯•æˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230803221218.png" alt="20230803221218"></p>
<p>å—¯,è¿˜æœ‰å¥½å¤šè¦å­¦å•Š</p>
<p>åå¤©å°±å»è¥¿å®‰å§</p>
<h2 id="9-OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"><a href="#9-OpenFeignæœåŠ¡æ¥å£è°ƒç”¨" class="headerlink" title="9 OpenFeignæœåŠ¡æ¥å£è°ƒç”¨"></a>9 OpenFeignæœåŠ¡æ¥å£è°ƒç”¨</h2><p>OpenFeignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebSeviceå®¢æˆ·ç«¯,ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•<br><strong>å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£</strong></p>
<p><strong>Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230804090820.png" alt="20230804090820"> </p>
<h3 id="OpenFeignä½¿ç”¨"><a href="#OpenFeignä½¿ç”¨" class="headerlink" title="OpenFeignä½¿ç”¨"></a>OpenFeignä½¿ç”¨</h3><p>æ–°å»º<code>cloud-consumer-feign-order80</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure>
<p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£,è¿™ä¸ªå°±æœ‰æ„æ€äº†ä¸€ä¸ªæ³¨è§£åŠ æ¥å£,ç›´æ¥è¡¨ç¤ºæ‰¾åˆ°<code>CLOUD-PAYMENT-SERVICE</code>æœåŠ¡ä¸­çš„<code>/payment/get&#123;id&#125;</code>æ¥å£(è™½ç„¶åœ¨serviceä¸­å†™äº†Mappingå°±ç¦»è°±å“ˆå“ˆå“ˆ)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±ä¸ç”¨å†å†™restTemplateäº†,å› ä¸ºopenfeignå·²ç»å°è£…äº†,åœ¨serviceæ¥å£ä¸­å·²ç»å®ç°äº†è¯¥åŠŸèƒ½</p>
<p>æ²¡é—®é¢˜:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230804094528.png" alt="20230804094528"></p>
<p>çªç„¶æ„Ÿè§‰ä¹Ÿæ˜¯å¥½æ¸…æ™°å•Š,ä½†æ˜¯å¦‚æœç”¨äº†è¿™ä¸ªOpenFeign,é‚£ä¹ˆå¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„ç®—æ³•å‘¢?<em>æˆ‘åº”è¯¥ç”¨ä¸åˆ°</em></p>
<h3 id="OpenFeignçš„è¶…æ—¶æ§åˆ¶"><a href="#OpenFeignçš„è¶…æ—¶æ§åˆ¶" class="headerlink" title="OpenFeignçš„è¶…æ—¶æ§åˆ¶"></a>OpenFeignçš„è¶…æ—¶æ§åˆ¶</h3><p><strong>æ•…æ„è®¾ç½®è¶…æ—¶æ¼”ç¤ºå‡ºé”™æƒ…å†µ</strong><br>8001æ¥å£ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>80ç«¯å£è¿›è¡Œè°ƒç”¨,å‡ºç°è¶…æ—¶æŠ¥é”™<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230804100021.png" alt="20230804100021"></p>
<p>æ‰€ä»¥å¯ä»¥ä¿®æ”¹Feignå®¢æˆ·ç«¯çš„ç­‰å¾…æ—¶é—´,åœ¨ymlé…ç½®æ–‡ä»¶ä¸­è®¾ç½®</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230804100343.png" alt="20230804100343"></p>
<h3 id="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"><a href="#OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½" class="headerlink" title="OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½"></a>OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½</h3><p>Feignæä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½,æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«,ä»è€Œäº†è§£Feignä¸­httpè¯·æ±‚çš„ç»†èŠ‚</p>
<p>è¯´ç™½äº†å°±æ˜¯<strong>å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</strong></p>
<p>æ—¥å¿—çº§åˆ«:</p>
<ul>
<li>NONE: é»˜è®¤çš„,ä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—</li>
<li>BASIC: ä»…è®°å½•è¯·æ±‚æ–¹æ³•,URL,å“åº”çŠ¶æ€ç ä»¥åŠæ‰§è¡Œæ—¶é—´</li>
<li>HEADERS: é™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–,è¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li>
<li>FULL: é™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–,è¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®</li>
</ul>
<p>é…ç½®ç±»:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span></span><br><span class="line">    <span class="attr">com.zzmr.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<p>æ²¡é—®é¢˜:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230804101230.png" alt="20230804101230"></p>
<h2 id="10-Hystrix"><a href="#10-Hystrix" class="headerlink" title="10 Hystrix"></a>10 Hystrix</h2><p>è¿™å°±å·²ç»åˆ°äº†<code>æœåŠ¡é™çº§</code>äº†</p>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</strong><br>å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»,æ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥</p>
<p>Histrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“,åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œ,è®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥,æ¯”å¦‚è¶…å¸‚,å¼‚å¸¸ç­‰,Hystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹,<strong>ä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥,é¿å…çº§è”æ•…éšœ,ä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§</strong></p>
<p><strong>æ–­è·¯å™¨</strong>æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®,å½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹å,é€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§(ç±»ä¼¼ç†”æ–­ä¿é™©ä¸),å‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„,å¯å¤„ç†çš„å¤‡é€‰å“åº”(FallBack),è€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ³•æ— æ³•å¤„ç†çš„å¼‚å¸¸,è¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´,ä¸å¿…è¦åœ°å ç”¨,ä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶,ä¹ƒè‡³é›ªå´©</p>
<h3 id="Hystrixé‡è¦æ¦‚å¿µ"><a href="#Hystrixé‡è¦æ¦‚å¿µ" class="headerlink" title="Hystrixé‡è¦æ¦‚å¿µ"></a>Hystrixé‡è¦æ¦‚å¿µ</h3><ol>
<li>æœåŠ¡é™çº§<ul>
<li>å¯¹æ–¹ç³»ç»Ÿä¸å¯ç”¨äº†,ä½ éœ€è¦ç»™æˆ‘ä¸€ä¸ªå…œåº•çš„è§£å†³æ–¹æ³•</li>
<li>ç¨‹åºè¿è¡Œå¼‚å¸¸</li>
<li>è¶…æ—¶</li>
<li>æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</li>
<li>çº¿ç¨‹æ± &#x2F;ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</li>
</ul>
</li>
<li>æœåŠ¡ç†”æ–­<ul>
<li>ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®å,ç›´æ¥æ‹’ç»è®¿é—®,æ‹‰é—¸é™ç”µ,ç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º</li>
</ul>
</li>
<li>æœåŠ¡é™æµ<ul>
<li>ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œ,ä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤,å¤§å®¶æ’é˜Ÿ,ä¸€ç§’é’ŸNä¸ª,æœ‰åºè¿›è¡Œ</li>
</ul>
</li>
</ol>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ–°å»º:<code>cloud-provider-hystrix-payment8001</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p>å†™æµ‹è¯•æ–¹æ³•,å¹¶ä»¥ä¸Šè¿°æ–¹æ³•ä¸ºæ ¹åŸºå¹³å°<br><code>æ­£ç¡®-é”™è¯¯-é™çº§ç†”æ–­-æ¢å¤</code></p>
<p>é«˜å¹¶å‘æµ‹è¯•:<br>å¼€å¯Jmeter,æ¥20000ä¸ªå¹¶å‘å‹æ­»8001,20000ä¸ªè¯·æ±‚éƒ½å»è®¿é—®paymentinfo_Timeout</p>
<p>æ²¡æœ‰å•Š,çœ‹ä¸€ä¸‹å¾—äº†</p>
<p>ç»™timeoutå‘20000ä¸ªè¯·æ±‚,æ­¤æ—¶okä¹Ÿè¢«æ‹–æ…¢äº†,å› ä¸ºè¿™ä¸ªå¾®æœåŠ¡é›†ä¸­èµ„æºéƒ½å»ç»™timeoutæ¥å£å¤„ç†äº†</p>
<p>ä¸Šé¢è¿˜æ˜¯æœåŠ¡<strong>æä¾›è€…8001è‡ªæµ‹</strong>,å‡å¦‚æ­¤æ—¶å¤–éƒ¨çš„æ¶ˆè´¹è€…80ä¹Ÿæ¥è®¿é—®,é‚£æ¶ˆè´¹è€…åªèƒ½å¹²ç­‰,æœ€ç»ˆå¯¼è‡´æ¶ˆè´¹è€…ç«¯80ä¸æ»¡æ„,æœåŠ¡ç«¯8001ç›´æ¥è¢«æ‹–æ­»</p>
<hr>
<p>å¥½ä¹…æ²¡çœ‹äº†,çªç„¶å‘ç°,hostæ–‡ä»¶é‡Œçš„å†…å®¹è¢«åˆ é™¤äº†â€¦</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1		eureka7001.com</span><br><span class="line">127.0.0.1		eureka7002.com</span><br></pre></td></tr></table></figure>

<p>å‹æµ‹ä¹‹åå¾—åˆ°çš„ç»“æœ:<br>8001åŒä¸€å±‚æ¬¡çš„å…¶ä»–æ¥å£æœåŠ¡è¢«å›°æ­»,å› ä¸ºtomcatçº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•,80æ­¤æ—¶è°ƒç”¨8001,å®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢,è½¬åœˆåœˆâ€¦</p>
<p>å“¦,åˆ°ç°åœ¨å¹¶æ²¡æœ‰å¼€å§‹ç”¨hystrixçš„åŠŸèƒ½å“å“ˆå“ˆå“ˆå“ˆæ“</p>
<p>è§£å†³æ–¹æ¡ˆ:</p>
<ol>
<li>å¯¹æ–¹æœåŠ¡8001è¶…æ—¶äº†,è°ƒç”¨è€…80ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…,å¿…é¡»æœ‰æœåŠ¡é™çº§</li>
<li>å¯¹æ–¹æœåŠ¡8001downæœºäº†,è°ƒç”¨è€…80ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…,å¿…é¡»æœ‰æœåŠ¡é™çº§</li>
<li>å¯¹æ–¹æœåŠ¡8001OK,è°ƒç”¨è€…80è‡ªå·±å‡ºæ•…éšœæœ‰è‡ªæˆ‘è¦æ±‚(è‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…)</li>
</ol>
<hr>
<h4 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h4><p>é™çº§é…ç½®:<code>@HystrixCommand</code></p>
<p>ç»™8001è‡ªèº«è®¾ç½®è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼,å³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œ,è¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†,ä½œæœåŠ¡é™çº§fallback</p>
<p>è¿™æ ·å†™:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeoutHandler&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span></span><br><span class="line"><span class="meta">        // 3sä»¥å†…,èµ°æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘,3sä»¥ä¸Š,å°±ä¼šè°ƒç”¨å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfo_Timeout</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">timeNumber</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(timeNumber);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± : &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_Timeout &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;å“ˆå“ˆå“ˆå“ˆå“ˆ&quot;</span> + <span class="string">&quot;è€—æ—¶: &quot;</span> + timeNumber + <span class="string">&quot;s&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeoutHandler</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± : &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeoutHandler &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;å˜¿å˜¿å˜¿&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„paymentInfo_TimeoutHandlerå°±ç›¸å½“äºå…œåº•çš„æ–¹æ³•,å½“paymentInfo_Timeouté¸¡äº†ä¹‹å,å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•</p>
<p><strong>æœ€ååœ¨ä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šå¯åŠ¨è¯¥æ³¨è§£çš„æ³¨è§£</strong><code>@EnableCircuitBreaker</code></p>
<p>ä¸€èˆ¬æœåŠ¡é™çº§éƒ½æ˜¯æ”¾åœ¨å®¢æˆ·ç«¯çš„,å°±æ˜¯æ¡ˆä¾‹ä¸­çš„80</p>
<p>80ç«¯çš„é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸»å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šæ³¨è§£:<code>@EnableHystrix</code></p>
<p>controllerä¸ŠåŠ å…¥:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;1500&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_Timeout(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>é—®é¢˜:<br>æ¯ä¸€ä¸ªæ–¹æ³•éƒ½éœ€è¦å…œåº•çš„æ–¹æ³•,ä»£ç è†¨èƒ€<br>å’Œä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·,æ··ä¹±</p>
<p>æ‰€ä»¥å°±æœ‰äº†å…¨å±€çš„å…œåº•æ–¹æ³•</p>
<p>é™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±,å…¶å®ƒæ™®é€šçš„å¯ä»¥é€šè¿‡&#96;@DefaultProperties(defaultFallback&#x3D;â€â€)ç»Ÿä¸€è·³è½¬åˆ°ç»Ÿä¸€å¤„ç†ç»“æœé¡µé¢,é€šè¿‡çš„å’Œç‹¬äº«çš„å„è‡ªåˆ†å¼€,é¿å…äº†ä»£ç è†¨èƒ€,åˆç†å‡å°‘äº†ä»£ç é‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-14 21:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystrixController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// @HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;, commandProperties = &#123;</span></span><br><span class="line">    <span class="comment">//         @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;4000&quot;)</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_Timeout(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">payment_Global_FallbackMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯,è¯·ç¨åå†è¯•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>Hystrixä¹‹é€šé…æœåŠ¡é™çº§</strong></p>
<p>ç°åœ¨æ˜¯æ”¹å†™æ¥å£,å®ç°é€šé…çš„æœåŠ¡é™çº§</p>
<p>æœåŠ¡é™çº§,å®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯,ç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­,æœ¬æ¬¡å®ä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„,ä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»,åªéœ€è¦ä¸ºFeignå®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦</p>
<p>æ ¹æ®cloud-consumer-feign-hystrix-order80å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£,é‡æ–°æ–°å»ºä¸€ä¸ªç±»(PaymentFallbackService)å®ç°è¯¥æ¥å£,<strong>ç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†</strong></p>
<p>PaymentFallbackServiceç±»å®ç°PaymentFeignClientServiceæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-14 23:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;--------PaymentFallbackService fall back ,ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_Timeout</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;--------PaymentFallbackService fall back ,error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ”¹å†™åŸæ¥å£:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-14 20:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_Timeout</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h4><p>ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®å,ç›´æ¥æ‹’ç»è®¿é—®,æ‹‰é—¸é™ç”µ,ç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º</p>
<p><strong>å°±æ˜¯ä¿é™©ä¸,æœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯</strong></p>
<p><strong>å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸å,å¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯</strong></p>
<p>åœ¨Spring Cloudæ¡†æ¶é‡Œ,ç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°,Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µ,å½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼,ç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥,å°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶,ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯<code>@HystrixCommand</code></p>
<hr>
<p>å®æ“</p>
<p>ä¿®æ”¹cloud-provider-hystrix-payment8001</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=========æœåŠ¡ç†”æ–­</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;, value = &quot;10000&quot;),</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;60&quot;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;******id ä¸èƒ½è´Ÿæ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">serialNumber</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot;</span> + serialNumber;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~   id: &quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>åŸºæœ¬å°±æ˜¯,å…ˆå¤§é‡è®¿é—®å¤±è´¥,å¯¼è‡´ç³»ç»Ÿè®¤ä¸ºè¯¥æœåŠ¡ä¸å¤ªè¡Œ,ç„¶åå°±ä¼šå°†æ‰€æœ‰çš„è¯·æ±‚åˆ°äº¤ç»™æ–­è·¯å™¨è§£å†³,ç„¶åå†é€æ¸æ¢å¤</p>
<p>è¿™å°±åˆ°æ€»ç»“äº†å•Š,æ„Ÿè§‰ä¹Ÿæ²¡å­¦åˆ°ä»€ä¹ˆâ€¦</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230815215705.png" alt="20230815215705"></p>
<p>å¥½å§,åªæ˜¯æœåŠ¡ç†”æ–­è¿™å—çš„å°æ€»ç»“..</p>
<p>ç†”æ–­ç±»å‹:</p>
<ol>
<li>ç†”æ–­æ‰“å¼€:è¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡,å†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTR(å¹³å‡æ•…éšœå¤„ç†æ—¶é—´),å½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥åŠç†”æ–­çŠ¶æ€</li>
<li>ç†”æ–­å…³é—­:ç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</li>
<li>ç†”æ–­åŠå¼€:éƒ¨åˆ†è¯·æ±‚è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡,å¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸,å…³é—­ç†”æ–­</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),  // æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;10&quot;), // è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;, value = &quot;10000&quot;),   // æ—¶é—´çª—å£æœŸ</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;60&quot;),   // å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨<br>æ¶‰åŠåˆ°æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°:<strong>å¿«ç…§æ—¶é—´çª—,è¯·æ±‚æ€»æ•°é˜ˆå€¼,é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼</strong></p>
</blockquote>
<ol>
<li>å¿«ç…§æ—¶é—´çª—:æ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿä¸€ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®,è€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—,é»˜è®¤ä¸ºæœ€è¿‘çš„10s</li>
<li>è¯·æ±‚æ€»æ•°é˜ˆå€¼:åœ¨å¿«ç…§æ—¶é—´çª—å†…,å¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜ˆå€¼æ‰æœ‰èµ„æ ¼ç†”æ–­,é»˜è®¤ä¸º20,æ„å‘³ç€åœ¨10så†…,å¦‚æœè¯¥hystrixå‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³20æ¬¡,å³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å…¶ä»–åŸå› å¤±è´¥,æ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€</li>
<li>é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼:å½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜ˆå€¼,æ¯”å¦‚å‘ç”Ÿäº†30æ¬¡è°ƒç”¨,å¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­,æœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸,ä¹Ÿå°±æ˜¯è¶…è¿‡50%çš„é”™è¯¯ç™¾åˆ†æ¯”,åœ¨é»˜è®¤è®¾å®š50%é˜ˆå€¼æƒ…å†µä¸‹,è¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€</li>
</ol>
<blockquote>
<p>æ–­è·¯å™¨å¼€å¯æˆ–å…³é—­çš„æ¡ä»¶</p>
</blockquote>
<ol>
<li>å½“æ»¡è¶³ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™(é»˜è®¤10så†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°)</li>
<li>å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™(é»˜è®¤10så†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥)</li>
<li>åˆ°è¾¾ä»¥ä¸Šé˜ˆå€¼,æ–­è·¯å™¨å°†ä¼šå¼€å¯</li>
<li>å½“å¼€å¯çš„æ—¶å€™,æ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘</li>
<li>ä¸€æ®µæ—¶é—´å(é»˜è®¤æ˜¯5s)è¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€,ä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘,å¦‚æœæˆåŠŸ,æ–­è·¯å™¨ä¼šå…³é—­,è‹¥å¤±è´¥,ç»§ç»­å¼€å¯,é‡å¤4å’Œ5</li>
</ol>
<hr>
<blockquote>
<p>æ–­è·¯å™¨æ‰“å¼€ä¹‹å</p>
</blockquote>
<ol>
<li>å†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™,å°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘,è€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fallback,é€šè¿‡æ–­è·¯å™¨,å®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘,å‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœ</li>
<li>åŸæœ¬çš„ä¸»é€»è¾‘è¦å¦‚ä½•æ¢å¤<br>å¯¹äºè¿™ä¸€é—®é¢˜,hystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½,å½“æ–­è·¯å™¨æ‰“å¼€,å¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹å,hystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—,åœ¨è¿™ä¸ªæ—¶é—´çª—å†…,é™çº§é€»è¾‘æ˜¯<strong>ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘</strong>,å½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸ,æ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€,é‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Š,å¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›,é‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆ,ä¸»é€»è¾‘æ¢å¤,å¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜,æ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€,ä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶</li>
</ol>
<hr>
<h3 id="hystrixå·¥ä½œæµç¨‹"><a href="#hystrixå·¥ä½œæµç¨‹" class="headerlink" title="hystrixå·¥ä½œæµç¨‹"></a>hystrixå·¥ä½œæµç¨‹</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230815224303.png" alt="20230815224303"></p>
<h3 id="hystrixä»ªè¡¨ç›˜"><a href="#hystrixä»ªè¡¨ç›˜" class="headerlink" title="hystrixä»ªè¡¨ç›˜"></a>hystrixä»ªè¡¨ç›˜</h3><p>é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä¹‹å¤–,hystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§(hystrix dashboard),hystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯,å¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·,åŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘æˆåŠŸ,å¤šå°‘å¤±è´¥,netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§,SpringCloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆ,å¯¹ç›‘æ§å†…å®¹è½¬åŒ–ä¸ºå¯è§†åŒ–ç•Œé¢</p>
<hr>
<p>æ–°å»ºé¡¹ç›®:<code>cloud-consumer-hystrix-dashboard9001</code></p>
<p>æ–°ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ–°æ³¨è§£:<code>@EnableHystrixDashboard</code>ç»™ä¸»å¯åŠ¨ç±»åŠ ä¸Š,<strong>æ¯å¤šä¸€ä¸ªåŠŸèƒ½,éƒ½è¦åœ¨ä¸»å¯åŠ¨ç±»ä¸Šå¼€å¯</strong></p>
<p>è®¿é—®å¯å¾—:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230816104755.png" alt="20230816104755"></p>
<p><strong>è¢«ç›‘æ§çš„å‰ææ˜¯è¦æœ‰å¦‚ä¸‹ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ–°ç‰ˆæœ¬Hystrixéœ€è¦åœ¨ä¸»å¯åŠ¨ç±»MainAppHystrix8001ä¸­æŒ‡å®šç›‘æ§è·¯å¾„,ä¸ç„¶ä¼šæŠ¥404</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span></span><br><span class="line"><span class="comment"> *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;/hystrix.stream&quot;ï¼Œ</span></span><br><span class="line"><span class="comment"> *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">getServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">HystrixMetricsStreamServlet</span> <span class="variable">streamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line">    <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(streamServlet);</span><br><span class="line">    registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">    registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">    registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9001ç›‘æ§8001</p>
<ol>
<li>å¡«å†™ç›‘æ§åœ°å€:<code>http://localhost:8001/hystrix.stream</code></li>
<li>å¼€å¯ç›‘æ§</li>
</ol>
<p>è¿˜æ˜¯æŒºç›´è§‚çš„,circuité‚£é‡Œæœ‰å½“å‰çš„æƒ…å†µæ˜¾ç¤º<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230816110023.png" alt="20230816110023"></p>
<p>åˆ°è¿™å°±okäº†,ä½†æ˜¯è¿™äº›å¯èƒ½éƒ½ä¸ç”¨å§,æ¯•ç«Ÿåé¢è¿˜æœ‰alibaba</p>
<h2 id="11-zuulè·¯ç”±ç½‘å…³å’ŒGatewayæ–°ä¸€ä»£ç½‘å…³"><a href="#11-zuulè·¯ç”±ç½‘å…³å’ŒGatewayæ–°ä¸€ä»£ç½‘å…³" class="headerlink" title="11 zuulè·¯ç”±ç½‘å…³å’ŒGatewayæ–°ä¸€ä»£ç½‘å…³"></a>11 zuulè·¯ç”±ç½‘å…³å’ŒGatewayæ–°ä¸€ä»£ç½‘å…³</h2><p>ä¸»è¦çœ‹è¿™ä¸ª<code>æ–°ä¸€ä»£</code>,ä½†æ˜¯zuulè¿˜æ˜¯è¦çœ‹çš„</p>
<blockquote>
<p>Cloudå…¨å®¶æ¡¶ä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ç»„ä»¶å°±æ˜¯ç½‘å…³ï¼Œåœ¨1.xç‰ˆæœ¬ä¸­éƒ½æ˜¯é‡‡ç”¨çš„zuulç½‘å…³;ä½†æ˜¯åœ¨2.xç‰ˆæœ¬ä¸­,zuulçš„å‡çº§ä¸€ç›´è·³ç¥¨,SpringCluodæœ€åè‡ªå·±ç ”å‘äº†ä¸€ä¸ªç½‘å…³æ›¿ä»£zuul,é‚£å°±æ˜¯SpringCloud Gateway<br>ä¸€å¥è¯:gateæ˜¯åŸzuul1.xç‰ˆçš„æ›¿ä»£</p>
</blockquote>
<p>Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring5,SpringBoot2å’ŒProjectReactorç­‰æŠ€æœ¯,Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±,ä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½,ä¾‹å¦‚:<strong>ç†”æ–­,é™æµ,é‡è¯•ç­‰</strong></p>
<p>SpringCloud Gatewayä½¿ç”¨çš„æ˜¯Webfluxä¸­çš„reactor-nettyå“åº”å¼ç¼–ç¨‹ç»„ä»¶,åº•å±‚ä½¿ç”¨äº†Nettyé€šè®¯æ¡†æ¶</p>
<h3 id="Gatewayç½‘å…³å·¥ä½œæµç¨‹"><a href="#Gatewayç½‘å…³å·¥ä½œæµç¨‹" class="headerlink" title="Gatewayç½‘å…³å·¥ä½œæµç¨‹"></a>Gatewayç½‘å…³å·¥ä½œæµç¨‹</h3><p>å®¢æˆ·ç«¯å‘Spring Cloud Gatewayå‘å‡ºè¯·æ±‚,ç„¶ååœ¨Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±,å°†å…¶å‘é€åˆ°Gateway Web Handler</p>
<p>Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘,ç„¶åè¿”å›.</p>
<p>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šå‘é€ä»£ç†è¯·æ±‚ä¹‹å‰(â€œpreâ€)æˆ–ä¹‹å(â€œpostâ€)æ‰§è¡Œä¸šåŠ¡é€»è¾‘</p>
<blockquote>
<p>æ ¸å¿ƒé€»è¾‘:**è·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p>
</blockquote>
<h3 id="åˆ›å»ºGateway9527æ¨¡å—"><a href="#åˆ›å»ºGateway9527æ¨¡å—" class="headerlink" title="åˆ›å»ºGateway9527æ¨¡å—"></a>åˆ›å»ºGateway9527æ¨¡å—</h3><p>æ–°åŠ ä¾èµ–<strong>æ³¨æ„,åŠ ä¸Šè¿™ä¸ªä¾èµ–å,å°±ä¸ç”¨å†åŠ ä¸Šstarter-webå’Œacaturäº†,åŠ ä¸Šä¼šæŠ¥é”™</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p><strong>ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</strong></p>
</blockquote>
<ol>
<li>Route(è·¯ç”±):è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</li>
<li>Predicate(æ–­è¨€):å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°),å¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</li>
<li>Filter(è¿‡æ»¤):æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹,ä½¿ç”¨è¿‡æ»¤å™¨,å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818114408.png" alt="20230818114408"></p>
<p>æ‰€ä»¥è¦åœ¨8001å¤–é¢åŒ…ä¸€å±‚9527,å†ç»™9527åŠ ä¸Šä¸€äº›é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>          <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span>          <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>


<p><strong>æ­¤æ—¶,å¦‚æœè¦è®¿é—®8001çš„lbæˆ–è€…æ˜¯getæ–¹æ³•,éƒ½ä¼šå…ˆæ‰“åˆ°9527</strong></p>
<p>å¯åŠ¨æˆåŠŸå</p>
<ol>
<li>æ·»åŠ ç½‘å…³å‰:<code>http://localhost:8001/payment/get/31</code></li>
<li>æ·»åŠ ç½‘å…³å:<code>http://localhost:9527/payment/get/31</code></li>
</ol>
<p>ä¸Šé¢çš„é…ç½®å…¶å®å°±æ˜¯,å½“è®¿é—®9527ä¸‹çš„æ¥å£æ—¶,ä¼šè‡ªåŠ¨æ˜ å°„åˆ°é…ç½®ä¸­uriå¯¹åº”çš„æ¥å£</p>
<hr>
<p>ä¸Šé¢gatewayé…ç½®çš„routes,ç…§ç€è¿™ä¸ªæ ¼å¼é…å°±è¡Œäº†,ä½†æ˜¯gatewayè¿˜æœ‰ä¸€ç§é…ç½®æ–¹å¼:ç¡¬ç¼–ç </p>
<blockquote>
<p>gatewayç¡¬ç¼–ç é…ç½®æ–¹å¼</p>
</blockquote>
<p><strong>ä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Bean</strong></p>
<p>ç„¶åå®ç°ä¸€ä¸ªåŠŸèƒ½:<code>é€šè¿‡9527ç½‘å…³è®¿é—®åˆ°å¤–ç½‘çš„ç½‘å€:blog.zzmr.club</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-18 12:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder routeLocatorBuilder)</span> &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> routeLocatorBuilder.routes();</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_zzmr&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/maps&quot;</span>)</span><br><span class="line">                        .uri(<span class="string">&quot;http://blog.zzmr.club/maps&quot;</span>)).build();</span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ è¿™ä¸ªé…ç½®ç±»,å°±å¯ä»¥å®ç°è®¿é—®å¤–ç½‘çš„åŠŸèƒ½äº†</p>
<p><strong>æµç¨‹å°±æ˜¯è¿™æ ·çš„,å¯¹9527çš„è¯·æ±‚:<code>localhost:9527/maps</code>ä¼šè‡ªåŠ¨æ˜ å°„åˆ°<code>http://blog.zzmr.club/maps</code></strong></p>
<h3 id="GateWayé…ç½®åŠ¨æ€è·¯ç”±"><a href="#GateWayé…ç½®åŠ¨æ€è·¯ç”±" class="headerlink" title="GateWayé…ç½®åŠ¨æ€è·¯ç”±"></a>GateWayé…ç½®åŠ¨æ€è·¯ç”±</h3><p>ä¸Šé¢çš„é…ç½®é—®é¢˜:</p>
<ol>
<li>åœ°å€å†™æ­»äº†</li>
<li>æ— æ³•å®ç°è´Ÿè½½å‡è¡¡</li>
</ol>
<p>æ‰€ä»¥è¦ç”¨åŠ¨æ€è·¯ç”±æ¥å®ç°è´Ÿè½½å‡è¡¡</p>
<p><strong>é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</strong></p>
<p><em>é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨,ä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»º<code>åŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘,ä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½</code></em></p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœ,å¼€ä¸€ä¸ª7001å’Œ8001å’Œ8002</p>
<p>æ”¹å†™9527çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="comment">#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://CLOUD-PAYMENT-SERVICE</span>  <span class="comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span> <span class="comment">#payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="comment">#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://CLOUD-PAYMENT-SERVICE</span>  <span class="comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p><strong>ç›¸å½“äºè¿˜æ˜¯é€šè¿‡æœåŠ¡åäº†,æ„Ÿè§‰å’Œä¹‹å‰çš„ribbonæ²¡å•¥åŒºåˆ«</strong></p>
<p>æ­¤æ—¶å†è®¿é—®:<code>http://localhost:9527/payment/lb</code>,å°±èƒ½å‘ç°,å®ç°äº†è´Ÿè½½å‡è¡¡</p>
<h3 id="Predicateçš„ä½¿ç”¨"><a href="#Predicateçš„ä½¿ç”¨" class="headerlink" title="Predicateçš„ä½¿ç”¨"></a>Predicateçš„ä½¿ç”¨</h3><p><strong>æ–­è¨€</strong></p>
<p>æ–­è¨€åˆ†ä¸ºå¥½å¤šç§,</p>
<blockquote>
<ol>
<li><code>-After</code></li>
</ol>
</blockquote>
<p>è¿™é‡Œçš„æ—¶é—´æ ¼å¼æ¯”è¾ƒç‰¹åˆ«:<code>2023-08-18T22:26:34.784+08:00[Asia/Shanghai]</code>æ˜¯è¿™ä¸ªæ ¼å¼çš„,è¦é€šè¿‡ä»¥ä¸‹ä»£ç è·å–:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ZonedDateTime</span> <span class="variable">zbj</span> <span class="operator">=</span> ZonedDateTime.now(); <span class="comment">// é»˜è®¤æ—¶åŒº</span></span><br><span class="line">        System.out.println(zbj); <span class="comment">//2023-08-18T22:26:34.784+08:00[Asia/Shanghai]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯è¿™æ ·é…ç½®çš„:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">predicates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">After=2023-08-18T22:26:34.784+08:00[Asia/Shanghai]</span> <span class="comment"># è¡¨ç¤ºåœ¨è¿™ä¸ªæ—¶é—´ä»¥å,lbè®¿é—®è¯·æ±‚æ‰æœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure>

<p><strong>å°±è¡¨ç¤ºè¿™è¿™ä¸ªé…ç½®æ—¶é—´ä¹‹åæ‰è¯¥è¯·æ±‚æ‰æœ‰æ•ˆ</strong></p>
<p>è¿™é‡Œæµ‹è¯•,æŠŠæ—¶é—´è°ƒåˆ°ä¸€ä¸ªå°æ—¶ä»¥å,å†æ¬¡è®¿é—®,å°±å¾—åˆ°404äº†<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818223125.png" alt="20230818223125"></p>
<p><em>ä¸€èˆ¬ç”¨äºä¸Šçº¿æœªæ¥çš„æ¥å£,ä½†æ˜¯åˆä¸èƒ½ç«‹å³å¯ç”¨</em></p>
<p>å’Œä¹‹ç›¸ä¼¼çš„è¿˜æœ‰Before,å’ŒBetween,betweenå°±æ˜¯é…ç½®ä¸¤ä¸ªæ—¶é—´,ç”¨é€—å·éš”å¼€:<br><code>- Between=2023-08-18T21:26:34.784+08:00[Asia/Shanghai],2023-08-18T23:26:34.784+08:00[Asia/Shanghai]</code></p>
<blockquote>
<ol start="2">
<li>Cookie</li>
</ol>
</blockquote>
<p>Cookie Route Predicateéœ€è¦ä¸¤ä¸ªå‚æ•°,ä¸€ä¸ªæ˜¯Cookie name,ä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼,è·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„Cookie nameå€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…,å¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±,å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œ</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>         <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Cookie=username,zzmr</span></span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨curlå‘½ä»¤æ¥å‘é€è¯·æ±‚</strong></p>
<p>è¿™ä¸ªè¿˜æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“,å°±ç›´æ¥åœ¨æ§åˆ¶å°:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818225355.png" alt="20230818225355"></p>
<p>åé¢<code>--cookie &quot;username=zzmr&quot;</code>å°±è¡¨ç¤ºè¯¥è¯·æ±‚æºå¸¦cookie</p>
<p>å¦‚æœä¸å¸¦æŒ‡å®šæ ¼å¼çš„cookie,å°±ä¼šæŠ¥404<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818225503.png" alt="20230818225503"></p>
<blockquote>
<ol start="3">
<li>Headerè¯·æ±‚å¤´</li>
</ol>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span>  <span class="comment"># è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è¿˜æ˜¯ç”¨curlå‘½ä»¤æ¥æµ‹è¯•:<code>http://localhost:9527/payment/lb -H &quot;X-Request-Id:20&quot;</code></p>
<p>æµ‹è¯•:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818230351.png" alt="20230818230351"></p>
<blockquote>
<ol start="4">
<li>Host</li>
</ol>
</blockquote>
<p>Host Route Predicate æ¥å—ä¸€ç»„å‚æ•°,ä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨,è¿™ä¸ªæ¨¡æ¿æ˜¯antåˆ†éš”çš„æ¨¡æ¿,ç”¨.å·ä½œä¸ºåˆ†éš”ç¬¦,å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818231059.png" alt="20230818231059"></p>
<blockquote>
<ol start="5">
<li>Method</li>
</ol>
</blockquote>
<p>è¿™ä¸ªæ›´ç®€å•äº†,å°±æ˜¯æŒ‡å®šå‘é€è¯·æ±‚çš„ç±»å‹:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å°±åªèƒ½æ¥æ”¶åˆ°GETè¯·æ±‚,å‘é€postè¯·æ±‚ä¼šæŠ¥404<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818231748.png" alt="20230818231748"></p>
<blockquote>
<ol start="6">
<li>Path</li>
</ol>
</blockquote>
<p>å°±æ˜¯ä¸Šé¢ç”¨çš„é‚£ä¸ª:<code>- Path=/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</code></p>
<p>æŒ‡å®šè¯·æ±‚è·¯å¾„çš„</p>
<blockquote>
<ol start="7">
<li>Query(è¯·æ±‚å‚æ•°)</li>
</ol>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Query=username,</span> <span class="string">\d+</span>  <span class="comment"># è¦æœ‰å‚æ•°åusernameå¹¶ä¸”å€¼è¿˜è¦æ˜¯æ•´æ•°æ‰èƒ½è·¯ç”±</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è¿™æ ·ç”¨:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230818232458.png" alt="20230818232458"></p>
<p><strong>æ³¨æ„æ­£åˆ™è¡¨è¾¾å¼é‡Œçš„åæ–œæ ,åˆšå†™é”™äº†,çœ‹äº†åŠå¤©</strong></p>
<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p><strong>è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨</strong></p>
<p>SpringCloud Gatewayå†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ</p>
<blockquote>
<p>ç”Ÿå‘½å‘¨æœŸ:</p>
</blockquote>
<ol>
<li>pre(ä¹‹å‰)</li>
<li>post(ä¹‹å)</li>
</ol>
<blockquote>
<p>ç§ç±»:</p>
</blockquote>
<ol>
<li>GatewayFilter(å•ä¸€)</li>
<li>GlobalFilter(å…¨å±€)</li>
</ol>
<hr>
<p>è¿‡æ»¤å™¨ç§ç±»å¤ªå¤šäº†,å…¨å±€çš„:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">AddRequestParameter=X-Request-Id,1024</span> <span class="comment">#è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåªè®²è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</p>
<p>è‡ªå®šä¹‰é…ç½®:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-19 10:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;*******come in MyLogGateWayFilter: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">// è¡¨ç¤ºè¦æ±‚è¯·æ±‚å¸¦æœ‰è¯·æ±‚å‚æ•°ï¼Œä¸”ç¬¬ä¸€ä¸ªä¸ºuname</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (uname == <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;*******ç”¨æˆ·åä¸ºnull,éæ³•ç”¨æˆ·&quot;</span>);</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¿”å›å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è®¿é—®,å¦‚æœå‚æ•°ä¸ç¬¦åˆè¦æ±‚,åˆ™ä¼šæŠ¥406</p>
<h2 id="12-SpringCloud-Config"><a href="#12-SpringCloud-Config" class="headerlink" title="12 SpringCloud Config"></a>12 SpringCloud Config</h2><p>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</p>
<p>ä¸çŸ¥ä¸è§‰å·²ç»çœ‹åˆ°è¿™äº†:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230819113003.png" alt="20230819113003"></p>
<p>ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ª?-<strong>é…ç½®é—®é¢˜</strong></p>
<p>å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡,æ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°,å› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡,ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œ,æ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„,åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„</p>
<p>springCloudæä¾›äº†ConfigServeræ¥è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ªapplication.yml,ä¸Šç™¾ä¸ªé…ç½®æ–‡ä»¶çš„ç®¡ç†</p>
<hr>
<blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒ,é…ç½®æœåŠ¡å™¨<strong>ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨</strong>çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ª<strong>ä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230819113838.png" alt="20230819113838"></p>
</blockquote>
<blockquote>
<p>æ€ä¹ˆç©<br>SpringCloud Configåˆ†ä¸º<strong>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</strong>ä¸¤ä¸ªéƒ¨åˆ†</p>
</blockquote>
<p>æœåŠ¡ç«¯ä¹Ÿç§°ä¸º<strong>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ,å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨</strong>,ç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯,åŠ å¯†&#x2F;è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£</p>
<p>å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æº,ä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹,å¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯,é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯,è¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†,å¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹</p>
<blockquote>
<p>èƒ½å¹²å˜›</p>
</blockquote>
<ol>
<li>é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶</li>
<li>ä¸åŒç¯å¢ƒä¸åŒé…ç½®,åŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°,åˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚<code>dev/test/prod/beta/release</code></li>
<li>è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®,ä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶,æœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯</li>
<li>å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶,æœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®</li>
<li>å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²</li>
</ol>
<h3 id="ConfigæœåŠ¡ç«¯é…ç½®"><a href="#ConfigæœåŠ¡ç«¯é…ç½®" class="headerlink" title="ConfigæœåŠ¡ç«¯é…ç½®"></a>ConfigæœåŠ¡ç«¯é…ç½®</h3><ol>
<li>åœ¨githubæ–°å»ºä¸€ä¸ª<code>springcloud-configçš„æ–°Repository</code></li>
<li>ç”±ä¸Šä¸€æ­¥è·å–åˆšæ–°å»ºçš„gitåœ°å€</li>
</ol>
<p>ç„¶åå°±æ˜¯å°†ä»“åº“cloneåˆ°æœ¬åœ°,ç„¶åæ·»åŠ äº›æ–‡ä»¶ä»€ä¹ˆçš„</p>
<p>æ–°å»ºæ¨¡å—:<code>cloud-config-center-3344</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span>  <span class="string">cloud-config-center</span> <span class="comment">#æ³¨å†Œè¿›EurekaæœåŠ¡å™¨çš„å¾®æœåŠ¡å</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">git@github.com:jimmy66886/springcloud-config.git</span> <span class="comment">#GitHubä¸Šé¢çš„gitä»“åº“åå­—</span></span><br><span class="line">          <span class="comment">####æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">springcloud-config</span></span><br><span class="line">      <span class="comment">####è¯»å–åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure>

<p>ä¸»å¯åŠ¨ç±»ä¸ŠåŠ å…¥æ–°çš„æ³¨è§£:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigServer</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååŠ æ˜ å°„:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230819121030.png" alt="20230819121030"></p>
<p>é…ç½®è¿™å—æœ‰å‘,å¦‚æœå¼€ç€æ¢¯å­,å°±è®¿ä¸äº†7001,ç„¶å3344è¿™ä¸ªä¹Ÿæœ‰é—®é¢˜,å…³äº†æ¢¯å­åå‘ç°è®¤è¯å¤±è´¥,è§£å†³åŠæ³•:</p>
<ol>
<li>å°†sshæ”¹æˆhttps:</li>
<li>åŠ ä¸Šç”¨æˆ·åå’Œå¯†ç <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#          uri: git@github.com:jimmy66886/springcloud-config.git #GitHubä¸Šé¢çš„gitä»“åº“åå­—</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://github.com/jimmy66886/springcloud-config.git</span></span><br><span class="line">          <span class="comment">####æœç´¢ç›®å½•</span></span><br><span class="line">          <span class="attr">search-paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">springcloud-config</span></span><br><span class="line"><span class="comment">#          username: jimmy66886</span></span><br><span class="line"><span class="comment">#          password: </span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>è¿˜æœ‰å°±æ˜¯,åˆ†æ”¯è¦æ”¹æˆmain,ä¸ç„¶è¿˜æ˜¯è®¿é—®ä¸åˆ°:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230819122559.png" alt="20230819122559"></p>
<hr>
<blockquote>
<p>é…ç½®è¯»å–è§„åˆ™</p>
</blockquote>
<p>å¦å¤–çš„ä¸€ç§è®¿é—®æ¨¡å¼:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230820151229.png" alt="20230820151229"></p>
<h3 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h3><p>æ–°å»ºæ¨¡å—:<code>cloud-config-client3355</code></p>
<p>æ–°ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¼•å…¥<code>bootstrap.yml</code></p>
<blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>application.ymlæ˜¯ç”¨æˆ·åŠçš„èµ„æºé…ç½®é¡¹<br>bootstrap.ymlæ˜¯ç³»ç»Ÿçº§çš„,<strong>ä¼˜å…ˆçº§æ›´é«˜</strong></p>
</blockquote>
<p>SpringCloudä¼šåˆ›å»ºä¸€ä¸ª<code>Bootstrap context</code>,ä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡,åˆå§‹åŒ–çš„æ—¶å€™,bootstrap Contextè´Ÿè´£ä»<strong>å¤–éƒ¨æº</strong>åŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®,è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„Environment</p>
<p>Bootstrapå±æ€§ç”±é«˜ä¼˜å…ˆçº§,é»˜è®¤æƒ…å†µä¸‹,å®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–,Bootstrap contextå’Œapplication Contextæœ‰ç€ä¸åŒçš„çº¦å®š,æ‰€ä»¥æ–°å¢äº†ä¸€ä¸ªbootstrap.ymlæ–‡ä»¶,ä¿è¯Bootstrap Contextå’ŒApplication Contexté…ç½®çš„åˆ†ç¦»</p>
<p><strong>è¦å°†Clientæ¨¡å—ä¸‹çš„applicaiton.ymlæ–‡ä»¶æ”¹ä¸ºbootstarp.yml,è¿™æ—¶å¾ˆå…³é”®çš„</strong></p>
<p>å†…å®¹:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">main</span> <span class="comment">#åˆ†æ”¯åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span> <span class="comment">#è¯»å–åç¼€åç§°   ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€k</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230820153001.png" alt="20230820153001"></p>
<p>è®¿é—®æˆåŠŸ,è¡¨ç¤º3355ä»3344æ‹¿åˆ°äº†é…ç½®ä¿¡æ¯<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230820153554.png" alt="20230820153554"></p>
<hr>
<p>æ­¤æ—¶å¦‚æœä¿®æ”¹äº†ä»“åº“é‡Œçš„å†…å®¹,å†æ¬¡è®¿é—®,3344æ˜¯èƒ½æ£€æµ‹åˆ°æ”¹å˜çš„,å› ä¸ºç›´è¿çš„æ•°æ®åº“,ä½†3355æ‹¿ä¸åˆ°æ–°çš„æ•°æ®</p>
<p><strong>æ‰€ä»¥è¦å®ç°<code>åŠ¨æ€åˆ·æ–°</code></strong></p>
<h3 id="åŠ¨æ€åˆ·æ–°"><a href="#åŠ¨æ€åˆ·æ–°" class="headerlink" title="åŠ¨æ€åˆ·æ–°"></a>åŠ¨æ€åˆ·æ–°</h3><p>å¯¹3355è¿›è¡Œä¿®æ”¹</p>
<ol>
<li>ä¿®æ”¹YML,æš´éœ²ç›‘æ§ç«¯å£<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><code>@RefreshScope</code>ä¸šåŠ¡ç±»Controllerä¿®æ”¹</li>
</ol>
<p>ç„¶åæµ‹è¯•å°±è¡Œäº†,ä½†æ˜¯å§,è¿™ä¸ªç½‘,ä¸å¼€æ¢¯å­,è¿›ä¸å»github,å¼€äº†æ¢¯å­,æœ¬åœ°çš„eurekaå°±æœ‰é—®é¢˜,æˆ‘çœŸæ˜¯æœäº†</p>
<p>æœ€åä¸€æ­¥å°±æ˜¯,è¦ç»™3355å‘é€ä¸€ä¸ªpostè¯·æ±‚,è¯·æ±‚åˆ·æ–°<code>curl -X POST &quot;http://localhost:3355/actuator/refresh</code></p>
<p>â€¦å¥½å›°</p>
<h2 id="13-Busæ¶ˆæ¯æ€»çº¿"><a href="#13-Busæ¶ˆæ¯æ€»çº¿" class="headerlink" title="13 Busæ¶ˆæ¯æ€»çº¿"></a>13 Busæ¶ˆæ¯æ€»çº¿</h2><p>è¿™ä¸ªçœ‹æ¥è¦é…ç½®RabbitMq,è®°å¾—dockerä¸Šé…ç½®çš„è¿˜åœ¨å§</p>
<blockquote>
<p>Busé…ç½®</p>
</blockquote>
<ol>
<li>åˆ†å¸ƒå¼è‡ªåŠ¨åˆ·æ–°é…ç½®åŠŸèƒ½</li>
<li>Spring Cloud Busé…åˆSpring Cloud Configä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°</li>
</ol>
<blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>Busæ”¯æŒä¸¤ç§æ¶ˆæ¯ä»£ç†:RabbitMQå’Œkafka</p>
</blockquote>
<blockquote>
<p>ä»€ä¹ˆæ˜¯æ€»çº¿<br>åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­,é€šå¸¸ä¼šä½¿ç”¨<strong>è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†</strong>æ¥æ„å»ºä¸€ä¸ª<strong>å…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜</strong>,å¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½é“¾æ¥ä¸Šæ¥.ç”±äº<strong>è¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹,æ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿</strong>,åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹,éƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯</p>
</blockquote>
<blockquote>
<p>åŸºæœ¬åŸç†<br>ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯springCloudBus),å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°çš„æ—¶å€™,å®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­,è¿™æ ·å…¶ä»–ç›‘å¬åŒä¸€topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥,ç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®</p>
</blockquote>
<h3 id="é…ç½®RabbitMq"><a href="#é…ç½®RabbitMq" class="headerlink" title="é…ç½®RabbitMq"></a>é…ç½®RabbitMq</h3><p>è¿˜æ˜¯ç”¨dockeræ¥é…ç½®</p>
<p>ä¹Ÿæ²¡å•¥é…ç½®çš„,ç›´æ¥èµ·ä¸€ä¸ªå®¹å™¨å°±è¡Œäº†</p>
<h3 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h3><ol>
<li>åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯&#x2F;bus&#x2F;refresh,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</li>
<li>åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ConfigServerçš„&#x2F;bus&#x2F;refreshç«¯ç‚¹,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</li>
</ol>
<p>ä½†æ˜¯ç¬¬ä¸€ç§æ–¹å¼ä¸å¤ªæ¨è,åŸå› å¦‚ä¸‹:</p>
<ul>
<li>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§,å› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—,å®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£</li>
<li>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§</li>
<li>æœ‰ä¸€å®šçš„å±€é™æ€§,ä¾‹å¦‚,å¾®æœåŠ¡åœ¨è¿ç§»æ—¶,å®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–,æ­¤æ—¶å¦‚æœè¦åšåˆ°è‡ªåŠ¨åˆ·æ–°,é‚£ä¹ˆå°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹</li>
</ul>
<h3 id="æ›´æ”¹é…ç½®"><a href="#æ›´æ”¹é…ç½®" class="headerlink" title="æ›´æ”¹é…ç½®"></a>æ›´æ”¹é…ç½®</h3><ol>
<li>ä¿®æ”¹3344<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>æ”¹yml<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rabbitmq:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">1.14</span><span class="number">.102</span><span class="number">.11</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;bus-refresh&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>è¿™é…ç½®çš„é›¶é›¶æ•£æ•£,å¥½ä¹±å•Š,æ™•äº†å·²ç»,ç”šè‡³è¿˜æ²¡å¯åŠ¨æˆåŠŸ</p>
<p>å®³,è´µåœ¨åšæŒ,ä½†æ˜¯ä¸è´µ</p>
<h2 id="14-cloud-Stream"><a href="#14-cloud-Stream" class="headerlink" title="14 cloud Stream"></a>14 cloud Stream</h2><blockquote>
<p>ä¸ºä»€ä¹ˆè¦å­¦<br>å› ä¸ºåç«¯çš„æ•°æ®å¯èƒ½æ˜¯ç”¨çš„RabbitMq,è€Œå¤§æ•°æ®å±‚é¢æ˜¯ç”¨çš„kafka,è¿™æ ·ä¸¤è€…çš„æ¶ˆæ¯å°±ä¸é€‚é…äº†</p>
</blockquote>
<blockquote>
<p>æœ‰ä¸€ç§æ–°çš„æŠ€æœ¯è¯ç”Ÿ,è®©æˆ‘ä»¬ä¸å†å…³æ³¨å…·ä½“MQçš„ç»†èŠ‚,æˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ç§é€‚é…ç»‘å®šçš„æ–¹å¼,è‡ªåŠ¨çš„ç»™æˆ‘ä»¬åœ¨å„ç§MQå†…åˆ‡æ¢</p>
</blockquote>
<h3 id="cloud-Steamç®€ä»‹"><a href="#cloud-Steamç®€ä»‹" class="headerlink" title="cloud Steamç®€ä»‹"></a>cloud Steamç®€ä»‹</h3><blockquote>
<p>æ˜¯ä»€ä¹ˆ<br><strong>å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬,ç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹</strong></p>
</blockquote>
<p>å®˜æ–¹å®šä¹‰:Spring Cloud Steamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶</p>
<p>åº”ç”¨ç¨‹åºé€šè¿‡inputsæˆ–è€…outputsæ¥ä¸Spring Cloud Streamä¸­çš„binderå¯¹è±¡äº¤äº’,é€šè¿‡æˆ‘ä»¬é…ç½®æ¥binding,è€ŒSpring Cloud Streamçš„binderå¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’<br><strong>æ‰€ä»¥,æˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå¦‚ä½•ä¸Spring Cloud Streamäº¤äº’å°±å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨çš„æ–¹å¼</strong></p>
<blockquote>
<p>å°±æ˜¯å‘å¸ƒå’Œè®¢é˜…çš„æ¨¡å¼</p>
</blockquote>
<h3 id="Spring-Cloud-Streamæ ‡å‡†æµç¨‹å¥—è·¯"><a href="#Spring-Cloud-Streamæ ‡å‡†æµç¨‹å¥—è·¯" class="headerlink" title="Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯"></a>Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯</h3><ol>
<li>Binder:å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶,å±è”½å·®å¼‚</li>
<li>Channel:é€šé“,æ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡,åœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹,é€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½®</li>
<li>Sourceå’ŒSink:ç®€å•çš„å¯ç†è§£ä¸ºå‚ç…§å¯¹è±¡æ˜¯Spring Cloud Steamè‡ªèº«,ä»Streamå‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡º,æ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥</li>
</ol>
<h3 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h3><p>å¥½å®¶ä¼™,åˆæ˜¯3å°æœºå­ä¸€å—æ¥</p>
<p>8801æ¨¡å—,æ–°ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">output:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° --ç”Ÿäº§è€…</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">send-8801.com</span>  <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span></span><br></pre></td></tr></table></figure>


<p><em>ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰äº›é…ç½®æ˜¯çˆ†çº¢çš„</em></p>
<p><strong>æ¶ˆæ¯æ¥å£å®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zzmr.springcloud.service.IMessageProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.MessageChannel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.support.MessageBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Source;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-22 16:53</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableBinding(Source.class)</span> <span class="comment">// å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IMessageProviderImpl</span> <span class="keyword">implements</span> <span class="title class_">IMessageProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serial</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(serial).build());</span><br><span class="line">        System.out.println(<span class="string">&quot;**********serial: &quot;</span>+serial);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡ä¸æ˜¯<code>@Service</code>äº†,è€Œæ˜¯<code>@EnableBinding(Source.class)</code>,ç‰¹åˆ«å®¹æ˜“å¼•é”™åŒ…çš„..</p>
<hr>
<p>ä¸‹åˆèµ°çš„æ—¶å€™8801éƒ½æ²¡å¯åŠ¨,å›æ¥æäº†å¥½ä¹…ä¹Ÿæ²¡å¯åŠ¨,æ‰å‘ç°åŸæ¥æ˜¯Source.classå¯¼é”™åŒ…äº†</p>
<blockquote>
<p><strong>æ¶ˆè´¹è€…</strong></p>
</blockquote>
<p>ä¾èµ–è¿˜æ˜¯é‚£äº›ä¾èµ–,ä½†æ˜¯é…ç½®æ–‡ä»¶æ”¹äº†äº›å†…å®¹,ä»output(ç”Ÿäº§è€…)å˜æˆäº†input(æ¶ˆè´¹è€…)</p>
<p><em>å€¦äº†å—</em></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-stream-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span></span><br><span class="line">        <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">          <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">1.14</span><span class="number">.102</span><span class="number">.11</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">        <span class="attr">input:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºå¯¹è±¡jsonï¼Œå¦‚æœæ˜¯æ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span>  <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>     <span class="comment"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯æ¶ˆè´¹è€…,è‡ªå·±å¹¶æ²¡æœ‰ä¸šåŠ¡é€»è¾‘,åªæœ‰ä¸€ä¸ªcontroller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.stream.annotation.StreamListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.stream.messaging.Sink;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-23 13:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveMessageListenerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">(Message&lt;String&gt; message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1å·,----&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯:&quot;</span> + message.getPayload() + <span class="string">&quot;\t    port: &quot;</span> + serverPort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¼åŒ…è¿˜æ˜¯æœ‰é—®é¢˜,å…ˆæµ‹è¯•çœ‹çœ‹å§</p>
<p>çœ‹æ¥å¯¼åŒ…æ²¡æœ‰é—®é¢˜,å…ˆæ˜¯8801å‘æ¶ˆæ¯,æˆåŠŸ<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823131729.png" alt="20230823131729"></p>
<p>ç„¶åæ˜¯8802æ¥æ”¶æ¶ˆæ¯,æˆåŠŸ<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823131749.png" alt="20230823131749"></p>
<h3 id="åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"><a href="#åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–" class="headerlink" title="åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"></a>åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</h3><p>å…ˆæ–°å»ºä¸€ä¸ª8803æ¶ˆè´¹è€…,ç°åœ¨å°±æ˜¯ä¸¤ä¸ªæ¶ˆè´¹è€…(8802å’Œ8803),ä¸€ä¸ªç”Ÿäº§è€…8801,å’Œä¸€ä¸ªæœåŠ¡æ³¨å†Œ7001</p>
<p>æ­¤æ—¶ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯,ä¸¤ä¸ªç”Ÿäº§è€…éƒ½èƒ½æ¥å—åˆ°æ¶ˆæ¯</p>
<h4 id="é‡å¤æ¶ˆè´¹é—®é¢˜"><a href="#é‡å¤æ¶ˆè´¹é—®é¢˜" class="headerlink" title="é‡å¤æ¶ˆè´¹é—®é¢˜"></a>é‡å¤æ¶ˆè´¹é—®é¢˜</h4><p><em>æˆ‘è®°å¾—ä¹‹å‰å­¦rabbitmqé‡Œé¢å­¦åˆ°äº†é‡å¤æ¶ˆè´¹è¿™ä¸ªä¸œè¥¿,ä½†æ˜¯ç°åœ¨å·²ç»å¿˜å…‰äº†</em></p>
<p>è¿™æ˜¯8801å‘å‡ºçš„æ¶ˆæ¯<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823133931.png" alt="20230823133931"></p>
<p>è¿™æ˜¯8802å’Œ8803æ¥æ”¶åˆ°çš„æ¶ˆæ¯<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823134002.png" alt="20230823134002"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823134133.png" alt="20230823134133"></p>
<p>ç›®å‰æ˜¯8802å’Œ8803éƒ½æ¥æ”¶åˆ°äº†æ¶ˆæ¯,å­˜åœ¨é‡å¤æ¶ˆè´¹çš„é—®é¢˜</p>
<blockquote>
<p>æ¡ˆä¾‹<br>åœ¨ä»¥ä¸‹åœºæ™¯ä¸­,è®¢å•ç³»ç»Ÿæˆ‘ä»¬åšé›†ç¾¤éƒ¨ç½²,éƒ½ä¼šä»RabbitMQä¸­è·å–è®¢å•ä¿¡æ¯,é‚£å¦‚æœ<strong>ä¸€ä¸ªè®¢å•åŒæ—¶è¢«ä¸¤ä¸ªæœåŠ¡è·å–åˆ°</strong>,é‚£ä¹ˆå°±ä¼šé€ æˆæ•°æ®é”™è¯¯,æˆ‘ä»¬å¾—é¿å…è¿™ç§æƒ…å†µ,è¿™æ—¶<strong>æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨streamä¸­çš„æ¶ˆæ¯åˆ†ç»„æ¥è§£å†³</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823134840.png" alt="20230823134840"></p>
</blockquote>
<p><strong>æ³¨æ„åœ¨Streamä¸­å¤„äºåŒä¸€ä¸ªgroupä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»,å°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸åŒç»„æ˜¯å¯ä»¥å…¨é¢æ¶ˆè´¹çš„(é‡å¤æ¶ˆè´¹)</span><br><span class="line">åŒä¸€ç»„ä¼šå‘ç”Ÿç«äº‰å…³ç³»</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‰€ä»¥ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé‡å¤æ¶ˆè´¹çš„é—®é¢˜å‘¢?ä¸Šé¢çœ‹:<code>ä¸åŒç»„æ˜¯å¯ä»¥å…¨é¢æ¶ˆè´¹çš„</code>,æ­¤æ—¶åœ¨mqä¸­èƒ½çœ‹åˆ°åˆ†äº†ä¸¤ä¸ªç»„,ä¹Ÿå³æ˜¯8802å’Œ8803æ˜¯ä¸åŒçš„ç»„,æ‰€ä»¥ä¸¤è€…éƒ½å¯ä»¥æ¶ˆè´¹åˆ°è¿™ä¸ªæ¶ˆæ¯<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823135451.png" alt="20230823135451"></p>
</blockquote>
<blockquote>
<p>è§£å†³<br>è¿›è¡Œåˆ†ç»„(group),å°†æ¶ˆè´¹è€…åˆ†æˆä¸€ä¸ªç»„,è¿™æ ·8802å’Œ8803å°±ä¸ä¼šå­˜åœ¨é‡å¤æ¶ˆè´¹çš„é—®é¢˜äº†</p>
</blockquote>
<ol>
<li>è‡ªå®šä¹‰é…ç½®åˆ†ç»„</li>
<li>è‡ªå®šä¹‰é…ç½®ä¸ºåŒä¸€ä¸ªç»„,è§£å†³é‡å¤æ¶ˆè´¹é—®é¢˜</li>
</ol>
<p>è®¾ç½®åˆ†ç»„,åªéœ€è¦åœ¨8802å’Œ8803çš„é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Š<code>group: zzmrA</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">  <span class="attr">input:</span> <span class="comment"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span></span><br><span class="line">    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span></span><br><span class="line">    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºå¯¹è±¡jsonï¼Œå¦‚æœæ˜¯æ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span></span><br><span class="line">    <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">zzmrA</span></span><br></pre></td></tr></table></figure>

<p><em>è¿™é‡Œå°±å†™å¤šä¸€ç‚¹,ä¸»è¦æ˜¯ä¸ºäº†çœ‹groupçš„ç¼©è¿›åœ¨å“ª</em></p>
<p>ç›®å‰æ˜¯8802ä¸º<code>zzmrA</code>,8803ä¸º<code>zzmrB</code>,åœ¨mqä¸­èƒ½çœ‹å‡º:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823142222.png" alt="20230823142222"></p>
<blockquote>
<p>åˆ†å¸ƒå¼å¾®æœåŠ¡åº”ç”¨ä¸ºäº†å®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡,å®é™…ä¸Šéƒ½ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹,æœ¬ä¾‹å¯åŠ¨äº†8802å’Œ8803,å¤šæ•°æƒ…å†µ,ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™æŸä¸ªå…·ä½“å¾®æœåŠ¡æ—¶,åªå¸Œæœ›è¢«æ¶ˆè´¹ä¸€æ¬¡,æŒ‰ç…§ä¸Šé¢æˆ‘ä»¬å¯åŠ¨äº†ä¸¤ä¸ªåº”ç”¨çš„ä¾‹å­,è™½ç„¶å®ƒä»¬åŒå±ä¸€ä¸ªåº”ç”¨,ä½†æ˜¯è¿™ä¸ªæ¶ˆæ¯å‡ºç°äº†è¢«é‡å¤æ¶ˆè´¹ä¸¤æ¬¡çš„æƒ…å†µ,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,åœ¨Spring Cloud Streamä¸­æä¾›äº†<strong>æ¶ˆè´¹ç»„</strong>çš„æ¦‚å¿µ</p>
</blockquote>
<hr>
<p>æ­¤æ—¶æŠŠ8802å’Œ8803åˆ†æˆåŒä¸€ä¸ªç»„</p>
<p>8801å‘é€4æ¡<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823143644.png" alt="20230823143644"><br>8802æ”¶åˆ°ä¸¤æ¡<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823143657.png" alt="20230823143657"><br>8803ä¹Ÿæ˜¯æ”¶åˆ°ä¸¤æ¡<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823143708.png" alt="20230823143708"></p>
<p>åœ¨mqä¸­,ä¹Ÿèƒ½çœ‹åˆ°zzmrAç»„çš„æ¶ˆè´¹è€…æœ‰ä¸¤ä¸ª:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823143843.png" alt="20230823143843"></p>
<h4 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h4><ol>
<li>åœæ‰8802&#x2F;8803å¹¶å»é™¤æ‰8802çš„åˆ†ç»„</li>
<li>8801å…ˆå‘é€4æ¡æ¶ˆæ¯åˆ°mq</li>
<li>å…ˆå¯åŠ¨8802,æ— åˆ†ç»„å±æ€§é…ç½®,åå°æ²¡æœ‰æ‰“å‡ºæ¶ˆæ¯</li>
<li>å†å¯åŠ¨8803,æœ‰åˆ†ç»„å±æ€§é…ç½®,åå°æ‰“å‡ºäº†MQä¸Šçš„æ¶ˆæ¯</li>
</ol>
<p>?è¿™å°±æ˜¯æŒä¹…åŒ–?</p>
<p>ä¹Ÿæ²¡é…ç½®ä¸œè¥¿,æ‰€ä»¥è¯´è¿™æ˜¯é»˜è®¤çš„,ä¹Ÿå°±è¯´,æ¶ˆè´¹è€…æ‰äº†ä¹‹å,æ¶ˆæ¯å¹¶ä¸ä¼šä¸¢å¤±,ä¼šç­‰æ¶ˆè´¹è€…ä¸Šçº¿åé‡æ–°æ¥æ”¶</p>
<h2 id="15-Sleuth"><a href="#15-Sleuth" class="headerlink" title="15 Sleuth"></a>15 Sleuth</h2><p><strong>åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</strong>(é“¾è·¯ç›‘æ§)</p>
<p>çœ‹ç€å¥½é«˜çº§å•Š</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæŠ€æœ¯<br>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­,ä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœ,æ¯ä¸€ä¸ªå‰ç«¯è¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯,é“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥â€”æ‰€ä»¥éœ€è¦ç›‘æ§</p>
</blockquote>
<blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ<br>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶å…¼å®¹æ”¯æŒäº†zipkin</p>
</blockquote>
<h3 id="æ­å»ºé“¾è·¯ç›‘æ§"><a href="#æ­å»ºé“¾è·¯ç›‘æ§" class="headerlink" title="æ­å»ºé“¾è·¯ç›‘æ§"></a>æ­å»ºé“¾è·¯ç›‘æ§</h3><ol>
<li>å®‰è£…zipkin<ul>
<li>ä¸‹è½½:SpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkinServeräº†,åªéœ€è¦è°ƒç”¨jaråŒ…å³å¯,<a target="_blank" rel="noopener" href="https://search.maven.org/remote_content?g=io.zipkin.java&a=zipkin-server&v=LATEST&c=exec">é“¾æ¥</a></li>
<li>è¿è¡ŒjaråŒ…</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823152040.png" alt="20230823152040"></li>
</ul>
</li>
<li>å›¾å½¢åŒ–ç•Œé¢<ul>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823152229.png" alt="20230823152229"></li>
</ul>
</li>
</ol>
<hr>
<p>æµç¨‹:<br>ä¸€æ¡é“¾è·¯é€šè¿‡Trace Idå”¯ä¸€æ ‡è¯†,Spanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯,å„spané€šè¿‡parent idå…³è”èµ·æ¥<br>    - Trace:ç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆ,è¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯,å­˜åœ¨å”¯ä¸€æ ‡è¯†<br>    - Span:è¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æº,é€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823152615.png" alt="20230823152615"></p>
<h3 id="æ›´æ”¹é…ç½®-1"><a href="#æ›´æ”¹é…ç½®-1" class="headerlink" title="æ›´æ”¹é…ç½®"></a>æ›´æ”¹é…ç½®</h3><p>æŠŠä¹‹å‰çš„8001å’Œ80ä¿®æ”¹ä¸€ä¸‹,åŠ ä¸Šä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ·»åŠ é…ç½®:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>            <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>              <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;010203&quot;</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">    <span class="attr">sleuth:</span></span><br><span class="line">      <span class="attr">sampler:</span></span><br><span class="line">        <span class="comment">#é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line">        <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è¿™ä¸ªä½ç½®,80ä¹Ÿæ˜¯ä¸€æ ·åŠ ä¸Š<code>zipkin.base-url</code>ä»¥åŠå…¶ä»–çš„</p>
<p>ç„¶åå„åŠ ä¸Šä¸€ä¸ªæ¥å£,å°±ä¸ç”¨å†™äº†</p>
<p>ç„¶åå‘¢?</p>
<p>ç„¶å80è°ƒç”¨8001,æ­¤æ—¶å°±èƒ½åœ¨<code>http://localhost:9411/zipkin</code>ä¸­æ£€æµ‹åˆ°å‘èµ·çš„è¯·æ±‚ä¿¡æ¯å•¥çš„</p>
<h2 id="16-SpringCloud-Alibaba-å…¥é—¨ç®€ä»‹"><a href="#16-SpringCloud-Alibaba-å…¥é—¨ç®€ä»‹" class="headerlink" title="16 SpringCloud Alibaba å…¥é—¨ç®€ä»‹"></a>16 SpringCloud Alibaba å…¥é—¨ç®€ä»‹</h2><blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>Spring Cloud Alibaba,å®ƒæ˜¯ç”±ä¸€äº›é˜¿é‡Œå·´å·´çš„å¼€æºç»„ä»¶å’Œäº‘äº§å“ç»„æˆçš„,è¿™ä¸ªé¡¹ç›®çš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤§å®¶æ‰€ç†ŸçŸ¥çš„Springæ¡†æ¶,å…¶ä¼˜ç§€çš„è®¾è®¡æ¨¡å¼å’ŒæŠ½è±¡ç†å¿µ,ä»¥ç»™ä½¿ç”¨é˜¿é‡Œå·´å·´äº§å“çš„Javaå¼€å‘è€…å¸¦æ¥ä½¿ç”¨Spring Bootå’ŒSpring Cloudçš„æ›´å¤šä¾¿åˆ©</p>
</blockquote>
<p>è¿™æ®µè¯æ€ä¹ˆè¯»èµ·æ¥è¿™ä¹ˆåˆ«æ‰­</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/2022.x/README-zh.md">Cloud Alibabaä¸­æ–‡æ–‡æ¡£</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823171610.png" alt="20230823171610"></p>
<p>å¥½,è¿™ä¸€ç« å°±æ˜¯é—²èŠ,æ²¡ä»€ä¹ˆä»£ç å•¥çš„</p>
<h2 id="17-Nacos"><a href="#17-Nacos" class="headerlink" title="17 Nacos"></a>17 Nacos</h2><h3 id="ä»‹ç»å’Œä¸‹è½½"><a href="#ä»‹ç»å’Œä¸‹è½½" class="headerlink" title="ä»‹ç»å’Œä¸‹è½½"></a>ä»‹ç»å’Œä¸‹è½½</h3><blockquote>
<p>ä¸ºä»€ä¹ˆå«nacos<br>na:Naming,co:Configuration,æœ€åçš„sä¸ºService(æœåŠ¡æ³¨å†Œ&#x2F;é…ç½®)</p>
</blockquote>
<blockquote>
<p>æ˜¯ä»€ä¹ˆ<br>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°,é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°<br>Nacos&#x3D;Eureka+Config+Bus</p>
</blockquote>
<p><em>å°±æŠŠè¿™ç©æ„å½“æˆeureka</em></p>
<blockquote>
<p>ä¸‹è½½<br>ä¸‹å“ªä¸ªç‰ˆæœ¬å‘¢?æœ€æ–°ç‰ˆéƒ½åˆ°2.1.2äº†,1.xçš„è¿˜æœ‰1.4.6,è¿™ä¸ªå¥½åƒæ˜¯ç¨³å®šä¸€äº›çš„,è€å¸ˆç”¨çš„æ˜¯1.1.4</p>
</blockquote>
<p>ä¸‹äº†ä¸ª1.4.6çš„,<a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases/tag/1.4.6">ä¸‹è½½é“¾æ¥</a></p>
<p>æ‰¾åˆ°&#x2F;bin&#x2F;startup.cmd,å´å‘ç°æŠ¥é”™:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;nacos is starting with cluster&quot;</span><br><span class="line">Error occurred during initialization of VM</span><br><span class="line">Could not reserve enough space for 2097152KB object heap</span><br></pre></td></tr></table></figure>
<p>è¯´nacosåœ¨é›†ç¾¤ä¸‹å¯åŠ¨,ç›®å‰æ˜¯ç”¨å•æœºç‰ˆçš„,æ‰€ä»¥è¦æ”¹é…ç½®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ°set MODE=&quot;cluster&quot;,æ”¹ä¸ºstandalone</span></span><br><span class="line"><span class="built_in">set</span> MODE=<span class="string">&quot;standalone&quot;</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æˆåŠŸ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823202604.png" alt="20230823202604"></p>
<p>è¿›å…¥<code>http://localhost:8848/nacos</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823202814.png" alt="20230823202814"></p>
<p>è¿™ç•Œé¢é«˜çº§å•Š(è´¦å·å¯†ç nacos)<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823202845.png" alt="20230823202845"></p>
<h3 id="nacosæœåŠ¡æ³¨å†Œ"><a href="#nacosæœåŠ¡æ³¨å†Œ" class="headerlink" title="nacosæœåŠ¡æ³¨å†Œ"></a>nacosæœåŠ¡æ³¨å†Œ</h3><p>çˆ¶å·¥ç¨‹å·²ç»å¼•å…¥äº†alibaba,å­æ¨¡å—9001åªéœ€è¦å¼•å…¥:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶ä¸­:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éšä¾¿å†™ä¸€ä¸ªcontrolleræ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-23 20:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry,serverPort: &quot;</span> + serverPort + <span class="string">&quot;\t id: &quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•æˆåŠŸ<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823204602.png" alt="20230823204602"></p>
<p>åœ¨8848çš„æœåŠ¡ç®¡ç†é‡Œé¢å¯ä»¥çœ‹åˆ°æœåŠ¡åˆ—è¡¨:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823204800.png" alt="20230823204800"></p>
<p>æ ¹æ®9001å†å†™ä¸€ä¸ª9002å‡ºæ¥:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823205659.png" alt="20230823205659"></p>
<p><em>è¿˜å¯ä»¥æ‹·è´è™šæ‹Ÿç«¯å£æ˜ å°„,ä¸è¿‡å¥½åƒä¸å¤ªå¥½ç”¨</em></p>
<blockquote>
<p>æ¶ˆè´¹è€…æœåŠ¡æ³¨å†Œ<code>cloudalibaba-consumer-nacos-order83</code>,æ¶ˆè´¹è€…çš„ä¾èµ–æ˜¯å’Œç”Ÿäº§è€…ä¸€æ ·çš„,éƒ½æ˜¯</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>nacosè‡ªå¸¦ribbonçš„è´Ÿè½½å‡è¡¡æ•ˆæœ</strong></p>
<p>83çš„é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„<code>service-url</code>å°±å¯ä»¥æ ¹æ®æœåŠ¡å,è‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡äº†(å…¶å®å°±æ˜¯æ‰¾åˆ°æœåŠ¡åä¸º<code>nacos-payment-provider</code>çš„æœåŠ¡,ç„¶åè‡ªåŠ¨åˆ†é…è°ƒç”¨)</p>
<p>çœ‹çœ‹controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;service-url.nacos-payment-provider&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL + <span class="string">&quot;/payment/nacos/&quot;</span> + id, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ˜¯æ²¡æœ‰å†™ip,è€Œæ˜¯ç”¨çš„æœåŠ¡å</p>
<p><strong>è¿™é‡Œè¦æ³¨æ„,ä½¿ç”¨restTemplateè¦ä½¿ç”¨é…ç½®ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzmr.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> zzyy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020-02-10 12:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823213553.png" alt="20230823213553"></p>
<p>å“ˆå“ˆå“ˆå“ˆ,è€å¸ˆæ­£è¯´:å¦‚æœä¸€åˆ‡é¡ºåˆ©..,ç„¶åå°±å˜æˆä¸€åˆ‡ä¸é¡ºåˆ©äº†,åŸæ¥æ˜¯æ²¡æœ‰ç»™restTemplateçš„getæ–¹æ³•ä¸Šæ²¡åŠ <code>@LoadBalanced</code></p>
<p>ç„¶åæˆ‘åˆé‡å¯é¡¹ç›®,å‘ç°è¿˜æ˜¯æŠ¥é”™,æœ€å¥½æ‰¾åˆ°é”™è¯¯åœ¨<code>@Value</code>çš„<code>$&#123;&#125;</code>å–å€¼ä¸Š,å–å€¼çš„åå­—å†™é”™äº†</p>
<p>å³å¯å®ç°è´Ÿè½½å‡è¡¡:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823214750.png" alt="20230823214750"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823214808.png" alt="20230823214808"></p>
<h3 id="å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a>å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h3><p>Nacosçš„æ˜¯å¯ä»¥AP&#x2F;CPäº’æ¢çš„<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823215114.png" alt="20230823215114"></p>
<p>å¯¹æ¯”å›¾:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823215248.png" alt="20230823215248"></p>
<blockquote>
<p>Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢<br>Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„,è€ŒAçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”</p>
</blockquote>
<p>ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼?<br>ä¸€èˆ¬æ¥è¯´</p>
<ul>
<li>å¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œ,å¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥,é‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼,å½“å‰ä¸»æµçš„æœåŠ¡å¦‚Spring Cloudå’ŒDubboæœåŠ¡,éƒ½é€‚ç”¨äºAPæ¨¡å¼,APæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§,å› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹</li>
<li>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯,é‚£ä¹ˆCPæ˜¯å¿…é¡»çš„,K8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼,CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹,æ­¤æ—¶åˆ™æ˜¯ä»¥Raftåè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼,è¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡,å¦‚æœæœåŠ¡ä¸å­˜åœ¨,åˆ™ä¼šè¿”å›é”™è¯¯</li>
</ul>
<p>é‚£ä¹ˆä¸€èˆ¬å°±æ˜¯çœ‹è¿™ä¸ªå›¾:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823215903.png" alt="20230823215903"></p>
<h3 id="nacosæœåŠ¡é…ç½®ä¸­å¿ƒ"><a href="#nacosæœåŠ¡é…ç½®ä¸­å¿ƒ" class="headerlink" title="nacosæœåŠ¡é…ç½®ä¸­å¿ƒ"></a>nacosæœåŠ¡é…ç½®ä¸­å¿ƒ</h3><h4 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h4><p>æ–°å»ºæ¨¡å—:<code>cloudalibaba-config-nacos-client3377</code></p>
<p>æ–°çš„ä¾èµ–:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos-config--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos-discovery--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯å¤šäº†ä¸ª<code>nacos-config</code></p>
<p>ç„¶åé…ç½®æ–‡ä»¶å¤šäº†,æœ‰ä¸¤ä¸ª</p>
<ol>
<li>bootstrap.yml<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacosé…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>application.yml<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¦ä¸¤ä¸ª</strong><br>NacosåŒspringcloud-configä¸€æ ·,åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶,è¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–,æ‹‰å»é…ç½®å,æ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨</p>
<p>SpringBootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„,bootstrapä¼˜å…ˆçº§é«˜äºapplication</p>
<hr>
<p>åœ¨<code>Nacos Spring Cloud</code>ä¸­,dataIdçš„å®Œæ•´æ ¼å¼å¦‚ä¸‹<br><code>$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</code></p>
<ol>
<li><code>prefix</code>é»˜è®¤ä¸º<code>spring.application.name</code>çš„å€¼,ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹<code>spring.cloud.nacos.config.prefix</code>æ¥é…ç½®</li>
<li><code>spring.profile.active</code>å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„profile,æ³¨æ„:å½“<code>spring.profile.active</code>ä¸ºç©ºæ—¶,å¯¹åº”çš„è¿æ¥ç¬¦-ä¹Ÿå°†ä¸å­˜åœ¨,dataIdçš„æ‹¼æ¥æ ¼å¼å˜æˆ<code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code></li>
<li><code>file-extension</code>ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼,å¯ä»¥é€šè¿‡é…ç½®é¡¹<code>spring.cloud.nacos.config.file-extension</code>æ¥é…ç½®,ç›®å‰æ”¯æŒ<code>properties</code>å’Œ<code>yaml</code>ç±»å‹<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823224331.png" alt="20230823224331"></li>
</ol>
<p>æ‰€ä»¥,æŒ‰ç…§å…¬å¼,è¿™ä¸ª3377æ‹¼å‡ºæ¥çš„å°±æ˜¯<code>nacos-config-client-dev.yml</code></p>
<p>ç„¶åå»nacosé…ç½®é¡µé¢é…ç½®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823224113.png" alt="20230823224113"></p>
<p>ç„¶åå°±æŠ¥é”™äº†,DataIdå†™æˆyml,å…¶å®è¦å†™æˆyaml,ä¹Ÿå°±æ˜¯å…¨ç§°</p>
<p>æ”¹æˆè¿™æ ·:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823224715.png" alt="20230823224715"></p>
<p>ç„¶åè®¿é—®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230823225654.png" alt="20230823225654"></p>
<p>ä¿®æ”¹ä¹‹å,ä¹Ÿèƒ½åŠ¨æ€åˆ·æ–°</p>
<h4 id="åˆ†ç±»é…ç½®"><a href="#åˆ†ç±»é…ç½®" class="headerlink" title="åˆ†ç±»é…ç½®"></a>åˆ†ç±»é…ç½®</h4><blockquote>
<p>é—®é¢˜ä¸€:<br>å®é™…å¼€å‘ä¸­,é€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡</p>
</blockquote>
<ul>
<li>devå¼€å‘ç¯å¢ƒ</li>
<li>testæµ‹è¯•ç¯å¢ƒ</li>
<li>prodç”Ÿäº§ç¯å¢ƒ<br>å¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ°Nacosä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å‘¢</li>
</ul>
<blockquote>
<p>é—®é¢˜2:<br>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šå¾®æœåŠ¡å­é¡¹ç›®,æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®åˆéƒ½ä¼šæœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒ,é¢„å‘ç¯å¢ƒ,æ­£å¼ç¯å¢ƒ,é‚£ä¹ˆæ€ä¹ˆå¯¹è¿™äº›å¾®æœåŠ¡é…ç½®è¿›è¡Œç®¡ç†å‘¢</p>
</blockquote>
<hr>
<p>é»˜è®¤æƒ…å†µ:Namespace&#x3D;public,Group&#x3D;DEFAULT_GROUP,é»˜è®¤Clusteræ˜¯DEFAULT</p>
<ol>
<li>æŒ‡å®šspring.profile.activeå’Œé…ç½®æ–‡ä»¶çš„DataIDæ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½®</li>
<li>é»˜è®¤ç©ºé—´+é»˜è®¤åˆ†ç»„+æ–°å»ºdevå’Œtestä¸¤ä¸ªDataID</li>
<li>é€šè¿‡spring.profile.activeå±æ€§å°±èƒ½è¿›è¡Œå¤šç¯å¢ƒä¸‹é…ç½®æ–‡ä»¶çš„è¯»å–</li>
</ol>
<blockquote>
<p><strong>æ ¹æ®DataIDé…ç½®</strong></p>
</blockquote>
<p>æ–°çš„testé…ç½®,ä¸åŒçš„DataId,ä½†æ˜¯æ˜¯åŒä¸€ç»„çš„<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824101701.png" alt="20230824101701"></p>
<p>è¿™ä¸ªapplication.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line"><span class="comment">#    active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure>

<p>æ¿€æ´»å“ªä¸ª,å°±ä¼šç”¨å“ªä¸ª</p>
<p>æµ‹è¯•æˆåŠŸ<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824102113.png" alt="20230824102113"></p>
<blockquote>
<p><strong>æ ¹æ®groupæ¥é…ç½®</strong></p>
</blockquote>
<p>æ–°å»ºé…ç½®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824102523.png" alt="20230824102523"></p>
<p>å†å»ºä¸€ä¸ªtest<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824102811.png" alt="20230824102811"></p>
<p>ç„¶åæ›´æ”¹é…ç½®æ–‡ä»¶:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824103002.png" alt="20230824103002"></p>
<p>æŒ‡å®šTEST_GROUP,å°±ä¼šå¾—åˆ°TEST<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824103112.png" alt="20230824103112"></p>
<p><code>group</code>æ”¹æˆå•¥å°±æ˜¯å•¥</p>
<blockquote>
<p><strong>NameSpace</strong>æ–¹æ¡ˆ</p>
</blockquote>
<ol>
<li>æ–°å»ºdev&#x2F;testçš„Namespace</li>
</ol>
<ul>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824105704.png" alt="20230824105704"></li>
</ul>
<ol start="2">
<li>å›åˆ°æœåŠ¡ç®¡ç†-æœåŠ¡åˆ—è¡¨æŸ¥çœ‹</li>
<li>æŒ‰ç…§åŸŸåé…ç½®å¡«å†™,æ–°å¢<code>namespace</code><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">a84323ef-99d0-463f-ae99-b3aa7eec8966</span></span><br></pre></td></tr></table></figure></li>
<li>YML</li>
</ol>
<p>åœ¨devé…ç½®ä¸­,æ·»åŠ è¿™äº›é…ç½®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824111022.png" alt="20230824111022"></p>
<p>â€¦</p>
<p>åœ¨è€ƒè™‘æ˜¯ä¸æ˜¯è¦å»çœ‹é»‘é©¬çš„cloudçš„è§†é¢‘</p>
<h3 id="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"><a href="#Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®" class="headerlink" title="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"></a><strong>Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</strong></h3><p>é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨,å¦‚æœå¯ç”¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹,æ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€æ‰§è¡Œé—®é¢˜çš„,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,Nacosé‡‡ç”¨äº†é›†ä¸­å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²,ç›®å‰åªæ”¯æŒMySqlçš„å­˜å‚¨</p>
<h4 id="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®-1"><a href="#Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®-1" class="headerlink" title="Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"></a>Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</h4><p><em>nacosé»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“derby</em></p>
<ol>
<li>å»nacosçš„confæ–‡ä»¶å¤¹ä¸‹,è¿è¡Œnacos-mysql.sqlè„šæœ¬,å»ºåº“è¡¨</li>
<li>æ‰¾åˆ°confä¸‹çš„application.properties,åŠ ä¸Š<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">010203</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p>é‡å¯nacos,å°±ä¼šå‘ç°,ä¹‹å‰çš„é…ç½®å…¨æ²¡äº†(å‚»é€¼çš„æ˜¯,é‚£ä¸ªurlè¦åŠ ä¸€å †ä¸œè¥¿,æ‰èƒ½å¯åŠ¨èµ·æ¥â€¦)</p>
<p>æ–°å»ºé…ç½®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824120122.png" alt="20230824120122"></p>
<p>ç„¶ååœ¨config_infoè¡¨ä¸­å³å¯æŸ¥çœ‹åˆ°æ•°æ®:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824120154.png" alt="20230824120154"></p>
<hr>
<blockquote>
<p><strong>Linuxç‰ˆNacos+MySqlç”Ÿäº§ç¯å¢ƒé…ç½®</strong></p>
</blockquote>
<p>è¿™ä¸ªæœ‰ç‚¹éº»çƒ¦äº†,æœåŠ¡å™¨ä¸Šä¸çŸ¥é“èƒ½ä¸èƒ½é…</p>
<p>å…ˆæŠŠlinuxç‰ˆçš„nacosä¸‹è½½ä¸‹æ¥,ç„¶åä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Š,è§£å‹<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825105114.png" alt="20230825105114"></p>
<p>é›†ç¾¤é…ç½®æ­¥éª¤:</p>
<ol>
<li>è¦ç”¨åˆ°æ•°æ®åº“,çœ‹æ¥è¿˜æ˜¯è¦ç”¨dockeræ¥åˆ›å»ºä¸€ä¸ª,åˆ›å»ºäº†åŠå¤©,è¿˜æ˜¯æœ‰æƒé™é—®é¢˜,æ‰€ä»¥æŠŠä¹‹å‰çš„é…ç½®æ–‡ä»¶è·¯å¾„æ¢æˆæ–°çš„äº†,ç°åœ¨æ˜¯æ²¡é—®é¢˜äº†</li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶<code>application.properties</code><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.platform=mysql</span><br><span class="line"></span><br><span class="line">db.num=1db.url.0=jdbc:mysql://1.14.102.11:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">db.user=root</span><br><span class="line">db.password=123456</span><br></pre></td></tr></table></figure></li>
<li>LinuxæœåŠ¡å™¨ä¸Šçš„nacosçš„é›†ç¾¤é…ç½®<code>cluster.conf</code><ul>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825112723.png" alt="20230825112723"></li>
<li>é…ç½®å†…å®¹:</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825112921.png" alt="20230825112921"></li>
<li>é¡ºä¾¿å»æ§åˆ¶å°æ”¾è¡Œäº†ç«¯å£çš„é˜²ç«å¢™:<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825113258.png" alt="20230825113258"></li>
</ul>
</li>
<li>ç¼–è¾‘Nacosçš„å¯åŠ¨è„šæœ¬<code>startup.sh</code>,ä½¿å®ƒèƒ½å¤Ÿæ¥å—ä¸åŒçš„å¯åŠ¨ç«¯å£ <ul>
<li>é›†ç¾¤å¯åŠ¨,æˆ‘ä»¬å¸Œæœ›å¯ä»¥ç±»ä¼¼å…¶ä»–è½¯ä»¶çš„shellå‘½ä»¤,ä¼ é€’ä¸åŒçš„ç«¯å£å·å¯åŠ¨ä¸åŒçš„nacoså®ä¾‹,å‘½ä»¤:<code>./startup.sh -p 3333</code>è¡¨ç¤ºå¯åŠ¨ç«¯å£å·ä¸º3333çš„nacosæœåŠ¡å™¨å®ä¾‹,å’Œä¸Šä¸€æ­¥çš„cluster.confé…ç½®çš„ä¸€è‡´</li>
<li>è€å¸ˆçš„æ˜¯è¿™ä¸ªæ ·å­çš„:<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825114028.png" alt="20230825114028"></li>
<li>è€Œæˆ‘çš„æ–°ç‰ˆé»˜è®¤å°±æ˜¯å››ä¸ªå‚æ•°,ç”¨ä¸åˆ°åŠ <code>:p</code>äº†</li>
<li>æœ€åé¢æ”¹æˆ:<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825115050.png" alt="20230825115050"></li>
</ul>
</li>
</ol>
<hr>
<p>é…ç½®nginx</p>
<ol>
<li>dockeré…ç½®nginx:<ul>
<li>æ‰§è¡Œå‘½ä»¤:<code>docker run --name nginx01 -p 80:80 -v /zzmr/nginx/nginx.conf:/etc/nginx/nginx.conf --privileged=true -d nginx</code>,å³å¯åˆ›å»ºä¸€ä¸ªnginxå®¹å™¨</li>
<li>è¯¥nginxçš„é…ç½®æ–‡ä»¶å°±åœ¨<code>/etc/nginx</code>,è¿™é‡Œä½¿ç”¨äº†å®¹å™¨å·,å› ä¸ºè¦æ”¹å†™é…ç½®æ–‡ä»¶,nginxå®¹å™¨ä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªç¼–è¾‘åŠŸèƒ½çš„,æ‰€ä»¥åªèƒ½æ”¹å¥½äº†ç„¶åæŒ‚è½½è¿‡å»</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825130236.png" alt="20230825130236"></li>
</ul>
</li>
</ol>
<hr>
<p><strong>å¯åŠ¨</strong></p>
<p>ç›´æ¥æ‰§è¡Œ<code>bash startup.sh -p 3333</code>,æ‰§è¡ŒæˆåŠŸ,å¦å¤–ä¸¤å°åŒç†<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230825131057.png" alt="20230825131057"></p>
<p>â€¦</p>
<p>nacoså¯åŠ¨ä¸äº†,ä¸€ç›´æç¤ºjdkæœ‰é—®é¢˜</p>
<p><strong>æš‚æ—¶åˆ°è¿™,å»çœ‹è‹ç©¹å¤–å–å§</strong></p>
<p>2023å¹´8æœˆ25æ—¥ 14ç‚¹53åˆ†</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="å¤´åƒ"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" title="å¤´åƒ" alt="å¤´åƒ"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" title="å¤´åƒ" alt="å¤´åƒ"></a><div class="post-copyright__author_name">Jimmy</div><div class="post-copyright__author_desc">æ¡ƒä¹‹å¤­å¤­ï¼Œç¼ç¼å…¶å</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®" href="https://jimmy66886.github.io/posts/96a41905.html">åŸåˆ›</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://jimmy66886.github.io/posts/96a41905.html')">SpringCloud</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="èµèµä½œè€…"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>æ‰“èµä½œè€…</div><div class="reward-main"><div class="reward-all"><span class="reward-title">æ„Ÿè°¢ä½ èµäºˆæˆ‘å‰è¿›çš„åŠ›é‡</span><ul class="reward-group"><li class="reward-item"><a href="https://img01.zzmr.club/img/chatpay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/chatpay.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://img01.zzmr.club/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/alipay.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">èµèµè€…åå•</div><div class="reward-dec">å› ä¸ºä½ ä»¬çš„æ”¯æŒè®©æˆ‘æ„è¯†åˆ°å†™æ–‡ç« çš„ä»·å€¼ğŸ™</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« "><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://jimmy66886.github.io/posts/96a41905.html"></div><div class="reward-dec">ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« </div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SpringCloud&amp;url=https://jimmy66886.github.io/posts/96a41905.html&amp;pic=https://img01.zzmr.club/img/springcloud.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="å¤åˆ¶é“¾æ¥" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://jimmy66886.github.io" target="_blank">ZZMR</a>ï¼</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/SpringCloud/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SpringCloud<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img01.zzmr.club/img/20231105105155.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/234602c1.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230613131406.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Github Pagesç»‘å®šåŸŸå</div></div></a></div><div class="next-post pull-right"><a href="/posts/ed8fc0b2.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824205147.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Hexo Algoliaé…ç½®</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> è¯„è®º</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">åŒ¿åè¯„è®º</a><a href="/privacy" style="margin-left: 4px">éšç§æ”¿ç­–</a></div><div class="comment-tips" id="comment-tips"><span>âœ… ä½ æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¯„è®ºä»¥è·å–æœ€ä½³å±•ç¤ºæ•ˆæœ</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar" title="ç‚¹å‡»å±•å¼€"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">éƒ½æ˜¯å­¦ä¹ ç¬”è®°å’Œç”Ÿæ´»çäº‹<b style="color:#fff"></b><b style="color:#fff">è¡Œä¹‹æ‰€å‘,å³å¿ƒä¹‹æ‰€å‘</b><b style="color:#fff"></b></div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff"></b><b style="color:#fff"></b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Jimmy</h1><div class="author-info__desc">æ¡ƒä¹‹å¤­å¤­ï¼Œç¼ç¼å…¶å</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/jimmy66886/" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>æ–‡ç« ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringCloud"><span class="toc-number">1.</span> <span class="toc-text">SpringCloud</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%8ESpringCloud"><span class="toc-number">1.1.</span> <span class="toc-text">1 å¾®æœåŠ¡æ¶æ„ä¸SpringCloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%8E2-2-x%E5%92%8CH%E7%89%88%E5%BC%80%E5%A7%8B%E8%AF%B4%E8%B5%B7"><span class="toc-number">1.2.</span> <span class="toc-text">2 ä»2.2.xå’ŒHç‰ˆå¼€å§‹è¯´èµ·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%85%B3%E4%BA%8ECloud%E5%90%84%E7%A7%8D%E7%BB%84%E4%BB%B6%E7%9A%84%E5%81%9C%E6%9B%B4-x2F-%E5%8D%87%E7%BA%A7-x2F-%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">3 å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´&#x2F;å‡çº§&#x2F;æ›¿æ¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.</span> <span class="toc-text">4 å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">æ–°å»ºé¡¹ç›®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.2.</span> <span class="toc-text">å»ºç«‹å­æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%87%8D%E6%9E%84"><span class="toc-number">1.4.3.</span> <span class="toc-text">å·¥ç¨‹é‡æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">1.5.</span> <span class="toc-text">5 EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EurekaServer%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.1.</span> <span class="toc-text">EurekaServeræœåŠ¡ç«¯å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A18001%E5%85%A5%E4%BD%8F%E8%BF%9BEureka-Server"><span class="toc-number">1.5.2.</span> <span class="toc-text">å¾®æœåŠ¡8001å…¥ä½è¿›Eureka Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EurekeClient%E7%AB%AFcloud-consumer-order80"><span class="toc-number">1.5.3.</span> <span class="toc-text">EurekeClientç«¯cloud-consumer-order80</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.4.</span> <span class="toc-text">é›†ç¾¤é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98%E4%B8%A4%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E8%BF%9BEureka%E9%9B%86%E7%BE%A4"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">è®¢å•æ”¯ä»˜ä¸¤å¾®æœåŠ¡æ³¨å†Œè¿›Eurekaé›†ç¾¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#actuator%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF%E5%AE%8C%E5%96%84"><span class="toc-number">1.5.5.</span> <span class="toc-text">actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0Discovery"><span class="toc-number">1.5.6.</span> <span class="toc-text">æœåŠ¡å‘ç°Discovery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Eureka%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4"><span class="toc-number">1.5.7.</span> <span class="toc-text">Eurekaè‡ªæˆ‘ä¿æŠ¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">1.6.</span> <span class="toc-text">6 ZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-number">1.6.1.</span> <span class="toc-text">æœåŠ¡æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E8%BF%9BZookeeper"><span class="toc-number">1.6.2.</span> <span class="toc-text">è®¢å•æœåŠ¡æ³¨å†Œè¿›Zookeeper</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-number">1.7.</span> <span class="toc-text">7 ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.7.1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E6%B3%A8%E5%86%8C"><span class="toc-number">1.7.2.</span> <span class="toc-text">æœåŠ¡æä¾›è€…æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85%E6%B3%A8%E5%86%8C"><span class="toc-number">1.7.3.</span> <span class="toc-text">æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%BC%82%E5%90%8C%E7%82%B9"><span class="toc-number">1.7.4.</span> <span class="toc-text">ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">8 Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3RestTemplate"><span class="toc-number">1.8.1.</span> <span class="toc-text">è¯¦è§£RestTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ribbon%E9%BB%98%E8%AE%A4%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%A7%84%E5%88%99"><span class="toc-number">1.8.2.</span> <span class="toc-text">Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"><span class="toc-number">1.8.3.</span> <span class="toc-text">Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA"><span class="toc-number">1.8.4.</span> <span class="toc-text">æ‰‹å†™ä¸€ä¸ª</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-number">1.9.</span> <span class="toc-text">9 OpenFeignæœåŠ¡æ¥å£è°ƒç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.1.</span> <span class="toc-text">OpenFeignä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E7%9A%84%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6"><span class="toc-number">1.9.2.</span> <span class="toc-text">OpenFeignçš„è¶…æ—¶æ§åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenFeign%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">1.9.3.</span> <span class="toc-text">OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Hystrix"><span class="toc-number">1.10.</span> <span class="toc-text">10 Hystrix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hystrix%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">1.10.1.</span> <span class="toc-text">Hystrixé‡è¦æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">æœåŠ¡é™çº§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">æœåŠ¡ç†”æ–­</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hystrix%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.10.3.</span> <span class="toc-text">hystrixå·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hystrix%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">1.10.4.</span> <span class="toc-text">hystrixä»ªè¡¨ç›˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-zuul%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3%E5%92%8CGateway%E6%96%B0%E4%B8%80%E4%BB%A3%E7%BD%91%E5%85%B3"><span class="toc-number">1.11.</span> <span class="toc-text">11 zuulè·¯ç”±ç½‘å…³å’ŒGatewayæ–°ä¸€ä»£ç½‘å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway%E7%BD%91%E5%85%B3%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.11.1.</span> <span class="toc-text">Gatewayç½‘å…³å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAGateway9527%E6%A8%A1%E5%9D%97"><span class="toc-number">1.11.2.</span> <span class="toc-text">åˆ›å»ºGateway9527æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GateWay%E9%85%8D%E7%BD%AE%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.11.3.</span> <span class="toc-text">GateWayé…ç½®åŠ¨æ€è·¯ç”±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Predicate%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.11.4.</span> <span class="toc-text">Predicateçš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter"><span class="toc-number">1.11.5.</span> <span class="toc-text">Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-SpringCloud-Config"><span class="toc-number">1.12.</span> <span class="toc-text">12 SpringCloud Config</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Config%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.12.1.</span> <span class="toc-text">ConfigæœåŠ¡ç«¯é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">1.12.2.</span> <span class="toc-text">å®¢æˆ·ç«¯é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0"><span class="toc-number">1.12.3.</span> <span class="toc-text">åŠ¨æ€åˆ·æ–°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF"><span class="toc-number">1.13.</span> <span class="toc-text">13 Busæ¶ˆæ¯æ€»çº¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AERabbitMq"><span class="toc-number">1.13.1.</span> <span class="toc-text">é…ç½®RabbitMq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="toc-number">1.13.2.</span> <span class="toc-text">è®¾è®¡æ€æƒ³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">1.13.3.</span> <span class="toc-text">æ›´æ”¹é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-cloud-Stream"><span class="toc-number">1.14.</span> <span class="toc-text">14 cloud Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cloud-Steam%E7%AE%80%E4%BB%8B"><span class="toc-number">1.14.1.</span> <span class="toc-text">cloud Steamç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cloud-Stream%E6%A0%87%E5%87%86%E6%B5%81%E7%A8%8B%E5%A5%97%E8%B7%AF"><span class="toc-number">1.14.2.</span> <span class="toc-text">Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D"><span class="toc-number">1.14.3.</span> <span class="toc-text">å®æ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%B6%88%E8%B4%B9%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.14.4.</span> <span class="toc-text">åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">é‡å¤æ¶ˆè´¹é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.14.4.2.</span> <span class="toc-text">æŒä¹…åŒ–</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-Sleuth"><span class="toc-number">1.15.</span> <span class="toc-text">15 Sleuth</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7"><span class="toc-number">1.15.1.</span> <span class="toc-text">æ­å»ºé“¾è·¯ç›‘æ§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E9%85%8D%E7%BD%AE-1"><span class="toc-number">1.15.2.</span> <span class="toc-text">æ›´æ”¹é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-SpringCloud-Alibaba-%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.16.</span> <span class="toc-text">16 SpringCloud Alibaba å…¥é—¨ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-Nacos"><span class="toc-number">1.17.</span> <span class="toc-text">17 Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.17.1.</span> <span class="toc-text">ä»‹ç»å’Œä¸‹è½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C"><span class="toc-number">1.17.2.</span> <span class="toc-text">nacosæœåŠ¡æ³¨å†Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94"><span class="toc-number">1.17.3.</span> <span class="toc-text">å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">1.17.4.</span> <span class="toc-text">nacosæœåŠ¡é…ç½®ä¸­å¿ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.17.4.1.</span> <span class="toc-text">åŸºç¡€é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E9%85%8D%E7%BD%AE"><span class="toc-number">1.17.4.2.</span> <span class="toc-text">åˆ†ç±»é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos%E9%9B%86%E7%BE%A4%E5%92%8C%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.17.5.</span> <span class="toc-text">Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nacos%E9%9B%86%E7%BE%A4%E5%92%8C%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE-1"><span class="toc-number">1.17.5.1.</span> <span class="toc-text">Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>æœ€è¿‘å‘å¸ƒ</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/bdf92eba.html" title="Ciy Mag68é©±åŠ¨ä½¿ç”¨æ•™ç¨‹"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20231105105155.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ciy Mag68é©±åŠ¨ä½¿ç”¨æ•™ç¨‹"/></a><div class="content"><a class="title" href="/posts/bdf92eba.html" title="Ciy Mag68é©±åŠ¨ä½¿ç”¨æ•™ç¨‹">Ciy Mag68é©±åŠ¨ä½¿ç”¨æ•™ç¨‹</a><time datetime="2023-11-05T02:46:13.000Z" title="å‘è¡¨äº 2023-11-05 10:46:13">2023-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/72387302.html" title="é›†åˆé¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/logo_list.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="é›†åˆé¢ç»"/></a><div class="content"><a class="title" href="/posts/72387302.html" title="é›†åˆé¢ç»">é›†åˆé¢ç»</a><time datetime="2023-10-10T05:09:39.000Z" title="å‘è¡¨äº 2023-10-10 13:09:39">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1e320f13.html" title="æ¡†æ¶é¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/logo (4).png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ¡†æ¶é¢ç»"/></a><div class="content"><a class="title" href="/posts/1e320f13.html" title="æ¡†æ¶é¢ç»">æ¡†æ¶é¢ç»</a><time datetime="2023-10-10T03:07:31.000Z" title="å‘è¡¨äº 2023-10-10 11:07:31">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b0e1545b.html" title="Mysqlé¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/æ‹¾å…‰_è´ªé£Ÿé¬¼_6684.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mysqlé¢ç»"/></a><div class="content"><a class="title" href="/posts/b0e1545b.html" title="Mysqlé¢ç»">Mysqlé¢ç»</a><time datetime="2023-10-10T01:29:15.000Z" title="å‘è¡¨äº 2023-10-10 09:29:15">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a91f5ba1.html" title="ç´¢å¼•çš„æ•°æ®ç»“æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/DSC08725.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç´¢å¼•çš„æ•°æ®ç»“æ„"/></a><div class="content"><a class="title" href="/posts/a91f5ba1.html" title="ç´¢å¼•çš„æ•°æ®ç»“æ„">ç´¢å¼•çš„æ•°æ®ç»“æ„</a><time datetime="2023-09-30T02:44:41.000Z" title="å‘è¡¨äº 2023-09-30 10:44:41">2023-09-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜" title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡" title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²" title="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/Hosted-Vercel.svg" alt="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²"/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN" title="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/CDN-jsDelivr.svg" alt="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20238040" style="margin-inline:5px" data-title="èŒICPå¤‡20238040å·" title="èŒICPå¤‡20238040å·"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20238040-fe1384" alt="èŒICPå¤‡20238040å·"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="Jimmy" target="_blank">Jimmy</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="ä¸»é¢˜">ä¸»é¢˜</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> éš§é“</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æˆ‘çš„</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/maps/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> å¯¼èˆª</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> æ¸¸æˆäººç”Ÿ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> ç›¸å†Œé›†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/staticIndex/test.html"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> èˆ”ç‹—æ—¥è®°</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div><span class="sidebar-menu-item-title">æ ‡ç­¾</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOP/" style="font-size: 0.88rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 0.88rem;">Ajax<sup>1</sup></a><a href="/tags/Algolia/" style="font-size: 0.88rem;">Algolia<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 0.88rem;">Axios<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/JVM/" style="font-size: 0.88rem;">JVM<sup>1</sup></a><a href="/tags/MySql/" style="font-size: 0.88rem;">MySql<sup>2</sup></a><a href="/tags/Promise/" style="font-size: 0.88rem;">Promise<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 0.88rem;">SSM<sup>3</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>1</sup></a><a href="/tags/SpingBoot/" style="font-size: 0.88rem;">SpingBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 0.88rem;">SpringCloud<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 0.88rem;">VsCode<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>1</sup></a><a href="/tags/mag68/" style="font-size: 0.88rem;">mag68<sup>1</sup></a><a href="/tags/maven/" style="font-size: 0.88rem;">maven<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 0.88rem;">ä¸»ä»å¤åˆ¶<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">å›¾åºŠ<sup>1</sup></a><a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 0.88rem;">åŸŸå<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">å¹´åº¦æ€»ç»“<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">å¼€å‘<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 0.88rem;">æ—…è¡Œ<sup>5</sup></a><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 0.88rem;">æ‚è°ˆ<sup>1</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE%E5%A4%96%E6%8C%82/" style="font-size: 0.88rem;">æ ‡ç­¾å¤–æŒ‚<sup>1</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">çº¿ç¨‹<sup>1</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 0.88rem;">ç¾åŒ–<sup>1</sup></a><a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" style="font-size: 0.88rem;">è‹ç©¹å¤–å–<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">é¢è¯•<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶é€‰ä¸­æ–‡æœ¬</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>ç²˜è´´æ–‡æœ¬</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>å¼•ç”¨åˆ°è¯„è®º</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>å¤åˆ¶é“¾æ¥åœ°å€</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>å¤åˆ¶æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>ä¸‹è½½æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç«™å†…æœç´¢</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç™¾åº¦æœç´¢</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>æ’­æ”¾éŸ³ä¹</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>åˆ‡æ¢åˆ°ä¸Šä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶æ­Œå</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>åšå®¢åˆ†ç±»</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶åœ°å€</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">å…³é—­çƒ­è¯„</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">æ·±è‰²æ¨¡å¼</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>è½‰ç‚ºç¹é«”</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// æ¶ˆé™¤æ§åˆ¶å°æ‰“å°
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //åœ¨æ¢å¤å‰è¾“å‡ºæ—¥å¿—
  const grt = new Date("09/02/2022 00:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `æ¬¢è¿ä½¿ç”¨å®‰çŸ¥é±¼!`,
    `ç”Ÿæ´»æ˜æœ—, ä¸‡ç‰©å¯çˆ±`,
    `
        
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
      â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
      â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â•
        
        `,
    "å·²ä¸Šçº¿",
    dnum,
    "å¤©",
    "Â©2020 By å®‰çŸ¥é±¼ V1.6.1",
  ];
  const ascll2 = [`NCC2-036`, `è°ƒç”¨å‰ç½®æ‘„åƒå¤´æ‹ç…§æˆåŠŸï¼Œè¯†åˆ«ä¸ºã€å°ç¬¨è›‹ã€‘.`, `Photo captured: `, `ğŸ¤ª`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c ä½ å¥½ï¼Œå°ç¬¨è›‹.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c âš¡ Powered by å®‰çŸ¥é±¼ %c ä½ æ­£åœ¨è®¿é—® Jimmy çš„åšå®¢.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c ä½ å·²æ‰“å¼€æ§åˆ¶å°.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c ä½ ç°åœ¨æ­£å¤„äºç›‘æ§ä¸­.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.zzmr.club/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.zzmr.club/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.zzmr.club/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">é€šçŸ¥</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">ä½ å¥½å‘€</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>