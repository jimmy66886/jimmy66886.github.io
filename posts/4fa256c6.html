<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>è‹ç©¹å¤–å– | ZZMR</title><meta name="keywords" content="è‹ç©¹å¤–å–"><meta name="author" content="Jimmy"><meta name="copyright" content="Jimmy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="è‹ç©¹å¤–å–"><meta name="application-name" content="è‹ç©¹å¤–å–"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="è‹ç©¹å¤–å–"><meta property="og:url" content="https://jimmy66886.github.io/posts/4fa256c6.html"><meta property="og:site_name" content="ZZMR"><meta property="og:description" content="è‹ç©¹å¤–å–é¡¹ç›®"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img01.zzmr.club/img/sky-take-out.png"><meta property="article:author" content="Jimmy"><meta property="article:tag" content="ä¸ªäººåšå®¢"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img01.zzmr.club/img/sky-take-out.png"><meta name="description" content="è‹ç©¹å¤–å–é¡¹ç›®"><link rel="shortcut icon" href="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg"><link rel="canonical" href="https://jimmy66886.github.io/posts/4fa256c6"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"404 Not Found","backTitle":"500 Internal Server Error"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo.zzmr.club/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: {"appId":"F9JLPTATA5","apiKey":"59b226541195bbf63bef817349ad87b5","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"è¾“å…¥å…³é”®è¯åæŒ‰ä¸‹å›è½¦æŸ¥æ‰¾","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€","rightMenuMsgToTraditionalChinese":"è½¬ä¸ºç¹ä½“","rightMenuMsgToSimplifiedChinese":"è½¬ä¸ºç®€ä½“"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"ä½œè€…: Jimmy","link":"é“¾æ¥: ","source":"æ¥æº: ZZMR","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","copySuccess":"å¤åˆ¶æˆåŠŸï¼Œå¤åˆ¶å’Œè½¬è½½è¯·æ ‡æ³¨æœ¬æ–‡åœ°å€"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZZMR',
  title: 'è‹ç©¹å¤–å–',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-10-07 22:52:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/about-tag.css"><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="åŠ è½½å¤´åƒ" src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">ç½‘é¡µ</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://index.zzmr.club/" title="ä¸ªäººä¸»é¡µ"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/HOMEMESSAGE.png" alt="ä¸ªäººä¸»é¡µ"/><span class="back-menu-item-text">ä¸ªäººä¸»é¡µ</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.zzmr.club/" title="åšå®¢"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="åšå®¢"/><span class="back-menu-item-text">åšå®¢</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">å·¥å…·</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://tools.zzmr.club/" title="å›¾åºŠå®¹é‡"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/github-alt.png" alt="å›¾åºŠå®¹é‡"/><span class="back-menu-item-text">å›¾åºŠå®¹é‡</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">ZZMR</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> éš§é“</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æˆ‘çš„</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/maps/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> å¯¼èˆª</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> æ¸¸æˆäººç”Ÿ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> ç›¸å†Œé›†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/staticIndex/test.html"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> èˆ”ç‹—æ—¥è®°</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºå‰å¾€ä¸€ä¸ªæ–‡ç« " href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="æœç´¢ğŸ”" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> æœç´¢</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="ä¸­æ§å°" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://img01.zzmr.club/img/chatpay.jpg" target="_blank"><img class="post-qr-code-img" alt="å¾®ä¿¡" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/chatpay.jpg"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://img01.zzmr.club/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="æ”¯ä»˜å®" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/alipay.jpg"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">äº’åŠ¨</div><span class="author-content-item-title"> <span>æœ€æ–°è¯„è®º</span></span></div><div class="aside-list"><span>æ­£åœ¨åŠ è½½ä¸­...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">å…´è¶£ç‚¹</div><span class="author-content-item-title">å¯»æ‰¾ä½ æ„Ÿå…´è¶£çš„é¢†åŸŸ</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOP/" style="font-size: 1.05rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 1.05rem;">Ajax<sup>1</sup></a><a href="/tags/Algolia/" style="font-size: 1.05rem;">Algolia<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 1.05rem;">Axios<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/MySql/" style="font-size: 1.05rem;">MySql<sup>2</sup></a><a href="/tags/Promise/" style="font-size: 1.05rem;">Promise<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 1.05rem;">SSM<sup>3</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>1</sup></a><a href="/tags/SpingBoot/" style="font-size: 1.05rem;">SpingBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 1.05rem;">SpringCloud<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 1.05rem;">VsCode<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>1</sup></a><a href="/tags/maven/" style="font-size: 1.05rem;">maven<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.05rem;">ä¸»ä»å¤åˆ¶<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 1.05rem;">å›¾åºŠ<sup>1</sup></a><a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 1.05rem;">åŸŸå<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">å¹´åº¦æ€»ç»“<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">å¼€å‘<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 1.05rem;">æ—…è¡Œ<sup>5</sup></a><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 1.05rem;">æ‚è°ˆ<sup>1</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE%E5%A4%96%E6%8C%82/" style="font-size: 1.05rem;">æ ‡ç­¾å¤–æŒ‚<sup>1</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">çº¿ç¨‹<sup>1</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 1.05rem;">ç¾åŒ–<sup>1</sup></a><a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" style="font-size: 1.05rem;">è‹ç©¹å¤–å–<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">é¢è¯•<sup>4</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>æ–‡ç« </span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>å½’æ¡£</span><a class="card-more-btn" href="/archives/" title="æŸ¥çœ‹æ›´å¤š">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">åæœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">ä¹æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">å…«æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">å…­æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">äº”æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">å››æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">ä¸‰æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">äºŒæœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>ç¯‡</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" onclick="anzhiyu.switchDarkMode()" title="æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="è¾¹æ æ˜¾ç¤ºæ§åˆ¶"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="çƒ­è¯„å¼€å…³"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="éŸ³ä¹å¼€å…³"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">åŸåˆ›</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/" itemprop="url">é¡¹ç›®</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>è‹ç©¹å¤–å–</span></a></span></div></div><h1 class="post-title" itemprop="name headline">è‹ç©¹å¤–å–</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-30T01:15:57.000Z" title="å‘è¡¨äº 2023-08-30 09:15:57">2023-08-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-10-07T14:52:34.453Z" title="æ›´æ–°äº 2023-10-07 22:52:34">2023-10-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span id="" data-flag-title="è‹ç©¹å¤–å–"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="é˜…è¯»é‡">é˜…è¯»é‡:</span><span id="twikoo_visitors" title="è®¿é—®é‡"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="ä½œè€…IPå±åœ°ä¸ºæ±‰ä¸­"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>æ±‰ä¸­</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img01.zzmr.club/img/sky-take-out.png"></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://jimmy66886.github.io/posts/4fa256c6.html"><header><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/" itemprop="url">é¡¹ç›®</a><a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" tabindex="-1" itemprop="url">è‹ç©¹å¤–å–</a><h1 id="CrawlerTitle" itemprop="name headline">è‹ç©¹å¤–å–</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Jimmy</span><time itemprop="dateCreated datePublished" datetime="2023-08-30T01:15:57.000Z" title="å‘è¡¨äº 2023-08-30 09:15:57">2023-08-30</time><time itemprop="dateCreated datePublished" datetime="2023-10-07T14:52:34.453Z" title="æ›´æ–°äº 2023-10-07 22:52:34">2023-10-07</time></header><p>2023å¹´8æœˆ25æ—¥ 16ç‚¹04åˆ†</p>
<p><strong>è¿™åº”è¯¥æ˜¯å†™åœ¨ç®€å†ä¸Šçš„é¡¹ç›®äº†,å¾…å¥½å¥½å¯¹å¾…å•Š</strong></p>
<h1 id="1-é¡¹ç›®æ¦‚è¿°-amp-ç¯å¢ƒæ­å»º"><a href="#1-é¡¹ç›®æ¦‚è¿°-amp-ç¯å¢ƒæ­å»º" class="headerlink" title="1 é¡¹ç›®æ¦‚è¿°&amp;ç¯å¢ƒæ­å»º"></a>1 é¡¹ç›®æ¦‚è¿°&amp;ç¯å¢ƒæ­å»º</h1><p>æŠ€æœ¯é€‰å‹<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826093518.png" alt="20230826093518"></p>
<h2 id="å‰ç«¯ç¯å¢ƒæ­å»º"><a href="#å‰ç«¯ç¯å¢ƒæ­å»º" class="headerlink" title="å‰ç«¯ç¯å¢ƒæ­å»º"></a>å‰ç«¯ç¯å¢ƒæ­å»º</h2><p>?å¥½åƒä¹Ÿæ²¡æ­å»ºå•¥,ç›´æ¥æ‰“å¼€èµ„æ–™,åŒå‡»nginxå°±okäº†<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826102250.png" alt="20230826102250"></p>
<h2 id="åç«¯ç¯å¢ƒæ­å»º"><a href="#åç«¯ç¯å¢ƒæ­å»º" class="headerlink" title="åç«¯ç¯å¢ƒæ­å»º"></a>åç«¯ç¯å¢ƒæ­å»º</h2><p>è¿™åç«¯ä»£ç å·²ç»å†™å¥½ä¸€å¤§éƒ¨åˆ†äº†å•Š<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826102836.png" alt="20230826102836"></p>
<ol>
<li><code>sky-take-out</code>:mavençˆ¶å·¥ç¨‹,ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬,èšåˆå…¶ä»–å­æ¨¡å—</li>
<li><code>sky-common</code>:å­æ¨¡å—,å­˜æ”¾å…¬å…±ç±»,ä¾‹å¦‚:å·¥å…·ç±»,å¸¸é‡ç±»,å¼‚å¸¸ç±»ç­‰</li>
<li><code>sky-pojo</code>:å­æ¨¡å—,å­˜æ”¾å®ä½“ç±»,VO,DTOç­‰</li>
<li><code>sky-server</code>:å­æ¨¡å—,åç«¯æœåŠ¡,å­˜æ”¾é…ç½®æ–‡ä»¶,Controller,Service,Mapperç­‰</li>
</ol>
<hr>
<p><code>sky-pojo</code>æ¨¡å—ä»‹ç»<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826103421.png" alt="20230826103421"></p>
<ul>
<li><code>Entity</code>:å®ä½“,é€šå¸¸å’Œæ•°æ®åº“ä¸­çš„è¡¨å¯¹åº”</li>
<li><code>DTO</code>:æ•°æ®ä¼ è¾“å¯¹è±¡,é€šå¸¸ç”¨äºç¨‹åºä¸­å„å±‚ä¹‹é—´ä¼ é€’æ•°æ®</li>
<li><code>VO</code>:è§†å›¾å¯¹è±¡,ä¸ºå‰ç«¯å±•ç¤ºæ•°æ®æä¾›çš„å¯¹è±¡</li>
<li><code>pojo</code>:æ™®é€šJavaå¯¹è±¡,åªæœ‰å±æ€§å’Œå¯¹åº”çš„getterå’Œetter</li>
</ul>
<hr>
<blockquote>
<p><strong>ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶</strong></p>
</blockquote>
<p>å®³,è¿™æ¯”ç½‘,æ¨äº†åŠå¤©éƒ½æ¨ä¸åˆ°githubä¸Š</p>
<p>æ¨ä¸Šå»äº†,<a target="_blank" rel="noopener" href="https://github.com/jimmy66886/sky-take-out">ä»“åº“åœ°å€</a></p>
<h2 id="æ•°æ®åº“ç¯å¢ƒæ­å»º"><a href="#æ•°æ®åº“ç¯å¢ƒæ­å»º" class="headerlink" title="æ•°æ®åº“ç¯å¢ƒæ­å»º"></a>æ•°æ®åº“ç¯å¢ƒæ­å»º</h2><p>è¿™ä¸ªæ¯”è¾ƒå¥½å“,æœ‰ä¸€ä¸ªsqlå¤–åŠ ä¸€ä¸ªæ•°æ®åº“è®¾è®¡æ–‡æ¡£</p>
<p>å„ä¸ªè¡¨ä»‹ç»<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826110410.png" alt="20230826110410"></p>
<h2 id="å‰åç«¯è”è°ƒ"><a href="#å‰åç«¯è”è°ƒ" class="headerlink" title="å‰åç«¯è”è°ƒ"></a>å‰åç«¯è”è°ƒ</h2><p>åç«¯çš„åˆå§‹å·¥ç¨‹ä¸­å·²ç»å®ç°äº†ç™»å½•åŠŸèƒ½,ç›´æ¥è¿›è¡Œå‰åç«¯è”è°ƒæµ‹è¯•</p>
<p>è¿™é‡Œç”¨åˆ°äº†<strong>å…¨å±€å¼‚å¸¸å¤„ç†</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.exception.BaseException;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œå¤„ç†é¡¹ç›®ä¸­æŠ›å‡ºçš„ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•è·ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(BaseException ex)</span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;å¼‚å¸¸ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.error(ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç”¨æˆ·ç™»å½•æ¥å£ä¸­,ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (employee == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//è´¦å·ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccountNotFoundException</span>(MessageConstant.ACCOUNT_NOT_FOUND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¦‚æœå‡ºç°å¼‚å¸¸,å°±ä¼šè¢« <code>GlobalExceptionHandler</code>æ•è·åˆ°,<strong>æŠ›å‡ºçš„æ˜¯AccountNotFoundException,èƒ½è¢«Globalæ•è·æ˜¯å› ä¸ºè¯¥å¼‚å¸¸ç»§æ‰¿è‡ªBaseException</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountNotFoundException</span> <span class="keyword">extends</span> <span class="title class_">BaseException</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>ä¸‹é¢ç”¨åˆ°äº†Builder,å¯ä»¥ç”¨æ¥åˆ›å»ºå¯¹è±¡,ç‰¹ç‚¹æ˜¯<strong>æ–¹æ³•åå³ä¸ºå±æ€§å,ä½¿ç”¨å‰ææ˜¯å®ä½“ç±»ä¸ŠåŠ ä¸Š <code>@Builder</code>æ³¨è§£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">EmployeeLoginVO</span> <span class="variable">employeeLoginVO</span> <span class="operator">=</span> EmployeeLoginVO.builder()</span><br><span class="line">        .id(employee.getId())</span><br><span class="line">        .userName(employee.getUsername())</span><br><span class="line">        .name(employee.getName())</span><br><span class="line">        .token(token)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<h2 id="Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"><a href="#Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡" class="headerlink" title="Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"></a>Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</h2><p><strong>åå‘ä»£ç†</strong></p>
<p>åˆšçœ‹äº†Nginxçš„é…ç½®æ–‡ä»¶,åŸæ¥æ˜¯ç”¨äº†åå‘ä»£ç†</p>
<p>å‰ç«¯è¯·æ±‚åœ°å€:<code>http://localhost/api/employee/login</code><br>åç«¯æ¥å£åœ°å€:<code>http://localhost:8080/admin/employee/login</code></p>
<p>æ‰€è°“åå‘ä»£ç†,å°±æ˜¯å°†å‰ç«¯å‘é€çš„åŠ¨æ€è¯·æ±‚ç”±nginxè½¬å‘åˆ°åç«¯æœåŠ¡å™¨</p>
<p>ä½¿ç”¨nginxçš„å¥½å¤„:</p>
<ol>
<li>æé«˜è®¿é—®é€Ÿåº¦<ul>
<li>nginxä¼šå¯¹è¯·æ±‚åœ°å€è¿›è¡Œç¼“å­˜,ç›¸åŒçš„è¯·æ±‚ä¸å¿…å†å‘é€è‡³åç«¯<em>é‚£åç«¯æ•°æ®å˜äº†æ€ä¹ˆåŠ?</em></li>
</ul>
</li>
<li>è¿›è¡Œè´Ÿè½½å‡è¡¡<ul>
<li>æ‰€è°“è´Ÿè½½å‡è¡¡,å°±æ˜¯æŠŠå¤§é‡çš„è¯·æ±‚æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ–¹å¼å‡è¡¡çš„åˆ†é…ç»™é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨</li>
</ul>
</li>
<li>ä¿è¯åç«¯æœåŠ¡å®‰å…¨<ul>
<li>åç«¯æœåŠ¡ä¸æš´éœ²åˆ°å¤–ç½‘</li>
</ul>
</li>
</ol>
<p>è¯¥é¡¹ç›®ä¸­çš„åå‘ä»£ç†:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        # åå‘ä»£ç†,å¤„ç†ç®¡ç†ç«¯å‘é€çš„è¯·æ±‚</span><br><span class="line">        location /api/ &#123;</span><br><span class="line">			proxy_pass   http://localhost:8080/admin/;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±ç›¸å½“äº,å‰ç«¯è¯·æ±‚çš„ <code>http://localhost/api</code>,ä¼šè¢«è½¬å‘åˆ° <code>http://localhost:8080/admin/</code>,åé¢çš„ <code>employee/login</code>æ˜¯ä¸å˜çš„</p>
<hr>
<p><strong>è´Ÿè½½å‡è¡¡</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream webservers&#123;</span><br><span class="line">	  server 127.0.0.1:8080 weight=90 ;</span><br><span class="line">	  #server 127.0.0.1:8088 weight=10 ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    location /api/&#123;</span><br><span class="line">        proxy_pass http://webservers/amdin/; # è´Ÿè½½å‡è¡¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚è¿‡æ¥æ—¶,<code>localhost:80/api/xxxx</code>ä¼šè¢«è½¬å‘åˆ° <code>http://webservers/amdin/xxx</code>,è€Œè¿™ä¸ª <code>webservers</code>å°±æ˜¯é…ç½®ä¸­çš„å¤šä¸ª <code>server</code>,nginxä¼šå¯¹è¿™äº›serverè¿›è¡Œåˆ†é…,<code>server</code>åé¢åŠ ä¸Š <code>weight</code>è¡¨ç¤ºæƒé‡,è¿™æ˜¯ä¸€ç§è´Ÿè½½å‡è¡¡çš„ç­–ç•¥<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826170157.png" alt="20230826170157"></p>
<h2 id="å®Œå–„ç™»å½•åŠŸèƒ½"><a href="#å®Œå–„ç™»å½•åŠŸèƒ½" class="headerlink" title="å®Œå–„ç™»å½•åŠŸèƒ½"></a>å®Œå–„ç™»å½•åŠŸèƒ½</h2><p>ç°åœ¨çš„é—®é¢˜:<strong>å¯†ç æ˜æ–‡å­˜å‚¨</strong></p>
<ol>
<li>å°†å¯†ç åŠ å¯†åå­˜å‚¨,æé«˜å®‰å…¨æ€§</li>
<li>ä½¿ç”¨MD5åŠ å¯†æ–¹å¼å¯¹æ˜æ–‡å¯†ç åŠ å¯†</li>
</ol>
<p>123456åŠ å¯†åä¸º:<code>e10adc3949ba59abbe56e057f20f883e</code></p>
<p>ä¾ç¨€è®°å¾—ä¹‹å‰è¿˜è‡ªå·±å†™md5åŠ å¯†çš„ä»£ç ,åŸæ¥springè‡ªå¸¦å•Š,ä¸€è¡Œä»£ç å°±å®Œæˆäº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO åæœŸéœ€è¦è¿›è¡Œmd5åŠ å¯†ï¼Œç„¶åå†è¿›è¡Œæ¯”å¯¹</span></span><br><span class="line">password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br></pre></td></tr></table></figure>

<p>md5DigestAsHex()å‡½æ•°å°±æ˜¯å°†å­—ç¬¦ä¸²(çš„bytes)è¿›è¡Œmd5åŠ å¯†</p>
<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><p>åœ¨è¿™ä¹‹å‰è¿˜å¼•å…¥äº†yapi,ä¸è¿‡æš‚æ—¶ç”¨ä¸åˆ°</p>
<p>è¿™ä¸€å°èŠ‚å¯ä»¥æ”¾åˆ°æˆ‘çš„<strong>å¼€å‘å·¥å…·ç®±é‡Œ</strong></p>
<p>ä½¿ç”¨Swaggeråªéœ€è¦æŒ‰ç…§å®ƒçš„è§„èŒƒå»å®šä¹‰æ¥å£åŠæ¥å£ç›¸å…³çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥åšåˆ°ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œä»¥åŠ<strong>åœ¨çº¿æ¥å£è°ƒè¯•</strong>é¡µé¢,<code>Knife4j</code>æ˜¯ä¸ºJava MVCæ¡†æ¶é›†æˆSwaggerç”ŸæˆApiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆ</p>
<p><strong>ä½¿ç”¨æ–¹å¼</strong></p>
<ol>
<li>å¯¼å…¥ä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨é…ç½®ç±»ä¸­åŠ å…¥ <code>knife4j</code>ç›¸å…³é…ç½®(æŸä¸ªå¸¦æœ‰ <code>@Configuration</code>çš„é…ç½®ç±»ä¸­å³å¯)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡knife4jç”Ÿæˆæ¥å£æ–‡æ¡£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">            .title(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">            .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">            .apiInfo(apiInfo)</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build();</span><br><span class="line">    <span class="keyword">return</span> docket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®¾ç½®é™æ€èµ„æºæ˜ å°„,å¦åˆ™æ¥å£æ–‡æ¡£é¡µé¢æ— æ³•è®¿é—®(è¦æ”¾åœ¨æŸä¸ªç»§æ‰¿è‡ª <code>WebMvcConfigurationSupport</code>ç±»ä¸­),è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯é‡å†™çš„çˆ¶ç±»çš„æ–¹æ³•<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826201101.png" alt="20230826201101"></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¡ºä¾¿æŠŠè¿™ä¸ªé…ç½®ç±»ä¹Ÿæ”¾ç€:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.interceptor.JwtTokenAdminInterceptor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»ï¼Œæ³¨å†Œwebå±‚ç›¸å…³ç»„ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenAdminInterceptor jwtTokenAdminInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨...&quot;</span>);</span><br><span class="line">        registry.addInterceptor(jwtTokenAdminInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/admin/employee/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡knife4jç”Ÿæˆæ¥å£æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;è‹ç©¹å¤–å–é¡¹ç›®æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>è¿™å°±é…ç½®å¥½äº†,å¯åŠ¨é¡¹ç›®è¿›å…¥æµè§ˆå™¨è®¿é—® <code>localhost:8080/doc.html</code>,å³å¯è¿›å…¥æ¥å£æ–‡æ¡£é¡µé¢<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826201533.png" alt="20230826201533"></p>
<hr>
<blockquote>
<p>Swaggerå’Œyapiçš„åŒºåˆ«</p>
</blockquote>
<ol>
<li>yapiæ˜¯<strong>è®¾è®¡é˜¶æ®µ</strong>ä½¿ç”¨çš„å·¥å…·,ç®¡ç†å’Œç»´æŠ¤æ¥å£</li>
<li>Swaggeræ˜¯åœ¨<strong>å¼€å‘é˜¶æ®µ</strong>ä½¿ç”¨çš„æ¡†æ¶,å¸®åŠ©åç«¯å¼€å‘äººå‘˜åšåç«¯çš„æ¥å£æµ‹è¯•</li>
</ol>
<h3 id="Swaggerå¸¸ç”¨æ³¨è§£"><a href="#Swaggerå¸¸ç”¨æ³¨è§£" class="headerlink" title="Swaggerå¸¸ç”¨æ³¨è§£"></a>Swaggerå¸¸ç”¨æ³¨è§£</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826202517.png" alt="20230826202517"></p>
<p>å…·ä½“ä½¿ç”¨æ¡ˆä¾‹</p>
<ol>
<li><code>@Api(tags = &quot;å‘˜å·¥ç›¸å…³æ¥å£&quot;)</code>,ç»™Controllerä¸ŠåŠ ,åœ¨é¡µé¢ä¸Šè¡¨ç¤ºä¸€çº§ç›®å½•,**tags&#x3D;**ä¸èƒ½çœç•¥,å¦åˆ™æ— æ•ˆ,</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;å‘˜å·¥ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>@ApiOperation(value = &quot;å‘˜å·¥ç™»å½•æ¥å£&quot;)</code>,ç»™æ¥å£ä¸ŠåŠ ,è¡¨ç¤ºå…·ä½“æ¥å£çš„åç§°</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;å‘˜å·¥ç™»å½•æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;EmployeeLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeLoginDTO employeeLoginDTO)</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>@ApiModel</code>å’Œ <code>@ApiModelProperty()</code>,ç»™å®ä½“ç±»å’Œå±æ€§ä¸ŠåŠ </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(description = &quot;å‘˜å·¥ç™»å½•æ—¶ä¼ é€’çš„æ•°æ®æ¨¡å‹&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ç”¨æˆ·å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;å¯†ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-å‘˜å·¥ç®¡ç†"><a href="#2-å‘˜å·¥ç®¡ç†" class="headerlink" title="2 å‘˜å·¥ç®¡ç†"></a>2 å‘˜å·¥ç®¡ç†</h1><h2 id="æ–°å¢å‘˜å·¥"><a href="#æ–°å¢å‘˜å·¥" class="headerlink" title="æ–°å¢å‘˜å·¥"></a>æ–°å¢å‘˜å·¥</h2><p>äº§å“åŸå‹:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826222241.png" alt="20230826222241"></p>
<p>è¿™é‡Œåˆè¯´äº†ä¸€ä¸‹ <code>DTO</code>çš„ç”¨å¤„,æˆ‘ä»¬çš„å®ä½“ç±»æ˜¯è·Ÿæ•°æ®åº“è¿›è¡Œæ˜ å°„çš„,è€Œ <code>DTO</code>,æ˜¯ç”¨æ¥å°è£…å‰ç«¯æ¥æ”¶çš„ä¿¡æ¯çš„,è¿™ä¸ª <code>EmployeeDTO</code>,å°±æ˜¯ç”¨æ¥å°è£…æ–°å¢å‘˜å·¥ä¿¡æ¯çš„,æˆ‘ä»¬çš„å®ä½“ç±»ä¸­çš„å±æ€§è¦æ¯” <code>DTO</code>å¤šä¸€äº›(ä¸Šé¢é‚£ä¸ªç™»å½•çš„DTO,ä¹Ÿæ˜¯å’Œç™»å½•ä¿¡æ¯æœ‰å…³çš„)<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230826223342.png" alt="20230826223342"></p>
<hr>
<p><strong>ä»£ç å¼€å‘</strong></p>
<blockquote>
<p>Controller,è°ƒç”¨serviceçš„saveæ–¹æ³•,ç„¶åè¿”å›æˆåŠŸ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢å‘˜å·¥&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ–°å¢å‘˜å·¥ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, employeeDTO);</span><br><span class="line"></span><br><span class="line">    employeeService.save(employeeDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<ol>
<li>å°±åƒä¸‹é¢è¯´çš„,è™½ç„¶æ¥æ”¶å‰ç«¯çš„æ•°æ®çš„æ˜¯DTO,ä½†æ˜¯å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’è¿˜æ˜¯ç”¨å®ä½“ç±»,æ‰€ä»¥è¿™é‡Œæ¶‰åŠåˆ°ç±»å‹è½¬æ¢,ç”¨ <code>BeanUtils.copyProperties(source,target)</code>èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„copyå¯¹è±¡,<strong>å‰ææ˜¯å±æ€§åä¸€è‡´</strong></li>
<li>å¯†ç æ˜¯é»˜è®¤çš„,ä¸º <code>123456</code>,å­˜å…¥æ•°æ®åº“çš„è¦è¿›è¡Œmd5åŠ å¯†</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å‘˜å·¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è™½ç„¶å‰ç«¯ä¼ æ¥çš„æ˜¯DTO,ä½†æ˜¯è¿˜æ˜¯å»ºè®®è·Ÿæ•°æ®äº¤äº’æ—¶ä½¿ç”¨å®ä½“ç±»,æ‰€ä»¥è¿™é‡Œè¦è¿›è¡Œç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹è±¡å±æ€§æ‹·è´--å¦‚æœä½¿ç”¨setä¸€ä¸ªä¸€ä¸ªå†™ï¼Œæ˜¯å¾ˆç¹ççš„</span></span><br><span class="line">        <span class="comment">// å‰ææ˜¯å±æ€§åä¸€è‡´</span></span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®è´¦å·çš„çŠ¶æ€ 1 è¡¨ç¤ºæ­£å¸¸ï¼Œè¿™é‡Œä½¿ç”¨å¸¸é‡ç±»ï¼Œé˜²æ­¢ç¡¬ç¼–ç </span></span><br><span class="line">        employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line">        <span class="comment">// å¯†ç é»˜è®¤ä¸º123456-md5åŠ å¯†åå†å­˜</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line">        employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®è®°å½•çš„åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line">        <span class="comment">// TODO åæœŸéœ€è¦æ”¹ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„id</span></span><br><span class="line">        employee.setCreateUser(<span class="number">10L</span>);</span><br><span class="line">        employee.setCreateUser(<span class="number">10L</span>);</span><br><span class="line"></span><br><span class="line">        employeeMapper.save(employee);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,è¿™ä¸ªå°±æ²¡ä»€ä¹ˆè¯´çš„äº†.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥å‘˜å·¥æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into employee(name,username,password,phone,sex,id_number,create_time,update_time,create_user,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;update_user,status) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;values(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>

<p><em>æ˜å¤©è§</em></p>
<blockquote>
<p><strong>ä»£ç å®Œå–„</strong></p>
</blockquote>
<p>ç›®å‰å­˜åœ¨çš„é—®é¢˜</p>
<ol>
<li>å½•å…¥çš„ç”¨æˆ·åå­˜åœ¨,æŠ›å‡ºå¼‚å¸¸åæ²¡æœ‰å¤„ç†</li>
<li>æ–°å¢å‘˜å·¥æ—¶,åˆ›å»ºäººidå’Œä¿®æ”¹äººidè®¾ç½®ä¸ºäº†å›ºå®šå€¼</li>
</ol>
<p>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜,ä½¿ç”¨å¼‚å¸¸å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span> &#123;</span><br><span class="line">    <span class="comment">// Duplicate entry &#x27;admin&#x27; for key &#x27;employee.idx_username&#x27;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">    <span class="keyword">if</span> (message.contains(<span class="string">&quot;Duplicate entry&quot;</span>)) &#123;</span><br><span class="line">        String[] messageArr = message.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">repeatName</span> <span class="operator">=</span> messageArr[<span class="number">2</span>];</span><br><span class="line">        <span class="comment">// return Result.error(repeatName + &quot;è¯¥ç”¨æˆ·åå·²å­˜&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(repeatName + MessageConstant.ALREADY_EXISTS);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº <code>ç”¨æˆ·åå­˜åœ¨</code>å¯¼è‡´sqlæ‰§è¡Œæ—¶çš„å”¯ä¸€æ€§çš„é—®é¢˜,ä¼šæŠ¥é”™:<code>Duplicate entry &#39;admin&#39; for key &#39;employee.idx_username</code>,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯æ¥è·å–éœ€è¦çš„å†…å®¹,æœ€ç»ˆå°è£…è¿”å›ç»“æœ</p>
<hr>
<p>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜</p>
<p>è¿™é‡Œå°±æ¶‰åŠåˆ°Jwt Tokenäº†,ä¹‹å‰ç”¨è¿‡,ä½†æ˜¯è¯´å®è¯,æˆ‘å¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šæ€ä¹ˆç”¨<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230827101540.png" alt="20230827101540"></p>
<p><strong>å¯ä»¥é€šè¿‡è§£æè¯·æ±‚å¤´ä¸­çš„token,æ¥å¾—åˆ°æ˜¯å“ªä¸ªç”¨æˆ·å‘èµ·çš„è¯·æ±‚</strong><br>ä½†æ˜¯è·å–åˆ°ä¹‹å,å¦‚ä½•ä¼ é€’ç»™service?</p>
<p>æ‰€ä»¥å¼•å…¥ <code>ThreadLocal</code>,<code>ThreadLocal</code>å¹¶ä¸æ˜¯ä¸€ä¸ª <code>Thread</code>,è€Œæ˜¯ <code>Thread</code>çš„å±€éƒ¨å˜é‡<br><code>ThreadLocal</code>ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å•ç‹¬ä¸€ä»½å­˜å‚¨ç©ºé—´,å…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœ,åªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–åˆ°å¯¹åº”çš„å€¼,çº¿ç¨‹å¤–åˆ™ä¸èƒ½è®¿é—®</p>
<p><strong>æ¯æ¬¡è¯·æ±‚,éƒ½æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</strong></p>
<blockquote>
<p><strong>ThreadLocal</strong>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<ol>
<li><code>public void set(T value)</code> è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li>
<li><code>public T get()</code> è¿”å›å½“å‰çº¿ç¨‹å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li>
<li><code>public void remove()</code> ç§»é™¤å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡</li>
</ol>
<p>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå·¥å…·ç±»:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€å…±ä¸¤å¤„ä¿®æ”¹:</p>
<ol>
<li>JwtTokenAdminInterceptoræ‹¦æˆªå™¨,åœ¨æ‹¿åˆ°tokenä¸­çš„empIdæ—¶,å°†è¯¥empIdå­˜å…¥ThreadLocalä¸­</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2ã€æ ¡éªŒä»¤ç‰Œ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;jwtæ ¡éªŒ:&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());</span><br><span class="line">            log.info(<span class="string">&quot;å½“å‰å‘˜å·¥idï¼š&#123;&#125;&quot;</span>, empId);</span><br><span class="line">            <span class="comment">// å°†empIdå­˜å…¥ThreadLocal</span></span><br><span class="line">            BaseContextByMe.setCurrentId(empId);</span><br><span class="line">            <span class="comment">// 3ã€é€šè¿‡ï¼Œæ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">// 4ã€ä¸é€šè¿‡ï¼Œå“åº”401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Serviceä¸­,åœ¨è®¾ç½®ç™»å½•ç”¨æˆ·çš„idå¤„,å–å‡ºThreadLocalä¸­çš„empId</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®è®°å½•çš„åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line"><span class="comment">// ä»ThreadLocalä¸­è·å–åˆ°ç™»å½•ç”¨æˆ·çš„id</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">employee.setCreateUser(empId);</span><br><span class="line">employee.setUpdateUser(empId);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"><a href="#å‘˜å·¥åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="å‘˜å·¥åˆ†é¡µæŸ¥è¯¢"></a>å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</h2><blockquote>
<p>ä¸šåŠ¡è§„åˆ™</p>
</blockquote>
<ol>
<li>æ ¹æ®é¡µç å±•ç¤ºå‘˜å·¥ä¿¡æ¯</li>
<li>æ¯é¡µå±•ç¤º10æ¡æ•°æ®</li>
<li>åˆ†é¡µæŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®éœ€è¦,è¾“å…¥å‘˜å·¥å§“åè¿›è¡ŒæŸ¥è¯¢</li>
</ol>
<hr>
<p>è¿™é‡Œå°è£…äº†ä¸€ä¸ªPageResultå¯¹è±¡,<strong>åé¢æ‰€æœ‰çš„åˆ†é¡µæŸ¥è¯¢,ç»Ÿä¸€éƒ½å°è£…æˆPageResultå¯¹è±¡</strong>,ç„¶åæœ€åè¿”å›ç»™å‰ç«¯çš„è¿˜æ˜¯Result,ä¸º <code>Result&lt;PageResult&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°è£…åˆ†é¡µæŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> total; <span class="comment">//æ€»è®°å½•æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List records; <span class="comment">//å½“å‰é¡µæ•°æ®é›†åˆ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åˆ°çš„åˆ†é¡µæ’ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰è¿™ä¸ªåˆ†é¡µæ’ä»¶å’Œmpçš„åˆ†é¡µåŒºåˆ«æŒºå¤§çš„,ä½†æ˜¯è¯´å®è¯,æˆ‘ç°åœ¨å¹¶ä¸å¤ªæƒ³ç”¨mp,è¿™ç©æ„å¼±åŒ–sqlçš„èƒ½åŠ›å“.</p>
<p><strong>ä»£ç å¼€å‘</strong></p>
<blockquote>
<p>Controller,è¿™é‡Œæ˜¯ç›´æ¥æ‹¿è¯·æ±‚å‚æ•°çš„,ä¸æ˜¯è¯·æ±‚ä½“,æ‰€ä»¥ä¸ç”¨ <code>@RequestBody</code>æ³¨è§£,ç”¨åˆ°çš„EmployeePageQueryDTOä¹Ÿæ˜¯éå¸¸ç®€å•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeePageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘˜å·¥å§“å</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¡µç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;å‘˜å·¥åˆ†é¡µæŸ¥è¯¢,å‚æ•°ä¸ºï¼š&#123;&#125;&quot;</span>, employeePageQueryDTO);</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> employeeService.pageQuery(employeePageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Serviceä¸­,ä½¿ç”¨åˆ°äº† <code>PageHelper</code>,é‡ç‚¹åœ¨äº <code>PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());</code>,ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰é¡µ,ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¯é¡µä¸ªæ•°,è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å‰ç«¯ä¼ æ¥çš„.æœ€åè°ƒç”¨mapperæŸ¥è¯¢æ•°æ®åº“</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å‘åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());</span><br><span class="line">    Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);</span><br><span class="line">    <span class="comment">// è¿™ä¹ä¸€çœ‹æ„Ÿè§‰Pageå’ŒPageHelperæ²¡æœ‰ä¼ é€’å‚æ•°çš„å…³ç³»ï¼Œä½†æ˜¯å…¶å®startPageé‡Œé¢æ˜¯ç”¨åˆ°äº†ThreadLocalæ¥å–å€¼çš„</span></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">    List&lt;Employee&gt; records = page.getResult();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,å› ä¸ºä½¿ç”¨äº†åˆ†é¡µæ’ä»¶,è¿™ä¸ªåˆ†é¡µæ’ä»¶ä¼šåŠ¨æ€çš„æ‹¼æ¥limit,æ‰€ä»¥è¿™é‡Œä¸ç”¨å†å†™limitäº†,åªéœ€è¦æ‹¼æ¥å¯é€‰å‚æ•°å§“åå³å¯</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Page&lt;Employee&gt; pageQuery(EmployeePageQueryDTO employeePageQueryDTO); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=&#x27;&#x27;and name!=null&quot;</span>&gt;</span></span><br><span class="line">            name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by create_time DESC</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•æ•´ä½“æ²¡ä»€ä¹ˆé—®é¢˜,ä½†æ˜¯è¿”å›çš„create_time,ä¹Ÿå°±æ˜¯æ—¥æœŸæ ¼å¼æœ‰é—®é¢˜</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lisi&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æå››&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;17513571211&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;412827200104013984&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">46</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">12</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">46</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">12</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhuozhuo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç¼ç¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;17513741212&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;idNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;111111112313213&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">38</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">16</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">38</span><span class="punctuation">,</span></span><br><span class="line">          <span class="number">16</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;createUser&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateUser&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å‰ç«¯å±•ç¤ºçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230827142346.png" alt="20230827142346"></p>
<p><strong>ä»£ç å®Œå–„</strong></p>
<p>è§£å†³æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§</p>
<ol>
<li>åœ¨å±æ€§ä¸ŠåŠ å…¥æ³¨è§£,å¯¹æ—¥æœŸè¿›è¡Œæ ¼å¼åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormt(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨WebMvcConfigurationä¸­æ‰©å±•SpringMVCçš„æ¶ˆæ¯è½¬æ¢å™¨,ç»Ÿä¸€å¯¹æ—¥æœŸç±»å‹è¿›è¡Œæ ¼å¼åŒ–å¤„ç†(<strong>æ¨èä½¿ç”¨,ä¸€åŠ³æ°¸é€¸</strong>)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰©å±•SpringMVCæ¡†æ¶çš„æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line"><span class="comment"> * å¯¹åç«¯è¿”å›ç»™å‰ç«¯çš„æ•°æ®è¿›è¡Œ ç»Ÿä¸€ çš„å¤„ç†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> converters the list of configured converters to extend</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ‰©å±•æ¶ˆæ¯è½¬æ¢å™¨-ç”¨äºæ—¥æœŸæ ¼å¼åŒ–&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å¯¹è±¡</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    <span class="comment">// éœ€è¦ä¸ºæ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ä¸€ä¸ªå¯¹è±¡è½¬æ¢å™¨,å¯ä»¥å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonæ•°æ®</span></span><br><span class="line">    converter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">    <span class="comment">// å°†è‡ªå·±çš„æ¶ˆæ¯è½¬æ¢å™¨åŠ å…¥åˆ°å®¹å™¨ä¸­,ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£è¡¨ç´¢å¼•,ä¹Ÿå³æ˜¯è¿™ä¸ªè½¬æ¢å™¨çš„ä¼˜å…ˆçº§,è¶Šå°è¶Šé«˜</span></span><br><span class="line">    converters.add(<span class="number">0</span>, converter);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ok,å‘˜å·¥åˆ†ç±»æŸ¥è¯¢ç»“æŸ</p>
<h2 id="å¯ç”¨-x2F-ç¦ç”¨å‘˜å·¥è´¦å·"><a href="#å¯ç”¨-x2F-ç¦ç”¨å‘˜å·¥è´¦å·" class="headerlink" title="å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·"></a>å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·</h2><p>è¿™ä¸ªæ•´ä½“è¿˜æ˜¯ç®€å•è®¸å¤šçš„,å°±æ˜¯æ¥å—å‰ç«¯å‘æ¥çš„çŠ¶æ€,å·²ç»è¦ä¿®æ”¹çš„å‘˜å·¥id</p>
<blockquote>
<p>Controller,<strong>è·¯å¾„å‚æ•°è¦ç”¨æ³¨è§£æ¥è·å–ï¼Œè€Œåœ°å€æ ä¼ å‚ä¸éœ€è¦åŠ æ³¨è§£</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment"> * å‚æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è·¯å¾„å‚æ•°ï¼Œè·¯å¾„å‚æ•°è¦ç”¨æ³¨è§£æ¥è·å–ï¼Œè€Œåœ°å€æ ä¼ å‚ä¸éœ€è¦åŠ æ³¨è§£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status, Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·ï¼š status:&#123;&#125;, id:&#123;&#125;&quot;</span>, status, id);</span><br><span class="line">    employeeService.startOrStop(status,id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™é‡Œä¹Ÿç”¨åˆ°äº†Builder,updateæ–¹æ³•å¯ä»¥æ ¹æ®ä¼ å…¥å¯¹è±¡çš„id,ä¿®æ”¹ä»»æ„çš„å­—æ®µ-åŠ¨æ€sql</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯ç”¨/ç¦ç”¨å‘˜å·¥è´¦å·</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> Employee.builder().id(id).status(status).build();</span><br><span class="line"></span><br><span class="line">    employeeMapper.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,è¿™é‡Œè¿˜ä¸èƒ½å†™æˆ <code>test=&quot;username != null and username != &#39;&#39;&quot;</code>,è¿˜å¿…é¡»åªèƒ½å†™æˆè¿™æ ·çš„..</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    void update(Employee employee);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update employee</span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">                username = #&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">                phone = #&#123;phone&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; sex != null&quot;</span>&gt;</span></span><br><span class="line">                sex = #&#123;sex&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idNumber != null&quot;</span>&gt;</span></span><br><span class="line">                id_number = #&#123;idNumber&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time = #&#123;updateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span></span><br><span class="line">                update_user = #&#123;updateUser&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status!=null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ç¼–è¾‘å‘˜å·¥"><a href="#ç¼–è¾‘å‘˜å·¥" class="headerlink" title="ç¼–è¾‘å‘˜å·¥"></a>ç¼–è¾‘å‘˜å·¥</h2><p>ç¼–è¾‘å‘˜å·¥åŠŸèƒ½æ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£</p>
<ol>
<li>æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</li>
</ol>
<blockquote>
<p>Controller<br>è¿™ä¸ªè¿˜æ˜¯å¾ˆç®€å•çš„</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¸»è¦å°±æ˜¯æ³¨æ„å¯†ç è¦é‡å†™ä¸€é,ä¸èƒ½ç›´æ¥å‘è¿‡å»,å°±ç®—æ˜¯åŠ å¯†è¿‡çš„ä¹Ÿä¸èƒ½å‘</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getById(id);</span><br><span class="line">    <span class="comment">// å¯†ç ä¸ä¼šå‘é€åˆ°å‰ç«¯</span></span><br><span class="line">    employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> employee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–è¾‘å‘˜å·¥ä¿¡æ¯</li>
</ol>
<blockquote>
<p>Controller,è¿˜æ˜¯ä½¿ç”¨çš„ <code>EmployeeDTO</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ç¼–è¾‘å‘˜å·¥ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    employeeService.update(employeeDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,é¦–å…ˆåˆ›å»ºä¸€ä¸ªemployeeå¯¹è±¡,å› ä¸ºç»™æ•°æ®åº“å­˜æ•°æ®éƒ½æ˜¯ç”¨çš„å®ä½“ç±»,è¿™é‡Œåˆç”¨åˆ°äº† <code>BeanUtils</code>æ¥copyå¯¹è±¡,æœ€åå†æŠŠ <code>ThreadLocal</code>ä¸­çš„å½“å‰ç”¨æˆ·id,ä¹Ÿå°±æ˜¯ <code>è°æ›´æ–°çš„</code>è®¾ç½®è¿›æ¥,å†ç”¨ä¸Šé¢æ›´æ–°å‘˜å·¥çŠ¶æ€çš„ <code>update</code>æ–¹æ³•å³å¯.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line"></span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateUser(BaseContextByMe.getCurrentId());</span><br><span class="line"></span><br><span class="line">    employeeMapper.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-åˆ†ç±»ç®¡ç†"><a href="#3-åˆ†ç±»ç®¡ç†" class="headerlink" title="3 åˆ†ç±»ç®¡ç†"></a>3 åˆ†ç±»ç®¡ç†</h1><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><ol>
<li>åˆ†ç±»åç§°å¿…é¡»<strong>å”¯ä¸€</strong></li>
<li>åˆ†ç±»æŒ‰ç…§ç±»å‹å¯ä»¥åˆ†ä¸º<strong>èœå“åˆ†ç±»</strong>å’Œ<strong>å¥—é¤åˆ†ç±»</strong></li>
<li>æ–°æ·»åŠ çš„åˆ†ç±»çŠ¶æ€é»˜è®¤ä¸º<strong>ç¦ç”¨</strong></li>
</ol>
<h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><ol>
<li>æ–°å¢åˆ†ç±»</li>
<li>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</li>
<li>æ ¹æ®idåˆ é™¤åˆ†ç±»</li>
<li>ä¿®æ”¹åˆ†ç±»</li>
<li>å¯ç”¨ç¦ç”¨åˆ†ç±»</li>
<li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</li>
</ol>
<p>è€å¸ˆçš„æ„æ€æ˜¯ç›´æ¥cväº†,å› ä¸ºæ•´ä½“é€»è¾‘å’Œå‘˜å·¥ç®¡ç†å·®ä¸å¤š,æˆ‘è‡ªå·±å†™ä¸€éå§</p>
<h3 id="æ–°å¢åˆ†ç±»"><a href="#æ–°å¢åˆ†ç±»" class="headerlink" title="æ–°å¢åˆ†ç±»"></a>æ–°å¢åˆ†ç±»</h3><blockquote>
<p>Controller,ç›´æ¥ç”¨categoryDTOæ¥æ”¶å‰ç«¯å‘æ¥çš„ä¿¡æ¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢åˆ†ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢åˆ†ç±»ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">    categoryService.save(categoryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,æ—¢ç„¶æ˜¯æ–°å¢,åŠ åˆ°æ•°æ®åº“çš„ä¾ç„¶æ˜¯ <code>Category</code>è€Œä¸æ˜¯ <code>CategoryDTO</code>,æ‰€ä»¥è¿™é‡Œè¦è¿›è¡Œç±»å‹è½¬æ¢,æ³¨æ„æ–°å¢çš„ç±»å‹æ˜¯é»˜è®¤ç¦æ­¢çš„,æœ€åå–å‡ºä¿®æ”¹åˆ›å»ºäººçš„idä¸€èµ·å°è£…</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">    <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">    BeanUtils.copyProperties(categoryDTO, category);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°å¢çš„èœå•é»˜è®¤æ˜¯ç¦æ­¢çš„</span></span><br><span class="line">    category.setStatus(StatusConstant.DISABLE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åæ˜¯åˆ›å»ºæ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´ï¼Œåˆ›å»ºäººï¼Œä¿®æ”¹äºº</span></span><br><span class="line">    category.setCreateTime(LocalDateTime.now());</span><br><span class="line">    category.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    category.setCreateUser(BaseContextByMe.getCurrentId());</span><br><span class="line">    category.setUpdateUser(BaseContextByMe.getCurrentId());</span><br><span class="line"></span><br><span class="line">    categoryMapper.insert(category);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†ç±»åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†ç±»åˆ†é¡µæŸ¥è¯¢"></a>åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</h3><blockquote>
<p>Controller,é‡åˆ°åˆ†é¡µæŸ¥è¯¢,æ—¢éœ€è¦ç”¨ <code>PageResult</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ç±»åˆ†é¡µæŸ¥è¯¢ï¼Œè¯·æ±‚å‚æ•°æœ‰nameåˆ†ç±»åç§°,page,pageSize,typeåˆ†ç±»ç±»å‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ†ç±»åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span> &#123;</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> categoryService.pageQuery(categoryPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™ä¸ªæ¥å£ä¾ç„¶ä¸ç®—éš¾,ç…§ç€ä¹‹å‰å†™çš„é‚£ä¸ªå°±èƒ½å†™</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(CategoryPageQueryDTO categoryPageQueryDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(categoryPageQueryDTO.getPage(), categoryPageQueryDTO.getPageSize());</span><br><span class="line">    Page&lt;Category&gt; page = categoryMapper.pageQuery(categoryPageQueryDTO);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">    List&lt;Category&gt; records = page.getResult();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,ä¹Ÿæ˜¯å¸¸è§„çš„å†…å®¹,æ³¨æ„åˆ†ç±»åè¦æ¨¡ç³ŠæŸ¥è¯¢,è€Œåˆ†ç±»ç±»å‹æ˜¯ç›´æ¥åˆ¤æ–­</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Category&quot;</span>&gt;</span></span><br><span class="line">    select * from category</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;type != null and type != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and type = #&#123;type&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by sort asc , create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ ¹æ®idåˆ é™¤åˆ†ç±»"><a href="#æ ¹æ®idåˆ é™¤åˆ†ç±»" class="headerlink" title="æ ¹æ®idåˆ é™¤åˆ†ç±»"></a>æ ¹æ®idåˆ é™¤åˆ†ç±»</h3><blockquote>
<p>Controller,é‚£å°±ç›´æ¥è°ƒç”¨serviceè¿›è¡Œåˆ é™¤</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ é™¤åˆ†ç±»&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    categoryService.deleteById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,<strong>ä¸»è¦å°±æ˜¯æ³¨æ„åˆ†ç±»æ˜¯å¦åŒ…å«èœå“æˆ–å¥—é¤</strong>,å¼•å…¥å¦å¤–çš„ä¸¤ä¸ªmapper,æ¥æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å½’å±è¯¥åˆ†ç±»çš„æ•°é‡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤åˆ†ç±»</span></span><br><span class="line"><span class="comment">     * ä½†æ˜¯è¦æ³¨æ„è¯¥åˆ†ç±»ä¸­æ˜¯å¦å…³è”äº†èœå“ï¼Œå¦‚æœå…³è”äº†å°±ä¸èƒ½åˆ é™¤</span></span><br><span class="line"><span class="comment">     * è¿˜è¦æ³¨æ„æ˜¯å¦å…³è”äº†å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> dishMapper.countByCategoryId(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯¥åˆ†ç±»ä¸­æœ‰èœå“ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.CATEGORY_BE_RELATED_BY_DISH);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count = setmealMapper.countByCategoryId(id);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯¥åˆ†ç±»ä¸­æœ‰å¥—é¤ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.CATEGORY_BE_RELATED_BY_SETMEAL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ²¡é—®é¢˜äº†å°±åˆ é™¤è¯¥åˆ†ç±»æ•°æ®</span></span><br><span class="line">        categoryMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹åˆ†ç±»"><a href="#ä¿®æ”¹åˆ†ç±»" class="headerlink" title="ä¿®æ”¹åˆ†ç±»"></a>ä¿®æ”¹åˆ†ç±»</h3><blockquote>
<p>Controller,ç›´æ¥ä¼ ,æ²¡ä»€ä¹ˆå¥½è¯´çš„</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹åˆ†ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ä¿®æ”¹åˆ†ç±»&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">    categoryService.update(categoryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¸»è¦æ˜¯å°† <code>categoryDTO</code>å°è£…ä¸º <code>category</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹åˆ†ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(CategoryDTO categoryDTO)</span> &#123;</span><br><span class="line">    <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">    BeanUtils.copyProperties(categoryDTO, category);</span><br><span class="line"></span><br><span class="line">    category.setUpdateUser(BaseContextByMe.getCurrentId());</span><br><span class="line">    category.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">    categoryMapper.update(category);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Category&quot;</span>&gt;</span></span><br><span class="line">        update category</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;type != null&quot;</span>&gt;</span></span><br><span class="line">                type = #&#123;type&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sort != null&quot;</span>&gt;</span></span><br><span class="line">                sort = #&#123;sort&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time = #&#123;updateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span></span><br><span class="line">                update_user = #&#123;updateUser&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯ç”¨ç¦ç”¨åˆ†ç±»"><a href="#å¯ç”¨ç¦ç”¨åˆ†ç±»" class="headerlink" title="å¯ç”¨ç¦ç”¨åˆ†ç±»"></a>å¯ç”¨ç¦ç”¨åˆ†ç±»</h3><blockquote>
<p>Controller,ä¹Ÿæ˜¯å’Œä¹‹å‰ä¸€æ ·</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹åˆ†ç±»çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">        categoryService.startOrStop(status, id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¦ç”¨/å¯ç”¨ åˆ†ç±»çŠ¶æ€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">    <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span></span><br><span class="line">            Category.builder().id(id).status(status)</span><br><span class="line">                    .updateTime(LocalDateTime.now()).updateUser(BaseContextByMe.getCurrentId()).</span><br><span class="line">                    build();</span><br><span class="line">    categoryMapper.update(category);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»"><a href="#æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»" class="headerlink" title="æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»"></a>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</h3><blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(type);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">list</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">    List&lt;Category&gt; list = categoryMapper.list(type);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±åˆ°è¿™äº†.åˆ†ç±»æ¥å£å†™å®Œ,ä¹Ÿå…¨éƒ¨æµ‹è¯•é€šè¿‡.</p>
<h1 id="4-èœå“ç®¡ç†"><a href="#4-èœå“ç®¡ç†" class="headerlink" title="4 èœå“ç®¡ç†"></a>4 èœå“ç®¡ç†</h1><h2 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><p>ä»€ä¹ˆæ„æ€å‘¢,å°±æ˜¯ä¹‹å‰å†™çš„å‘˜å·¥ç®¡ç†æ¥å£,ä»¥åŠåˆ†ç±»ç®¡ç†,è¿™äº›ä¸šåŠ¡è¡¨ä¸­éƒ½æœ‰å…¬å…±å­—æ®µ:</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>æ•°æ®ç±»å‹</th>
<th align="center">æ“ä½œç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>create_time</td>
<td>åˆ›å»ºæ—¶é—´</td>
<td>datetime</td>
<td align="center">insert</td>
</tr>
<tr>
<td>2</td>
<td>create_user</td>
<td>åˆ›å»ºäººid</td>
<td>bigint</td>
<td align="center">insert</td>
</tr>
<tr>
<td>3</td>
<td>update_time</td>
<td>ä¿®æ”¹æ—¶é—´</td>
<td>datatime</td>
<td align="center">insert,update</td>
</tr>
<tr>
<td>4</td>
<td>update_user</td>
<td>ä¿®æ”¹äººid</td>
<td>bigint</td>
<td align="center">insert,update</td>
</tr>
</tbody></table>
<p>å¯¹åº”çš„ä»£ç å°±æ˜¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç„¶åæ˜¯åˆ›å»ºæ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´ï¼Œåˆ›å»ºäººï¼Œä¿®æ”¹äºº</span></span><br><span class="line">category.setCreateTime(LocalDateTime.now());</span><br><span class="line">category.setUpdateTime(LocalDateTime.now());</span><br><span class="line">category.setCreateUser(BaseContextByMe.getCurrentId());</span><br><span class="line">category.setUpdateUser(BaseContextByMe.getCurrentId());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼è¿™ç§ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line">employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è®°å½•çš„åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line"><span class="comment">// ä»ThreadLocalä¸­è·å–åˆ°ç™»å½•ç”¨æˆ·çš„id</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">employee.setCreateUser(empId);</span><br><span class="line">employee.setUpdateUser(empId);</span><br></pre></td></tr></table></figure>

<p><strong>é—®é¢˜å°±æ˜¯,ä»£ç å†—ä½™,ä¸ä¾¿äºåæœŸç»´æŠ¤</strong></p>
<p><em>æœç„¶æ˜¯ç”¨åˆ°åˆ‡é¢</em></p>
<ol>
<li>è‡ªå®šä¹‰æ³¨è§£<code>AutoFill</code>,ç”¨äºæ ‡è¯†éœ€è¦è¿›è¡Œå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……çš„æ–¹æ³•</li>
<li>è‡ªå®šä¹‰åˆ‡é¢ç±»<code>AutoFillAspect</code>,ç»Ÿä¸€æ‹¦æˆªåŠ å…¥äº†<code>AutoFill</code>æ³¨è§£çš„æ–¹æ³•,é€šè¿‡åå°„ä¸ºå…¬å…±å­—æ®µèµ‹å€¼</li>
<li>åœ¨Mapperä¸­éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ä¸ŠåŠ å…¥<code>AutoFill</code>æ³¨è§£</li>
</ol>
<p><strong>è¿™é‡Œè¿˜é—¹äº†ä¸ªä¹Œé¾™,å½“æ—¶åœ¨tokenä¸­å–æ•°æ®å¹¶å­˜å…¥ThreadLocalæ—¶,æ˜¯ç”¨çš„æˆ‘è‡ªå·±å†™çš„,è€Œåˆšæ‰å†™åˆ‡é¢æ—¶,å´ç”¨çš„æ˜¯ä¹‹å‰çš„,ä¸¤ä¸ªä¸åŒçš„ç±»å…·æœ‰ä¸åŒçš„ThreadLocal,æ‰€ä»¥è·å–ä¸åˆ°æ•°æ®</strong>,ä¸‹é¢æ˜¯ChatGPTç»™å‡ºçš„ç­”æ¡ˆ</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œå¦‚æœä½ åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨äº†ä¸åŒçš„ ThreadLocal å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒä»¬å­˜å‚¨çš„å†…å®¹å°±æ˜¯éš”ç¦»çš„ã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼ŒBaseContext å’Œ BaseContextByMe éƒ½ä½¿ç”¨äº†ä¸åŒçš„ ThreadLocal å®ä¾‹ï¼Œå› æ­¤åœ¨åˆ‡é¢æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ä¸åŒçš„ ThreadLocal å®ä¾‹å°±ä¼šå¯¼è‡´è·å–åˆ°ä¸åŒçš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœä½ åœ¨ä½¿ç”¨ BaseContext æ—¶æ— æ³•è·å–åˆ° currentIdï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ çš„åˆ‡é¢æ‰€åœ¨çš„çº¿ç¨‹æ²¡æœ‰åœ¨ BaseContext ä¸­è®¾ç½®è¿‡ currentIdã€‚è€Œåœ¨ä½¿ç”¨ BaseContextByMe æ—¶èƒ½å¤Ÿè·å–åˆ° currentIdï¼Œå¯èƒ½æ˜¯å› ä¸ºåˆ‡é¢æ‰€åœ¨çš„çº¿ç¨‹åœ¨æŸä¸ªåœ°æ–¹å·²ç»è®¾ç½®è¿‡äº† currentIdï¼Œä¾‹å¦‚åœ¨æŸä¸ªè¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>è‡ªå®šä¹‰æ³¨è§£<code>AutoFill</code></strong>,è¿™ä¸ªè¦å¥½å¥½è®°,æˆ–è€…ç»å¸¸çœ‹çœ‹,ä¹‹å‰éƒ½æ²¡å†™è¿‡è‡ªå®šä¹‰æ³¨è§£</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-28 14:32</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºæ ‡è¯†æ–¹æ³•éœ€è¦è¿›è¡Œå…¬å…±å­—æ®µçš„è‡ªåŠ¨å¡«å……</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoFill &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“æ“ä½œç±»å‹ update,insert</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡Œé¢ç”¨åˆ°çš„æšä¸¾ç±»å‹OperationType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.enumeration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“æ“ä½œç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">OperationType</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UPDATE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSERT</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åˆ‡é¢ç±»<code>AutoFillAspect</code></strong>,ä¹‹å‰å­¦çš„ç”¨åˆ°äº†ä¸€ç‚¹,ä¹‹å‰ç”¨çš„æ˜¯Signature,ä½†æ˜¯è¿™ä¸ªç­¾åæ˜¯æ‹¿ä¸åˆ°å…·ä½“æ–¹æ³•ä¸Šçš„æ³¨è§£çš„,æ‰€ä»¥è¦ç”¨è¿™ä¸ª<code>MethodSignature</code>,<code>.getMethod().getAnnotation(AutoFill.class);</code>,å³å¯æ‹¿åˆ°æŒ‡å®šæ³¨è§£çš„å¯¹è±¡,ç„¶åé€šè¿‡<code>autoFill.value();</code>å°±å¯å–åˆ°æ³¨è§£çš„å‚æ•°,ç©¶ç«Ÿæ˜¯<code>update</code>è¿˜æ˜¯<code>insert</code>,<code>entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME,LocalDateTime.class);</code>è¿™ä¸ªå°±æ˜¯é€šè¿‡åå°„æ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•,å›ºå®šå†™æ³•,ç„¶åå†é€šè¿‡<code>invoke</code>æ¥è®¾ç½®æ–¹æ³•çš„å‚æ•°<code>setCreateTime.invoke(entity, now);</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.AutoFillConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContextByMe;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-28 14:40</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åˆ‡é¢ï¼Œå®ç°å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™é‡Œè¦ä½¿ç”¨å‰ç½®é€šçŸ¥ï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ï¼Œå°±å°†è¿™å‡ ä¸ªå…¬å…±å­—æ®µåŠ å…¥è¿›å»ï¼Œå¦‚æœä½¿ç”¨åç½®é€šçŸ¥ï¼Œé‚£å°±æ™šäº†ï¼Œç›®æ ‡æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œsqléƒ½æ‰§è¡Œç»“æŸäº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹è¿›è¡Œå…¬å…±å­—æ®µçš„è‡ªåŠ¨å¡«å……ï¼Œ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. å…ˆè·å–å½“å‰è¢«æ‹¦æˆªçš„æ–¹æ³•çš„æ“ä½œç±»å‹-update/insert</span></span><br><span class="line">        <span class="comment">// å‘ä¸‹è½¬å‹ï¼Œä¸ç”¨çš„è¯ï¼Œæ‹¿ä¸åˆ°å¯¹åº”æ–¹æ³•æ ‡è¯†çš„æ³¨è§£å¯¹è±¡</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();  <span class="comment">// è·å¾—æ–¹æ³•ç­¾åå¯¹è±¡</span></span><br><span class="line">        <span class="type">AutoFill</span> <span class="variable">autoFill</span> <span class="operator">=</span> signature.getMethod().getAnnotation(AutoFill.class); <span class="comment">// è·å–æ–¹æ³•ä¸Šæ ‡è¯†çš„æ³¨è§£å¯¹è±¡</span></span><br><span class="line">        <span class="type">OperationType</span> <span class="variable">operationType</span> <span class="operator">=</span> autoFill.value();<span class="comment">// è·å–æ•°æ®åº“æ“ä½œç±»å‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. è·å–å®ä½“-åº”è¯¥å°±æ˜¯è·å–å‚æ•°å§ï¼Œç”¨getArgs()å°±è¡Œ ä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªçº¦å®šï¼Œå°±æ˜¯å‚æ•°å¯ä»¥æœ‰å¤šä¸ªçš„ï¼Œä½†æ˜¯å®ä½“ç±»å¿…é¡»æ”¾åœ¨ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">if</span> (args == <span class="literal">null</span> || args.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å®ä½“ç±»å‹ä¸ç¡®å®šï¼Œæ‰€ä»¥è¦ä½¿ç”¨Object</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">entity</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 3. å‡†å¤‡æ•°æ®</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">        <span class="comment">// 4. æ ¹æ®æ“ä½œç±»å‹ä¸åŒï¼Œé€šè¿‡åå°„ç»™å¯¹åº”çš„å±æ€§è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (operationType == OperationType.INSERT) &#123;</span><br><span class="line">            <span class="comment">// ä¸º4ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è¿™é‡Œä½¿ç”¨å¸¸é‡ç±»æ¥æ›¿æ¢å­—ç¬¦ä¸²ï¼Œå…¶å®å°±æ˜¯`setCreateTime....`</span></span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME,</span><br><span class="line">                        LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER,</span><br><span class="line">                        Long.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,</span><br><span class="line">                        Long.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,</span><br><span class="line">                        LocalDateTime.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é€šè¿‡åå°„ä¸ºå¯¹è±¡å±æ€§èµ‹å€¼</span></span><br><span class="line">                setCreateTime.invoke(entity, now);</span><br><span class="line">                setCreateUser.invoke(entity, currentId);</span><br><span class="line">                setUpdateTime.invoke(entity, now);</span><br><span class="line">                setUpdateUser.invoke(entity, currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operationType == OperationType.UPDATE) &#123;</span><br><span class="line">            <span class="comment">// ä¸º2ä¸ªå…¬å…±å­—æ®µèµ‹å€¼</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,</span><br><span class="line">                        Long.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,</span><br><span class="line">                        LocalDateTime.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é€šè¿‡åå°„invokeèµ‹å€¼</span></span><br><span class="line">                setUpdateTime.invoke(entity, now);</span><br><span class="line">                setUpdateUser.invoke(entity, currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapperæ”¹å†™,æ—¢ç„¶è¦ä½¿ç”¨åˆ‡é¢,é‚£è‚¯å®šå°±è¦ç»™æƒ³è¦ä½¿ç”¨åˆ‡é¢çš„æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£,å¹¶æŒ‡å®šç±»å‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥å‘˜å·¥æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AutoFill(value = OperationType.INSERT)</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into employee(name,username,password,phone,sex,id_number,create_time,update_time,create_user,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;update_user,status) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;values(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,å·²ç»ä½¿ç”¨äº†åˆ‡é¢äº†,é‚£å°±ä¸éœ€è¦å†åœ¨serviceä¸­å†™äº†</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å½“å‰è®°å½•çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´</span></span><br><span class="line"><span class="comment">// employee.setCreateTime(LocalDateTime.now());</span></span><br><span class="line"><span class="comment">// employee.setUpdateTime(LocalDateTime.now());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è®°å½•çš„åˆ›å»ºäººidå’Œä¿®æ”¹äººid</span></span><br><span class="line"><span class="comment">// ä»ThreadLocalä¸­è·å–åˆ°ç™»å½•ç”¨æˆ·çš„id</span></span><br><span class="line"><span class="comment">// Long empId = BaseContextByMe.getCurrentId();</span></span><br><span class="line"><span class="comment">// employee.setCreateUser(empId);</span></span><br><span class="line"><span class="comment">// employee.setUpdateUser(empId);</span></span><br></pre></td></tr></table></figure>

<h2 id="æ–°å¢èœå“"><a href="#æ–°å¢èœå“" class="headerlink" title="æ–°å¢èœå“"></a>æ–°å¢èœå“</h2><p>è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªè¡¨å•,é‡è¦çš„æ˜¯æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ,è¿™ä¸ªå¾…å¥½å¥½å­¦</p>
<p><strong>ä¸šåŠ¡è§„åˆ™</strong></p>
<ol>
<li>èœå“åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„</li>
<li>èœå“å¿…é¡»å±äºæŸä¸ªåˆ†ç±»ä¸‹,ä¸èƒ½å•ç‹¬å­˜åœ¨</li>
<li>æ–°å¢èœå“æ—¶å¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©èœå“çš„å£å‘³</li>
<li>æ¯ä¸ªèœå“å¿…é¡»å¯¹åº”ä¸€å¼ å›¾ç‰‡</li>
</ol>
<p><strong>æ¥å£è®¾è®¡</strong></p>
<ol>
<li>æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»(å·²å®Œæˆ)</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>æ–°å¢èœå“</li>
</ol>
<p>æ–‡ä»¶ä¸Šä¼ è¿™ä¸ªæ¥å£è¯¦æƒ…:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230828225643.png" alt="20230828225643"></p>
<p>è€Œä¸‹é¢çš„dishè¡¨-èœå“è¡¨ä¸­,æœ‰ä¸€ä¸ª<code>category_id</code>,å®ƒæ˜¯é€»è¾‘å¤–é”®-æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰è®¾ç½®å¤–é”®,è¿™ä¸ª<code>å¤–é”®</code>æ˜¯é€šè¿‡ç¨‹åºå®ç°çš„<br>åœ¨dish_flavorå£å‘³è¡¨ä¸­,ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªé€»è¾‘å¤–é”®<code>dish_id</code>,ä¸€ä¸ªèœå“-å¤šä¸ªå£å‘³</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ æ¥å£"><a href="#æ–‡ä»¶ä¸Šä¼ æ¥å£" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¥å£"></a>æ–‡ä»¶ä¸Šä¼ æ¥å£</h3><p><em>çœ‹æ¥è¦ä¹°OSSäº†</em></p>
<p>æ•´ä½“æµç¨‹:</p>
<p>åˆ«æµç¨‹äº†,å…ˆå»æŠŠOSSçš„æ•™ç¨‹çœ‹äº†å†è¯´,ä»Šå¤©ä¸æ—©äº†,å°±åˆ°è¿™å§,<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1m84y1w7Tb?p=146&vd_source=5815ab19beeaab6a8ea7a561cba20233">è¯¾ç¨‹é“¾æ¥</a></p>
<p>å¥½äº†,å¤§æ¦‚çŸ¥é“ossæ€ä¹ˆç”¨äº†,æ–°ç‰ˆæ•™ç¨‹ä¸­å·²ç»å°†access Keyå’Œkey secretéƒ½ç»™å°è£…åˆ°ç¯å¢ƒå˜é‡é‡Œäº†,è¿™é‡Œæˆ‘å…ˆæŠŠè¿™ä¸¤ä¸ªé…ç½®æ³¨é‡Šæ‰,çœ‹çœ‹ä¸€ä¼šæ€ä¹ˆå†™</p>
<p>é…ç½®æ–‡ä»¶ä¸­æ–°å¢,æ³¨æ„,è¿™ä¸ªä¸æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„é…ç½®å±æ€§,è€Œæ˜¯æ ¹æ®ä¸€ä¸ªè‡ªå®šä¹‰çš„é…ç½®ç±»å†™çš„,è€Œä¸”çœŸæ­£çš„é…ç½®ä¿¡æ¯æ˜¯åœ¨devé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„,è¿™ä¸ªä¸»é…ç½®æ–‡ä»¶æ˜¯å¼•ç”¨,å› ä¸ºä»¥åå¯èƒ½ä¼šå­˜åœ¨ç”Ÿäº§æ¨¡å¼,æ–¹ä¾¿æ›´æ¢é…ç½®ä¿¡æ¯</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># devé…ç½®æ–‡ä»¶ä¸­ï¼Œæ³¨æ„endpointä¸èƒ½åŠ https://</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-beijing.aliyuncs.com</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">zzmr-sky-take-out</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸çŸ¥é“å¥½ç”¨ä¸ç”¨è®¾ç½®access Keyï¼Œå› ä¸ºç³»ç»Ÿå˜é‡é‡Œå·²ç»è®¾ç½®äº†</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">$&#123;sky.alioss.endpoint&#125;</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">$&#123;sky.alioss.bucket-name&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå°±æ˜¯é…ç½®ç±»,æ³¨è§£<code>@ConfigurationProperties</code>å¯ä»¥è‡ªåŠ¨è·å–é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯,ç„¶ååŠ å…¥åˆ°å®¹å™¨ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.alioss&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="comment">// private String accessKeyId;</span></span><br><span class="line">    <span class="comment">// private String accessKeySecret;</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä»¥åŠé…ç½®ç±»,è¿˜æœ‰ä¸€ä¸ªåˆ›å»ºå·¥å…·ç±»çš„é…ç½®ç±»,è¿™ä¸ªé…ç½®ç±»å¯ä»¥è·å–åˆ°ä¸Šé¢çš„propertiesç±»ä¸­çš„ä¿¡æ¯,æ˜¯ç³»ç»Ÿåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ‰ç”¨çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.properties.AliOssProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.AliOssUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»,ç”¨äºåˆ›å»ºAliOssUtilå¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-29 12:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> AliOssUtil <span class="title function_">getAliOssUtil</span><span class="params">(AliOssProperties aliOssProperties)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹åˆ›å»ºé˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ å·¥å…·ç±»å¯¹è±¡&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;å‚æ•°ä¸º:&#123;&#125;&quot;</span>, aliOssProperties);</span><br><span class="line">        <span class="type">AliOssUtil</span> <span class="variable">aliOssUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(), aliOssProperties.getBucketName());</span><br><span class="line">        <span class="keyword">return</span> aliOssUtil;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åå°±æ˜¯å·¥å…·ç±»,è¿™ä¸ªå·¥å…·ç±»ä¹Ÿæ˜¯è¢«æˆ‘æ”¹å†™è¿‡,ä¹‹å‰éƒ½æ˜¯å°†keyä¿¡æ¯é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­,ç°åœ¨æ˜¯å°†keyä»ç¯å¢ƒå˜é‡ä¸­å–å‡º,æ‰€ä»¥è¿™é‡Œåªéœ€è¦ç”¨åˆ°å‰©ä¸‹çš„ä¸¤ä¸ªå‚æ•°,ä¸Šé¢çš„é…ç½®ç±»ç›´æ¥é€šè¿‡ä¸€ä¸ªæ„é€ æ–¹æ³•,æ„é€ ä¸€ä¸ªå·¥å…·ç±».</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSException;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.CredentialsProviderFactory;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.EnvironmentVariableCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="comment">// private String accessKeyId;</span></span><br><span class="line">    <span class="comment">// private String accessKeySecret;</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String objectName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è‡ªå·±æ–°å¢çš„é…ç½®</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">EnvironmentVariableCredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            credentialsProvider = CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (com.aliyuncs.exceptions.ClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚åŸç‰ˆæ˜¯å°†accessKeyIdå’ŒaccessKeySecretç›´æ¥ä¼ å…¥ï¼Œè€Œæ–°ç‰ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è·å–çš„</span></span><br><span class="line">        <span class="comment">// OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, credentialsProvider);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span></span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException ce) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                    + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–‡ä»¶è®¿é—®è·¯å¾„è§„åˆ™ https://BucketName.Endpoint/ObjectName</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;https://&quot;</span>);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ åˆ°:&#123;&#125;&quot;</span>, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€åè¿”å›ä¸Šä¼ æ–‡ä»¶çš„ç½‘å€</span></span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤æ–‡ä»¶ä¸Šä¼ çš„é…ç½®å·²ç»æå®Œäº†,ä½†æ˜¯æ¥å£è¿˜æ²¡å¼€å§‹å†™å‘¢</p>
<hr>
<p><strong>æ–‡ä»¶ä¸Šä¼ æ¥å£å¼€å‘</strong></p>
<p>è¿™ä¸ªå°±æ˜¯ä¸Šä¼ çš„æ¥å£,æµç¨‹å°±æ˜¯,å…ˆé€šè¿‡<code>MultipartFile</code>æ¥è·å–åˆ°å‰ç«¯å‘æ¥çš„æ–‡ä»¶,ç„¶åè·å–åˆ°æ–‡ä»¶çš„åŸæ–‡ä»¶å,æˆªå–åç¼€,é€šè¿‡UUIDæ¥è·å–ä¸€ä¸ªæ–°çš„æ–‡ä»¶åæ¥é˜²æ­¢æ–‡ä»¶åé‡å¤çš„é—®é¢˜,æœ€åæ‹¼åœ¨ä¸€èµ·,å­˜å‚¨åè¿”å›urlç»™å‰ç«¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.AliOssUtil;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-08-28 23:10</span></span><br><span class="line"><span class="comment"> * é€šç”¨æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;é€šç”¨æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚æ•°åå¿…é¡»å’Œå‰ç«¯ä¼ æ¥çš„ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯file</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–‡ä»¶ä¸Šä¼ &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ ï¼š&#123;&#125;&quot;</span>, file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸Šä¼ åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶çš„å­—èŠ‚,ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ossçš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å…ˆæˆªå–åŸæ–‡ä»¶çš„åç¼€,å› ä¸ºæ–‡ä»¶éƒ½æ˜¯æœ‰åæœ€çš„</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">// æ•°ç»„çš„æœ€åä¸€é¡¹æ‰æ˜¯çœŸæ­£çš„åç¼€,å› ä¸ºæ–‡ä»¶åä¸­å¯èƒ½ä¹Ÿå­˜åœ¨ç‚¹ ä¸è¿‡çœ‹æ¥è€å¸ˆä¸ç”¨è¿™ç§æ–¹æ³•</span></span><br><span class="line">            <span class="comment">// String[] split = originalFilename.split(&quot;.&quot;);</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ„å»ºæ–°æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> UUID.randomUUID().toString() + extension;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> aliOssUtil.upload(file.getBytes(), objectName);</span><br><span class="line">            <span class="keyword">return</span> Result.success(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥:&#123;&#125;&quot;</span>, e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return Result.error(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å¢èœå“æ¥å£"><a href="#æ–°å¢èœå“æ¥å£" class="headerlink" title="æ–°å¢èœå“æ¥å£"></a>æ–°å¢èœå“æ¥å£</h3><blockquote>
<p>è¿™é‡Œè¦ç”¨åˆ°äº‹åŠ¡<code>@Transactional</code>,æƒ³è¦ä½¿ç”¨æ³¨è§£çš„äº‹åŠ¡,è¦åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š<code>@EnableTransactionManagement</code>æ³¨è§£</p>
</blockquote>
<p>å‰ç«¯ä¼ æ¥çš„DTOæ¸…æ™°æ˜äº†<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230829144106.png" alt="20230829144106"></p>
<blockquote>
<p><strong>Controller</strong>,åº”è¯¥controllerç®—æ˜¯æœ€ç®€å•çš„äº†,åªè´Ÿè´£å°†<code>dishDTO</code>å¾€serviceä¸Šä¼ å°±ok</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ–°å¢èœå“&quot;</span>);</span><br><span class="line">    dishService.saveWithFlavor(dishDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Service</strong>,åœ¨è¿™ä¸ªServiceä¸­,ç”¨åˆ°äº†ä¸¤ä¸ªMapper,å…¶ä¸­ä¸€ä¸ªå°±æ˜¯èœå“Mapper,å› ä¸ºè¦æ–°å¢èœå“,æ‰€ä»¥è‚¯å®šè¦ç”¨èœå“çš„Mapper,æ¯ä¸ªèœå“å¯¹åº”çš„æœ‰å£å‘³,è¦å°†å£å‘³ä¹Ÿå­˜å…¥æ•°æ®åº“å°±è¦ç”¨åˆ°å£å‘³çš„Mapper</p>
</blockquote>
<ol>
<li>é¦–å…ˆå°†dtoä¸­çš„æ•°æ®èµ‹å€¼ç»™dishå®ä½“,ä»¥ä¾¿æ“ä½œæ•°æ®åº“:<code>BeanUtils.copyProperties</code></li>
<li>è¿™é‡Œç”¨åˆ°äº†Mapperä¸­çš„æ’å…¥å›æ˜¾Id,å…·ä½“é…ç½®è§Mapper,æ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥<code>getId()</code>æ¥è·å–èœå“Id,ä¸ºä»€ä¹ˆè¦ç”¨èœå“Id?å› ä¸ºå£å‘³æ˜¯å’Œèœå“ç»‘å®šçš„,ä¸€ä¸ªèœå“å¯¹åº”å¤šä¸ªå£å‘³,åœ¨å£å‘³è¡¨ä¸­,æ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ªèœå“Id:<code>dish_id</code>,æ‰€ä»¥è¦è·å–åˆ°è¯¥æ¡èœå“çš„idæ‰è¡Œ</li>
<li>å–å‡ºé›†åˆ,å°†å£å‘³è¿™ä¸ªé›†åˆæ’å…¥æ•°æ®åº“,å¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥è¿›è¡Œéå†,ä¹Ÿå¯ä»¥åœ¨mapperä¸­ä½¿ç”¨åŠ¨æ€sqlæ¥å®ç°æ‰¹é‡æ’å…¥</li>
<li>å› ä¸ºå‰ç«¯ä¼ æ¥çš„flavorsä¸­è‚¯å®šæ˜¯æ²¡æœ‰<code>dish_id</code>çš„,å› ä¸ºè¿™ä¸ª<code>dish_id</code>åªæœ‰æ’å…¥äº†æ•°æ®åº“ä¹‹åæ‰èƒ½å¾—åˆ°,æ­¤æ—¶å°±è¦ç»™é›†åˆä¸­çš„æ¯ä¸€é¡¹éƒ½èµ‹å€¼ä¸€ä¸ª<code>dish_id</code>,ä»¥ä¾¿æ•°æ®åº“çš„æ’å…¥<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// å‘èœå“è¡¨æ’å…¥1æ¡æ•°æ®</span></span><br><span class="line">        <span class="comment">// å‰ç«¯ä¼ æ¥çš„dishDTO,ä¸­åŒ…å«å£å‘³ä¿¡æ¯,ä½†æ˜¯èœå“è¡¨ä¸­æ˜¯æ²¡æœ‰å£å‘³ä¿¡æ¯çš„,æ‰€ä»¥è¿˜æ˜¯è¦æŠŠè¿™ä¸ªDTOè½¬æ¢æˆDishæ¥ä¼ å…¥æ•°æ®åº“</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        <span class="comment">// å°†dtoä¸­éœ€è¦çš„æ•°æ®æ‹·è´ç»™dish</span></span><br><span class="line">        BeanUtils.copyProperties(dishDTO, dish);</span><br><span class="line">        <span class="comment">// ç»ˆäºç»™ideaé…ç½®å¥½äº†æ•°æ®åº“,å¯ä»¥å®ç°å­—æ®µæç¤ºäº†</span></span><br><span class="line">        dishMapper.insert(dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–insertè¯­å¥ç”Ÿæˆçš„ä¸»é”®å€¼</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish.getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆå°†dtoä¸­å­˜æ”¾å£å‘³æ•°æ®çš„é›†åˆå–å‡º</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘å£å‘³è¡¨æ’å…¥næ¡æ•°æ® - å› ä¸º1ä¸ªèœå“å¯¹åº”å¤šä¸ªå£å‘³</span></span><br><span class="line">            <span class="comment">// ä¸¤ç§æ–¹æ³•,å¯ä»¥éå†é›†åˆ,ç„¶åæ’å…¥,ä¹Ÿå¯ä»¥æ‰¹é‡æ’å…¥</span></span><br><span class="line">            flavors.forEach(dishFlavor -&gt; dishFlavor.setDishId(dishId));</span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Mapper</strong></p>
</blockquote>
<ol>
<li>DishMapperèœå“,åœ¨èœå“Mapperä¸­,è¦åŠ ä¸Šå±æ€§<code>useGeneratedKeys</code>å’Œ<code>keyProperty</code>æ¥å¾—åˆ°æ’å…¥æ•°æ®åº“å¾—åˆ°çš„id<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    useGeneratedKeyså°±æ˜¯è¡¨ç¤ºè¦æ’å…¥æ•°æ®åå°†idè¿”å›,è€ŒkeyPropertyå°±æ˜¯è¿”å›èµ‹å€¼ç»™å“ªä¸ªå±æ€§ä¸Š--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into dish(name, category_id, price, image, description, status, create_time, update_time, create_user,</span><br><span class="line">                         update_user)</span><br><span class="line">        values (#&#123;name&#125;, #&#123;categoryId&#125;, #&#123;price&#125;, #&#123;image&#125;, #&#123;description&#125;, #&#123;status&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,</span><br><span class="line">                #&#123;createUser&#125;, #&#123;updateUser&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>DishFlavorMapper,è¿™ä¸ªMapperå°±æ˜¯é€šè¿‡åŠ¨æ€Sqlæ¥å®ç°çš„æ‰¹é‡æ’å…¥,æ³¨æ„<code>forEachçš„è¯­æ³•</code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span>&gt;</span></span><br><span class="line">    insert into dish_flavor (dish_id, name, value) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;flavors&quot;</span> <span class="attr">item</span>=<span class="string">&quot;df&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p>è¿™ä¸ªæ¥å£ç»ˆäºå†™å®Œäº†,å¥¶å¥¶æ»´,å› ä¸ºå­—æ®µå†™é”™äº†æäº†è€åŠå¤©.å¥½å›°å•Š,æ‰“ä¼šæ¸¸æˆ</p>
<h2 id="èœå“åˆ†é¡µæŸ¥è¯¢"><a href="#èœå“åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="èœå“åˆ†é¡µæŸ¥è¯¢"></a>èœå“åˆ†é¡µæŸ¥è¯¢</h2><p>ä¸šåŠ¡è§„åˆ™</p>
<ol>
<li>æ ¹æ®é¡µç å±•ç¤ºèœå“ä¿¡æ¯</li>
<li>æ¯é¡µå±•ç¤º10æ¡æ•°æ®</li>
<li>åˆ†é¡µæŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®éœ€è¦è¾“å…¥èœå“åç§°,èœå“åˆ†ç±»,èœå“çŠ¶æ€è¿›è¡ŒæŸ¥è¯¢</li>
</ol>
<p>æ¥å£è¯¦æƒ…:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230829154556.png" alt="20230829154556"></p>
<p><strong>å½“ä½¿ç”¨åŠ¨æ€sqlæ—¶,å³ä½¿ç”¨<code>&lt;if&gt;</code>å¦‚æœè¿™ä¸ª<code>&lt;if&gt;</code>æ˜¯å†™åœ¨<code>&lt;where&gt;</code>ä¸­,é‚£å°±ä¸å¿…åœ¨æ¯è¡Œçš„æœ€åå†™é€—å·,è€Œå¦‚æœåœ¨<code>&lt;set&gt;</code>é‡Œé¢,é‚£ä¹ˆå°±è¦æ³¨æ„é€—å·çš„ä½¿ç”¨äº†,é™¤äº†æœ€åä¸€ä¸ªä»¥å¤–,éƒ½éœ€è¦åŠ é€—å·,è¿™ä¹Ÿå°±æ˜¯æŸ¥è¯¢å’Œæ’å…¥çš„åŒºåˆ«å§,ç®€å•è®°:<code>æŸ¥è¯¢ä¸åŠ é€—å·,æ’å…¥è¦åŠ é€—å·</code></strong></p>
<p><em>è¿™ä¸ªåˆ†é¡µå†™çš„ä¹ŸçœŸæ˜¯æ›²æŠ˜å•Š</em></p>
<blockquote>
<p>Controller,controllerè¿˜æ˜¯è¿™äº›æ´»</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;èœå“åˆ†é¡µæŸ¥è¯¢å¼€å§‹&quot;</span>);</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> dishService.pageQuery(dishPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,ç”±äºå‰ç«¯éœ€è¦ç”¨åˆ°å­—æ®µ<code>categoryName</code>,æ‰€ä»¥ä¸èƒ½ä½¿ç”¨Dish,è€Œè¦ç”¨DishVO,è¿™ä¸ªVOå°±åˆšå¥½å’Œå‰ç«¯è¦æ±‚çš„æ•°æ®ä¸€æ ·<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230829174741.png" alt="20230829174741"></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èœå“åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">    PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“ç›´æ¥æŸ¥åˆ°çš„æ˜¯Dish,è€Œå‰ç«¯è¦æ±‚çš„æ˜¯DishVO,å› ä¸ºDishVOä¸­æ‰æœ‰åˆ†ç±»åç§°çš„,é‚£æ€ä¹ˆæŸ¥å‘¢?</span></span><br><span class="line"><span class="comment">     * åŸæ¥æ˜¯ç”¨åˆ°äº†å¤šè¡¨è”æŸ¥,åªä¸è¿‡è¿”å›ç»“æœæ˜¯VOç½¢äº†,åªéœ€è¦æ”¹ä¸€ä¸‹Sql,æ”¹ä¸€ä¸‹è¿”å›ç»“æœæ³›å‹å°±OKäº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;æŸ¥è¯¢åˆ°çš„åˆ†é¡µä¿¡æ¯:&#123;&#125;&quot;</span>, page);</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">    List&lt;DishVO&gt; records = page.getResult();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper,è¿˜æ˜¯æ²¡æƒ³æ˜ç™½ä¸ºä»€ä¹ˆæœ‰çš„åœ°æ–¹ä¸èƒ½å†™<code>status != null and status != &#39;&#39;</code>,å†™æˆè¿™æ ·æ¡ä»¶å°±ä¸æˆç«‹,å°±å¾ˆéº»çƒ¦,é‚£ä»¥åå…ˆå…¨ç”¨<code>status != null</code>è¿™ç§å½¢å¼å§</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    è¿™é‡Œè¦æ³¨æ„,åŠ äº†å…³è”æŸ¥è¯¢å,ä¸‹é¢ifä¸­çš„å­—æ®µè¦åŠ ä¸Šå¯¹åº”çš„è¡¨å,ä¸ç„¶ä¼šä¸å‡ºç»“æœ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span></span><br><span class="line">    select dish.*,</span><br><span class="line">    category.`name` category_name from dish left join category on dish.category_id = category.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and dish.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and dish.category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and dish.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by dish.create_time DESC</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤èœå“"><a href="#åˆ é™¤èœå“" class="headerlink" title="åˆ é™¤èœå“"></a>åˆ é™¤èœå“</h2><blockquote>
<p>è¿™ä¸ªæˆ‘è‡ªå·±å†™äº†,åŠŸèƒ½å¥½åƒä¹Ÿæ²¡é—®é¢˜</p>
</blockquote>
<p>?ä½†æ˜¯ä¸€çœ‹è§†é¢‘,å°±çŸ¥é“è‡ªå·±å†™çš„å¤§æœ‰é—®é¢˜äº†</p>
<p>ä¸šåŠ¡è§„åˆ™:</p>
<ol>
<li>å¯ä»¥ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªèœå“,ä¹Ÿå¯ä»¥æ‰¹é‡åˆ é™¤èœå“</li>
<li>èµ·å”®ä¸­çš„èœå“ä¸èƒ½åˆ é™¤</li>
<li>è¢«å¥—é¤å…³è”çš„èœå“ä¸èƒ½åˆ é™¤</li>
<li>åˆ é™¤èœå“å,å…³è”çš„å£å‘³æ•°æ®ä¹Ÿéœ€è¦åˆ é™¤æ‰</li>
</ol>
<p><em>å¥½å®¶ä¼™,å°±å®ç°äº†ç¬¬ä¸€æ¡</em></p>
<blockquote>
<p>Controller,ä¹‹å‰å†™çš„æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¥æ”¶,ä¹Ÿæ˜¯èƒ½å®ç°åˆ é™¤çš„,ä½†æ˜¯æŒ‰ç…§è§„èŒƒ,è¿˜æ˜¯è¦ç”¨Listé›†åˆ,è€Œä¸”è¿™é‡Œè¦ç”¨<code>@RequestParam</code>æ³¨è§£æ‰èƒ½å°è£…ä¸Šè¿›å»</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡åˆ é™¤èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteBatchDish</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¯ä»¥æ‹¿åˆ°çš„,ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">    log.info(<span class="string">&quot;ä¼ å…¥çš„ids: &#123;&#125;&quot;</span>, ids.size());</span><br><span class="line">    dishService.deleteBatchDish(ids);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,å°±åƒä¸Šé¢è¯´çš„,åœ¨åˆ é™¤ä¹‹å‰,è¦å…ˆè¿›è¡Œåˆ¤æ–­,</p>
</blockquote>
<ol>
<li>åœ¨åˆ¤æ–­èœå“æ˜¯å¦åœ¨æŸä¸ªå¥—é¤ä¸­æ—¶,ä½¿ç”¨äº†<code>setmealDishMapper</code>,è¿™ä¸ªæ˜¯ä¸€ä¸ªæ–°çš„Mapper,å…·ä½“å†…å®¹å¦‚ä¸‹,æ ¹æ®dishIdæ¥æŸ¥è¯¢æ˜¯å¦æœ‰å¥—é¤å…³è”,åªè¦æœ‰ä¸€ä¸ªèœå“ä¸­å…³è”äº†å¥—é¤,é‚£å°±ä¸èƒ½åˆ é™¤<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">    select setmeal_id from setmeal_dish where dish_id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;dishIds&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dishId&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;dishId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>åœ¨åˆ é™¤äº†èœå“å,ä¹Ÿè¦åˆ é™¤èœå“å¯¹åº”çš„å£å‘³,è¿™é‡Œå°±è¦æ ¹æ®dishIdæ¥åˆ é™¤<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from dish_flavor where dish_id = #&#123;dishId&#125;;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure></li>
<li>æœ€ç»ˆçš„ä»£ç :<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ‰¹é‡åˆ é™¤èœå“</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatchDish</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1. åˆ¤æ–­å½“å‰èœå“æ˜¯å¦èƒ½å¤Ÿåˆ é™¤-æ˜¯å¦å­˜åœ¨èµ·å”®ä¸­</span></span><br><span class="line">       <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">           <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">           <span class="keyword">if</span> (dish.getStatus() == StatusConstant.ENABLE) &#123;</span><br><span class="line">               <span class="comment">// å½“å‰èœå“å¤„äºèµ·å”®ä¸­ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 2. æ˜¯å¦åœ¨æŸä¸ªå¥—é¤ä¸­</span></span><br><span class="line">       List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">       <span class="keyword">if</span> (setmealIds != <span class="literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">// æŸ¥åˆ°äº†å¯¹åº”çš„å¥—é¤-è¯¥èœå“è¢«å¥—é¤å…³è”äº†ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.CATEGORY_BE_RELATED_BY_SETMEAL);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">           <span class="comment">// 3. åˆ é™¤èœå“æ•°æ®ï¼Œè¿˜æœ‰èœå“å…³è”çš„å£å‘³æ•°æ®</span></span><br><span class="line">           dishMapper.deleteById(id);</span><br><span class="line">           <span class="comment">// åˆ é™¤å£å‘³ç›¸å…³--æœ‰å°±åˆ é™¤ï¼Œæ²¡æœ‰å°±ç®—äº†ï¼Œä¸ç”¨æŸ¥</span></span><br><span class="line">           dishFlavorMapper.deleteByDishId(id);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ä¿®æ”¹èœå“"><a href="#ä¿®æ”¹èœå“" class="headerlink" title="ä¿®æ”¹èœå“"></a>ä¿®æ”¹èœå“</h2><blockquote>
<p>ä¿®æ”¹èœå“éœ€è¦çš„æ¥å£</p>
</blockquote>
<ol>
<li>æ ¹æ®idæŸ¥è¯¢èœå“(åŒæ—¶ä¹ŸæŠŠèœå“å…³è”çš„å£å‘³ä¹ŸæŸ¥å‡ºæ¥)</li>
<li>æ ¹æ®ç±»å‹(èœå“ç±»å‹&#x2F;å¥—é¤ç±»å‹)æŸ¥è¯¢åˆ†ç±»</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>ä¿®æ”¹èœå“</li>
</ol>
<h3 id="æ ¹æ®idæŸ¥è¯¢èœå“"><a href="#æ ¹æ®idæŸ¥è¯¢èœå“" class="headerlink" title="æ ¹æ®idæŸ¥è¯¢èœå“"></a>æ ¹æ®idæŸ¥è¯¢èœå“</h3><p>è¿™ä¸ªè¿˜æ˜¯å¾ˆç®€å•çš„</p>
<blockquote>
<p>Controller,åªæ˜¯èµ·åå­—èµ·çš„æœ‰ç‚¹ç‰¹åˆ«,å› ä¸ºè¦æŸ¥è¯¢èœå“å’Œèœå“å¯¹åº”çš„å£å‘³,æ‰€ä»¥è¿™é‡Œç”¨çš„è¿˜æ˜¯DishVO</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢èœå“,å’Œå¯¹åº”çš„å£å‘³</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢èœå“,å’Œå¯¹åº”çš„å£å‘³&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ ¹æ®idæŸ¥è¯¢èœå“ï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œåˆ†ä¸¤æ­¥,ç¬¬ä¸€æ­¥å…ˆæŸ¥å‡ºèœå“ä¿¡æ¯,ç¬¬äºŒæ­¥æ ¹æ®èœå“ä¿¡æ¯çš„èœå“dish_idå†æŸ¥è¯¢å¯¹åº”çš„å£å‘³,æœ€åå°è£…åˆ°ä¸€ä¸ªVOä¸­</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢èœå“,å’Œå¯¹åº”çš„å£å‘³</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢èœå“æ•°æ®</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">    <span class="comment">// æ ¹æ®èœå“idæŸ¥è¯¢å£å‘³æ•°æ®</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishFlavorMapper.getByDishId(id);</span><br><span class="line">    <span class="comment">// å°†æŸ¥è¯¢åˆ°çš„å£å‘³æ•°æ®å°è£…åˆ°VO</span></span><br><span class="line">    <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(dish, dishVO);</span><br><span class="line">    dishVO.setFlavors(flavors);</span><br><span class="line">    <span class="keyword">return</span> dishVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>Mapperä¸­å°±æ˜¯å¾ˆç®€å•çš„å•è¡¨æŸ¥è¯¢äº†</em></p>
<h3 id="ä¿®æ”¹èœå“-1"><a href="#ä¿®æ”¹èœå“-1" class="headerlink" title="ä¿®æ”¹èœå“"></a>ä¿®æ”¹èœå“</h3><blockquote>
<p>Controller,æ²¡ä»€ä¹ˆè¯´çš„,å› ä¸ºè¿™é‡Œæ›´æ–°æ•°æ®ä¼ æ¥çš„jsonæ˜¯å¯ä»¥å°è£…ä¸ºä¸€ä¸ªDTOçš„,æ‰€ä»¥ç”¨ä¸åˆ°VOäº†(VOåªæ˜¯æ¯”DTOå¤šä¸€ä¸ªåˆ†ç±»åç§°)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¿®æ”¹èœå“:&#123;&#125; &quot;</span>, dishDTO);</span><br><span class="line">        dishService.updateWithFlavor(dishDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,updateèœå“è¿˜æ˜¯è€åŠæ³•,åŠ¨æ€Sql,ä½†æ˜¯æ›´æ”¹å£å‘³å°±æ¢ä¸ªæ–¹æ³•äº†,<strong>å…ˆåˆ å†åŠ </strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹èœå“</span></span><br><span class="line"><span class="comment"> * å­¦åˆ°æ–°ä¸œè¥¿äº†ï¼Œå¦‚æœ**ä¸€ä¸ªä¸œè¥¿ç›´æ¥ä¿®æ”¹å¾ˆéš¾åŠï¼Œå¯ä»¥è€ƒè™‘å…ˆåˆ é™¤å†æ·»åŠ **</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆå°†dishDTOä¸­çš„åŸºæœ¬ä¿¡æ¯å­˜å…¥æ•°æ®åº“</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">    <span class="comment">// è¿˜æ˜¯ä½¿ç”¨çš„è€åŠæ³•ï¼Œæ‹·è´å¯¹è±¡çš„å±æ€§</span></span><br><span class="line">    BeanUtils.copyProperties(dishDTO, dish);</span><br><span class="line">    dishMapper.update(dish);</span><br><span class="line">    <span class="comment">// å†å°†æ›´æ–°åçš„å£å‘³ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼Œè¿™é‡Œè¦ç”¨åˆ°dishFlavorMapper</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯ç”±äºå£å‘³ä¿®æ”¹å¾ˆéš¾ç¡®å®šï¼Œæ˜¯å¤šäº†æ˜¯å°‘äº†ï¼Œè¿˜æ˜¯æ²¡æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©ï¼Œå…ˆå°†åŸå…ˆçš„å£å‘³åˆ é™¤ï¼Œå†æ·»åŠ æ–°çš„å£å‘³</span></span><br><span class="line">    dishFlavorMapper.deleteByDishId(dishDTO.getId());</span><br><span class="line"></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">    <span class="keyword">if</span> (flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        flavors.forEach(flavor -&gt; flavor.setDishId(dishDTO.getId()));</span><br><span class="line">        dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper,å†å†™æœ€åä¸€æ¬¡Mapper,ä¸»è¦æ˜¯è¿™åŠ¨æ€sqlçš„æ ¼å¼å¤ªå®¹æ˜“å¼„é”™äº†,åˆ°åº•åŠ ä¸åŠ é€—å·,åŠ ä¸åŠ and,ç°åœ¨æˆ‘ç¡®å®šäº†<strong>setä¸­ä¸åŠ and,åŠ é€—å·,æŸ¥è¯¢æ—¶ç”¨çš„where,è¦åŠ and,ä¸åŠ é€—å·(åŸæœ¬å°±æ˜¯é€šè¿‡andé“¾æ¥èµ·æ¥çš„)</strong>,</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update dish</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                category_id = #&#123;categoryId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span></span><br><span class="line">                price = #&#123;price&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null&quot;</span>&gt;</span></span><br><span class="line">                description = #&#123;description&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span></span><br><span class="line">                image = #&#123;image&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time = #&#123;updateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span></span><br><span class="line">                update_user = #&#123;updateUser&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-å¥—é¤ç®¡ç†"><a href="#5-å¥—é¤ç®¡ç†" class="headerlink" title="5 å¥—é¤ç®¡ç†"></a>5 å¥—é¤ç®¡ç†</h1><p><strong>è¿™ä¸ªå°±è¦è‡ªå·±å†™äº†,è™½ç„¶ç»™äº†ç­”æ¡ˆ,ä½†æ˜¯è¿˜æ˜¯è‡ªå·±æ•²ä¸€éå§,è¿™ä¸ªå¥—é¤ç®¡ç†åº”è¯¥å’Œåˆ†ç±»ç®¡ç†æœ‰ç‚¹åƒ?æˆ–è€…å°±æ˜¯èœå“ç®¡ç†</strong></p>
<p><em>?è´¹äº†åŠå¤©åŠ²å†™å‡ºäº†çš„åˆ†é¡µ,å‘ç°æ²¡æœ‰å¥—é¤çš„æ•°æ®,æ˜å¤©ç»§ç»­å§</em></p>
<p>ç®—æ˜¯å†™çš„å·®ä¸å¤š?</p>
<p>æš‚æ—¶å®Œæˆäº†åˆ†é¡µå’Œæ–°å¢,æ˜¾ç¤ºçš„ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜</p>
<p><strong>å†™å®Œå’¯!</strong></p>
<p>å¯¹å¯¹ç­”æ¡ˆ</p>
<h2 id="æ–°å¢å¥—é¤"><a href="#æ–°å¢å¥—é¤" class="headerlink" title="æ–°å¢å¥—é¤"></a>æ–°å¢å¥—é¤</h2><p>åœ¨æ–°å¢å¥—é¤é‡Œé¢,ä¼šç”¨åˆ°æ ¹æ®åˆ†ç±»idæŸ¥è¯¢ç±»å‹å¯¹åº”çš„èœå“çš„æ¥å£:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230831160805.png" alt="20230831160805"><br>æ‰€ä»¥è¿™é‡Œè¦å…ˆå†™ä¸€ä¸ªæ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¯¹åº”èœå“çš„æ¥å£</p>
<blockquote>
<p>Controller,å‰ç«¯åªä¼ æ¥ä¸€ä¸ªid,ç„¶åæ ¹æ®idæŸ¥è¯¢</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="title function_">getByCategoryId</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“ï¼Œå‚æ•°ä¸º&#123;&#125;&quot;</span>, categoryId);</span><br><span class="line">    List&lt;Dish&gt; list = dishService.getByCategoryId(categoryId);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œæˆ‘åˆšå¼€å§‹å†™çš„æ—¶å€™å‡ºé—®é¢˜äº†,æ²¡è€ƒè™‘åˆ°èœå“å¦‚æœä¸‹æ¶çš„æƒ…å†µ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> * å¯¹æ¯”ç­”æ¡ˆ,å‘ç°é—®é¢˜äº†,è¿™é‡ŒæŸ¥çš„æ˜¯æ‰€æœ‰èœå“,ä¸ç®¡çŠ¶æ€å¦‚ä½•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Dish&gt; <span class="title function_">getByCategoryId</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¹‹å‰å†™çš„</span></span><br><span class="line">    <span class="comment">// List&lt;Dish&gt; list = dishMapper.getByCategoryId(categoryId);</span></span><br><span class="line">    <span class="comment">// return list;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹å</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> Dish.builder().categoryId(categoryId).status(StatusConstant.ENABLE).build();</span><br><span class="line">    <span class="keyword">return</span> dishMapper.getByCategoryId(dish);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper,å› ä¸ºæœ‰ä¸¤ä¸ªå€¼è¦ä¼ ,æ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨dishå¯¹è±¡æ¥ä¼ é€’å‚æ•°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“-ä½†æ˜¯è¦æŸ¥è¯¢çŠ¶æ€ä¸º1çš„,ä¹Ÿå°±æ˜¯å¯ç”¨çš„èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from dish where category_id = #&#123;categoryId&#125; and status = #&#123;status&#125;&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getByCategoryId</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„,æˆ‘è¿™é‡Œå†™çš„å’Œæ–‡æ¡£é‡Œé¢æ˜¯ä¸ä¸€æ ·çš„</strong></p>
<hr>
<p>ä¸‹é¢æ‰æ˜¯æ–°å¢å¥—é¤çš„æ¥å£</p>
<blockquote>
<p>Controller,å‰ç«¯ä¼ æ¥çš„æ•°æ®æ˜¯DTO,å› ä¸ºé‡Œé¢ä¸ä½†åŒ…å«å¥—é¤çš„åŸºæœ¬ä¿¡æ¯,è¿˜åŒ…å«å¥—é¤ä¸­å¯¹åº”çš„èœå“ä¿¡æ¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤çš„æ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–°å¢å¥—é¤æ•°æ®ï¼š&#123;&#125;&quot;</span>, setmealDTO);</span><br><span class="line">        setmealService.saveWithDish(setmealDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œå°±ç¨å¾®å¤æ‚ç‚¹äº†</p>
</blockquote>
<ol>
<li>é¦–å…ˆå°†dtoè½¬åŒ–ä¸ºsetmealå¯¹è±¡,ç„¶åç›´æ¥è¿›è¡Œæ’å…¥,è¿™é‡Œæœ‰ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†,å¦‚æœå‡ºç°å”¯ä¸€é”®é—®é¢˜,ä¼šè‡ªåŠ¨è¿›è¡Œå¼‚å¸¸å¤„ç†</li>
<li>é€šè¿‡mybatisä¸­çš„æ’å…¥åè¿”å›ä¸»é”®çš„åŠŸèƒ½,è·å–åˆ°æ’å…¥å¥—é¤åå¯¹åº”çš„ä¸»é”®å€¼,å¹¶å¾—åˆ°æ¯ä¸ªsetmealDish,å¯¹æ¯ä¸ªsetmealDishçš„setmealIdè¿›è¡Œèµ‹å€¼,è¿™æ ·è¿™ä¸ªsetmealDishä¸­å°±æœ‰äº†èœå“id(è‡ªå¸¦,å› ä¸ºèœå“ä¼ è¿‡æ¥è‚¯å®šæ˜¯è¦æœ‰idçš„),è¿˜æœ‰setmealId,æœ€åæ‰§è¡Œæ’å…¥<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO å‰ç«¯ä¼ æ¥çš„å¸¦æœ‰å¥—é¤å†…èœå“çš„å¥—é¤æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆè®²setmealDTOè½¬æ¢æˆsetmealï¼Œç„¶åæ‰§è¡Œä¸€æ¬¡æ’å…¥</span></span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line">        setmealMapper.insert(setmeal);</span><br><span class="line">        <span class="comment">// æ’å…¥è¯¥å¥—é¤ä¿¡æ¯åï¼Œç”±äºå¥—é¤å’Œèœå“æ˜¯æ ¹æ®idç»‘å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ’å…¥è¿™æ¡æ•°æ®åï¼Œè¦è·å–åˆ°è¯¥æ¡è®°å½•çš„idå€¼</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmeal.getId();</span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ‰¹é‡æ’å…¥å¥—é¤-èœå“ï¼Œå‰ç«¯å‘æ¥çš„æ•°æ®ä¸­è‚¯å®šæ˜¯æœ‰dish_idçš„ï¼Œæ‰€ä»¥è¦æƒ³æ’å…¥ï¼Œåº”è¯¥å…ˆæŠŠå‰é¢è·å–çš„setmealIdèµ‹å€¼ç»™setmealDishesçš„æ¯ä¸€é¡¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        setmealDishes.forEach(setmealDish -&gt; setmealDish.setSetmealId(setmealId));</span><br><span class="line">        setmealDishMapper.insert(setmealDishes);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper</p>
</blockquote>
</li>
<li>Setmeal.mapper,å¸¸è§„çš„æ’å…¥è¯­å¥<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal(category_id, name, price, status, description, image, create_time, update_time, create_user,</span><br><span class="line">                        update_user)</span><br><span class="line">    VALUES (#&#123;categoryId&#125;, #&#123;name&#125;, #&#123;price&#125;, #&#123;status&#125;, #&#123;description&#125;, #&#123;image&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;,</span><br><span class="line">            #&#123;createUser&#125;, #&#123;updateUser&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>SetmealDish.mapper,ä½¿ç”¨äº†foreach,å› ä¸ºä¼šæœ‰å¾ˆå¤šæ¡æ•°æ®,æ˜¯ä¸€ä¸ªé›†åˆ<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">    insert into setmeal_dish (setmeal_id,dish_id,name,price,copies) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;setmealDishes&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;item.setmealId&#125;,#&#123;item.dishId&#125;,#&#123;item.name&#125;,#&#123;item.price&#125;,#&#123;item.copies&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p>è¿™æ ·å°±å®Œæˆäº†è¿™ä¸ªæ–°å¢å¥—é¤çš„æ¥å£</p>
<h2 id="å¥—é¤åˆ†é¡µæŸ¥è¯¢"><a href="#å¥—é¤åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="å¥—é¤åˆ†é¡µæŸ¥è¯¢"></a>å¥—é¤åˆ†é¡µæŸ¥è¯¢</h2><p><strong>è¿™ä¸ªä¹Ÿæ˜¯çŠ¯äº†ä¸€ä¸ªå¾ˆè ¢çš„é”™è¯¯</strong></p>
<p>åˆ†é¡µæŸ¥è¯¢æ—¶æ ¹æœ¬ç”¨ä¸åˆ°å¥—é¤å¯¹åº”çš„èœå“ä¿¡æ¯</p>
<blockquote>
<p>Controller,æ­£å¸¸å†™æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤åˆ†é¡µæŸ¥è¯¢-ä½†æ˜¯å¥—é¤æ˜¯æ²¡æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸å‡ºæ¥å†…å®¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ”¶åˆ°äº†åˆ†é¡µè¯·æ±‚,å‚æ•°ä¸º: &#123;&#125;&quot;</span>, setmealPageQueryDTO);</span><br><span class="line">    <span class="comment">// serviceè¿”å›ä¸€ä¸ªpageResultå¯¹è±¡</span></span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> setmealService.pageQuery(setmealPageQueryDTO);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™ä¸ªæ˜¯çœŸçš„å‚»äº†,å½“æ—¶çœ‹åˆ°ä»€ä¹ˆæƒ…å†µ,å°±æ”¹äº†è¿™ä¸€å †ä»£ç ?</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¥—é¤åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">/*    @Override</span></span><br><span class="line"><span class="comment">    public PageResult pageQuery(SetmealPageQueryDTO setmealPageQueryDTO) &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        PageHelper.startPage(setmealPageQueryDTO.getPage(), setmealPageQueryDTO.getPageSize());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        Page&lt;SetmealVO&gt; page = setmealMapper.pageQuery(setmealPageQueryDTO);</span></span><br><span class="line"><span class="comment">        // List&lt;SetmealVO&gt; result = page.getResult();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºç°ä¸¥é‡bug,ä¸‹é¢çš„è·å–ç±»å‹åæ˜¯é€šè¿‡åˆ†é¡µçš„ç¬¬ä¸€é¡¹çš„ç±»å‹åçš„,æ¯”å¦‚ç¬¬ä¸€ä¸ªæ˜¯å•†åŠ¡å¥—é¤,é‚£ä¹ˆåé¢çš„å°±å…¨æ˜¯å•†åŠ¡å¥—é¤,é‚£è‚¯å®šä¸è¡Œ</span></span><br><span class="line"><span class="comment">     */</span><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span><span class="comment">/*        if (result.size() &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">            // ä¸´æ—¶å˜é‡</span></span><br><span class="line"><span class="comment">            SetmealVO setmealVOD = result.get(0);</span></span><br><span class="line"><span class="comment">            String categoryName = categoryMapper.getById(setmealVOD.getCategoryId());</span></span><br><span class="line"><span class="comment">            page.forEach(setmealVO -&gt; setmealVO.setCategoryName(categoryName));</span></span><br><span class="line"><span class="comment">        &#125;*/</span><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // æ”¹æˆè¿™æ ·åº”è¯¥å°±è¡Œäº†,æ˜¯éå†æ•´ä¸ªé¡µé¢çš„æ‰€æœ‰é¡¹,åˆ†åˆ«è·å–æ¯ä¸€é¡¹çš„ç±»å‹å</span></span><br><span class="line"><span class="comment">        for (SetmealVO setmealVO : page) &#123;</span></span><br><span class="line"><span class="comment">            String categoryName = categoryMapper.getById(setmealVO.getCategoryId());</span></span><br><span class="line"><span class="comment">            setmealVO.setCategoryName(categoryName);</span></span><br><span class="line"><span class="comment">            // æˆ‘æ˜æ˜è®°å¾—ç»™è¿™ä¸ªVOåŠ å…¥äº†è¿™ä¸ªå¯¹åº”çš„å¥—é¤åˆ—è¡¨,å¯å°±æ˜¯æ²¡æœ‰?</span></span><br><span class="line"><span class="comment">            setmealVO.setSetmealDishes(setmealDishMapper.getBySetmealId(setmealVO.getId()));</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // æ ¹æ®åˆ†ç±»idæŸ¥è¯¢åˆ†ç±»åï¼Œç„¶åå°†åˆ†ç±»åç½®å…¥è¿™ä¸ªå¥—é¤VOä¸­</span></span><br><span class="line"><span class="comment">        return new PageResult(page.getTotal(), page.getResult());</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°å†™çš„ä¸€ä¸ªService è¿™ä¸ªæ–°çš„å’Œä¹‹å‰å†™çš„åŒºåˆ«åœ¨äº,ä¹‹å‰çš„åˆ†ç±»åæ˜¯åæ¥æŸ¥äº†å­˜è¿›å»çš„,æ–°çš„è¿™ä¸ªæ˜¯é€šè¿‡å…³è”æŸ¥è¯¢å‡ºæ¥çš„</span></span><br><span class="line">    <span class="comment">// å¯¹å•Š,ä¸Šé¢æŠŠå¥—é¤å¯¹åº”çš„èœå“ä¹Ÿæ”¾è¿›å»äº†,ä½†æ˜¯å‰ç«¯å±•ç¤ºåˆ†é¡µ,é‚£ä¸ªé¡µé¢å°±ç”¨ä¸åˆ°å¥—é¤å¯¹åº”çš„èœå“ä¿¡æ¯,åªæ˜¯ä¿®æ”¹æ—¶ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(SetmealPageQueryDTO setmealPageQueryDTO)</span> &#123;</span><br><span class="line">        PageHelper.startPage(setmealPageQueryDTO.getPage(), setmealPageQueryDTO.getPageSize());</span><br><span class="line">        Page&lt;SetmealVO&gt; page = setmealMapper.pageQueryBySql(setmealPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper,ä¸€ä¸ªå¾ˆç®€å•çš„å…³è”æŸ¥è¯¢,åªæ˜¯ä¸ºäº†å°†åˆ†ç±»åæŸ¥å‡ºæ¥,å› ä¸ºåªæ˜¯éœ€è¦åˆ†ç±»å,å…¶ä»–çš„å¹¶ä¸éœ€è¦â€¦</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQueryBySql&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.SetmealVO&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    s.*,c.name categoryName</span><br><span class="line">    from</span><br><span class="line">    setmeal s</span><br><span class="line">    left join</span><br><span class="line">    category c</span><br><span class="line">    on</span><br><span class="line">    s.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and s.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and s.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and s.category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by s.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤å¥—é¤"><a href="#åˆ é™¤å¥—é¤" class="headerlink" title="åˆ é™¤å¥—é¤"></a>åˆ é™¤å¥—é¤</h2><p>ä¸šåŠ¡è§„åˆ™:</p>
<ul>
<li>å¯ä»¥ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªå¥—é¤ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡åˆ é™¤å¥—é¤</li>
<li>èµ·å”®ä¸­çš„å¥—é¤ä¸èƒ½åˆ é™¤</li>
</ul>
<p>è¿™ä¸€çœ‹æœç„¶æ˜¯æ­£å¸¸é€»è¾‘,åªæœ‰èµ·å”®ä¸­çš„å¥—é¤ä¸èƒ½åˆ é™¤,é‚£æˆ‘å†™çš„åº”è¯¥æ˜¯æ²¡é—®é¢˜å§</p>
<p>è¿˜æ˜¯è¿™ä¸ªç®€å•äº›</p>
<blockquote>
<p>Controller,å‰ç«¯ä¼ æ¥ä¸€ä¸ªæ•°ç»„,ç”¨<code>@RequestParam</code>æ¥è®²æ•°ç»„å°è£…ä¸ºä¸€ä¸ªLongå‹çš„é›†åˆ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteBitch</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰¹é‡åˆ é™¤èœå“,å‚æ•°:&#123;&#125;&quot;</span>, ids);</span><br><span class="line">        setmealService.deleteBitch(ids);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œæ—¢ç„¶æ¶‰åŠåˆ°å¤šè¡¨,æ‰€ä»¥ç”¨åˆ°äº†<code>@Transactional</code>äº‹åŠ¡å¤„ç†</p>
</blockquote>
<ol>
<li>éå†è¿™ä¸ªids,å¾—åˆ°æ¯ä¸€é¡¹</li>
<li>å¯¹æ¯ä¸€é¡¹è¿›è¡Œåˆ¤æ–­çŠ¶æ€,å¦‚æœæœ‰ä¸€ä¸ªçŠ¶æ€æ˜¯èµ·å”®çš„,å°±ç›´æ¥æŠ›å‡ºä¸èƒ½åˆ é™¤çš„å¼‚å¸¸</li>
<li>æœ€ååœ¨åˆ é™¤å°±è¡Œäº†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ‰¹é‡idåˆ é™¤å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBitch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ ¹æ®idsæŸ¥è¯¢å¥—é¤</span></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">            <span class="keyword">if</span> (setmeal.getStatus() == StatusConstant.ENABLE) &#123;</span><br><span class="line">                <span class="comment">// èµ·å”®ä¸­,ä¸èƒ½åˆ é™¤,æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.SETMEAL_ON_SALE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¥½åˆå‘ç°é—®é¢˜äº†,è¿™é‡Œåªåˆ é™¤äº†</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. éƒ½æ˜¯åœå”®çš„,è¿›è¡Œæ‰¹é‡åˆ é™¤</span></span><br><span class="line">        setmealMapper.deleteBitch(ids);</span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            setmealDishMapper.deleteBySetmealId(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper</p>
</blockquote>
</li>
<li>SetmealMapper,è¿™é‡Œå› ä¸ºæ˜¯æ‰¹é‡åˆ é™¤,æ‰€ä»¥ä½¿ç”¨äº†foreach(è€å¸ˆçš„æ˜¯å•ä¸ªåˆ é™¤,ç„¶åå¤–é¢å¥—äº†ä¸€å±‚éå†idsçš„å¾ªç¯)<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBitch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from setmeal</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>SetmealDishMapper,å°±æ˜¯æ™®é€šçš„åˆ é™¤æ–¹æ³•äº†,æ ¹æ®å¥—é¤idåˆ <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®setmealIdæ¥åˆ é™¤å¥—é¤ä¸èœå“çš„å¯¹åº”å…³ç³»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Delete(&quot;delete from setmeal_dish where setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ä¿®æ”¹å¥—é¤"><a href="#ä¿®æ”¹å¥—é¤" class="headerlink" title="ä¿®æ”¹å¥—é¤"></a>ä¿®æ”¹å¥—é¤</h2><blockquote>
<p>Controller,å…ˆæŸ¥,è¿›è¡Œå›æ˜¾,å†æ”¹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢å¥—é¤ä»¥åŠå¥—é¤å¯¹åº”çš„èœå“åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢å¥—é¤ä»¥åŠå¥—é¤å¯¹åº”çš„èœå“åˆ—è¡¨&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SetmealVO&gt; <span class="title function_">getWithSetmealDishesById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ ¹æ®idæŸ¥è¯¢å¥—é¤ä»¥åŠå¥—é¤å¯¹åº”çš„èœå“åˆ—è¡¨ï¼Œå‚æ•°ä¸ºï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">    <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> setmealService.getWithSetmealDishById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(setmealVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;ä¿®æ”¹çš„å‚æ•°:&#123;&#125;&quot;</span>, setmealDTO);</span><br><span class="line">    setmealService.update(setmealDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,çœ‹å¥½äº†å•Š,è¿™é‡Œä¸éœ€è¦æŸ¥è¯¢åˆ†ç±»åâ€¦æˆ‘è¯´æ§åˆ¶å°æ€ä¹ˆå¤šäº†è¿™ä¹ˆå¤šæŸ¥è¯¢è¯­å¥</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢å¥—é¤ä»¥åŠå¥—é¤å¯¹åº”çš„èœå“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SetmealVO <span class="title function_">getWithSetmealDishById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ­¥ï¼Œå…ˆæ ¹æ®idæŸ¥è¯¢å¥—é¤è¡¨</span></span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(id);</span><br><span class="line">        log.info(<span class="string">&quot;è·å–åˆ°çš„å¥—é¤ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, setmeal);</span><br><span class="line">        <span class="type">SetmealVO</span> <span class="variable">setmealVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmeal, setmealVO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ­¥ï¼Œæ ¹æ®idåœ¨ setmeal_dishè¡¨ä¸­æŸ¥è¯¢å…³è”çš„ä¿¡æ¯</span></span><br><span class="line">        List&lt;SetmealDish&gt; list = setmealDishMapper.getBySetmealId(id);</span><br><span class="line">        setmealVO.setSetmealDishes(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ«å¿˜äº†è¿˜æœ‰åˆ†ç±»å é€šè¿‡åˆ†ç±»idè·å–ç±»å‹å----ååŠ ,å¥½åƒç”¨ä¸åˆ°åˆ†ç±»å</span></span><br><span class="line"><span class="comment">/*        String categoryName = categoryMapper.getById(setmeal.getCategoryId());</span></span><br><span class="line"><span class="comment">        setmealVO.setCategoryName(categoryName);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> setmealVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹å¥—é¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(SetmealDTO setmealDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿˜æ˜¯è¦åˆ†æˆä¸¤æ­¥ä¿®æ”¹å•Š</span></span><br><span class="line">        <span class="comment">// 1. å…ˆç›´æ¥ä¿®æ”¹å¥—é¤çš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">        BeanUtils.copyProperties(setmealDTO, setmeal);</span><br><span class="line">        setmealMapper.update(setmeal);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. ä¿®æ”¹å¥—é¤å¯¹åº”çš„èœå“ä¿¡æ¯,æˆ–è€…è¯´æ˜¯setmeal_dishè¡¨ä¸­çš„ä¿¡æ¯</span></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.1 å…ˆåˆ é™¤-æ ¹æ®setmealIdåˆ é™¤</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> setmealDTO.getId();</span><br><span class="line">        setmealDishMapper.deleteBySetmealId(setmealId);</span><br><span class="line">        <span class="comment">// 2.2 å†èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">            setmealDish.setSetmealId(setmealId);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;ä¿®æ”¹åçš„å¥—é¤èœå“å¯¹è±¡ä¸º:&#123;&#125;&quot;</span>, setmealDishes);</span><br><span class="line">        setmealDishMapper.insert(setmealDishes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper,åœ¨SetmealMapperä¸­ç”¨åˆ°çš„è¿™ä¸ªåŠ¨æ€sql,ä¹Ÿä¸éš¾â€¦</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Setmeal&quot;</span>&gt;</span></span><br><span class="line">        update setmeal</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">                category_id = #&#123;categoryId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span></span><br><span class="line">                price = #&#123;price&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null&quot;</span>&gt;</span></span><br><span class="line">                description = #&#123;description&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br><span class="line">                image = #&#123;image&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time = #&#123;updateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span></span><br><span class="line">                update_user = #&#123;updateUser&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹å¥—é¤çŠ¶æ€"><a href="#ä¿®æ”¹å¥—é¤çŠ¶æ€" class="headerlink" title="ä¿®æ”¹å¥—é¤çŠ¶æ€"></a>ä¿®æ”¹å¥—é¤çŠ¶æ€</h2><blockquote>
<p>Controller,è¿™ä¸ªä¸éš¾å§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å¥—é¤èµ·å”®/åœå”®&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line">    setmealService.startOrStop(status, id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>???åŸæ¥è¿™ä¸ªä¹Ÿè¿™ä¹ˆéº»çƒ¦<br>å®å±æ²¡æƒ³åˆ°</p>
<ul>
<li>å¯ä»¥å¯¹çŠ¶æ€ä¸ºèµ·å”®çš„å¥—é¤è¿›è¡Œåœå”®æ“ä½œï¼Œå¯ä»¥å¯¹çŠ¶æ€ä¸ºåœå”®çš„å¥—é¤è¿›è¡Œèµ·å”®æ“ä½œ</li>
<li>èµ·å”®çš„å¥—é¤å¯ä»¥å±•ç¤ºåœ¨ç”¨æˆ·ç«¯ï¼Œåœå”®çš„å¥—é¤ä¸èƒ½å±•ç¤ºåœ¨ç”¨æˆ·ç«¯</li>
<li><strong>èµ·å”®å¥—é¤æ—¶ï¼Œå¦‚æœå¥—é¤å†…åŒ…å«åœå”®çš„èœå“ï¼Œåˆ™ä¸èƒ½èµ·å”®</strong></li>
</ul>
<p>ç¬¬ä¸‰æ¡,æ ¹æœ¬ä¹ˆè€ƒè™‘åˆ°</p>
<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¥—é¤èµ·å”®/åœå”®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€ç§æ˜¯æˆ‘å†™çš„ï¼Œç¬¬äºŒç§æ˜¯è€å¸ˆå†™çš„ï¼Œä¸¤ç§æ–¹å¼ï¼Œéƒ½èƒ½å®ç°æ•ˆæœ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status == StatusConstant.ENABLE)&#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å¥—é¤idæŸ¥è¯¢å¥—é¤å…³è”çš„èœå“id</span></span><br><span class="line">            List&lt;SetmealDish&gt; setmealDishes = setmealDishMapper.getBySetmealId(id);</span><br><span class="line">            <span class="keyword">for</span> (SetmealDish setmealDish : setmealDishes) &#123;</span><br><span class="line">                <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(setmealDish.getDishId());</span><br><span class="line">                <span class="keyword">if</span> (dish.getStatus() == StatusConstant.DISABLE) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SetmealEnableFailedException</span>(MessageConstant.SETMEAL_ENABLE_FAILED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// èµ·å”®å¥—é¤æ—¶ï¼Œåˆ¤æ–­å¥—é¤å†…æ˜¯å¦æœ‰åœå”®èœå“ï¼Œæœ‰åœå”®èœå“æç¤º&quot;å¥—é¤å†…åŒ…å«æœªå¯å”®èœå“ï¼Œæ— æ³•å¯å”®&quot;</span></span><br><span class="line"><span class="comment">/*        if (status == StatusConstant.ENABLE) &#123;</span></span><br><span class="line"><span class="comment">            // select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = ?</span></span><br><span class="line"><span class="comment">            List&lt;Dish&gt; dishList = dishMapper.getBySetmealId(id);</span></span><br><span class="line"><span class="comment">            if (dishList != null &amp;&amp; dishList.size() &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">                dishList.forEach(dish -&gt; &#123;</span></span><br><span class="line"><span class="comment">                    if (StatusConstant.DISABLE == dish.getStatus()) &#123;</span></span><br><span class="line"><span class="comment">                        throw new SetmealEnableFailedException(MessageConstant.SETMEAL_ENABLE_FAILED);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> Setmeal.builder().id(id).status(status).build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™ä¸€ä¸ªå¯ä»¥ä¿®æ”¹ä»»æ„çš„å­—æ®µ</span></span><br><span class="line">        setmealMapper.update(setmeal);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,æˆ‘å†™çš„é‚£ä¸ªä¸»è¦å°±æ˜¯ç®€å•çš„sql,è€å¸ˆå†™çš„é‚£ä¸ªåªæ˜¯å¤šä¸ªæ ¹æ®setmealIdåœ¨dishè¡¨ä¸­æŸ¥,æ˜¯ä¸€ä¸ªå…³è”æŸ¥è¯¢,å°±æ˜¯ä»–ä¸€æ¡Sqlè§£å†³äº†,è€Œæˆ‘ä¸¤æ¡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å¥—é¤idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select a.* from dish a left join setmeal_dish b on a.id = b.dish_id where b.setmeal_id = #&#123;setmealId&#125;&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getBySetmealId</span><span class="params">(Long setmealId)</span>;</span><br></pre></td></tr></table></figure>

<h1 id="6-åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"><a href="#6-åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®" class="headerlink" title="6 åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"></a>6 åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</h1><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="Rediså¤ä¹ "><a href="#Rediså¤ä¹ " class="headerlink" title="Rediså¤ä¹ ?"></a>Rediså¤ä¹ ?</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230903120240.png" alt="20230903120240"></p>
<p>è¿™ä¸€éƒ¨åˆ†å°±ä¸çœ‹äº†,ç›´æ¥è·³åˆ°åœ¨Javaä¸­æ“ä½œRedis</p>
<h3 id="Javaæ“ä½œRedis"><a href="#Javaæ“ä½œRedis" class="headerlink" title="Javaæ“ä½œRedis"></a>Javaæ“ä½œRedis</h3><p>ä¸€å…±ä¸¤ç§æ“ä½œæ–¹å¼:</p>
<ol>
<li>Redisçš„Javaå®¢æˆ·ç«¯</li>
<li>Spring Data Redisä½¿ç”¨æ–¹å¼</li>
</ol>
<p>é‡ç‚¹æ”¾åœ¨<code>Spring Data Redis</code>ä¸Šé¢</p>
<p>æ“ä½œæ­¥éª¤</p>
<ol>
<li>å¯¼å…¥<code>Spring Data Redis</code>çš„mavenåæ ‡</li>
<li>é…ç½®Redisæ•°æ®æº<br>è¿™é‡Œè¿˜æ˜¯åˆ†å¼€é…ç½®çš„<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">$&#123;sky.redis.host&#125;</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">$&#123;sky.redis.port&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;sky.redis.password&#125;</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">$&#123;sky.redis.database&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># devæ–‡ä»¶</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">1.14</span><span class="number">.102</span><span class="string">.xx</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;010203&quot;</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure></li>
<li>ç¼–å†™é…ç½®ç±»,åˆ›å»ºRedisTemplateå¯¹è±¡<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹åˆ›å»ºredisæ¨¡æ¿å¯¹è±¡&quot;</span>);</span><br><span class="line">        <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®redisçš„è¿æ¥å·¥å‚å¯¹è±¡</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// è®¾ç½®redis keyçš„åºåˆ—åŒ–å™¨</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>é€šè¿‡RedisTemplateå¯¹è±¡æ“ä½œRedis,ç›´æ¥æ‰“å°å¯¹è±¡<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(redisTemplate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>åŸºæœ¬æ“ä½œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.DataType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-03 12:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataRedisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(redisTemplate);</span><br><span class="line">        <span class="type">ValueOperations</span> <span class="variable">valueOperations</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">        <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;æ“ä½œå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ±‰ä¸­&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;city&quot;</span>);</span><br><span class="line">        System.out.println(city);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 30sè¿‡æœŸ</span></span><br><span class="line">        <span class="comment">// redisTemplate.opsForValue().set(&quot;county&quot;, &quot;ç•™å&quot;, 30, TimeUnit.SECONDS);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">county</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(<span class="string">&quot;county&quot;</span>);</span><br><span class="line">        System.out.println(county);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// setnx</span></span><br><span class="line">        redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æˆéƒ½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// hset hget hdel hkeys hvals</span></span><br><span class="line">        <span class="type">HashOperations</span> <span class="variable">hashOperations</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">        hashOperations.put(<span class="string">&quot;101&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line">        hashOperations.put(<span class="string">&quot;101&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;20&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) hashOperations.get(<span class="string">&quot;101&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        hashOperations.keys(<span class="string">&quot;101&quot;</span>);</span><br><span class="line">        <span class="type">List</span> <span class="variable">values</span> <span class="operator">=</span> hashOperations.values(<span class="string">&quot;101&quot;</span>);</span><br><span class="line">        System.out.println(values);</span><br><span class="line"></span><br><span class="line">        hashOperations.delete(<span class="string">&quot;101&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ListOperations</span> <span class="variable">listOperations</span> <span class="operator">=</span> redisTemplate.opsForList();</span><br><span class="line">        listOperations.leftPushAll(<span class="string">&quot;myList&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        listOperations.leftPush(<span class="string">&quot;myList&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">        <span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> listOperations.range(<span class="string">&quot;myList&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(myList);</span><br><span class="line"></span><br><span class="line">        listOperations.rightPop(<span class="string">&quot;myList&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> listOperations.size(<span class="string">&quot;myList&quot;</span>);</span><br><span class="line">        System.out.println(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SetOperations</span> <span class="variable">setOperations</span> <span class="operator">=</span> redisTemplate.opsForSet();</span><br><span class="line">        setOperations.add(<span class="string">&quot;set02&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">        setOperations.add(<span class="string">&quot;set03&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Set</span> <span class="variable">members</span> <span class="operator">=</span> setOperations.members(<span class="string">&quot;set02&quot;</span>);</span><br><span class="line">        System.out.println(members);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> setOperations.size(<span class="string">&quot;set02&quot;</span>);</span><br><span class="line">        System.out.println(size);</span><br><span class="line"></span><br><span class="line">        <span class="type">Set</span> <span class="variable">intersect</span> <span class="operator">=</span> setOperations.intersect(<span class="string">&quot;set02&quot;</span>, <span class="string">&quot;set03&quot;</span>);</span><br><span class="line">        System.out.println(intersect);</span><br><span class="line"></span><br><span class="line">        <span class="type">Set</span> <span class="variable">union</span> <span class="operator">=</span> setOperations.union(<span class="string">&quot;set02&quot;</span>, <span class="string">&quot;set03&quot;</span>);</span><br><span class="line">        System.out.println(union);</span><br><span class="line"></span><br><span class="line">        setOperations.remove(<span class="string">&quot;set02&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ZSetOperations</span> <span class="variable">zSetOperations</span> <span class="operator">=</span> redisTemplate.opsForZSet();</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;zset01&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;zset01&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        zSetOperations.add(<span class="string">&quot;zset01&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Set</span> <span class="variable">zset01</span> <span class="operator">=</span> zSetOperations.range(<span class="string">&quot;zset01&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(zset01);</span><br><span class="line"></span><br><span class="line">        zSetOperations.incrementScore(<span class="string">&quot;zset01&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        zSetOperations.remove(<span class="string">&quot;zset01&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCommon</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        System.out.println(keys);</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">myList</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;myList&quot;</span>);</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">xx</span> <span class="operator">=</span> redisTemplate.hasKey(<span class="string">&quot;xx&quot;</span>);</span><br><span class="line">        System.out.println(myList);</span><br><span class="line">        System.out.println(xx);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object key : keys) &#123;</span><br><span class="line">            <span class="type">DataType</span> <span class="variable">type</span> <span class="operator">=</span> redisTemplate.type(key);</span><br><span class="line">            System.out.println(type);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;li&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"><a href="#åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®" class="headerlink" title="åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®"></a>åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</h2><ol>
<li>æŸ¥è¯¢çŠ¶æ€(ç”±äºè·¯å¾„è§„èŒƒ,ç®¡ç†ç«¯å’Œç”¨æˆ·ç«¯æ˜¯ä¸åŒçš„æ¥å£è·¯å¾„,æ‰€ä»¥éœ€è¦ä¸¤ä¸ªæŸ¥è¯¢æ¥å£)<ul>
<li>ç®¡ç†ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</li>
<li>ç”¨æˆ·ç«¯æŸ¥è¯¢è¥ä¸šçŠ¶æ€</li>
</ul>
</li>
<li>ä¿®æ”¹çŠ¶æ€</li>
</ol>
<p><strong>è¥ä¸šçŠ¶æ€æ•°æ®å­˜å‚¨æ–¹å¼,åŸºäºRedisçš„å­—ç¬¦ä¸²æ¥è¿›è¡Œå­˜å‚¨</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230903194414.png" alt="20230903194414"></p>
<hr>
<blockquote>
<p>Controller,è¿™é‡ŒæŒ‡å®šäº†beançš„åˆ«å,å› ä¸ºä¼šæœ‰ä¸¤ä¸ª<code>ShopController</code>,ä¸€ä¸ªæ˜¯adminä¸‹çš„,ä¸€ä¸ªæ˜¯userä¸‹çš„,æ‰€ä»¥éœ€è¦æŒ‡å®š,ä¸ç„¶å°±ä¼šæŠ¥é”™,é™¤äº†Controller,å…¶ä»–ä¹Ÿå°±ä¸éœ€è¦äº†,å› ä¸ºè¿™é‡Œçš„æ•°æ®æ˜¯ç›´æ¥å­˜å‚¨åˆ°redisä¸­çš„,å› ä¸ºå°±åªæœ‰ä¸€æ¡æ•°æ®,æ”¾åˆ°redisä¸­éå¸¸å¿«é€Ÿ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;adminShopController&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¾ç½®åº—é“ºçš„è¥ä¸šçŠ¶æ€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setStatus</span><span class="params">(<span class="meta">@PathVariable</span> Integer status)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¾ç½®è¥ä¸šçŠ¶æ€ä¸º:&#123;&#125;&quot;</span>, status == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸š&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†çŠ¶æ€å­˜å‚¨åˆ°redisä¸­</span></span><br><span class="line">        redisTemplate.opsForValue().set(KEY, status);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åº—é“ºçŠ¶æ€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢åº—é“ºçŠ¶æ€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">shopStatus</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">        log.info(<span class="string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä½:&#123;&#125;&quot;</span>, shopStatus == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸š&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(shopStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>userä¸‹çš„Controller,ä¸¤ä¸ªé€»è¾‘å…¶å®æ˜¯ä¸€æ ·çš„,åªæ˜¯æœ‰è¯·æ±‚è·¯å¾„ä¸ç‚¹åŒºåˆ«,è¿™é‡Œçš„beanåˆ«åä¹Ÿè®¾ç½®äº†</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userShopController&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shop&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;åº—é“ºç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;SHOP_STATUS&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åº—é“ºçŠ¶æ€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢åº—é“ºçŠ¶æ€&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">shopStatus</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(KEY);</span><br><span class="line">        log.info(<span class="string">&quot;è·å–åˆ°åº—é“ºçš„è¥ä¸šçŠ¶æ€ä½:&#123;&#125;&quot;</span>, shopStatus == <span class="number">1</span> ? <span class="string">&quot;è¥ä¸š&quot;</span> : <span class="string">&quot;æ‰“çƒŠä¸­&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success(shopStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-å¾®ä¿¡ç™»å½•-å•†å“é¢„è§ˆ"><a href="#7-å¾®ä¿¡ç™»å½•-å•†å“é¢„è§ˆ" class="headerlink" title="7 å¾®ä¿¡ç™»å½•-å•†å“é¢„è§ˆ"></a>7 å¾®ä¿¡ç™»å½•-å•†å“é¢„è§ˆ</h1><h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><p>HttpClientæ˜¯<code>Apache Jakarta Common</code>ä¸‹çš„å­é¡¹ç›®,å¯ä»¥ç”¨æ¥æä¾›é«˜æ•ˆçš„,æœ€æ–°çš„,åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒHTTPåè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…,å¹¶ä¸”å®ƒæ”¯æŒHTTPåè®®æœ€æ–°çš„ç‰ˆæœ¬å’Œå»ºè®®</p>
<p>ä¾èµ–,è¿™ä¸ªä¾èµ–åœ¨OSSä¸­å·²ç»å¼•å…¥äº†</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘é€è¯·æ±‚æ­¥éª¤</p>
<ol>
<li>åˆ›å»ºHttpClientå¯¹è±¡</li>
<li>åˆ›å»ºHttpè¯·æ±‚å¯¹è±¡(get&#x2F;post)</li>
<li>è°ƒç”¨HttpClientçš„executeæ–¹æ³•å‘é€è¯·æ±‚</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230904094835.png" alt="20230904094835"></p>
<h3 id="å‘é€GETè¯·æ±‚"><a href="#å‘é€GETè¯·æ±‚" class="headerlink" title="å‘é€GETè¯·æ±‚"></a>å‘é€GETè¯·æ±‚</h3><p>å°±æ˜¯ä¸Šé¢é‚£ä¸‰æ­¥,çœ‹èµ·æ¥ä¹Ÿæ²¡å•¥éš¾å¾—,å°±æ˜¯è¦è®°å‡ ä¸ªAPI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// HttpClientçš„å®ç°ç±»</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost:8080/user/shop/status&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€è¯·æ±‚,å¹¶æ¥æ”¶å“åº”ç»“æœ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line">            <span class="comment">// è·å–æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç </span></span><br><span class="line">            <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">            System.out.println(<span class="string">&quot;æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç ï¼š&quot;</span> + statusCode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…·ä½“ç›¸åº”çš„æ•°æ®</span></span><br><span class="line">            <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">            <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> EntityUtils.toString(entity);</span><br><span class="line">            System.out.println(<span class="string">&quot;æœåŠ¡ç«¯è¿”å›çš„æ•°æ®ï¼š&quot;</span> + body);</span><br><span class="line">            <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">            response.close();</span><br><span class="line">            httpClient.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘é€POSTè¯·æ±‚"><a href="#å‘é€POSTè¯·æ±‚" class="headerlink" title="å‘é€POSTè¯·æ±‚"></a>å‘é€POSTè¯·æ±‚</h3><p>æ²¡å•¥éš¾çš„,åªæ˜¯è®°å¾—å°è£…è¯·æ±‚ä½“è¦ä½¿ç”¨åˆ°fastJson</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡httpClientå‘é€GETæ–¹å¼è¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPost</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/admin/employee/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ è¯·æ±‚ä½“  StringEntity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    jsonObject.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    jsonObject.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString());</span><br><span class="line">    <span class="comment">// æŒ‡å®šè¯·æ±‚çš„ç¼–ç æ–¹å¼</span></span><br><span class="line">    entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">// æŒ‡å®šä¼ è¾“çš„æ•°æ®æ ¼å¼</span></span><br><span class="line">    entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    httpPost.setEntity(entity);</span><br><span class="line">    <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè¿”å›ç»“æœ</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;å“åº”çŠ¶æ€ç ï¼š&quot;</span> + statusCode);</span><br><span class="line"></span><br><span class="line">    <span class="type">HttpEntity</span> <span class="variable">responseEntity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">    <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> EntityUtils.toString(responseEntity);</span><br><span class="line">    System.out.println(<span class="string">&quot;å“åº”ä½“ï¼š&quot;</span> + body);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°è£…çš„å·¥å…·ç±»"><a href="#å°è£…çš„å·¥å…·ç±»" class="headerlink" title="å°è£…çš„å·¥å…·ç±»"></a>å°è£…çš„å·¥å…·ç±»</h3><p>ä½†æ˜¯é¡¹ç›®ä¸­ä½¿ç”¨è¿˜æ˜¯ç”¨çš„å°è£…å¥½çš„å·¥å…·ç±»,ä¸ç„¶ä¸€æ¬¡åˆä¸€æ¬¡åˆ›å»ºHttpClientå¤šéº»çƒ¦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.utils.URIBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Httpå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">int</span> <span class="variable">TIMEOUT_MSEC</span> <span class="operator">=</span> <span class="number">5</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€GETæ–¹å¼è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doGet</span><span class="params">(String url,Map&lt;String,String&gt; paramMap)</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºHttpclientå¯¹è±¡</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">URIBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(url);</span><br><span class="line">            <span class="keyword">if</span>(paramMap != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (String key : paramMap.keySet()) &#123;</span><br><span class="line">                    builder.addParameter(key,paramMap.get(key));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> builder.build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ›å»ºGETè¯·æ±‚</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ¤æ–­å“åº”çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">if</span>(response.getStatusLine().getStatusCode() == <span class="number">200</span>)&#123;</span><br><span class="line">                result = EntityUtils.toString(response.getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€POSTæ–¹å¼è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doPost</span><span class="params">(String url, Map&lt;String, String&gt; paramMap)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºHttpclientå¯¹è±¡</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resultString</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºHttp Postè¯·æ±‚</span></span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºå‚æ•°åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> (paramMap != <span class="literal">null</span>) &#123;</span><br><span class="line">                List&lt;NameValuePair&gt; paramList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; param : paramMap.entrySet()) &#123;</span><br><span class="line">                    paramList.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(param.getKey(), param.getValue()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ¨¡æ‹Ÿè¡¨å•</span></span><br><span class="line">                <span class="type">UrlEncodedFormEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(paramList);</span><br><span class="line">                httpPost.setEntity(entity);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            httpPost.setConfig(builderRequestConfig());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰§è¡Œhttpè¯·æ±‚</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            resultString = EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€POSTæ–¹å¼è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doPost4Json</span><span class="params">(String url, Map&lt;String, String&gt; paramMap)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºHttpclientå¯¹è±¡</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resultString</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºHttp Postè¯·æ±‚</span></span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (paramMap != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ„é€ jsonæ ¼å¼æ•°æ®</span></span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; param : paramMap.entrySet()) &#123;</span><br><span class="line">                    jsonObject.put(param.getKey(),param.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString(),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">//è®¾ç½®è¯·æ±‚ç¼–ç </span></span><br><span class="line">                entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">//è®¾ç½®æ•°æ®ç±»å‹</span></span><br><span class="line">                entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                httpPost.setEntity(entity);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            httpPost.setConfig(builderRequestConfig());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰§è¡Œhttpè¯·æ±‚</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            resultString = EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultString;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RequestConfig <span class="title function_">builderRequestConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(TIMEOUT_MSEC)</span><br><span class="line">                .setConnectionRequestTimeout(TIMEOUT_MSEC)</span><br><span class="line">                .setSocketTimeout(TIMEOUT_MSEC).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¾®ä¿¡å°ç¨‹åºå¼€å‘"><a href="#å¾®ä¿¡å°ç¨‹åºå¼€å‘" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºå¼€å‘"></a>å¾®ä¿¡å°ç¨‹åºå¼€å‘</h2><h3 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><p>çœ‹çœ‹è¿™ä¸ªè¯¾å’ŒåŸ¹è®­è€å¸ˆè®²çš„å“ªä¸ªå¥½</p>
<blockquote>
<p>è·å–ç”¨æˆ·çš„å¤´åƒä¿¡æ¯,è¦æŠŠåŸºç¡€åº“ç‰ˆæœ¬è°ƒåˆ°2.10å·¦å³æ‰èƒ½çœ‹åˆ°å¼¹çª—,ä¸ç„¶åªèƒ½å¾—åˆ°é»˜è®¤çš„ç”¨æˆ·åå’Œå¤´åƒ,åº”è¯¥æ˜¯æ¥å£æ¢äº†</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ç”¨æˆ·çš„å¤´åƒå’Œæ˜µç§°</span></span><br><span class="line">  <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">getUserProfile</span>(&#123;</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&#x27;è·å–ç”¨æˆ·ä¿¡æ¯&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: (<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">userInfo</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">nickName</span>: res.<span class="property">userInfo</span>.<span class="property">nickName</span>,</span><br><span class="line">          <span class="attr">url</span>: res.<span class="property">userInfo</span>.<span class="property">avatarUrl</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨æˆ·ç™»å½•,ä¼šè¿”å›ä¸€ä¸ªæˆæƒç ,æ˜¯éšæœºçš„,ä¸”ä¸€ä¸ªæˆæƒç åªèƒ½ä½¿ç”¨ä¸€æ¬¡ </p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾®ä¿¡ç™»å½•-è·å–ç”¨æˆ·çš„æˆæƒç </span></span><br><span class="line">  <span class="title function_">wxlogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">code</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‘é€å¼‚æ­¥è¯·æ±‚</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line"><span class="title function_">sendRequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://localhost:8080/user/shop/status&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="attr">status</span>: res.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¯¼å…¥å°ç¨‹åºä»£ç "><a href="#å¯¼å…¥å°ç¨‹åºä»£ç " class="headerlink" title="å¯¼å…¥å°ç¨‹åºä»£ç "></a>å¯¼å…¥å°ç¨‹åºä»£ç </h2><p>çœŸå°±æ˜¯ç›´æ¥å¯¼å…¥,ä¸€ç‚¹éƒ½ä¸ç”¨æ”¹</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230904222503.png" alt="20230904222503"></p>
<h2 id="å¾®ä¿¡ç™»å½•æµç¨‹"><a href="#å¾®ä¿¡ç™»å½•æµç¨‹" class="headerlink" title="å¾®ä¿¡ç™»å½•æµç¨‹"></a>å¾®ä¿¡ç™»å½•æµç¨‹</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://res.wx.qq.com/wxdoc/dist/assets/img/api-login.2fcc9f35.jpg" alt="ç™»å½•æµç¨‹"></p>
<p>å°±æ˜¯</p>
<ol>
<li>å°ç¨‹åºç«¯è°ƒ<code>wx.login</code>å¾—åˆ°code(ç”¨æˆ·æˆæƒç )</li>
<li>å°ç¨‹åºç«¯å‘é€è¯·æ±‚,æºå¸¦code</li>
<li>æœåŠ¡ç«¯æ¥æ”¶åˆ°codeå’Œè¯·æ±‚,ç„¶åè°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡(<code>appId</code>,<code>appsecret</code>,<code>code</code>)</li>
<li>å¾®ä¿¡æ¥å£è¿”å›<code>session_key</code>å’Œ<code>openId</code></li>
<li>æœåŠ¡ç«¯è‡ªå®šä¹‰ç™»é™†çŠ¶æ€,ä¸<code>openId</code>å’Œ<code>session_key</code>å…³è”,è¿”å›è‡ªå®šä¹‰çŠ¶æ€</li>
<li>å°ç¨‹åºå­˜å…¥è‡ªå®šä¹‰ç™»å½•çŠ¶æ€,æ¯æ¬¡å‘é€è¯·æ±‚æ—¶,æºå¸¦ç™»å½•çŠ¶æ€</li>
</ol>
<p><em>wx26b00f9454de88a6</em><br><em>6c4ad5db6efb880425969b7afe4099c7</em></p>
<p>ç”¨postmanå‘é€è¯·æ±‚è¯•ä¸€ä¸‹,æ˜¯æ²¡é—®é¢˜çš„<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230905082536.png" alt="20230905082536"></p>
<h2 id="æ¥å£è®¾è®¡"><a href="#æ¥å£è®¾è®¡" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h2><p>ä¸šåŠ¡è§„åˆ™</p>
<ul>
<li>åŸºäºå¾®ä¿¡ç™»é™†å®ç°å°ç¨‹åºçš„çš„ç™»å½•åŠŸèƒ½</li>
<li>å¦‚æœæ˜¯æ–°ç”¨æˆ·éœ€è¦è‡ªåŠ¨å®Œæˆæ³¨å†Œ</li>
</ul>
<h2 id="ä»£ç å¼€å‘"><a href="#ä»£ç å¼€å‘" class="headerlink" title="ä»£ç å¼€å‘"></a>ä»£ç å¼€å‘</h2><p>jwtä»¤ç‰Œ-ç”¨æˆ·å’Œç®¡ç†ç«¯è¦åˆ†å¼€é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtç­¾ååŠ å¯†æ—¶ä½¿ç”¨çš„ç§˜é’¥</span></span><br><span class="line">    <span class="attr">admin-secret-key:</span> <span class="string">itcast</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtè¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="attr">admin-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="comment"># è®¾ç½®å‰ç«¯ä¼ é€’è¿‡æ¥çš„ä»¤ç‰Œåç§°</span></span><br><span class="line">    <span class="attr">admin-token-name:</span> <span class="string">token</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtåŠ å¯†æ—¶çš„å¯†é’¥</span></span><br><span class="line">    <span class="attr">user-secret-key:</span> <span class="string">itheima</span></span><br><span class="line">    <span class="comment"># è®¾ç½®jwtçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="attr">user-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="comment"># è®¾ç½®å‰ç«¯ä¼ æ¥çš„ä»¤ç‰Œåç§°</span></span><br><span class="line">    <span class="attr">user-token-name:</span> <span class="string">authentication</span></span><br></pre></td></tr></table></figure>

<p>wxçš„id</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wechat:</span></span><br><span class="line">  <span class="attr">appid:</span> <span class="string">$&#123;sky.wechat.appid&#125;</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">$&#123;sky.wechat.secret&#125;</span></span><br></pre></td></tr></table></figure>

<p><em>å½“æ—¶ä»¥ä¸ºè¿™ä¸ªHttpClientæ˜¯ç”¨æ¥åˆ†æ¨¡å—å¼€å‘çš„,æ²¡æƒ³åˆ°åªæ˜¯ç”¨æ¥è¯·æ±‚å¾®ä¿¡æ¥å£çš„</em></p>
<hr>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-05 8:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ç”¨æˆ·ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å¾®ä¿¡ç™»å½•&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡ç”¨æˆ·ç™»å½•ï¼Œæˆæƒç ï¼š&#123;&#125;&quot;</span>, userLoginDTO.getCode());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.wxLogin(userLoginDTO);</span><br><span class="line">        <span class="comment">// ä¸ºå¾®ä¿¡ç”¨æˆ·ç”Ÿæˆjwtä»¤ç‰Œ</span></span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// claims.put(&quot;userId&quot;, user.getId());</span></span><br><span class="line">        claims.put(JwtClaimsConstant.USER_ID, user.getId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(jwtProperties.getUserSecretKey(), jwtProperties.getUserTtl(), claims);</span><br><span class="line">        <span class="type">UserLoginVO</span> <span class="variable">userLoginVO</span> <span class="operator">=</span> UserLoginVO.builder().id(user.getId()).openid(user.getOpenid()).token(token).build();</span><br><span class="line">        log.info(<span class="string">&quot;ç™»é™†æˆåŠŸï¼š&#123;&#125;&quot;</span>, userLoginVO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(userLoginVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡ç™»é™†</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œå°±ä¼šè‡ªåŠ¨å®Œæˆæ³¨å†Œï¼Œå°è£…userç„¶åè¿”å›</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥åœ¨æ•°æ®åº“ä¸­å°±æŸ¥å‡ºäº†è¯¥userå¯¹è±¡ï¼Œä¹Ÿæ˜¯è¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">wxLogin</span><span class="params">(UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// å·®ä¸å¤šå°±æ˜¯ï¼Œå…ˆæ‹¿ç€codeå’Œç”¨æˆ·idè¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå°è£…åˆ°ä¸€ä¸ªuseré‡Œï¼Œæœ€åè¿”å›</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">openId</span> <span class="operator">=</span> getString(userLoginDTO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.1 åˆ¤æ–­openIdæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (openId == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LoginFailedException</span>(MessageConstant.LOGIN_FAILED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæ–°ç”¨æˆ·-æ ¹æ®openId</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getByOpenId(openId);</span><br><span class="line">        <span class="comment">// 2.1 æ˜¯æ–°ç”¨æˆ·ï¼Œåˆ™è‡ªåŠ¨å®Œæˆæ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ˜¯æ–°çš„ç”¨æˆ· -- æ„é€ ç”¨æˆ·ä¿¡æ¯-å®Œæˆæ³¨å†Œ -- ç°åœ¨åªèƒ½æ‹¿åˆ°openIdå’Œåˆ›å»ºæ—¶é—´ï¼Œå…¶ä½™çš„æ˜¯æ‹¿ä¸åˆ°çš„</span></span><br><span class="line">            user = User.builder().openid(openId).createTime(LocalDateTime.now()).build();</span><br><span class="line">            userMapper.insert(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.2 è¿”å›ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç°åœ¨å°ç¨‹åºç«¯å‘å‡ºçš„è¯·æ±‚éƒ½ä¼šæºå¸¦è¯·æ±‚å¤´token</strong></p>
<p>æˆ‘ç»ˆäºçŸ¥é“ä¸ºä»€ä¹ˆæœ‰äº›ä¼šè¦æ±‚æœ‰è¯·æ±‚å¤´çš„token,æœ‰äº›ä¸ç”¨äº†,æ˜¯è¿™ä¸ªæ‹¦æˆªå™¨åœ¨èµ·ä½œç”¨,ä¹Ÿå°±æ˜¯ä»è¯·æ±‚å¤´ä¸­è·å–åˆ°token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€ä»è¯·æ±‚å¤´ä¸­è·å–ä»¤ç‰Œ</span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(jwtProperties.getUserTokenName());</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ˜¯å°†æ‹¦æˆªå™¨æ³¨å†Œè¿›å»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenAdminInterceptor jwtTokenAdminInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUserInterceptor jwtTokenUserInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨...&quot;</span>);</span><br><span class="line">        registry.addInterceptor(jwtTokenAdminInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/admin/employee/login&quot;</span>);</span><br><span class="line">        registry.addInterceptor(jwtTokenUserInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/user/user/login&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/user/shop/status&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="å•†å“é¢„è§ˆ"><a href="#å•†å“é¢„è§ˆ" class="headerlink" title="å•†å“é¢„è§ˆ"></a>å•†å“é¢„è§ˆ</h2><p><em>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ç§ç±»?,å°±æ˜¯æœ‰å£å‘³,å°±ä¼šæœ‰è§„æ ¼,æ²¡æœ‰å£å‘³,å°±æ˜¯é€‰ä¸ªæ•°</em></p>
<ol>
<li>æŸ¥è¯¢åˆ†ç±»</li>
<li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</li>
<li>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤</li>
<li>æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</li>
</ol>
<blockquote>
<p>æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»-CategoryController,è¿›å…¥å°ç¨‹åºåè‡ªåŠ¨å‘èµ·è¯·æ±‚,è¯·æ±‚æ‰€æœ‰çš„åˆ†ç±»å’Œå¥—é¤,è¿™é‡Œå¯ä»¥æ ¹æ®åˆ†ç±»ç±»å‹è¿›è¡ŒæŸ¥è¯¢-åˆ†ç±»&#x2F;å¥—é¤</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æ‰€æœ‰çš„åˆ†ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(type);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“,å°±æ˜¯ç‚¹å‡»æŸä¸ªåˆ†ç±»,è¿›è¡ŒæŸ¥è¯¢è¯¥åˆ†ç±»çš„èœå“,è§„åˆ™å°±æ˜¯è¦æ±‚æ˜¯èµ·å”®çš„</p>
</blockquote>
<ol>
<li><code>DishController</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ªæœ‰åˆ†ç±»idï¼Œå’ŒçŠ¶æ€ä¸ºèµ·å”®çš„èœå“</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> Dish.builder().status(StatusConstant.ENABLE).categoryId(categoryId).build();</span><br><span class="line"></span><br><span class="line">    List&lt;DishVO&gt; list = dishService.listWithFlavor(dish);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>DishServiceImpl</code>,é¦–é€‰æ ¹æ®åˆ†ç±»çš„idæŸ¥è¯¢æ‰€æœ‰çš„èœå“,ç”¨ä¸€ä¸ª<code>List&lt;Dish&gt;</code>å°è£…,ç„¶åå°±æ˜¯éå†è¿™ä¸ªé›†åˆ,åˆ›å»ºä¸€ä¸ªDishVOå¯¹è±¡,ç„¶åå°†æ¯ä¸€ä¸ªDishå¯¹è±¡å¤åˆ¶ç»™DishVO,å†æ ¹æ®dishIdæŸ¥è¯¢æ‰€æœ‰çš„å£å‘³,æœ€åå°†å£å‘³å°è£…åˆ°DishVOä¸­,æœ€åè¿”å›.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®dishçš„åˆ†ç±»idè¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DishVO&gt; <span class="title function_">listWithFlavor</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆæ ¹æ®dishä¸­çš„åˆ†ç±»idè¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥åˆ°å¯¹åº”åˆ†ç±»æ‰€æœ‰çš„èœå“</span></span><br><span class="line">        List&lt;Dish&gt; dishList = dishMapper.getByCategoryId(dish);</span><br><span class="line">        List&lt;DishVO&gt; dishVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†è¿™ä¸ªdishListï¼Œæ‹¿åˆ°æ¯ä¸€ä¸ªdish,ç„¶åå°†æ¯ä¸€ä¸ªdishçš„å£å‘³éƒ½æŸ¥å‡ºæ¥ï¼Œå°è£…åˆ°ä¸€ä¸ªdishVOä¸­ï¼Œå†æ·»åŠ åˆ°dishVOListä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (Dish d : dishList) &#123;</span><br><span class="line">            <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">            BeanUtils.copyProperties(d, dishVO);</span><br><span class="line">            List&lt;DishFlavor&gt; flavors = dishFlavorMapper.getByDishId(dish.getId());</span><br><span class="line">            dishVO.setFlavors(flavors);</span><br><span class="line">            dishVOList.add(dishVO);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dishVOList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> Setmeal.builder().status(StatusConstant.ENABLE).categoryId(categoryId).build();</span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/dish/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;DishItemVO&gt;&gt; <span class="title function_">dishList</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    List&lt;DishItemVO&gt; list = setmealService.getDishItemById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰Serviceä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å¥—é¤idæŸ¥è¯¢åŒ…å«çš„èœå“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;DishItemVO&gt; <span class="title function_">getDishItemById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    List&lt;DishItemVO&gt; list = setmealMapper.getDishItemById(id);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨åˆ°äº†å¤šè¡¨è”æŸ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT setmeal_dish.copies,dish.description,dish.image,dish.`name`&quot; +</span></span><br><span class="line"><span class="meta">        &quot;FROM setmeal_dish LEFT JOIN dish ON setmeal_dish.dish_id = dish.id WHERE setmeal_id = #&#123;id&#125; &quot;)</span></span><br><span class="line">List&lt;DishItemVO&gt; <span class="title function_">getDishItemById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>

<h1 id="8-ç¼“å­˜-è´­ç‰©è½¦"><a href="#8-ç¼“å­˜-è´­ç‰©è½¦" class="headerlink" title="8 ç¼“å­˜-è´­ç‰©è½¦"></a>8 ç¼“å­˜-è´­ç‰©è½¦</h1><h2 id="ç¼“å­˜èœå“"><a href="#ç¼“å­˜èœå“" class="headerlink" title="ç¼“å­˜èœå“"></a>ç¼“å­˜èœå“</h2><blockquote>
<p>é—®é¢˜åˆ†æ<br>ç”¨æˆ·ç«¯å°ç¨‹åºå±•ç¤ºçš„èœå“æ•°æ®<code>éƒ½æ˜¯é€šè¿‡æŸ¥è¯¢æ•°æ®åº“è·å¾—</code>,å¦‚æœç”¨æˆ·ç«¯è®¿é—®é‡è¾ƒå¤§,æ•°æ®åº“è®¿é—®å‹åŠ›éšä¹‹å¢å¤§<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230906090125.png" alt="20230906090125"></p>
</blockquote>
<p><strong>ç»“æœå°±æ˜¯,ç³»ç»Ÿå“åº”æ…¢,ç”¨æˆ·ä½“éªŒå·®</strong></p>
<blockquote>
<p>å®ç°æ€è·¯<br>é€šè¿‡Redisæ¥ç¼“å­˜èœå“æ•°æ®,å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ“ä½œ<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/2023-09-06ddfa.png" alt="2023-09-06ddfa"></p>
</blockquote>
<p><strong>å°±æ˜¯ä¼˜å…ˆè¯»å–ç¼“å­˜æ•°æ®,æœ‰çš„è¯å°±ç”¨ç¼“å­˜çš„,æ²¡æœ‰å†å»æ•°æ®åº“ä¸­æŸ¥,ç„¶åå°†æŸ¥åˆ°çš„æ•°æ®å†™å…¥ç¼“å­˜ä¸­</strong></p>
<p>ç¼“å­˜é€»è¾‘åˆ†æ</p>
<p>å°ç¨‹åºç«¯æ˜¯æŒ‰ç…§åˆ†ç±»å±•ç¤ºçš„èœå“,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®åˆ†ç±»æ¥è¿›è¡Œç¼“å­˜,<strong>ä¸€ä¸ªåˆ†ç±»æ˜¯ä¸€ä»½ç¼“å­˜æ•°æ®</strong></p>
<p>è€Œç¼“å­˜çš„keyå°±å¯ä»¥ç”¨åˆ†ç±»idæ¥è¡¨ç¤º,valueå¯ä»¥ç”¨èœå“æ•°æ®çš„stringå­—ç¬¦ä¸²æ¥ä¿å­˜<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230906091732.png" alt="20230906091732"></p>
<p>è¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„å°±æ˜¯:<strong>æ•°æ®åº“ä¸­çš„èœå“æ•°æ®æœ‰å˜æ›´æ—¶,æ¸…ç†ç¼“å­˜æ•°æ®</strong></p>
<blockquote>
<p>æ”¹é€ ä¸Šé¢çš„<code>userDishController</code>,è¿™ä¸ªä¸»è¦æ˜¯æŸ¥è¯¢æ—¶åŠ å…¥redis,å½“æ¥å£æ¥æ”¶åˆ°è¯·æ±‚,å…ˆå»redisä¸­è·å–,å¦‚æœæœ‰å°±ç›´æ¥è¿”å›,æ²¡æœ‰å†å»æ•°æ®åº“ä¸­æŸ¥è¯¢,æœ€åè¿”å›</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     * æ”¹é€ æ¥å£-å®ç°ç¼“å­˜åˆ†ç±»èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * redisæ”¾å…¥çš„ç±»å‹å’Œå–å‡ºçš„ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œä¸ç”¨æ‹…å¿ƒç±»å‹é—®é¢˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€ redisä¸­çš„keyï¼Œè§„åˆ™ dish_åˆ†ç±»id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + categoryId;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢redisä¸­æ˜¯å¦å­˜åœ¨èœå“æ•°æ®</span></span><br><span class="line">        List&lt;DishVO&gt; list = (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.success(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æŸ¥è¯¢åˆ°çš„æ•°æ®å­˜å…¥redisä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»ºä¸€ä¸ªæœ‰åˆ†ç±»idï¼Œå’ŒçŠ¶æ€ä¸ºèµ·å”®çš„èœå“</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> Dish.builder().status(StatusConstant.ENABLE).categoryId(categoryId).build();</span><br><span class="line"></span><br><span class="line">        list = dishService.listWithFlavor(dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å®Œä¹‹åï¼Œå°†æ•°æ®å†™å…¥redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(key, list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯æ•°æ®ä¸€è‡´æ€§è¿˜æ²¡æœ‰ä¿è¯,å¦‚æœç°åœ¨æ›´æ”¹äº†æ•°æ®åº“ä¸­çš„æ•°æ®,ç¼“å­˜çš„æ•°æ®æ˜¯ä¸ä¼šå˜çš„</strong></p>
<p>æ‰€ä»¥è¦åœ¨æ›´æ–°å®Œæ•°æ®ä¸­çš„æ•°æ®ä¹‹å,é©¬ä¸Šåˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®,<code>æˆ–è€…æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®?ä¹Ÿæœ‰å¯èƒ½è¿™é¡¹æ•°æ®å¹¶ä¸æ˜¯ç«‹å³ä½¿ç”¨çš„,æ‰€ä»¥å¯ä»¥ä¸ç”¨ç«‹å³æ›´æ–°,åªæ˜¯åˆ é™¤æ‰</code></p>
<p>å¥½åƒå·²ç»çŒœåˆ°äº†è¯¥æ€ä¹ˆåšäº†,åœ¨ä¿®æ”¹å’Œæ·»åŠ ,èµ·å”®åœå”®ä»¥åŠåˆ é™¤çš„åœ°æ–¹(å¥½åƒæ˜¯,é™¤äº†æŸ¥è¯¢,éƒ½è¦æ¸…ç©ºç¼“å­˜),éƒ½è¦è¿›è¡Œæ¸…ç©ºç¼“å­˜,åº”è¯¥æ˜¯ç”¨åˆ°åˆ‡é¢ç±»çš„</p>
<p>ä½†æ˜¯å‘¢,ç›®å‰ç¼“å­˜çš„åœ°æ–¹åªæœ‰èœå“ç›¸å…³çš„,ä¹Ÿå°±æ˜¯è¯´,å…¶ä»–æ¥å£ä¸ç”¨è¿›è¡Œç¼“å­˜ç›¸å…³çš„æ“ä½œ,æ‰€ä»¥åªéœ€è¦æ“ä½œç®¡ç†ç«¯çš„<code>DishController</code>,é‚£æ¶‰åŠåˆ°çš„æ–¹æ³•å°±ä¸å¤šäº†,å®Œå…¨ä¸éœ€è¦ç”¨åˆ‡é¢</p>
<blockquote>
<p>æ ¹æ®é€šé…ç¬¦æ¥æŸ¥æ‰¾<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230906100903.png" alt="20230906100903"></p>
</blockquote>
<p>å¥½å¤šä¿®æ”¹çš„åœ°æ–¹,å¦‚æœä¸èƒ½ç›´æ¥æ‹¿åˆ°åˆ†ç±»id,é‚£å°±ç›´æ¥å…¨éƒ¨æ¸…ç©º,å› ä¸ºå¦‚æœæ²¡æœ‰åˆ†ç±»id,è¿˜è¦æŸ¥è¯¢æ•°æ®åº“æ¥è·å–åˆ†ç±»id,æœ¬æ¥åŠ å…¥ç¼“å­˜å°±æ˜¯ä¸ºäº†å‡å°‘æ•°æ®åº“çš„IOæ“ä½œ,<strong>è¿™æ ·å°±æœ‰ç‚¹å¾—ä¸å¿å¤±äº†</strong></p>
<p>æ›´æ”¹åçš„Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;èœå“ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ–°å¢èœå“&quot;</span>);</span><br><span class="line">        dishService.saveWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// new</span></span><br><span class="line">        <span class="comment">// æ¸…ç†ç¼“å­˜æ•°æ®-æ¸…ç†å¯¹åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œå…ˆç¡®å®šè¿™ä¸ªèœå“çš„åˆ†ç±»idï¼Œç„¶åæ¸…ç©ºè¯¥åˆ†ç±»idçš„ç¼“å­˜</span></span><br><span class="line">       cleanCache(<span class="string">&quot;dish_&quot;</span> + dishDTO.getCategoryId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;èœå“åˆ†é¡µæŸ¥è¯¢å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> dishService.pageQuery(dishPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteBatchDish</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ˜¯å¯ä»¥æ‹¿åˆ°çš„,ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">        log.info(<span class="string">&quot;ä¼ å…¥çš„ids: &#123;&#125;&quot;</span>, ids.size());</span><br><span class="line">        dishService.deleteBatchDish(ids);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// new</span></span><br><span class="line">        <span class="comment">// æ‰¹é‡æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">        <span class="comment">/*for (Long id : ids) &#123;</span></span><br><span class="line"><span class="comment">            // è·å–æ¯ä¸€ä¸ªèœå“çš„åˆ†ç±»id,è¿™é‡Œè¦ç”¨åˆ° ä¸€ä¸ª æ ¹æ®èœå“idæŸ¥è¯¢èœå“çš„ä¿¡æ¯çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">            Dish dish = dishService.getById(id);</span></span><br><span class="line"><span class="comment">            String key = &quot;dish_&quot; + dish.getCategoryId();</span></span><br><span class="line"><span class="comment">            redisTemplate.delete(key);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æ–¹æ³•,å°±æ˜¯ç›´æ¥æ¸…ç©ºå…¨éƒ¨çš„ç¼“å­˜,æ‰€æœ‰ä»¥dish_å¼€å¤´çš„key--ç®€å•ç²—æš´ä¸”æœ‰æ•ˆ</span></span><br><span class="line">        cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æå–å‡ºæ¸…ç©ºç¼“å­˜çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cleanCache</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> redisTemplate.keys(pattern);</span><br><span class="line">        redisTemplate.delete(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èœå“èµ·å”®ã€åœå”®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status æ–°çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id     èœå“id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;èœå“çš„èµ·å”®/åœå”®&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†è¦æ›´æ”¹çš„çŠ¶æ€å’Œè¢«æ›´æ”¹èœå“çš„idä¼ å…¥</span></span><br><span class="line">        dishService.startOrStop(status, id);</span><br><span class="line"></span><br><span class="line">        cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idæŸ¥è¯¢èœå“,å’Œå¯¹åº”çš„å£å‘³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢èœå“,å’Œå¯¹åº”çš„å£å‘³&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ ¹æ®idæŸ¥è¯¢èœå“ï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">        <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¿®æ”¹èœå“:&#123;&#125; &quot;</span>, dishDTO);</span><br><span class="line">        dishService.updateWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// new -æ¸…ç©ºç¼“å­˜--ä½†æ˜¯ä¿®æ”¹æ—¶æ˜¯å¯ä»¥ä¿®æ”¹èœå“çš„åˆ†ç±»çš„,å¦‚æœèœå“çš„åˆ†ç±»ä¿®æ”¹äº†,é‚£å°±è¦æ¸…ç©ºåŸæœ¬çš„å’Œæ–°çš„åˆ†ç±»èœå“çš„ç¼“å­˜äº†,ä¹Ÿæ˜¯ç›´æ¥å…¨éƒ¨æ¸…ç©º?---ç›´æ¥æ¸…ç©ºå…¨éƒ¨</span></span><br><span class="line">        cleanCache(<span class="string">&quot;dish_*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;Dish&gt;&gt; <span class="title function_">getByCategoryId</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢èœå“ï¼Œå‚æ•°ä¸º&#123;&#125;&quot;</span>, categoryId);</span><br><span class="line">        List&lt;Dish&gt; list = dishService.getByCategoryId(categoryId);</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><p>å¯ä»¥æ›¿ä»£redis?</p>
<blockquote>
<p>Spring Cacheæ˜¯ä¸€ä¸ªæ¡†æ¶,å®ç°äº†åŸºäº<code>æ³¨è§£</code>çš„ç¼“å­˜åŠŸèƒ½,åªéœ€è¦ç®€å•åœ°åŠ ä¸€ä¸ªæ³¨è§£,å°±èƒ½å®ç°ç¼“å­˜åŠŸèƒ½</p>
</blockquote>
<p>Spring Cacheæä¾›äº†ä¸€å±‚æŠ½è±¡,åº•å±‚å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç¼“å­˜å®ç°</p>
<ul>
<li>EHCache</li>
<li>Caffeine</li>
<li>Redis</li>
</ul>
<blockquote>
<p>å¯¼å…¥ä¾èµ–</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç„¶åå®Œå…¨ä¸éœ€è¦é…ç½®,è¿™é‡ŒSpring Cacheå°±ä½¿ç”¨çš„æ˜¯redisä½œä¸ºç¼“å­˜çš„åº•å±‚äº†,å› ä¸ºå‰é¢å·²ç»å¯¼å…¥è¿‡<code>spring-boot-starter-data-redis</code></strong></p>
<hr>
<blockquote>
<p>å¸¸ç”¨æ³¨è§£</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>@EnableCaching</td>
<td>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½,é€šå¸¸åŠ åœ¨å¯åŠ¨ç±»ä¸Š</td>
</tr>
<tr>
<td>@Cacheable</td>
<td>åœ¨æ–¹æ³•æ‰§è¡Œå‰å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®,å¦‚æœæœ‰æ•°æ®,åˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®,å¦‚æœæ²¡æœ‰,è°ƒç”¨æ–¹æ³•,å¹¶å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td>
</tr>
<tr>
<td>@CachePut</td>
<td>å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>å°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td>
</tr>
</tbody></table>
<ul>
<li><code>@Cacheable</code>å¯ä»¥ç”¨åœ¨å°ç¨‹åºç«¯è·å–æ•°æ®æ—¶,å…ˆæŸ¥æœ‰æ²¡æœ‰ç¼“å­˜æ•°æ®,ç„¶ååœ¨è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</li>
<li><code>@CachePut</code>å¯ä»¥ç”¨åœ¨ç®¡ç†ç«¯,å½“ä¿®æ”¹äº†æŸäº›æ•°æ®æ—¶,å°†ä¿®æ”¹åçš„æ•°æ®æ”¾åˆ°ç¼“å­˜ä¸­</li>
</ul>
<h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p><em>è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ–°demo</em></p>
<ol>
<li><p>ç»™å¯åŠ¨ç±»ä¸ŠåŠ <code>@EnableCaching</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">// å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheDemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(CacheDemoApplication.class,args);</span><br><span class="line">        log.info(<span class="string">&quot;é¡¹ç›®å¯åŠ¨æˆåŠŸ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@CachePut</code>æ³¨è§£çš„ä½¿ç”¨,å°±æ˜¯æ³¨æ„keyçš„æ‹¼æ¥,å†™æ³•å•¥çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœä½¿ç”¨Spring Cacheç¼“å­˜æ•°æ®ï¼Œkeyçš„ç”Ÿæˆæ˜¯å’ŒcacheNamesæœ‰å…³</span></span><br><span class="line"><span class="comment">     * ä¸º userCache:id   userCache::1</span></span><br><span class="line"><span class="comment">     * å†™æ³•æ˜¯å¤šæ ·çš„ï¼Œè¿˜å¯ä»¥å†™`result.id`ï¼Œresultå°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">     * p0,pxxï¼Œä»£è¡¨ç¬¬å‡ ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">     * a0,axxï¼Œä»£è¡¨ç¬¬å‡ ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="comment">// @CachePut(cacheNames = &quot;userCache&quot;,key=&quot;#result.id&quot;)</span></span><br><span class="line">    <span class="comment">// @CachePut(cacheNames = &quot;userCache&quot;,key=&quot;#p0.id&quot;)</span></span><br><span class="line">    <span class="meta">@CachePut(cacheNames = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@Cacheable</code>æ³¨è§£,<strong>å…ˆæ˜¯æ ¹æ®cacheNameså’Œkeyè¿›è¡Œæ‹¼æ¥,å¾—åˆ°ç¼“å­˜æ•°æ®çš„key,ç„¶ååœ¨redisä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰è¯¥æ•°æ®,æœ‰çš„è¯,ä¼šç›´æ¥è¿”å›,è·³è¿‡è¯¥æ¥å£çš„æ‰§è¡Œ</strong>,<code>å‘ç°ä¸€ä¸ªå°é—®é¢˜,å¦‚æœä¸å­˜åœ¨è¿™æ¡æ•°æ®,é‚£ä¹ˆç¼“å­˜ä¸­ä¹Ÿä¼šå­˜ä¸€ä¸ªæ•°æ®,ä¸è¿‡ä¸ºç©º,å¥½åƒä¹Ÿæ²¡å•¥é—®é¢˜</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230906163035.png" alt="20230906163035"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Cacheable</span> è¿™ä¸ªæ³¨è§£æŒºç¥å¥‡çš„ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œåˆ™è¿è¿™ä¸ªæ¥å£éƒ½ä¸ä¼šè°ƒç”¨ï¼Œç›´æ¥å°†ç¼“å­˜ä¸­çš„æ•°æ®è¿”å›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@CacheEvict</code>æ¸…é™¤ç¼“å­˜,æ³¨æ„æ¸…é™¤å…¨éƒ¨ç¼“å­˜,è¦ç”¨<code>allEntries = true</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;, key = &quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    userMapper.deleteById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¸…é™¤å…¨éƒ¨çš„ç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/delAll&quot;)</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span> &#123;</span><br><span class="line">    userMapper.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ç¼“å­˜å¥—é¤"><a href="#ç¼“å­˜å¥—é¤" class="headerlink" title="ç¼“å­˜å¥—é¤"></a>ç¼“å­˜å¥—é¤</h2><ol>
<li>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥<code>@EnableCaching</code></li>
<li>åœ¨ç”¨æˆ·ç«¯æ¥å£<code>SetmealController</code>çš„listæ–¹æ³•ä¸ŠåŠ å…¥<code>@Cacheable</code>æ³¨è§£<ul>
<li>è¿™æ ·çœ‹ä¹Ÿå¤ªç®€å•äº†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å¥—é¤&quot;)</span></span><br><span class="line"><span class="comment">// åŠ¨æ€è®¡ç®—é™¤key  setmealCache::20</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> Setmeal.builder().status(StatusConstant.ENABLE).categoryId(categoryId).build();</span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>åœ¨æœåŠ¡ç«¯æ¥å£<code>SetmealController</code>çš„save,delete,update,startOrStopç­‰æ–¹æ³•ä¸ŠåŠ å…¥<code>CacheEvict</code>æ³¨è§£<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢å¥—é¤çš„æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢å¥—é¤&quot;)</span></span><br><span class="line">    <span class="comment">// æ–°å¢çš„å¥—é¤ä¸€å®šæœ‰å¯¹åº”çš„åˆ†ç±»,æ‰€ä»¥æ ¹æ®åˆ†ç±»idæ¥åˆ é™¤è¿™ä¸ªç¼“å­˜,ç²¾ç¡®åˆ é™¤</span></span><br><span class="line">    <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, key = &quot;#setmealDTO.categoryId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å¥—é¤èµ·å”®/åœå”®&quot;)</span></span><br><span class="line">    <span class="comment">// ç”±äºä¸èƒ½ç›´æ¥æ‹¿åˆ°å¥—é¤çš„åˆ†ç±»id,æ‰€ä»¥é€‰æ‹©ç›´æ¥æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">    <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹å¥—é¤&quot;)</span></span><br><span class="line">    <span class="comment">// ç†ç”±æ˜¯æ›´æ”¹çš„ä¿¡æ¯å…·æœ‰å¤šæ ·æ€§,æ‰€ä»¥é€‰æ‹©ç›´æ¥æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">    <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ é™¤èœå“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ‰¹é‡åˆ é™¤èœå“&quot;)</span></span><br><span class="line">    <span class="comment">// ç”±äºä¸èƒ½ç›´æ¥æ‹¿åˆ°å¥—é¤çš„åˆ†ç±»id,æ‰€ä»¥é€‰æ‹©ç›´æ¥æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">    <span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteBitch</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>ç¼“å­˜ç¿»ç¯‡</p>
<hr>
<h2 id="è´­ç‰©è½¦"><a href="#è´­ç‰©è½¦" class="headerlink" title="è´­ç‰©è½¦"></a>è´­ç‰©è½¦</h2><h3 id="æ·»åŠ è´­ç‰©è½¦"><a href="#æ·»åŠ è´­ç‰©è½¦" class="headerlink" title="æ·»åŠ è´­ç‰©è½¦"></a>æ·»åŠ è´­ç‰©è½¦</h3><p>è´­ç‰©è½¦è¡¨:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230906203501.png" alt="20230906203501"></p>
<p><strong>æ·»åŠ è´­ç‰©è½¦çš„ä¸¤ç§æƒ…å†µ</strong></p>
<ol>
<li>æ·»åŠ ä¸€æ¡èœå“çš„æ•°æ®,è¿™æ—¶è¦å…ˆæŸ¥è¯¢è¯¥ç”¨æˆ·çš„è´­ç‰©è½¦ä¸­æ˜¯å¦æœ‰è¯¥èœå“,ä¸”å£å‘³ç›¸åŒ,å¦‚æœæœ‰åˆ™ç›´æ¥æ•°é‡åŠ 1<ul>
<li>ç›¸å…³çš„sql:<code>select * from shopping_cart where user_id = ? and dish_id = ? and dish_flavor</code></li>
</ul>
</li>
<li>æ·»åŠ ä¸€æ¡å¥—é¤çš„æ•°æ®,è¿™æ—¶è¦å…ˆæŸ¥è¯¢è¯¥ç”¨æˆ·çš„è´­ç‰©è½¦ä¸­æ˜¯å¦æœ‰è¯¥å¥—é¤,å¦‚æœæœ‰åˆ™ç›´æ¥æ•°é‡åŠ 1<ul>
<li>ç›¸å…³çš„sql:<code>select * from shopping_cart where user_id = ? and setmeal_id = ?</code></li>
</ul>
</li>
</ol>
<p><strong>æ‰€ä»¥è¦ç”¨åŠ¨æ€sqlæ¥è§£å†³è¿™ä¸ªé—®é¢˜</strong></p>
<blockquote>
<p>ShoppingCartController,å‰ç«¯åªéœ€è¦ä¼ æ¥ä¸€ä¸ªæœ‰<code>setmeal_id,dish_id,ä»¥åŠdish_flavor</code>çš„å¯¹è±¡å³å¯,è¿™ä¸ª<code>dish_flavor</code>åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,åŒ…æ‹¬é€‰ä¸­çš„å£å‘³,å¦‚<code>å¾®è¾£</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ·»åŠ è´­ç‰©è½¦&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ·»åŠ è´­ç‰©è½¦:&#123;&#125;&quot;</span>, shoppingCartDTO);</span><br><span class="line">    shoppingCartService.addShoppingCard(shoppingCartDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è™½ç„¶ä»£ç é•¿,ä½†æ˜¯é€»è¾‘ä¸æ˜¯å¾ˆéš¾,å°±æ˜¯å…ˆåˆ¤æ–­è¿™æ¡æ–°åŠ çš„æ•°æ®æ˜¯å¦åœ¨è´­ç‰©è½¦ä¸­å‡ºç°è¿‡,å¦‚æœæœ‰å°±åŠ æ•°é‡,æ²¡æœ‰å°±æ˜¯æ–°å¢ä¸€æ¡æ•°æ®,è€Œå°è£…è¿™æ¡è´­ç‰©è½¦æ•°æ®éœ€è¦ç”¨åˆ°nameå’Œimageç­‰,è¿™äº›å­—æ®µéœ€è¦æŸ¥dishæˆ–è€…setmealè¡¨,æ‰€ä»¥è¦åˆ¤æ–­è¿™æ¡æ•°æ®æ˜¯èœå“è¿˜æ˜¯å¥—é¤,å†è¿›ä¸€æ­¥å°è£…æ•°æ®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCard</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­çš„å•†å“æ˜¯å¦å·²ç»å­˜åœ¨</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è™½ç„¶è¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆ,ä½†æ˜¯æŒ‰ç…§ä»¥ä¸Šçš„æ¡ä»¶,è¿”å›çš„ç»“æœåº”è¯¥åªæœ‰ä¸€æ¡</span></span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">        <span class="comment">// å¦‚æœå·²ç»å­˜åœ¨,åˆ™åªéœ€è¦æ•°é‡åŠ 1</span></span><br><span class="line">        <span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è·å–è¯¥æ¡è®°å½•,ç„¶å</span></span><br><span class="line">            <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// æ•°é‡åŠ ä¸€</span></span><br><span class="line">            cart.setNumber(cart.getNumber() + <span class="number">1</span>); <span class="comment">// æ‰§è¡Œsql update shopping_cart set number = ? where id = ?</span></span><br><span class="line">            shoppingCartMapper.updateNumberById(cart);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸å­˜åœ¨,éœ€è¦æ’å…¥ä¸€æ¡è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">            <span class="comment">// é‚£å°±è¦æ„é€ è¿™ä¸ªè´­ç‰©è½¦æ•°æ®,åªæœ‰å‰ç«¯ä¼ æ¥çš„setmeal_id/dish_id å’ŒdishFlavor ä»¥åŠè·å–çš„userId,æ˜¯ä¸å¤Ÿçš„,è¿˜éœ€è¦name,image</span></span><br><span class="line">            <span class="comment">// å…ˆåˆ¤æ–­æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ä¸ºèœå“,å…ˆæ ¹æ®dishIdæŸ¥è¯¢è¯¥èœå“ä¿¡æ¯,éœ€è¦nameå’Œimage</span></span><br><span class="line">                <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(dishId);</span><br><span class="line">                shoppingCart.setName(dish.getName());</span><br><span class="line">                shoppingCart.setImage(dish.getImage());</span><br><span class="line">                shoppingCart.setAmount(dish.getPrice());</span><br><span class="line">                <span class="comment">// é»˜è®¤çš„æ•°é‡</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä¸ºå¥—é¤</span></span><br><span class="line">                <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(shoppingCart.getSetmealId());</span><br><span class="line">                shoppingCart.setName(setmeal.getName());</span><br><span class="line">                shoppingCart.setImage(setmeal.getImage());</span><br><span class="line">                shoppingCart.setAmount(setmeal.getPrice());</span><br><span class="line">                <span class="comment">// é»˜è®¤çš„æ•°é‡</span></span><br><span class="line">            &#125;</span><br><span class="line">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">            shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// ä¸ç®¡æ˜¯æ’å…¥å“ªä¸€ä¸ª,åˆ°è¿™é‡Œæ—¶æ•°æ®å°±å·²ç»å°è£…å¥½äº†</span></span><br><span class="line">            shoppingCartMapper.insert(shoppingCart);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥ä¸€æ¡è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into shopping_cart(name, image, user_id, dish_id, setmeal_id, dish_flavor, amount, create_time) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;values (#&#123;name&#125;,#&#123;image&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;amount&#125;,#&#123;createTime&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br></pre></td></tr></table></figure>

<p>åŠ¨æ€sql</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    åŠ¨æ€æ¡ä»¶æŸ¥è¯¢--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.ShoppingCart&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from shopping_cart</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userId != null&quot;</span>&gt;</span></span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;dishId != null&quot;</span>&gt;</span></span><br><span class="line">            and dish_id = #&#123;dishId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;setmealId != null&quot;</span>&gt;</span></span><br><span class="line">            and setmeal_id = #&#123;setmealId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;dishFlavor&quot;</span>&gt;</span></span><br><span class="line">            and dish_flavor = #&#123;dishFlavor&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢è´­ç‰©è½¦"><a href="#æŸ¥è¯¢è´­ç‰©è½¦" class="headerlink" title="æŸ¥è¯¢è´­ç‰©è½¦"></a>æŸ¥è¯¢è´­ç‰©è½¦</h3><p>è¿™ä¸ªæ¥å£ä¹Ÿæ²¡å•¥éš¾çš„</p>
<blockquote>
<p>Controller,ç›´æ¥è°ƒç”¨service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿™ä¸ªæ¥å£ä¸éœ€è¦ä»»ä½•å‚æ•°,å› ä¸ºç”¨æˆ·çš„idå¯ä»¥ç›´æ¥å–å‡º</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è´­ç‰©è½¦&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;ShoppingCart&gt; list = shoppingCartService.getByUserId();</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,Serviceä¸­è°ƒç”¨ä¸Šä¸€ä¸ªæ¥å£ç”¨åˆ°çš„listæ–¹æ³•,å°±æ˜¯åŠ¨æ€sqlæŸ¥è¯¢è´­ç‰©è½¦,ä½†æ˜¯ç”±äºåªä¼ å…¥äº†ä¸€ä¸ªuserId,æ‰€ä»¥å¯ä»¥æŸ¥è¯¢åˆ°è¯¥ç”¨æˆ·çš„æ‰€æœ‰è´­ç‰©è½¦æ•°æ®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®userIdæŸ¥è¯¢è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">getByUserId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–åˆ°å½“å‰ç”¨æˆ·çš„id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">    <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> ShoppingCart.builder().userId(userId).build();</span><br><span class="line">    List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¸…ç©ºè´­ç‰©è½¦"><a href="#æ¸…ç©ºè´­ç‰©è½¦" class="headerlink" title="æ¸…ç©ºè´­ç‰©è½¦"></a>æ¸…ç©ºè´­ç‰©è½¦</h3><blockquote>
<p>Controller,è¿™ä¸ªå°±æ›´ç®€å•äº†,ç”šè‡³ä¸éœ€è¦å‰ç«¯ä¼ æ¥ä»»ä½•çš„æ•°æ®,åªéœ€è¦ä»çº¿ç¨‹ä¸­å–å‡ºuserIdå³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ¸…ç©ºè´­ç‰©è½¦&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cleanCart</span><span class="params">()</span> &#123;</span><br><span class="line">    shoppingCartService.cleanCart();</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanCart</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–åˆ°å½“å‰ç”¨æˆ·çš„id ç„¶åæ ¹æ®ç”¨æˆ·çš„idï¼Œåˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">    shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤ä¸€é¡¹"><a href="#åˆ é™¤ä¸€é¡¹" class="headerlink" title="åˆ é™¤ä¸€é¡¹"></a>åˆ é™¤ä¸€é¡¹</h3><blockquote>
<p>Controller,ä¾ç„¶æ˜¯ä½¿ç”¨shoppingCartDTOæ¥å®ç°ä¼ å‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ æ¥çš„æ•°æ®å…¶å®å’Œæ·»åŠ å·®ä¸å¤š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ é™¤è´­ç‰©è½¦çš„ä¸€ä¸ªå•†å“&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/sub&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">subOne</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;åˆ é™¤è´­ç‰©è½¦çš„ä¸€ä¸ªå•†å“ï¼š&#123;&#125;&quot;</span>, shoppingCartDTO);</span><br><span class="line">    shoppingCartService.subShoppingCart(shoppingCartDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¹Ÿæ²¡å•¥éš¾å¾—,å°±æ˜¯è¦åˆ¤æ–­è¿™æ¡æ•°æ®çš„number,å¦‚æœå¤§äº1åˆ™æ˜¯â€“,å¦‚æœä¸º1åˆ™æ˜¯ç›´æ¥åˆ é™¤è¿™æ¡æ•°æ®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤è´­ç‰©è½¦çš„ä¸€ä¸ªå•†å“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œæ¶‰åŠåˆ°æ•°é‡é—®é¢˜ï¼Œå¦‚æœè¿™ä¸ªå•†å“çš„æ•°é‡å‡å»1è¿˜æ˜¯å¤§äº1ï¼Œé‚£ä¹ˆæ‰§è¡Œåˆ é™¤åªæ˜¯number-1ï¼Œè€Œå¦‚æœä¸º1ï¼Œé‚£ä¹ˆå°±æ˜¯ç›´æ¥åˆ é™¤è¿™æ¡æ•°æ®äº†</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line">        <span class="comment">// è¿™æ ·è‚¯å®šè¿˜æ˜¯ä¸€æ¡æ•°æ® æ¯‹åº¸ç½®ç–‘</span></span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¼åŠ äº†åˆ¤æ–­è¿™ä¸ªlisté›†åˆæ˜¯å¦ä¸ºç©ºçš„é—®é¢˜äº†</span></span><br><span class="line">        <span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// åˆ¤æ–­number</span></span><br><span class="line">            <span class="keyword">if</span> (cart.getNumber() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// ä¸º1ï¼Œåˆ™ç›´æ¥åˆ é™¤è¿™æ¡è®°å½•</span></span><br><span class="line">                shoppingCartMapper.deleteByCartId(cart);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¤§äº1ï¼Œåˆ™number-1</span></span><br><span class="line">                cart.setNumber(cart.getNumber() - <span class="number">1</span>);</span><br><span class="line">                shoppingCartMapper.updateNumberById(cart);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¹Ÿæ²¡é—®é¢˜å•Šæ²¡é—®é¢˜</p>
<h1 id="9-ç”¨æˆ·ä¸‹å•-è®¢å•æ”¯ä»˜"><a href="#9-ç”¨æˆ·ä¸‹å•-è®¢å•æ”¯ä»˜" class="headerlink" title="9 ç”¨æˆ·ä¸‹å•-è®¢å•æ”¯ä»˜"></a>9 ç”¨æˆ·ä¸‹å•-è®¢å•æ”¯ä»˜</h1><h2 id="å¯¼å…¥åœ°å€ç°¿"><a href="#å¯¼å…¥åœ°å€ç°¿" class="headerlink" title="å¯¼å…¥åœ°å€ç°¿"></a>å¯¼å…¥åœ°å€ç°¿</h2><p>?</p>
<p>çœ‹çœ‹æ¥å£æ•²ä¸€éå¾—äº†</p>
<h3 id="ä¿å­˜åœ°å€ç°¿"><a href="#ä¿å­˜åœ°å€ç°¿" class="headerlink" title="ä¿å­˜åœ°å€ç°¿"></a>ä¿å­˜åœ°å€ç°¿</h3><p>æ–°å¢åœ°å€</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ–°å¢åœ°å€ï¼š&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">    addressBookService.add(addressBook);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¸»è¦å°±æ˜¯æ³¨æ„è¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘-è®¾ç½®æ˜¯å¦é»˜è®¤-0,è¿˜æœ‰è®¾ç½®ç”¨æˆ·id</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ åœ°å€ç°¿æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸å‡ºæ‰€æ–™,userIdå‰ç«¯å¹¶æ²¡æœ‰ä¼ è¿‡æ¥,è¿˜æ˜¯è¦è‡ªå·±ä»ThreadLocalä¸­è·å–</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">    <span class="comment">// å¿˜äº†è®¾ç½®è¿™ä¸ªçŠ¶æ€äº†</span></span><br><span class="line">    addressBook.setIsDefault(<span class="number">0</span>);</span><br><span class="line">    addressBook.setUserId(userId);</span><br><span class="line">    addressBookMapper.insert(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into address_book(user_id, consignee, sex, phone, province_code, province_name, city_code, &quot; +</span></span><br><span class="line"><span class="meta">        &quot;city_name, district_code, district_name, detail, label,is_default) VALUES (#&#123;userId&#125;,#&#123;consignee&#125;,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;sex&#125;,#&#123;phone&#125;,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;provinceCode&#125;,#&#123;provinceName&#125;,#&#123;cityCode&#125;,#&#123;cityName&#125;,#&#123;districtCode&#125;,#&#123;districtName&#125;,#&#123;detail&#125;,&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;label&#125;,#&#123;isDefault&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(AddressBook addressBook)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="åœ°å€ç°¿åˆ—è¡¨"><a href="#åœ°å€ç°¿åˆ—è¡¨" class="headerlink" title="åœ°å€ç°¿åˆ—è¡¨"></a>åœ°å€ç°¿åˆ—è¡¨</h3><p>æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€ä¿¡æ¯</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">getByUserId</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;AddressBook&gt; list = addressBookService.list();</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">    List&lt;AddressBook&gt; list = addressBookMapper.list(userId);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from address_book where user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹åœ°å€ç°¿"><a href="#ä¿®æ”¹åœ°å€ç°¿" class="headerlink" title="ä¿®æ”¹åœ°å€ç°¿"></a>ä¿®æ”¹åœ°å€ç°¿</h3><ol>
<li>æ ¹æ®idæŸ¥è¯¢åœ°å€<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;AddressBook&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idæŸ¥è¯¢ä¸€æ¡åœ°å€ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AddressBook <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getById(id);</span><br><span class="line">    <span class="keyword">return</span> addressBook;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from address_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">AddressBook <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä¿®æ”¹<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;ä¿®æ”¹åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;ä¿®æ”¹åœ°å€:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">    addressBookService.update(addressBook);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressBook</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    addressBookMapper.update(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,è¿™ä¸ªè·Ÿè€å¸ˆå†™çš„ä¸å¤ªä¸€æ ·,ä½†æ•ˆæœå·®ä¸å¤š</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update address_book</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;consignee != null&quot;</span>&gt;</span></span><br><span class="line">                consignee = #&#123;consignee&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">                sex = #&#123;sex&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">                phone = #&#123;phone&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;provinceCode != null&quot;</span>&gt;</span></span><br><span class="line">                province_code = #&#123;provinceCode&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;provinceName != null&quot;</span>&gt;</span></span><br><span class="line">                province_name = #&#123;provinceName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cityCode != null&quot;</span>&gt;</span></span><br><span class="line">                city_code = #&#123;cityCode&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cityName != null&quot;</span>&gt;</span></span><br><span class="line">                city_name = #&#123;cityName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;districtCode != null&quot;</span>&gt;</span></span><br><span class="line">                district_code = #&#123;districtCode&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;districtName != null&quot;</span>&gt;</span></span><br><span class="line">                district_name = #&#123;districtName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;detail != null&quot;</span>&gt;</span></span><br><span class="line">                detail = #&#123;detail&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;label != null&quot;</span>&gt;</span></span><br><span class="line">                label = #&#123;label&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isDefault != null&quot;</span>&gt;</span></span><br><span class="line">                is_default = #&#123;isDefault&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®é»˜è®¤åœ°å€"><a href="#è®¾ç½®é»˜è®¤åœ°å€" class="headerlink" title="è®¾ç½®é»˜è®¤åœ°å€"></a>è®¾ç½®é»˜è®¤åœ°å€</h3><blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;è®¾ç½®é»˜è®¤åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span>&#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå€’æ˜¯ç”¨äº†è¯·æ±‚ä½“çš„idäº†</span></span><br><span class="line">    addressBookService.setDefault(addressBook);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™ä¸ªæ˜¯çœŸçš„ç¦»è°±,æ­£ç€å†™è¦å¥½å¤šè¡Œ,åç€å†™å°±ä¸¤è¡Œ..,æ­£ç€å†™å°±æ˜¯å…ˆå°†ç›®æ ‡åœ°å€ç½®ä¸ºé»˜è®¤,ç„¶åå°†å…¶ä½™çš„åœ°å€ç½®ä¸ºéé»˜è®¤,åç€å†™å°±æ˜¯å…ˆæŠŠæ‰€æœ‰çš„åœ°å€éƒ½è®¾ç½®ä¸ºéé»˜è®¤,ç„¶åç›´æ¥è®¾ç½®ç›®æ ‡åœ°å€ä¸ºé»˜è®¤å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefault</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line"><span class="comment">/*        Long id = addressBook.getId();</span></span><br><span class="line"><span class="comment">        addressBookMapper.setDefault(id);</span></span><br><span class="line"><span class="comment">        // åªè®¾ç½®è¿™ä¸ªé»˜è®¤çš„å¯ä¸è¡Œ,è¿˜è¦æŠŠå…¶ä½™çš„åœ°å€å…¨éƒ½è®¾ç½®æˆä¸æ˜¯é»˜è®¤çš„</span></span><br><span class="line"><span class="comment">        // æ ¹æ®ç”¨æˆ·idæŸ¥å‡ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰åœ°å€</span></span><br><span class="line"><span class="comment">        List&lt;AddressBook&gt; list = addressBookMapper.list(BaseContextByMe.getCurrentId());</span></span><br><span class="line"><span class="comment">        for (AddressBook book : list) &#123;</span></span><br><span class="line"><span class="comment">            if (book.getId() == id) &#123;</span></span><br><span class="line"><span class="comment">                continue;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            // ä¸æ˜¯è¦è®¾ç½®é»˜è®¤çš„åœ°å€,å°±è¦å°†è¯¥åœ°å€çš„é»˜è®¤è®¾ä¸º0</span></span><br><span class="line"><span class="comment">            book.setIsDefault(0);</span></span><br><span class="line"><span class="comment">            // ç„¶åå°†è¯¥æ¡æ•°æ®æ›´æ–°æ•°æ®åº“</span></span><br><span class="line"><span class="comment">            addressBookMapper.update(book);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// =====================</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æˆ–è€…è¯´,è€å¸ˆçš„é€»è¾‘æ˜¯æ›´æ¸…æ¥šåœ°,å…ˆå°†è¯¥ç”¨æˆ·çš„æ‰€æœ‰åœ°å€éƒ½è®¾ç½®æˆä¸æ˜¯é»˜è®¤,ç„¶åå†è®¾ç½®æŒ‡å®šåœ°å€ä¸ºé»˜è®¤</span></span><br><span class="line">        addressBookMapper.updateAllAddressByUserId(BaseContextByMe.getCurrentId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç„¶åè®¾ç½®é»˜è®¤</span></span><br><span class="line">        addressBookMapper.setDefault(addressBook.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢é»˜è®¤åœ°å€"><a href="#æŸ¥è¯¢é»˜è®¤åœ°å€" class="headerlink" title="æŸ¥è¯¢é»˜è®¤åœ°å€"></a>æŸ¥è¯¢é»˜è®¤åœ°å€</h3><blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢é»˜è®¤åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getDefault();</span><br><span class="line">    <span class="keyword">return</span> Result.success(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™é‡Œä¹Ÿæ˜¯å’Œè€å¸ˆå†™çš„ä¸å¤ªä¸€æ ·çš„åœ°æ–¹,è€å¸ˆæ˜¯æŸ¥ä¸åˆ°ç›´æ¥è¿”å›æŸ¥ä¸åˆ°çš„ä¿¡æ¯,æˆ‘è¿™é‡Œæ˜¯æŸ¥ä¸åˆ°å°±é»˜è®¤ç¬¬ä¸€ä¸ª</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢é»˜è®¤åœ°å€</span></span><br><span class="line"><span class="comment">     * ä¸çŸ¥é“è¿™ä¸ªé€»è¾‘å¯¹ä¸å¯¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AddressBook <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–è¯¥ç”¨æˆ·çš„é»˜è®¤åœ°å€</span></span><br><span class="line">        <span class="comment">// select * from address_book where is_default = 1</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getDefault(userId);</span><br><span class="line">        <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰é»˜è®¤åœ°å€æ€ä¹ˆåŠ?</span></span><br><span class="line">            List&lt;AddressBook&gt; list = addressBookMapper.list(userId);</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢æ‰€æœ‰çš„åœ°å€,ç„¶åé€‰æ‹©ç¬¬ä¸€ä¸ª?</span></span><br><span class="line">            addressBook = list.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸ç®¡æ˜¯å¦å­˜åœ¨é»˜è®¤åœ°å€,éƒ½å¯ä»¥ç›´æ¥return</span></span><br><span class="line">        <span class="comment">// å¦‚æœå­˜åœ¨,åˆ™ä¸ä¼šè¿›å…¥if,ä¸å­˜åœ¨,è¿›å…¥ifåè¯¥addressBookä¹Ÿå·²ç»è¢«èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">return</span> addressBook;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤åœ°å€ç°¿"><a href="#åˆ é™¤åœ°å€ç°¿" class="headerlink" title="åˆ é™¤åœ°å€ç°¿"></a>åˆ é™¤åœ°å€ç°¿</h3><p>æ ¹æ®idåˆ é™¤åœ°å€</p>
<p>è¿™ä¸ªå°±æ²¡ä»€ä¹ˆè¯´çš„äº†,ç›´æ¥åˆ å°±ok</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idåˆ é™¤åœ°å€&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    addressBookService.deleteById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æˆ·ä¸‹å•"><a href="#ç”¨æˆ·ä¸‹å•" class="headerlink" title="ç”¨æˆ·ä¸‹å•"></a>ç”¨æˆ·ä¸‹å•</h2><p>ç”¨æˆ·ä¸‹å•ä¸šåŠ¡è¯´æ˜<br>åœ¨ç”µå•†ç³»ç»Ÿä¸­,ç”¨æˆ·æ˜¯é€šè¿‡ä¸‹å•çš„æ–¹å¼é€šçŸ¥å•†å®¶,ç”¨æˆ·å·²ç»è´­ä¹°äº†å•†å“,éœ€è¦å•†å®¶è¿›è¡Œå¤‡è´§å’Œå‘è´§</p>
<p>ç”¨æˆ·ä¸‹å•åä¼šäº§ç”Ÿè®¢å•ç›¸å…³æ•°æ®,è®¢å•æ•°æ®éœ€è¦èƒ½å¤Ÿä½“ç°å¦‚ä¸‹ä¿¡æ¯</p>
<ol>
<li>ä¹°çš„å•†å“å’Œæ•°é‡</li>
<li>æ”¶è´§åœ°å€</li>
<li>è®¢å•æ€»é‡‘é¢</li>
<li>å“ªä¸ªç”¨æˆ·ä¸‹çš„å•</li>
<li>æ‰‹æœºå·å¤šå°‘</li>
</ol>
<p>ç”¨æˆ·ä¸‹å•æµç¨‹:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230908084554.png" alt="20230908084554"></p>
<p>è®¢å•ç›¸å…³çš„æ•°æ®åº“è®¾è®¡<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230908085847.png" alt="20230908085847"></p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ä¸‹å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderSubmitVO&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;ä¸‹å•çš„æ•°æ®ï¼š&#123;&#125;&quot;</span>, ordersSubmitDTO);</span><br><span class="line">    <span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span> orderService.submitOrder(ordersSubmitDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderSubmitVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è™½ç„¶ä»£ç å¤š,ä½†æ˜¯å¹¶ä¸éš¾</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> OrderSubmitVO <span class="title function_">submitOrder</span><span class="params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†å„ç§å¼‚å¸¸ï¼ˆåœ°å€ç°¿ä¸ºç©ºï¼Œè´­ç‰©è½¦æ•°æ®ä¸ºç©ºï¼‰</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());</span><br><span class="line">        <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åœ°å€ä¸ºç©ºï¼ŒæŠ›å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContextByMe.getCurrentId();</span><br><span class="line">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.getByUserId(userId);</span><br><span class="line">        <span class="keyword">if</span> (shoppingCartList == <span class="literal">null</span> || shoppingCartList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰æŸ¥åˆ°è´­ç‰©è½¦æ•°æ®ï¼Œè´­ç‰©è½¦ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// =================</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘è®¢å•è¡¨æ’å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">        BeanUtils.copyProperties(ordersSubmitDTO, orders);</span><br><span class="line"></span><br><span class="line">        orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">        orders.setPayStatus(Orders.UN_PAID);</span><br><span class="line">        <span class="comment">// è®¾ç½®è®¢å•çŠ¶æ€ä¸ºå¾…ä»˜æ¬¾</span></span><br><span class="line">        orders.setStatus(Orders.PENDING_PAYMENT);</span><br><span class="line">        orders.setNumber(String.valueOf(System.currentTimeMillis()));</span><br><span class="line">        orders.setPhone(addressBook.getPhone());</span><br><span class="line">        orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">        orders.setUserId(userId);</span><br><span class="line">        <span class="comment">// æ’å…¥ä¹‹åä¼šå°†ä¸»é”®è¿”å›</span></span><br><span class="line">        orderMapper.insert(orders);</span><br><span class="line">        <span class="comment">// å‘è®¢å•æ˜ç»†è¡¨æ’å…¥næ¡æ•°æ®  ç”±è´­ç‰©è½¦çš„æ•°æ®å†³å®š</span></span><br><span class="line"></span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ShoppingCart shoppingCart : shoppingCartList) &#123;</span><br><span class="line">            <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">            <span class="comment">// å°†è´­ç‰©è½¦çš„æ•°æ®æ‹·è´ç»™orderDetail</span></span><br><span class="line">            BeanUtils.copyProperties(shoppingCart, orderDetail);</span><br><span class="line">            orderDetail.setOrderId(orders.getId());</span><br><span class="line">            orderDetailList.add(orderDetail);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¹é‡æ’å…¥è®¢å•è¯¦æƒ…æ•°æ®</span></span><br><span class="line">        orderDetailMapper.insert(orderDetailList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç©ºè´­ç‰©è½¦</span></span><br><span class="line">        shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è£…è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span></span><br><span class="line">                OrderSubmitVO.builder().id(orders.getId()).orderTime(orders.getOrderTime()).orderNumber(orders.getNumber()).orderAmount(orders.getAmount()).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderSubmitVO;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper,æ•´ä½“éƒ½ä¸éš¾</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    æ’å…¥è®¢å•æ•°æ®&lt;ï¼Œä¸”è¦è¿”å›è®¢å•çš„id--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into orders(number, status, user_id, address_book_id, order_time, checkout_time, pay_method, pay_status,</span><br><span class="line">                       amount, remark, phone, address, user_name, consignee, cancel_reason, rejection_reason,</span><br><span class="line">                       cancel_time, estimated_delivery_time, delivery_status, delivery_time, pack_amount,</span><br><span class="line">                       tableware_number, tableware_status)</span><br><span class="line">    VALUES (#&#123;number&#125;, #&#123;status&#125;, #&#123;userId&#125;, #&#123;addressBookId&#125;, #&#123;orderTime&#125;, #&#123;checkoutTime&#125;, #&#123;payMethod&#125;,</span><br><span class="line">            #&#123;payStatus&#125;, #&#123;amount&#125;, #&#123;remark&#125;, #&#123;phone&#125;, #&#123;address&#125;, #&#123;userName&#125;, #&#123;consignee&#125;, #&#123;cancelReason&#125;,</span><br><span class="line">            #&#123;rejectionReason&#125;, #&#123;cancelTime&#125;, #&#123;estimatedDeliveryTime&#125;, #&#123;deliveryStatus&#125;, #&#123;deliveryTime&#125;,</span><br><span class="line">            #&#123;packAmount&#125;, #&#123;tablewareNumber&#125;, #&#123;tablewareStatus&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="è®¢å•æ”¯ä»˜"><a href="#è®¢å•æ”¯ä»˜" class="headerlink" title="è®¢å•æ”¯ä»˜"></a>è®¢å•æ”¯ä»˜</h2><p>è¿™ä¸ªæ”¯ä»˜æ˜¯å®ç°ä¸äº†çš„,ä½†æ˜¯å¯ä»¥äº†è§£æµç¨‹,é˜…è¯»æ–‡æ¡£</p>
<h3 id="å¾®ä¿¡æ”¯ä»˜ä»‹ç»"><a href="#å¾®ä¿¡æ”¯ä»˜ä»‹ç»" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜ä»‹ç»"></a>å¾®ä¿¡æ”¯ä»˜ä»‹ç»</h3><p>æ•´ä½“çš„æµç¨‹è¿˜æ˜¯æŒºå¤æ‚çš„.<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230908132800.png" alt="20230908132800"></p>
<p><strong>JSPI</strong>ä¸‹å•:å•†æˆ·ç³»ç»Ÿè°ƒç”¨è¯¥æ¥å£åœ¨å¾®ä¿¡æ”¯ä»˜æœåŠ¡åå°ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</p>
<p><strong>è¿™å—æ˜¯çœŸåšä¸äº†,ç›´æ¥ç‚¹å‡»æ”¯ä»˜å°±æ”¯ä»˜æˆåŠŸå¾—äº†</strong></p>
<h3 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h3><p>ä¸ç®¡åˆ«çš„,å…ˆæŠŠå†…ç½‘ç©¿é€å•¥çš„æå¥½å†è¯´,ä¹‹å‰ç”¨çš„æ˜¯linuxç‰ˆçš„,è¿™æ¬¡è¯•è¯•winç‰ˆ</p>
<p>æ‰“å¼€è½¯ä»¶å®‰è£…ç›®å½•<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230908135603.png" alt="20230908135603"></p>
<p>æ²¡å•¥äº†,ç›´æ¥æ‰§è¡Œ<code>cpolar.exe http 8080</code>,å°±èƒ½ç»™æœ¬æœºçš„8080ç«¯å£ä¸€ä¸ªå…¬ç½‘çš„åŸŸå</p>
<p>èƒ½å¤Ÿç›´æ¥è¿›è¡Œè®¿é—®æ¥å£<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230908140309.png" alt="20230908140309"></p>
<h3 id="ä»£ç è¿˜å¯¼å…¥å—"><a href="#ä»£ç è¿˜å¯¼å…¥å—" class="headerlink" title="ä»£ç è¿˜å¯¼å…¥å—?"></a>ä»£ç è¿˜å¯¼å…¥å—?</h3><p>ä¸ç”¨äº†å§,å¯¼å…¥äº†åˆ«åˆ°æ—¶å€™å…¨Gäº†</p>
<p>å‰ç«¯å‘è¯·æ±‚å°±ç›´æ¥è¿”å›success,ç„¶åæ”¹å˜æ”¯ä»˜çŠ¶æ€å¾—äº†</p>
<p>çœ‹ä¸€ä¸‹ä»£ç ,ç„¶åäº†è§£ä¸€ä¸‹æµç¨‹å³å¯</p>
<p>å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ,ä»¥å‰çš„æ„Ÿè§‰åˆå›æ¥äº†â€¦</p>
<p>?</p>
<p>è¿˜æ˜¯æœ‰é—®é¢˜,ç°åœ¨å‰ç«¯éœ€è¦æ•°æ®,ä½†æ˜¯é‚£äº›æ•°æ®æ ¹æœ¬è·å–ä¸åˆ°</p>
<p>è¦ä¸å°±æ˜¯ç›´æ¥æ›´æ”¹è®¢å•çŠ¶æ€?</p>
<p>è¯•è¯•</p>
<p>å¥½äº†,åæ­£ç°åœ¨èƒ½æ”¹å˜è®¢å•çš„çŠ¶æ€äº†,å…¶ä»–å°±ä¸ç®¡äº†</p>
<h2 id="10-è®¢å•ç®¡ç†"><a href="#10-è®¢å•ç®¡ç†" class="headerlink" title="10 è®¢å•ç®¡ç†"></a>10 è®¢å•ç®¡ç†</h2><p>è¿™ä¸ªæ¨¡å—åˆæ˜¯è‡ªå·±å†™çš„</p>
<p>è¦å®Œæˆç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—,å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</p>
<p>è¿˜è¦å¯¹ä¹‹å‰çš„åŠŸèƒ½è¿›è¡Œä¼˜åŒ–</p>
<h3 id="ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"><a href="#ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—" class="headerlink" title="ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—"></a>ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</h3><ol>
<li>æŸ¥è¯¢å†å²è®¢å•</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/historyOrders&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†å²è®¢å•åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">getHistoryOrders</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;è®¢å•åˆ†é¡µæŸ¥è¯¢&quot;</span>);</span><br><span class="line">    <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.pageQuery(ordersPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œå°±æ¯”è¾ƒå¥‡æ€ªäº†,å½“æ—¶æ²¡çœ‹æ˜ç™½OrderVOæ˜¯å¹²å˜›çš„,åæ¥æ‰å‘ç°æ˜¯ç»§æ‰¿çš„Orders,å¯ä»¥ç®€å•ç†è§£ä¸ºOrderVOæ˜¯orderå’ŒorderDetailçš„ç»“åˆä½“!</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());</span><br><span class="line">        ordersPageQueryDTO.setUserId(BaseContextByMe.getCurrentId());</span><br><span class="line"></span><br><span class="line">        Page&lt;Orders&gt; page = orderMapper.list(ordersPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        List&lt;OrderVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é—®é¢˜å‡ºåœ¨æ²¡æœ‰æŸ¥å‡ºæ¥è®¢å•æ˜ç»†,è¿™ä¸ªè¦å°è£…åˆ°OrderVoä¸­æ‰è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders orders : page) &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•æ˜ç»†</span></span><br><span class="line">                <span class="type">Long</span> <span class="variable">ordersId</span> <span class="operator">=</span> orders.getId();</span><br><span class="line">                List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(ordersId);</span><br><span class="line">                <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æˆ‘ä¸å¤ªæ˜ç™½è¿™ä¸€æ­¥æ˜¯å¹²ä»€ä¹ˆ?æ˜æ˜orderVOåªèƒ½ä¸¤ä¸ªå­—æ®µ,è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²,å±æ€§åå’Œordersé‡Œè¿˜æ²¡æœ‰å¯¹åº”ä¸Šçš„.</span></span><br><span class="line">                <span class="comment">// å¥¶å¥¶æ»´,åŸæ¥è¿™é‡Œæ˜¯ç»§æ‰¿!!!!!</span></span><br><span class="line">                BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">                orderVO.setOrderDetailList(orderDetailList);</span><br><span class="line">                list.add(orderVO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>æŸ¥è¯¢è®¢å•è¯¦æƒ…</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/orderDetail/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">getOrderDetail</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ æ¥çš„æ˜¯orderId,è¦æ ¹æ®orderIdå…ˆåœ¨orderè¡¨ä¸­æŸ¥åˆ°è®¢å•çš„åŸºæœ¬ä¿¡æ¯,ç„¶ååœ¨order_detailè¡¨ä¸­æŸ¥åˆ°è¯¦ç»†ä¿¡æ¯,ä¹Ÿå°±æ˜¯èœå“å•¥çš„</span></span><br><span class="line"></span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.getOrderDetail(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™é‡Œæ›´èƒ½çœ‹å‡º,orderVOæ˜¯ç»§æ‰¿çš„orders</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> OrderVO <span class="title function_">getOrderDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">    <span class="comment">// å°†æŸ¥è¯¢åˆ°çš„Orderä¿¡æ¯èµ‹å€¼ç»™OrderVO,å› ä¸ºOrderVOä¸­å¯ä»¥å°è£…è®¢å•è¯¦æƒ…</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);</span><br><span class="line">    orderVO.setOrderDetailList(orderDetailList);</span><br><span class="line">    <span class="keyword">return</span> orderVO;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>å–æ¶ˆè®¢å•</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/cancel/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cancel</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;å–æ¶ˆè®¢å•idä¸º:&#123;&#125;&quot;</span>, id);</span><br><span class="line">    orderService.userCancelById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,åŸæœ¬æ˜¯è¦å–æ¶ˆåé€€æ¬¾æ¥ç€,ä½†æ˜¯ç°åœ¨å¾ˆæ˜æ˜¾å®Œæˆä¸äº†.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userCancelById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¦å…ˆåˆ¤æ–­ å½“å‰è®¢å•çš„çŠ¶æ€-æ ¹æ®è®¢å•idæ¥æŸ¥è¯¢</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆåˆ¤æ–­è®¢å•æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (orders == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç„¶åå°±æ˜¯åˆ¤æ–­çŠ¶æ€äº†,è¿™é‡Œç›´æ¥åˆ¤æ–­çŠ¶æ€æ˜¯å¦å¤§äº2,å¦‚æœå¤§äº2å°±ä¸è®©å–æ¶ˆè®¢å•,è™½ç„¶ç†åº”æ˜¯åå•†æ˜¯å¦èƒ½é€€</span></span><br><span class="line">        <span class="keyword">if</span> (orders.getStatus() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰©ä¸‹çš„æƒ…å†µå°±æ˜¯æ­£å¸¸äº†,èƒ½å¤Ÿé€€æ¬¾  1 å¾…æ”¯ä»˜ 2 å¾…æ¥å•</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€€æ¬¾çš„æ¥å£è‚¯å®šå†™ä¸äº†äº†,å°±æ”¾ç€å§</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾…æ”¯ä»˜å’Œå¾…æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å¯ç›´æ¥å–æ¶ˆè®¢å•</span></span><br><span class="line">        <span class="type">Orders</span> <span class="variable">cancelOrder</span> <span class="operator">=</span></span><br><span class="line">                Orders.builder().id(id).status(Orders.CANCELLED)</span><br><span class="line">                        .cancelReason(<span class="string">&quot;ç”¨æˆ·å–æ¶ˆ&quot;</span>).cancelTime(LocalDateTime.now()).build();</span><br><span class="line"></span><br><span class="line">        orderMapper.update(cancelOrder);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å†æ¥ä¸€å•</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†æ¥ä¸€å•å°±æ˜¯å°†åŸè®¢å•ä¸­çš„å•†å“é‡æ–°åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/repetition/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†æ¥ä¸€å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">repetitionOrder</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;è¦é‡æ–°ä¸‹å•çš„è®¢å•idï¼š&#123;&#125;&quot;</span>, id);</span><br><span class="line">    orderService.repetitionOrder(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™ä¸ªè·Ÿè€å¸ˆå†™çš„ä¹Ÿä¸å¤ªä¸€æ ·,ä½†æ˜¯åŒºåˆ«ä¸å¤§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†æ¬¡ä¸‹å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">repetitionOrder</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‚£æ•´ä½“æ­¥éª¤å°±æ˜¯</span></span><br><span class="line">        <span class="comment">// 1.æ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line">        <span class="comment">// 2.å°†è®¢å•è¯¦æƒ…çš„æ¯ä¸€é¡¹éƒ½èµ‹å€¼ç»™ä¸€ä¸ªè´­ç‰©è½¦ï¼Œç„¶åå°†è¯¥è´­ç‰©è½¦æ•°æ®åŠ å…¥æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ‰äº†è®¢å•è¯¦æƒ…ï¼Œä¹Ÿæœ‰äº†è®¢å•çš„åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (OrderDetail orderDetail : orderDetailList) &#123;</span><br><span class="line">            <span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">            BeanUtils.copyProperties(orderDetail, shoppingCart);</span><br><span class="line">            shoppingCart.setUserId(BaseContextByMe.getCurrentId());</span><br><span class="line">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">            shoppingCartMapper.insert(shoppingCart);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>ç”¨æˆ·ç«¯ç»“æŸ</p>
<h3 id="å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"><a href="#å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—" class="headerlink" title="å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—"></a>å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</h3><ol>
<li>è®¢å•æœç´¢</li>
</ol>
<p>æˆ–è€…è¯´æ˜¯ç®¡ç†ç«¯</p>
<ul>
<li>ä¸šåŠ¡è§„åˆ™<ol>
<li>è¾“å…¥è®¢å•å·&#x2F;æ‰‹æœºå·è¿›è¡Œæœç´¢,æ”¯æŒæ¨¡ç³Šæœç´¢</li>
<li>æ ¹æ®è®¢å•çŠ¶æ€æœç´¢</li>
<li>ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰</li>
<li>æœç´¢å†…å®¹ä¸ºç©º,æç¤ºæœªæ‰¾åˆ°ç›¸å…³è®¢å•</li>
<li>æœç´¢ç»“æœé¡µ,å±•ç¤ºåŒ…å«æœç´¢å…³é”®è¯çš„å†…å®¹</li>
<li>åˆ†é¡µå±•ç¤ºæœç´¢åˆ°çš„è®¢å•æ•°æ®</li>
</ol>
</li>
</ul>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æœç´¢ï¼Œå¯ä»¥æ ¹æ®</span></span><br><span class="line"><span class="comment">     * è®¢å•å·/æ‰‹æœºå·è¿›è¡Œæœç´¢,æ”¯æŒæ¨¡ç³Šæœç´¢</span></span><br><span class="line"><span class="comment">     * æ ¹æ®è®¢å•çŠ¶æ€æœç´¢</span></span><br><span class="line"><span class="comment">     * ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰</span></span><br><span class="line"><span class="comment">     * ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/conditionSearch&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¢å•æœç´¢&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">conditionSearchOrder</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.conditionSearch(ordersPageQueryDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è¿™ä¸ªServiceä¸»è¦è¿˜æ˜¯å°è£…OrderVOä¿¡æ¯,ä»¥åŠæ‹¼æ¥èœå“çš„ä¿¡æ¯,æ¯”å¦‚å¨ƒå¨ƒèœ*1;è¿™ç§å½¢å¼çš„.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç®¡ç†ç«¯è®¢å•åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// å¼€å¯åˆ†é¡µ</span></span><br><span class="line">        PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™ä¸ªåº”è¯¥å°±ä¸éœ€è¦ç”¨æˆ·idäº†ï¼Œç›´æ¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„</span></span><br><span class="line"></span><br><span class="line">        Page&lt;Orders&gt; page = orderMapper.list(ordersPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿˜è¦å†å°è£… è®¢å•è¯¦æƒ…çš„ä¿¡æ¯  è¿™é‡Œçš„pageæ˜¯æ‰€æœ‰çš„è®¢å•ï¼ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">        List&lt;OrderVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders orders : page) &#123;</span><br><span class="line">                <span class="comment">// æ‹¿åˆ°è®¢å•idï¼Œæ ¹æ®è®¢å•idæŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line">                <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">                BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">                <span class="comment">// è¿™ä¸ªè¦æ‹¼æ¥ä¸€ä¸‹</span></span><br><span class="line">                orderVO.setOrderDishes(getOrderDishes(orders));</span><br><span class="line">                list.add(orderVO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getOrderDishes</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line">        <span class="comment">// å°†æ¯ä¸€æ¡èœå“çš„ä¿¡æ¯æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (OrderDetail orderDetail : orderDetails) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">orderDish</span> <span class="operator">=</span> orderDetail.getName() + <span class="string">&quot;*&quot;</span> + orderDetail.getNumber() + <span class="string">&quot;;&quot;</span>;</span><br><span class="line">            stringBuffer.append(orderDish);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuffer.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> * å¾…æ¥å•ï¼Œå¾…æ´¾é€ï¼Œæ´¾é€ä¸­</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/statistics&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderStatisticsVO&gt; <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> orderService.statistics();</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderStatisticsVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ç›´æ¥æŸ¥æ•°é‡ç„¶åèµ‹å€¼è¿”å›,æ¯”æˆ‘è‡ªå·±å†™çš„é‚£æ ·ç®€å•å¤šäº†</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     * å¾…æ¥å•ï¼Œå¾…æ´¾é€ï¼Œæ´¾é€ä¸­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderStatisticsVO <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*OrderStatisticsVO orderStatisticsVO = new OrderStatisticsVO();</span></span><br><span class="line"><span class="comment">        orderStatisticsVO.setToBeConfirmed(0);</span></span><br><span class="line"><span class="comment">        orderStatisticsVO.setConfirmed(0);</span></span><br><span class="line"><span class="comment">        orderStatisticsVO.setDeliveryInProgress(0);</span></span><br><span class="line"><span class="comment">        // æŸ¥è¯¢æ‰€æœ‰çš„è®¢å•</span></span><br><span class="line"><span class="comment">        List&lt;Orders&gt; list = orderMapper.getAllOrders();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // éå†æ•´ä¸ªè®¢å•é›†åˆ</span></span><br><span class="line"><span class="comment">        for (Orders orders : list) &#123;</span></span><br><span class="line"><span class="comment">            Integer status = orders.getStatus();</span></span><br><span class="line"><span class="comment">            if (status == Orders.TO_BE_CONFIRMED) &#123;</span></span><br><span class="line"><span class="comment">                orderStatisticsVO.setToBeConfirmed(orderStatisticsVO.getToBeConfirmed() + 1);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            if (status == Orders.CONFIRMED) &#123;</span></span><br><span class="line"><span class="comment">                orderStatisticsVO.setConfirmed(orderStatisticsVO.getConfirmed() + 1);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            if (status == Orders.DELIVERY_IN_PROGRESS) &#123;</span></span><br><span class="line"><span class="comment">                orderStatisticsVO.setDeliveryInProgress(orderStatisticsVO.getDeliveryInProgress() + 1);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        return orderStatisticsVO;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//=================</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸Šé¢çš„ä»£ç å¤ªéº»çƒ¦äº†</span></span><br><span class="line">        <span class="comment">// æ ¹æ®çŠ¶æ€-åˆ†åˆ«æŸ¥è¯¢å‡ºå¾…æ¥å•ï¼Œå¸¦æ´¾é€ï¼Œæ´¾é€ä¸­çš„è®¢å•æ•°é‡</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">toBeConfirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.TO_BE_CONFIRMED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">confirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.CONFIRMED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">deliveryInProgress</span> <span class="operator">=</span> orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è£…æ•°æ®</span></span><br><span class="line">        <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderStatisticsVO</span>();</span><br><span class="line">        orderStatisticsVO.setToBeConfirmed(toBeConfirmed);</span><br><span class="line">        orderStatisticsVO.setConfirmed(confirmed);</span><br><span class="line">        orderStatisticsVO.setDeliveryInProgress(deliveryInProgress);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderStatisticsVO;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®çŠ¶æ€æŸ¥è¯¢æ•°é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> toBeConfirmed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select count(id) from orders where status = #&#123;status&#125; &quot;)</span></span><br><span class="line">Integer <span class="title function_">countStatus</span><span class="params">(Integer toBeConfirmed)</span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŸ¥è¯¢è®¢å•è¯¦æƒ…</li>
</ol>
<p>ä¸šåŠ¡è§„åˆ™<br>    - è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•åŸºæœ¬ä¿¡æ¯(çŠ¶æ€,è®¢å•å·,ä¸‹å•æ—¶é—´,æ”¶è´§äºº,ç”µè¯,æ”¶è´§åœ°å€,é‡‘é¢ç­‰)<br>    - è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•æ˜ç»†æ•°æ®(å•†å“åç§°,æ•°é‡,å•ä»·)</p>
<blockquote>
<p>Controller,è¿™ä¸ªæ˜¯ä¹‹å‰ç”¨æˆ·ç«¯çš„ä¸šåŠ¡,ç›´æ¥è°ƒç”¨å¯¹åº”çš„serviceå³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/details/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">details</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.getOrderDetail(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ¥å•</li>
</ol>
<p>æˆ‘æ˜¯æ²¡æƒ³åˆ°è¿™ä¸ªidç«Ÿç„¶è¿˜ç”¨ä¸€ä¸ªDTOæ¥å°è£…</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ¥å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">confirm</span><span class="params">(<span class="meta">@RequestBody</span> OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    orderService.confirm(ordersConfirmDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä»è¿™ä¸€æ­¥å°±èƒ½çœ‹å‡ºæ¥,æ ¹æœ¬ä¸éœ€è¦å°è£…è¿™ä¸ªDTO,ç›´æ¥ç”¨idå°±å¯ä»¥äº†.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®idå’ŒçŠ¶æ€ä¸ºå·²æ¥å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder().id(ordersConfirmDTO.getId()).status(Orders.CONFIRMED).build();</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¹‹å‰çš„åŠ¨æ€sqlæ¥ä¿®æ”¹</span></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æ‹’å•</li>
</ol>
<p><strong>è¿™ä¸ªåˆå¿˜äº†æ‰€è°“çš„ä¸šåŠ¡è§„åˆ™äº†</strong><br>    - å•†å®¶æ‹’å•å°±æ˜¯å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸ºå·²å–æ¶ˆ<br>    - åªæœ‰å½“è®¢å•å¤„äºå¾…æ¥å•çš„çŠ¶æ€æ˜¯å¯ä»¥æ‰§è¡Œæ‹’å•æ“ä½œ<br>    - éœ€è¦æŒ‡å®šåŸå› <br>    - å¦‚æœå·²å®Œæˆæ”¯ä»˜,è¦é€€æ¬¾?</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/rejection&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ‹’å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">rejection</span><span class="params">(<span class="meta">@RequestBody</span> OrdersRejectionDTO ordersRejectionDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªç”¨DTOæˆ‘èƒ½ç†è§£,å› ä¸ºè¿˜æœ‰ä¸€ä¸ªæ‹’å•åŸå› å‘¢</span></span><br><span class="line">    orderService.rejection(ordersRejectionDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service è¿™ä¸ªè·Ÿè€å¸ˆå†™çš„ä¹Ÿä¸ä¸€æ ·,è€å¸ˆå†™çš„è¿˜è¦åˆ¤æ–­çŠ¶æ€ä»€ä¹ˆçš„,ç„¶åè¿˜è¦è¿›è¡Œé€€æ¬¾..</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersRejectionDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejection</span><span class="params">(OrdersRejectionDTO ordersRejectionDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶å®å°±æ˜¯è®¾ç½®çŠ¶æ€ä¸ºå·²å–æ¶ˆ</span></span><br><span class="line">    <span class="comment">// è¿˜è¦å…ˆåˆ¤æ–­æ˜¯å¦è®¢å•å·²æ”¯ä»˜</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> orderMapper.getById(ordersRejectionDTO.getId()).getStatus();</span><br><span class="line">    log.info(<span class="string">&quot;å½“å‰çŠ¶æ€ä¸º:&#123;&#125;&quot;</span>, status);</span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span></span><br><span class="line">            Orders.builder().id(ordersRejectionDTO.getId()).status(Orders.CANCELLED).cancelTime(LocalDateTime.now())</span><br><span class="line">                    .rejectionReason(ordersRejectionDTO.getRejectionReason()).build();</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>å–æ¶ˆè®¢å•</li>
</ol>
<p>å–æ¶ˆè®¢å•,å°±æ˜¯è®¾ç½®è®¢å•çŠ¶æ€ä¸º<code>å·²å–æ¶ˆ</code><br>å•†å®¶å–æ¶ˆè®¢å•éœ€è¦æŒ‡å®šå–æ¶ˆåŸå› <br>å¦‚æœç”¨æˆ·å·²ç»ä»˜æ¬¾,åˆ™è¦è¿›è¡Œé€€æ¬¾</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/cancel&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cancel</span><span class="params">(<span class="meta">@RequestBody</span> OrdersCancelDTO ordersCancelDTO)</span> &#123;</span><br><span class="line">    orderService.adminCancel(ordersCancelDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,å¿˜äº†è¿˜æœ‰ä¸€ä¸ªpayStatuså­—æ®µäº†,å¯ä»¥æ ¹æ®è¿™ä¸ªå­—æ®µæ¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å·²ç»æ”¯ä»˜</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">adminCancel</span><span class="params">(OrdersCancelDTO ordersCancelDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€æ¬¾çš„ä»£ç ä¾ç„¶ä¸ç”¨å†™  é‚£ä¹Ÿå†™ä¸€ä¸‹åˆ¤æ–­å§</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(ordersCancelDTO.getId());</span><br><span class="line">    <span class="keyword">if</span> (ordersDB.getPayStatus() == <span class="number">1</span>) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;é€€æ¬¾ä¸­....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span></span><br><span class="line">            Orders.builder().id(ordersCancelDTO.getId()).cancelTime(LocalDateTime.now())</span><br><span class="line">                    .cancelReason(ordersCancelDTO.getCancelReason()).status(Orders.CANCELLED).build();</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>æ´¾é€è®¢å•</li>
</ol>
<p><strong>ä¸šåŠ¡è§„åˆ™</strong><br>    - æ´¾é€è®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œæ´¾é€ä¸­â€<br>    - åªæœ‰çŠ¶æ€ä¸ºâ€œå¾…æ´¾é€â€çš„è®¢å•å¯ä»¥æ‰§è¡Œæ´¾é€è®¢å•æ“ä½œ</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/delivery/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ´¾é€è®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delivery</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ´¾é€è®¢å•çš„id:&#123;&#125;&quot;</span>, id);</span><br><span class="line">    orderService.delivery(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¸»è¦å°±æ˜¯æ³¨æ„çŠ¶æ€</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delivery</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (orderMapper.getById(id).getStatus() != Orders.CONFIRMED) &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰è¿™ä¸ªå·²æ¥å•çš„çŠ¶æ€æ‰èƒ½æ´¾é€</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è®¢å•çŠ¶æ€é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹æ´¾é€çš„è®¢å•çš„è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder().id(id).status(Orders.DELIVERY_IN_PROGRESS).build();</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>å®Œæˆè®¢å•</li>
</ol>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/complete/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å®Œæˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">complete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    orderService.complete(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,æ³¨æ„çŠ¶æ€å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®Œæˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">complete</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orderDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line">    <span class="comment">// åªæœ‰æ´¾é€ä¸­çš„è®¢å•æ‰èƒ½å®Œæˆ</span></span><br><span class="line">    <span class="keyword">if</span> (orderDB == <span class="literal">null</span> || orderDB.getStatus() != Orders.DELIVERY_IN_PROGRESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è®¢å•çŠ¶æ€é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder().id(id).status(Orders.COMPLETED).build();</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>æ¥å£è¿™å—æ˜¯å®Œæˆäº†â€¦</p>
<p>è¿˜æœ‰ä¼˜åŒ–å•¥çš„,çœ‹çœ‹æ€ä¹ˆåš</p>
<p>ç™¾åº¦åœ°å›¾AK:<code>cXa9RUd5ZOkF7zcvBxAXFGm12PRLVGvP</code></p>
<p>é…ç½®æ–‡ä»¶:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">shop:</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">åŒ—äº¬å¸‚æµ·æ·€åŒºä¸Šåœ°åè¡—10å·</span></span><br><span class="line"><span class="attr">baidu:</span></span><br><span class="line">  <span class="attr">ak:</span> <span class="string">cXa9RUd5ZOkF7zcvBxAXFGm12PRLVGvP</span></span><br></pre></td></tr></table></figure>

<p>åœ¨OrderServiceImplä¸­æ·»åŠ æ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;sky.shop.address&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String shopAddress;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sky.baidu.ak&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ak;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥å®¢æˆ·çš„æ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkOutOfRange</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;address&quot;</span>, shopAddress);</span><br><span class="line">        map.put(<span class="string">&quot;output&quot;</span>, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;ak&quot;</span>, ak);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–åº—é“ºçš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(shopCoordinate);</span><br><span class="line">        <span class="keyword">if</span> (!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;åº—é“ºåœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®è§£æ</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">location</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lat</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lng</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">        <span class="comment">// åº—é“ºç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;address&quot;</span>, address);</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·æ”¶è´§åœ°å€çš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        jsonObject = JSON.parseObject(userCoordinate);</span><br><span class="line">        <span class="keyword">if</span> (!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;æ”¶è´§åœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®è§£æ</span></span><br><span class="line">        location = jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        lat = location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">        lng = location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æ”¶è´§åœ°å€ç»çº¬åº¦åæ ‡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;origin&quot;</span>, shopLngLat);</span><br><span class="line">        map.put(<span class="string">&quot;destination&quot;</span>, userLngLat);</span><br><span class="line">        map.put(<span class="string">&quot;steps_info&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·¯çº¿è§„åˆ’</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/directionlite/v1/driving&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">        jsonObject = JSON.parseObject(json);</span><br><span class="line">        <span class="keyword">if</span> (!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;é…é€è·¯çº¿è§„åˆ’å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®è§£æ</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> (JSONArray) result.get(<span class="string">&quot;routes&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">distance</span> <span class="operator">=</span> (Integer) ((JSONObject) jsonArray.get(<span class="number">0</span>)).get(<span class="string">&quot;distance&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (distance &gt; <span class="number">5000</span>) &#123;</span><br><span class="line">            <span class="comment">// é…é€è·ç¦»è¶…è¿‡5000ç±³</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è¶…å‡ºé…é€èŒƒå›´&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç”¨æˆ·ä¸‹å•çš„åœ°æ–¹åŠ å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥ç”¨æˆ·çš„æ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></span><br><span class="line">        checkOutOfRange(addressBook.getCityName() + addressBook.getDistrictName() + addressBook.getDetail());</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™æ®µä»£ç ,éœ€ä¸éœ€è¦è®°ä¸‹æ¥å‘¢?</p>
<p>å—¯,å…ˆåˆ°è¿™å§</p>
<h1 id="11-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†-æ¥å•æé†’å’Œå®¢æˆ·å‚¬å•"><a href="#11-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†-æ¥å•æé†’å’Œå®¢æˆ·å‚¬å•" class="headerlink" title="11 è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†-æ¥å•æé†’å’Œå®¢æˆ·å‚¬å•"></a>11 è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†-æ¥å•æé†’å’Œå®¢æˆ·å‚¬å•</h1><p>ä¸¤ç§æç¤º</p>
<ol>
<li>æ”¯ä»˜è¶…æ—¶çš„è®¢å•å¦‚ä½•å¤„ç†</li>
<li>æ´¾é€ä¸­çš„è®¢å•ä¸€ç›´ä¸ç‚¹å‡»å®Œæˆå¦‚ä½•å¤„ç†</li>
</ol>
<h2 id="Spring-Task"><a href="#Spring-Task" class="headerlink" title="Spring Task"></a>Spring Task</h2><p>æ¶ˆæ¯?</p>
<p><code>Spring Task</code>æ˜¯Springæ¡†æ¶æä¾›çš„ä»»åŠ¡è°ƒåº¦å·¥å…·,å¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸä¸ªä»£ç é€»è¾‘</p>
<p><strong>å®šæ—¶ä»»åŠ¡æ¡†æ¶</strong></p>
<p>ä½œç”¨:å®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µä»£ç </p>
<h3 id="cronè¡¨è¾¾å¼"><a href="#cronè¡¨è¾¾å¼" class="headerlink" title="cronè¡¨è¾¾å¼"></a>cronè¡¨è¾¾å¼</h3><p>cronè¡¨è¾¾å¼å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,é€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥<strong>å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´</strong></p>
<p>æ„æˆè§„åˆ™:åˆ†æˆ6æˆ–7ä¸ªåŸŸ,ç”±ç©ºæ ¼åˆ†éš”å¼€,æ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰</p>
<p>æ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸º:<code>ç§’,åˆ†é’Ÿ,å°æ—¶,æ—¥,æœˆ,å‘¨,å¹´(å¯é€‰)</code></p>
<p>æè¿°ä¸€ä¸ªæ—¶é—´:<code>2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´</code>,å¯¹åº”çš„cronè¡¨è¾¾å¼ä¸º<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230910185659.png" alt="20230910185659"><br><strong>æ—¥å’Œå‘¨åªèƒ½å†™ä¸€ä¸ª</strong></p>
<p>ä½†æ˜¯æœ‰äº›è¡¨è¾¾å¼æ˜¯ä¸èƒ½ç›´æ¥æè¿°çš„,éœ€è¦ä¸€äº›ç¬¦å·</p>
<p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://qqe2.com/cron">cornåœ¨çº¿ç”Ÿæˆå™¨</a></p>
<h3 id="å…¥é—¨æ¡ˆä¾‹-1"><a href="#å…¥é—¨æ¡ˆä¾‹-1" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><ol>
<li>å¯¼å…¥mavenåæ ‡:<code>spring-context</code>(å·²å­˜åœ¨)</li>
<li>å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£:<code>@EnableScheduling</code>å¼€å¯ä»»åŠ¡è°ƒåº¦</li>
<li>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-10 19:37</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»ç¬¬0ç§’å¼€å§‹,æ¯5ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTask</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œ:&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±ä¼šæ¯éš”5ç§’è‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230910194231.png" alt="20230910194231"></p>
<h2 id="è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"><a href="#è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†" class="headerlink" title="è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†"></a>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</h2><p>ç”¨æˆ·ä¸‹å•åå¯èƒ½å­˜åœ¨çš„æƒ…å†µ</p>
<ol>
<li>ä¸‹å•åæœªæ”¯ä»˜,è®¢å•ä¸€ç›´å¤„äº<code>å¾…æ”¯ä»˜</code>çŠ¶æ€</li>
<li>ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å®ŒæˆæŒ‰é’®,è®¢å•ä¸€ç›´å¤„äº<code>æ´¾é€ä¸­</code>çŠ¶æ€</li>
</ol>
<p>å¯¹äºä¸Šé¢ä¸¤ç§æƒ…å†µéœ€è¦é€šè¿‡<code>å®šæ—¶ä»»åŠ¡</code>æ¥ä¿®æ”¹è®¢å•çŠ¶æ€,å…·ä½“é€»è¾‘ä¸º</p>
<ul>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡<code>æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</code>æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•(ä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•),å¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º<code>å·²å–æ¶ˆ</code></li>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡<code>æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡</code>æ˜¯å¦å­˜åœ¨<code>æ´¾é€ä¸­</code>çš„è®¢å•,å¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸º<code>å·²å®Œæˆ</code></li>
</ul>
<blockquote>
<p>OrderTask.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Orders;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.OrderMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-10 19:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†è¶…æ—¶è®¢å•çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 * * * * ? &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®šæ—¶å¤„ç†è¶…æ—¶è®¢å•:&#123;&#125;&quot;</span>, LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// timeè¿™ä¸ª,è€å¸ˆç”¨çš„æ˜¯plusMinutes(-15),é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨minuså‘¢?</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢è¶…æ—¶è®¢å• select * from orders where status = ? and order_time &lt; (å½“å‰æ—¶é—´-15åˆ†é’Ÿ)</span></span><br><span class="line">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrderTimeLT(Orders.PENDING_PAYMENT,</span><br><span class="line">                LocalDateTime.now().minusMinutes(<span class="number">15</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders orders : ordersList) &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®çŠ¶æ€ä¸ºå–æ¶ˆ</span></span><br><span class="line">                orders.setStatus(Orders.CANCELLED);</span><br><span class="line">                orders.setCancelReason(<span class="string">&quot;è®¢å•è¶…æ—¶,è‡ªåŠ¨å–æ¶ˆ&quot;</span>);</span><br><span class="line">                orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">                orderMapper.update(orders);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯å¤©å‡Œæ™¨ä¸€ç‚¹è§¦å‘</span></span><br><span class="line"><span class="comment">     * å¤„ç†ä¸€ç›´å¤„äºæ´¾é€ä¸­çš„è®¢å•-è‡ªåŠ¨å®Œæˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®šæ—¶å¤„ç†ä¸€ç›´å¤„äºæ´¾é€ä¸­çš„è®¢å•:&#123;&#125;&quot;</span>, LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´ ä¸€ç‚¹,å‡å»ä¸€ä¸ªå°æ—¶,å¾—åˆ°å°±æ˜¯0ç‚¹,å¯ä»¥ç”¨æ¥æ•´ç†æ˜¨å¤©çš„è®¢å•</span></span><br><span class="line">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrderTimeLT(Orders.DELIVERY_IN_PROGRESS,</span><br><span class="line">                LocalDateTime.now().minusHours(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders orders : ordersList) &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®çŠ¶æ€ä¸ºå–æ¶ˆ</span></span><br><span class="line">                orders.setStatus(Orders.COMPLETED);</span><br><span class="line">                orderMapper.update(orders);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è®¢å•çŠ¶æ€å’Œä¸‹å•æ—¶é—´æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œä¼ å…¥çš„orderTimeæ˜¯å·²ç»å¤„ç†è¿‡çš„.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderTime</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from orders where status = #&#123;status&#125; and order_time &lt; #&#123;orderTime&#125;&quot;)</span></span><br><span class="line">List&lt;Orders&gt; <span class="title function_">getByStatusAndOrderTimeLT</span><span class="params">(Integer status, LocalDateTime orderTime)</span>;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¹Ÿæ²¡é—®é¢˜å•Šæ²¡é—®é¢˜</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>WebSocketæ˜¯åŸºäºTCPçš„ä¸€ç§æ–°çš„ç½‘ç»œåè®®,å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡-æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦<code>å®Œæˆä¸€æ¬¡æ¡æ‰‹</code>,ä¸¤è€…ä¹‹é—´å°±å¯ä»¥<code>åˆ›å»ºæŒä¹…æ€§è¿æ¥</code>,å¹¶è¿›è¡Œ<code>åŒå‘</code>æ•°æ®ä¼ è¾“</p>
<p>é‚£è¿™ä¸ªWebSocketå’ŒHttpåè®®æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230910203637.png" alt="20230910203637"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230910203650.png" alt="20230910203650"></p>
<p>å“¦,åŸæ¥æ˜¯é•¿è¿æ¥?æ¡ä¸€æ¬¡æ‰‹,ç„¶åå¯ä»¥åŒå‘é€šè®¯,ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨è¯·æ±‚æµè§ˆå™¨?</p>
<p><strong>åº•å±‚äºŒè€…éƒ½æ˜¯TCPè¿æ¥</strong></p>
<h4 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><p>å®ç°æ­¥éª¤</p>
<ol>
<li>mavenä¾èµ–<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>ç›´æ¥ä½¿ç”¨websocket.htmlé¡µé¢ä½œä¸ºWebSocketå®¢æˆ·ç«¯<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;send()&quot;</span>&gt;</span>å‘é€æ¶ˆæ¯<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;closeWebSocket()&quot;</span>&gt;</span>å…³é—­è¿æ¥<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> clientId = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(<span class="string">&#x27;WebSocket&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//è¿æ¥WebSocketèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="language-javascript">        websocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/ws/&quot;</span>+clientId);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;Not support websocket&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;error&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">    websocket.<span class="property">onclose</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setMessageInnerHTML</span>(<span class="string">&quot;close&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setMessageInnerHTML</span>(<span class="params">innerHTML</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">innerHTML</span> += innerHTML + <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> message = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;text&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">send</span>(message);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">	</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">//å…³é—­è¿æ¥</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">closeWebSocket</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        websocket.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>å¯¼å…¥WebSocketæœåŠ¡ç«¯ç»„ä»¶WebSocketServer,ç”¨äºå’Œå®¢æˆ·ç«¯é€šè®¯<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnClose;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnMessage;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnOpen;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.Session;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketæœåŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws/&#123;sid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜æ”¾ä¼šè¯å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;å»ºç«‹è¿æ¥&quot;</span>);</span><br><span class="line">        sessionMap.put(sid, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;çš„ä¿¡æ¯:&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(<span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥æ–­å¼€:&quot;</span> + sid);</span><br><span class="line">        sessionMap.remove(sid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¾¤å‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        Collection&lt;Session&gt; sessions = sessionMap.values();</span><br><span class="line">        <span class="keyword">for</span> (Session session : sessions) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">                session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å¯¼å…¥é…ç½®ç±»WebSocketConfiguration,æ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketé…ç½®ç±»ï¼Œç”¨äºæ³¨å†ŒWebSocketçš„Bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å¯¼å…¥å®šæ—¶ä»»åŠ¡ç±»WebSocketTask,å®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebSocketServer webSocketServer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡WebSocketæ¯éš”5ç§’å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessageToClient</span><span class="params">()</span> &#123;</span><br><span class="line">        webSocketServer.sendToAllClient(<span class="string">&quot;è¿™æ˜¯æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼š&quot;</span> + DateTimeFormatter.ofPattern(<span class="string">&quot;HH:mm:ss&quot;</span>).format(LocalDateTime.now()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>ç®€å†-æŠ•ç®€å†</p>
<h2 id="æ¥å•æé†’"><a href="#æ¥å•æé†’" class="headerlink" title="æ¥å•æé†’"></a>æ¥å•æé†’</h2><p>ç”¨æˆ·ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸå,éœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶,é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§</p>
<ol>
<li>è¯­éŸ³æ’­æŠ¥</li>
<li>å¼¹å‡ºæç¤ºæ¡†</li>
</ol>
<p>å°±æ˜¯æœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯</p>
<ol>
<li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li>
<li>å½“å®¢æˆ·æ”¯ä»˜å,è°ƒç”¨WebSocketç›¸å…³çš„APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯,åˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·ç«¯å‚¬å•,è¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</li>
<li>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSON,å­—æ®µåŒ…æ‹¬:type,orderId,contetn<ul>
<li><code>type</code>ä¸ºæ¶ˆæ¯ç±»å‹,1ä¸ºæ¥å•æé†’,2ä¸ºå®¢æˆ·å‚¬å•</li>
<li><code>orderId</code>ä¸ºè®¢å•id</li>
<li><code>content</code>ä¸ºæ¶ˆæ¯å†…å®¹</li>
</ul>
</li>
</ol>
<hr>
<p>åœ¨å¯¼å…¥ä¸Šé¢çš„<code>WebSocketServer</code>å,è¿™æ—¶è¿è¡Œå‰ç«¯å°±å·²ç»å¯ä»¥è¿›è¡ŒWebSocketè¿æ¥äº†<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911202207.png" alt="20230911202207"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911202225.png" alt="20230911202225"></p>
<p>ä½†æ˜¯æœ‰æ²¡æœ‰å‘ç°,å‰ç«¯è¯·æ±‚æ˜¯<code>ws://localhost/ws/nigh7mb27z</code>,ä¹Ÿå°±æ˜¯80ç«¯å£,è€Œåç«¯ç›¸å½“äºæ˜¯<code>ws://localhost:8080/ws/&#123;sid&#125;</code></p>
<p><strong>è¿™é‡Œå°±æ˜¯Nginxçš„åå‘ä»£ç†:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># WebSocket</span><br><span class="line">location /ws/ &#123;</span><br><span class="line">          proxy_pass   http://webservers/ws/;</span><br><span class="line">	proxy_http_version 1.1;</span><br><span class="line">	proxy_read_timeout 3600s;</span><br><span class="line">	proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">	proxy_set_header Connection &quot;$connection_upgrade&quot;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>å½“å‰ç«¯æœåŠ¡è¯·æ±‚åˆ°nginxä¸Šçš„<code>ws://localhost/ws/xxx</code>å°±ä¼šè½¬å‘åˆ°åç«¯æœåŠ¡å™¨ä¸Šçš„<code>ws://localhost:8080/ws/xxx</code></p>
<hr>
<p>è¿™é‡Œåˆè¦å’Œè€å¸ˆå†™çš„ä¸å¤ªä¸€æ ·äº†,å› ä¸ºè¿™ä¸ªè€å¸ˆæ˜¯å°†è¿™ä¸ªæé†’æ”¾åœ¨äº†<code>æ”¯ä»˜æˆåŠŸçš„å›è°ƒä¸­</code>,è€Œè¿™ä¸ªå›è°ƒæ˜¯åšä¸äº†çš„,æ‰€ä»¥æˆ‘ç›´æ¥æ”¾åˆ°è‡ªå·±å†™çš„æ¨¡æ‹Ÿæ”¯ä»˜çš„æ¥å£ä¸­å°±è¡Œäº†</p>
<p>æ›´æ”¹<code>OrderServiceImpl</code>çš„<code>paymentWithNoMoney</code>,å°±æ˜¯åœ¨ä¸‹é¢åŠ ä¸Šå‡ è¡Œä»£ç å°±è¡Œäº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿçš„æ”¯ä»˜ï¼Œç›´æ¥æ”¯ä»˜æˆåŠŸå°±å®Œäº†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paymentWithNoMoney</span><span class="params">(OrdersPaymentDTO ordersPaymentDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–åˆ°è®¢å•å·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderNumber</span> <span class="operator">=</span> ordersPaymentDTO.getOrderNumber();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯èƒ½è¦åŠ ä¸ªä»˜æ¬¾æ—¶é—´</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">checkoutTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›´æ¥ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line">    orderMapper.changeStatusAndCheckoutTime(orderNumber, checkoutTime);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¦è·å–ä¸ªè®¢å•idæ‰è¡Œï¼Œæ ¹æ®è®¢å•å·è·å–è®¢å•id</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getByNumber(ordersPaymentDTO.getOrderNumber());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡webSocketå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯ type,orderId,content</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;type&quot;</span>, <span class="number">1</span>); <span class="comment">// 1è¡¨ç¤ºæ¥å•æé†’</span></span><br><span class="line">    map.put(<span class="string">&quot;orderId&quot;</span>, orders.getId());</span><br><span class="line">    map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;è®¢å•å·ï¼š&quot;</span> + orderNumber);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(map);</span><br><span class="line">    webSocketServer.sendToAllClient(json);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœæ²¡é—®é¢˜<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911204259.png" alt="20230911204259"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911205147.png" alt="20230911205147"></p>
<p>å¦‚æœä¸ç‚¹å‡»æç¤º,å°±ä¼šä¸€ç›´å“!</p>
<h2 id="å®¢æˆ·å‚¬å•"><a href="#å®¢æˆ·å‚¬å•" class="headerlink" title="å®¢æˆ·å‚¬å•"></a>å®¢æˆ·å‚¬å•</h2><blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ç”¨æˆ·å‚¬å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">reminder</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨æˆ·å‚¬å•,æœåŠ¡ç«¯æ¥æ”¶åˆ°å‚¬å•è¯·æ±‚,ç„¶åå†æé†’æµè§ˆå™¨</span></span><br><span class="line">    orderService.reminder(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reminder</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">// å…ˆæ ¹æ®è®¢å•idæŸ¥è¯¢åˆ°è®¢å•å·</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orderDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (orderDB == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">String</span> <span class="variable">number</span> <span class="operator">=</span> orderDB.getNumber();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å°è£…è¿”å›ä¿¡æ¯</span></span><br><span class="line">       <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">       map.put(<span class="string">&quot;type&quot;</span>, <span class="number">2</span>);</span><br><span class="line">       map.put(<span class="string">&quot;orderId&quot;</span>, id);</span><br><span class="line">       map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;ç”¨æˆ·å‚¬å•:&quot;</span> + number);</span><br><span class="line">       webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ä½“æ¥çœ‹ä¹Ÿæ²¡å•¥éš¾çš„.</p>
<p>æ²¡é—®é¢˜<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911205850.png" alt="20230911205850"></p>
<h1 id="12-æ•°æ®ç»Ÿè®¡"><a href="#12-æ•°æ®ç»Ÿè®¡" class="headerlink" title="12 æ•°æ®ç»Ÿè®¡"></a>12 æ•°æ®ç»Ÿè®¡</h1><h2 id="Apache-ECharts"><a href="#Apache-ECharts" class="headerlink" title="Apache ECharts"></a>Apache ECharts</h2><p>Apache EChartsæ˜¯ä¸€æ¬¾åŸºäºJSçš„æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“,æä¾›ç›´è§‚,ç”ŸåŠ¨,å¯äº¤äº’,å¯ä¸ªæ€§åŒ–å®šåˆ¶çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨</p>
<p><a target="_blank" rel="noopener" href="https://echarts.apache.org/handbook/zh/get-started">å®˜ç½‘</a></p>
<p>ç›´æ¥çœ‹å¿«é€Ÿå¼€å§‹å°±çŸ¥é“æ€ä¹ˆç®€å•çš„ä½¿ç”¨äº†</p>
<p><strong>é‡ç‚¹åœ¨äºç ”ç©¶æŸä¸ªå›¾è¡¨æ‰€éœ€è¦çš„<code>æ•°æ®æ ¼å¼</code>,é€šå¸¸æ˜¯éœ€è¦åç«¯æä¾›ç¬¦åˆæ ¼å¼è¦æ±‚çš„åŠ¨æ€æ•°æ®,ç„¶åç›¸åº”ç»™å‰ç«¯æ¥å±•ç¤ºå›¾æ ‡</strong></p>
<p>å—¯..å¥½åƒå¯ä»¥ç”¨è¿™ä¸ªechartsæ”¹è¿›ä¸€ä¸‹é‚£ä¸ªè„±è£¤å­æ”¾å±çš„ä¸œè¥¿</p>
<h2 id="è¥ä¸šé¢ç»Ÿè®¡"><a href="#è¥ä¸šé¢ç»Ÿè®¡" class="headerlink" title="è¥ä¸šé¢ç»Ÿè®¡"></a>è¥ä¸šé¢ç»Ÿè®¡</h2><p>äº§å“åŸå‹:ä¸€ä¸ªæŠ˜çº¿å›¾<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230911231332.png" alt="20230911231332"></p>
<p>æ‰€ä»¥å°±è¦è·å–<strong>æ¯å¤©çš„è¥ä¸šé¢</strong>,è€Œæ—¥æœŸè¦æ ¹æ®æ—¶é—´é€‰æ‹©å™¨æ¥å†³å®š</p>
<p>ä¸šåŠ¡è§„åˆ™</p>
<ul>
<li>è¥ä¸šé¢æŒ‡è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆçš„è®¢å•é‡‘é¢åˆè®¡</li>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè¥ä¸šé¢æ•°æ®,xè½´ä¸ºæ—¥æœŸ,yè½´ä¸ºè¥ä¸šé¢</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´,å±•ç¤ºæ¯å¤©çš„è¥ä¸šé¢æ•°æ®</li>
</ul>
<p><strong>å‰ç«¯æäº¤å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ</strong></p>
<p><strong>è¿”å›çš„æ•°æ®åº”åŒ…æ‹¬xè½´çš„æ—¥æœŸå’Œyè½´çš„è¥ä¸šé¢æ•°æ®</strong></p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¥ä¸šé¢ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin å¼€å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   ç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/turnoverStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è¥ä¸šé¢ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;TurnoverReportVO&gt; <span class="title function_">turnoverStatistics</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">                                                       <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è¥ä¸šé¢æ•°æ®ç»Ÿè®¡ï¼š&#123;&#125;,&#123;&#125;&quot;</span>, begin, end);</span><br><span class="line">        <span class="type">TurnoverReportVO</span> <span class="variable">reportVO</span> <span class="operator">=</span> reportService.turnoverStatistics(begin, end);</span><br><span class="line">        <span class="keyword">return</span> Result.success(reportVO);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,æœç„¶é‡å¤´æˆéƒ½åœ¨serviceä¸­,è¿™é‡Œæ¶‰åŠåˆ°æ—¥æœŸçš„å åŠ ,æœ‰<code>LocalDateTime.of(LocalDate)</code>è¿™ç§ç±»å‹è½¬æ¢,ä½¿ç”¨<code>LocalTime.MAX</code>æ¥è·å–å½“å¤©çš„æœ€åä¸€æ—¶åˆ»,è¿˜æœ‰<code>StringUtils.join(dateList, &quot;,&quot;)</code>æ¥è·å–é›†åˆçš„æ¯ä¸€é¡¹,ç„¶åç”¨é€—å·åˆ†éš”,æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TurnoverReportVO <span class="title function_">turnoverStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºäºbeginå’Œendå¾—åˆ°åŒºé—´å†…çš„æ—¥æœŸï¼Œå¯ä»¥æ— éœ€æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">// å½“å‰é›†åˆç”¨äºå­˜æ”¾ä»beginåˆ°endèŒƒå›´å†…çš„æ‰€æœ‰æ—¥æœŸ</span></span><br><span class="line">        dateList.add(begin);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ—¥æœŸè®¡ç®—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">while</span> (!begin.equals(end)) &#123;</span><br><span class="line">            begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">            dateList.add(begin);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜æ”¾æ¯å¤©çš„è¥ä¸šé¢</span></span><br><span class="line">        List&lt;Double&gt; turnoverList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (LocalDate localDate : dateList) &#123;</span><br><span class="line">            <span class="comment">// éå†è¿™ä¸ªæ—¥æœŸé›†åˆï¼Œç„¶åæ ¹æ®æ¯ä¸€å¤©çš„æ—¥æœŸæŸ¥è¯¢æ•°æ®åº“ï¼Œè¿”å›è¥ä¸šé¢æ•°æ®--- çŠ¶æ€ä¸ºå·²å®Œæˆçš„è®¢å•é‡‘é¢åˆè®¡</span></span><br><span class="line">            <span class="comment">// select sum(amount) from orders where status = ? and order_time &gt; ? and order_time &lt; ?</span></span><br><span class="line">            <span class="comment">// è·å–åˆ°çš„æ˜¯è¯¥æ—¥æœŸçš„0ç‚¹0åˆ†0ç§’å’Œ23:59:59.999999999</span></span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MIN);</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MAX);</span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            map.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">            map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">            map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">            <span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map);</span><br><span class="line">            <span class="comment">// ä¸‰å…ƒè¿ç®—ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™èµ‹å€¼ä¸º0.0</span></span><br><span class="line">            turnover = turnover == <span class="literal">null</span> ? <span class="number">0.0</span> : turnover;</span><br><span class="line">            turnoverList.add(turnover);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å·¥å…·ç±»ï¼Œå–å‡ºdateListé›†åˆä¸­çš„æ¯ä¸€é¡¹ï¼Œç„¶åä»¥é€—å·åˆ†éš”ï¼Œå¾—åˆ°ä¸€ä¸ªStringå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> TurnoverReportVO.builder()</span><br><span class="line">                .dateList(StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .turnoverList(StringUtils.join(turnoverList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;sumByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Double&quot;</span>&gt;</span></span><br><span class="line">        select sum(amount) from orders</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status!=null&quot;</span>&gt;</span></span><br><span class="line">                and status = #&#123;status&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;gt;</span> #&#123;begin&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;end != null&quot;</span>&gt;</span></span><br><span class="line">                and order_time <span class="symbol">&amp;lt;</span> #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å“åº”ç»“æœ:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230912092915.png" alt="20230912092915"></p>
<p><em>å°±æ˜¯æ•°æ®æœ‰ç‚¹å°‘</em></p>
<h2 id="ç”¨æˆ·ç»Ÿè®¡"><a href="#ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="ç”¨æˆ·ç»Ÿè®¡"></a>ç”¨æˆ·ç»Ÿè®¡</h2><p>ä¸šåŠ¡è§„åˆ™</p>
<ol>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè¥ä¸šé¢æ•°æ®,xè½´ä¸ºæ—¥æœŸ,yè½´ä¸ºç”¨æˆ·æ•°é‡</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´,å±•ç¤ºæ¯å¤©çš„ç”¨æˆ·æ€»é‡å’Œæ–°å¢ç”¨æˆ·é‡æ•°æ®</li>
</ol>
<p>è¿™é‡Œçš„æ—¥æœŸé€‰æ‹©å™¨æ˜¯å…¨å±€çš„,ä¼šåŒæ—¶æ”¹å˜<code>è¥ä¸šé¢ç»Ÿè®¡,ç”¨æˆ·ç»Ÿè®¡,è®¢å•ç»Ÿè®¡,é”€é‡æ’åTop10</code>çš„æ•°æ®<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230912095011.png" alt="20230912095011"></p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ç”¨æˆ·ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserReportVO&gt; <span class="title function_">userStatistics</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">                                               <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·ç»Ÿè®¡ï¼š&#123;&#125;,&#123;&#125;&quot;</span>, begin, end);</span><br><span class="line">        <span class="type">UserReportVO</span> <span class="variable">userReportVO</span> <span class="operator">=</span> reportService.userStatistics(begin, end);</span><br><span class="line">        <span class="keyword">return</span> Result.success(userReportVO);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,è·Ÿä¸Šé¢çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯å¤šäº†ä¸€ä¸ªé›†åˆ,ç„¶åå°è£…é›†åˆçš„æ–¹å¼ä¸å¤ªä¸€æ ·,sqlä¸å¤ªä¸€æ ·</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserReportVO <span class="title function_">userStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¦è·å–å½“å¤©æ–°å¢çš„ç”¨æˆ·é‡ï¼Œå½“å¤©æ€»ç”¨æˆ·é‡ï¼Œä»¥åŠæ—¥æœŸçš„æ—¶é—´æ®µï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">        List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        dateList.add(begin);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!begin.equals(end)) &#123;</span><br><span class="line">            begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">            dateList.add(begin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿™æ ·å°±å¾—åˆ°äº†æ—¥æœŸçš„é›†åˆ</span></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; newUserList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; totalUserList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// é‚£æ–°å¢çš„ç”¨æˆ·/ç”¨æˆ·æ€»é‡æ€ä¹ˆæ±‚å‘¢</span></span><br><span class="line">        <span class="comment">// select count(id) from user where create_time &lt; end and createTime &gt; begin</span></span><br><span class="line">        <span class="comment">// select count(id) from user where create_time &lt; end</span></span><br><span class="line">        <span class="keyword">for</span> (LocalDate localDate : dateList) &#123;</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MIN);</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MAX);</span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">            map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">            totalUserList.add(userMapper.countByMap(map));</span><br><span class="line">            map.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">            newUserList.add(userMapper.countByMap(map));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UserReportVO.builder()</span><br><span class="line">                .dateList(StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .newUserList(StringUtils.join(newUserList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .totalUserList(StringUtils.join(totalUserList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapper</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;countByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from user</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;end != null&quot;</span>&gt;</span></span><br><span class="line">                and create_time <span class="symbol">&amp;lt;</span> #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null&quot;</span>&gt;</span></span><br><span class="line">                and create_time <span class="symbol">&amp;gt;</span> #&#123;begin&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="è®¢å•ç»Ÿè®¡"><a href="#è®¢å•ç»Ÿè®¡" class="headerlink" title="è®¢å•ç»Ÿè®¡"></a>è®¢å•ç»Ÿè®¡</h2><p>è¿™å‡ ä¸ªæ¥å£è¯´å®è¯éƒ½ä¸éš¾.</p>
<p>äº§å“åŸå‹:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230912174101.png" alt="20230912174101"></p>
<p>ä¸šåŠ¡è§„åˆ™</p>
<ol>
<li>çŠ¶æ€ä¸ºå·²å®Œæˆçš„æ˜¯æœ‰æ•ˆè®¢å•</li>
<li>xè½´ä¾ç„¶æ˜¯æ—¥æœŸ</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´,å±•ç¤ºæ¯å¤©çš„è®¢å•æ€»æ•°å’Œæœ‰æ•ˆè®¢å•æ•°</li>
<li>å±•ç¤ºæ‰€é€‰æ—¶é—´åŒºé—´å†…çš„æœ‰æ•ˆè®¢å•æ•°,æ€»è®¢å•æ•°,è®¢å•å®Œæˆç‡,è®¢å•å®Œæˆç‡&#x3D;æœ‰æ•ˆè®¢å•æ•°&#x2F;æ€»è®¢å•æ•°*100%</li>
</ol>
<p>æå–äº†ä¸€ä¸ªå…¬ç”¨çš„æ–¹æ³•,ç”¨æ¥æ ¹æ®å‰ç«¯ä¼ æ¥çš„æ—¥æœŸåŒºé—´æ¥è·å–æ—¥æœŸåˆ—è¡¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;LocalDate&gt; <span class="title function_">getLocalDateList</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">    List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    dateList.add(begin);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!begin.equals(end)) &#123;</span><br><span class="line">        begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">        dateList.add(begin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dateList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ordersStatistics&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¢å•ç»Ÿè®¡&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;OrderReportVO&gt; <span class="title function_">orderStatistics</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">                                                 <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¢å•ç»Ÿè®¡ï¼š&#123;&#125;,&#123;&#125;&quot;</span>, begin, end);</span><br><span class="line">        <span class="type">OrderReportVO</span> <span class="variable">orderReportVO</span> <span class="operator">=</span> reportService.orderStatistics(begin, end);</span><br><span class="line">        <span class="keyword">return</span> Result.success(orderReportVO);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,åˆšå¼€å§‹å†™çš„æ˜¯æ²¡æœ‰æå–å‡ºä¸€ä¸ªæ–¹æ³•æ¥æŸ¥è¯¢æ•°æ®åº“çš„,æ‰€ä»¥æ˜¯è‡ªå·±å°è£…mapæ¥å®ç°çš„æ¡ä»¶,è€Œæ–°çš„æ˜¯å®šä¹‰ä¸€ä¸ªæ–¹æ³•,ä¼ å…¥ä¸‰ä¸ªå‚æ•°(begin,end,status),ç„¶ååœ¨æ–¹æ³•ä¸­å®šä¹‰map,æœ€åæŸ¥è¯¢æ—¶èƒ½æ ¹æ®ä¼ å…¥çš„å‚æ•°è¿›è¡ŒåŠ¨æ€æŸ¥è¯¢,<strong>è¿™æ ·èƒ½å°‘äº›å¥½å¤šè¡Œä»£ç å“</strong>,è€Œä¸”æ€»æ•°é‡é‚£ä¸¤ä¸ªæ˜¯ä¸è¦ç”¨æŸ¥æ•°æ®åº“çš„.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderReportVO <span class="title function_">orderStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;LocalDate&gt; dateList = getLocalDateList(begin, end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾—åˆ°æ—¥æœŸé›†åˆ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¦æ±‚çš„æ•°æ®ï¼šæœ‰æ•ˆè®¢å•æ€»æ•°  è®¢å•æ€»æ•° æ¥å¾—åˆ°å®Œæˆç‡  è®¢å•æ•°åˆ—è¡¨ æœ‰æ•ˆè®¢å•æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">// select count(id) from orders where status = ? and order_time &lt; ?  and order_time &gt;?</span></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; orderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; validOrderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (LocalDate localDate : dateList) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®æ—¥æœŸï¼Œå¾—åˆ°è¯¥æ—¥æœŸçš„è®¢å•æ€»æ•°å’Œæœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MIN);</span><br><span class="line">            <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(localDate, LocalTime.MAX);</span><br><span class="line">            <span class="comment">// æ²¡æœ‰çŠ¶æ€æ¡ä»¶ï¼ŒæŸ¥çš„æ˜¯è¯¥æ—¥æœŸçš„æ‰€æœ‰è®¢å•çš„æ•°é‡</span></span><br><span class="line">            orderCountList.add(getOrderCount(beginTime, endTime, <span class="literal">null</span>));</span><br><span class="line">            <span class="comment">// æŸ¥çš„æ˜¯è¯¥æ—¥æœŸçš„æœ‰æ•ˆè®¢å•æ•°é‡</span></span><br><span class="line">            validOrderCountList.add(getOrderCount(beginTime, endTime, Orders.COMPLETED));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä¸æŸ¥æ•°æ®åº“ï¼Œè€Œå»éå†é›†åˆï¼Œå³å¯å¾—åˆ°åŒºé—´å†…çš„è®¢å•æ€»æ•°é‡å’Œæœ‰æ•ˆè®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">         * ä½¿ç”¨Streamæµæ›´ç®€å•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">/*Integer totalOrderCount = 0;</span></span><br><span class="line"><span class="comment">        for (Integer i : orderCountList) &#123;</span></span><br><span class="line"><span class="comment">            totalOrderCount += i;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        Integer validOrderCount = 0;</span></span><br><span class="line"><span class="comment">        for (Integer i : validOrderCountList) &#123;</span></span><br><span class="line"><span class="comment">            validOrderCount += i;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">// streamæµçš„å½¢å¼ï¼Œåªéœ€è¦ä¸¤è¡Œ</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalOrderCount</span> <span class="operator">=</span> orderCountList.stream().reduce(Integer::sum).get();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> validOrderCountList.stream().reduce(Integer::sum).get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¢å•å®Œæˆç‡ è¿™é‡Œåˆæ²¡æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯æ€»è®¢å•æ•°ä¸º0çš„æƒ…å†µ</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (totalOrderCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            orderCompletionRate = (validOrderCount / totalOrderCount.doubleValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OrderReportVO.builder()</span><br><span class="line">                .dateList(StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .totalOrderCount(totalOrderCount)</span><br><span class="line">                .validOrderCount(validOrderCount)</span><br><span class="line">                .orderCountList(StringUtils.join(orderCountList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .validOrderCountList(StringUtils.join(validOrderCountList, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .orderCompletionRate(orderCompletionRate)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer <span class="title function_">getOrderCount</span><span class="params">(LocalDateTime beginTime, LocalDateTime endTime, Integer status)</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">timeMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        timeMap.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">        timeMap.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">        timeMap.put(<span class="string">&quot;status&quot;</span>, status);</span><br><span class="line">        <span class="keyword">return</span> orderMapper.countOrderByMap(timeMap);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="é”€é‡æ’åTop10"><a href="#é”€é‡æ’åTop10" class="headerlink" title="é”€é‡æ’åTop10"></a>é”€é‡æ’åTop10</h2><p>é”€é‡æ’å,è¿™ä¸ªä¸œè¥¿</p>
<p>ä¸šåŠ¡è§„åˆ™</p>
<ol>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´,å±•ç¤ºé”€é‡å‰10çš„å•†å“(åŒ…æ‹¬èœå“å’Œå¥—é¤),è¿™ä¸ªå’Œä¹‹å‰çš„æ—¶é—´é€‰æ‹©ä¹Ÿå·®ä¸å¤š</li>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŸ±çŠ¶å›¾é™åºå±•ç¤ºå•†å“é”€é‡</li>
<li>æ­¤å¤„çš„é”€é‡ä¸ºå•†å“é”€å”®çš„ä»½æ•°</li>
</ol>
<p><strong>é”€é‡æ€ä¹ˆç®—?</strong></p>
<p><strong>åœ¨<code>order_detail</code>è¡¨ä¸­æ ¹æ®<code>dish_id</code>å’Œ<code>setmeal_id</code>æ¥ç®—</strong></p>
<p>è¿™æ ·çš„sql?<code>select count(id) from order_detail where dish_id = ?</code></p>
<p>çš„ç¡®èƒ½æŸ¥,ä½†æ˜¯è¿™ä¹ˆå¤šèœå“å‘¢,æ€»ä¸èƒ½å…¨éƒ¨æŸ¥ä¸€éå§?,è€Œä¸”è¦çš„æ˜¯èœå“çš„åå­—å’Œæ•°é‡</p>
<p>è€Œä¸”è¿˜ä¸å¯¹,å› ä¸º<code>order_detail</code>è¡¨ä¸­è¿˜æœ‰ä¸€ä¸ªå­—æ®µæ˜¯<code>number</code>,è¡¨ç¤ºæ•°é‡</p>
<p>!è€Œä¸”,è¿˜æœ‰å°±æ˜¯è®¢å•å¦‚æœæ˜¯æœªå®Œæˆçš„,é‚£ä¹ˆè¿™ä¸ªæ•°æ®ä¹Ÿéœ€è¦è¿›è¡Œç­›é€‰</p>
<p>æœ€ç»ˆçš„å®ç°æ–¹å¼:<strong>é€šè¿‡ä¸€ä¸ªå¤šè¡¨è”æŸ¥,åŒæ—¶æŸ¥orderå’Œorder_detailä¸¤ä¸ªè¡¨,æŸ¥è¯¢åç§°å’Œå¯¹åº”çš„æ•°é‡,<code>od.name,sum(od.number) number</code></strong>,ç„¶åé€šè¿‡<code>group by</code>è¿›è¡Œåˆ†ç»„,å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ³›å‹ä¸º<code>GoodsSalesDTO</code>çš„é›†åˆ,è¿™ä¸ªGoodsSalesDTOæœ‰ä¸¤ä¸ªå­—æ®µ,åˆ†åˆ«æ˜¯Stringç±»å‹çš„nameå’ŒIntegerç±»å‹çš„number,åˆšå¥½å¯ä»¥å°è£…æŸ¥å‡ºæ¥çš„æ•°æ®,åˆå› ä¸ºæœ‰å¾ˆå¤šçš„æ¡,æ‰€ä»¥æ˜¯ä¸€ä¸ªé›†åˆ,æœ€åå–å‡ºé›†åˆä¸­çš„nameå’Œnumber,è¿›è¡Œæ‹¼æ¥å­—ç¬¦ä¸²</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/top10&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;é”€é‡æ’å&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;SalesTop10ReportVO&gt; <span class="title function_">getTop10</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">                                           <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;é”€é‡æ’åï¼š&#123;&#125;,&#123;&#125;&quot;</span>, begin, end);</span><br><span class="line">    <span class="type">SalesTop10ReportVO</span> <span class="variable">salesTop10ReportVO</span> <span class="operator">=</span> reportService.getTop10(begin, end);</span><br><span class="line">    <span class="keyword">return</span> Result.success(salesTop10ReportVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service,è¿™ä¸ªStreamæµçœ‹èµ·æ¥å°±æ˜¯å¾ˆå¥½ç”¨å•Š.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”€é‡å‰å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SalesTop10ReportVO <span class="title function_">getTop10</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(begin, LocalTime.MIN);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(end, LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">        List&lt;GoodsSalesDTO&gt; top10List = orderMapper.getTop10(beginTime, endTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä½¿ç”¨Streamæµå¤„ç†</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;String&gt; names = top10List.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList());</span><br><span class="line">        <span class="type">String</span> <span class="variable">nameList</span> <span class="operator">=</span> StringUtils.join(names, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        List&lt;Integer&gt; numbers = top10List.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList());</span><br><span class="line">        <span class="type">String</span> <span class="variable">numberList</span> <span class="operator">=</span> StringUtils.join(numbers, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SalesTop10ReportVO.builder()</span><br><span class="line">                .nameList(nameList)</span><br><span class="line">                .numberList(numberList)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç®—æ˜¯æå®Œäº†,åˆšæ‰æµ‹è¯•æ‰å‘ç°ä¹‹å‰å†™çš„æ’å…¥è®¢å•æ˜ç»†æœ‰é—®é¢˜,å°‘æ’å…¥äº†ä¸€ä¸ªnumber,æ‰€ä»¥æ‰€æœ‰çš„èœå“æ•°é‡éƒ½æ˜¯1..</p>
<h1 id="13-æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨"><a href="#13-æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨" class="headerlink" title="13 æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨"></a>13 æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨</h1><h2 id="å·¥ä½œå°æ¥å£"><a href="#å·¥ä½œå°æ¥å£" class="headerlink" title="å·¥ä½œå°æ¥å£"></a>å·¥ä½œå°æ¥å£</h2><p>å·¥ä½œå°,å°±æ˜¯è¿›å…¥åå°ç®¡ç†åçš„ç¬¬ä¸€ä¸ªé¡µé¢</p>
<p>çœ‹ç€æ¥å£æ–‡æ¡£å†™ä¸€éå§</p>
<p>æ²¡å•¥éš¾çš„,å†™å®Œäº†å·²ç».</p>
<p>ç›´æ¥å…¨æ”¾ç€:</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-13 15:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/workspace&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å·¥ä½œå°æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkSpaceController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WorkSpaceService workSpaceService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/businessData&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;BusinessDataVO&gt; <span class="title function_">businessData</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="type">BusinessDataVO</span> <span class="variable">businessDataVO</span> <span class="operator">=</span> workSpaceService.businessData();</span><br><span class="line">        <span class="keyword">return</span> Result.success(businessDataVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewSetmeals&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢å¥—é¤æ€»è§ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;SetmealOverViewVO&gt; <span class="title function_">overviewSetmeals</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢å¥—é¤æ€»è§ˆ&quot;</span>);</span><br><span class="line">        <span class="type">SetmealOverViewVO</span> <span class="variable">setmealOverViewVO</span> <span class="operator">=</span> workSpaceService.overviewSetmeals();</span><br><span class="line">        <span class="keyword">return</span> Result.success(setmealOverViewVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewDishes&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢èœå“æ€»è§ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;DishOverViewVO&gt; <span class="title function_">overviewDishes</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢å¥—é¤æ€»è§ˆ&quot;</span>);</span><br><span class="line">        <span class="type">DishOverViewVO</span> <span class="variable">dishOverViewVO</span> <span class="operator">=</span> workSpaceService.overviewDishes();</span><br><span class="line">        <span class="keyword">return</span> Result.success(dishOverViewVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/overviewOrders&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è®¢å•ç®¡ç†&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;OrderOverViewVO&gt; <span class="title function_">overviewOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">OrderOverViewVO</span> <span class="variable">orderOverViewVO</span> <span class="operator">=</span> workSpaceService.overviewOrder();</span><br><span class="line">        <span class="keyword">return</span> Result.success(orderOverViewVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zzmr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-09-13 15:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkSpaceServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">WorkSpaceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æŸ¥è¯¢ä»Šæ—¥è¿è¥æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BusinessDataVO <span class="title function_">businessData</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä»Šæ—¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ—¥æœŸçš„æ•°æ®</span></span><br><span class="line"><span class="comment">         * è¿™æ ·å°±æ‹¿åˆ°äº†ä»Šå¤©çš„æ—¶é—´åŒºé—´</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDateTime.of(LocalDate.now(), LocalTime.MIN);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">end</span> <span class="operator">=</span> LocalDateTime.of(LocalDate.now(), LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * éœ€è¦çš„æ•°æ®</span></span><br><span class="line"><span class="comment">         * newUsers æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line"><span class="comment">         * orderCompletionRate è®¢å•å®Œæˆç‡</span></span><br><span class="line"><span class="comment">         * turnover è¥ä¸šé¢</span></span><br><span class="line"><span class="comment">         * unitPrice å¹³å‡å®¢å•ä»·</span></span><br><span class="line"><span class="comment">         * validOrderCount æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. newUsers</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;begin&quot;</span>, begin);</span><br><span class="line">        map.put(<span class="string">&quot;end&quot;</span>, end);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">newUser</span> <span class="operator">=</span> userMapper.countByMap(map); <span class="comment">// å¯ä»¥ç›´æ¥ç”¨ä¹‹å‰å†™çš„åŠ¨æ€sql</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. orderCompletionRate</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">orderCount</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (orderCount != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸æ˜¯é›¶ï¼Œå†é™¤</span></span><br><span class="line">            orderCompletionRate = validOrderCount / orderCount.doubleValue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. turnover å½“å¤©æ‰€æœ‰è®¢å•çš„æ€»é¢ è¿˜æ˜¯ç”¨ä¹‹å‰çš„mapper</span></span><br><span class="line">        <span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map);</span><br><span class="line">        <span class="comment">// æ²¡è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå½“turnoverä¸º0æ—¶è¦èµ‹å€¼0.0ï¼Œä¸ç„¶æ˜¯ç©ºçš„</span></span><br><span class="line">        turnover = turnover == <span class="literal">null</span> ? <span class="number">0.0</span> : turnover;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. unitPrice  å¹³å‡å®¢å•ä»· è¦æœ‰å½“å¤©ä¸‹å•çš„ç”¨æˆ·é‡ï¼Œç„¶åæ‹¿ä¸Šé¢çš„æ€»é¢ä¸€é™¤å°±å®Œäº†</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">totalOrderUser</span> <span class="operator">=</span> orderMapper.getDistinctUser(map);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">unitPrice</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (totalOrderUser != <span class="number">0</span>) &#123;</span><br><span class="line">            unitPrice = turnover / totalOrderUser.doubleValue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BusinessDataVO.builder()</span><br><span class="line">                .validOrderCount(validOrderCount)</span><br><span class="line">                .orderCompletionRate(orderCompletionRate)</span><br><span class="line">                .newUsers(newUser)</span><br><span class="line">                .turnover(turnover)</span><br><span class="line">                .unitPrice(unitPrice)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SetmealOverViewVO <span class="title function_">overviewSetmeals</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¥—é¤æ€»è§ˆ 1. å·²åœå”®å¥—é¤æ•°é‡  2. å·²å¯å”®å¥—é¤æ•°é‡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// å¯å”®</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">startCount</span> <span class="operator">=</span> setmealMapper.getCountByStatus(StatusConstant.ENABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">stopCount</span> <span class="operator">=</span> setmealMapper.getCountByStatus(StatusConstant.DISABLE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SetmealOverViewVO.builder().sold(startCount).discontinued(stopCount).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DishOverViewVO <span class="title function_">overviewDishes</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">startCount</span> <span class="operator">=</span> dishMapper.getCountByStatus(StatusConstant.ENABLE);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">stopCount</span> <span class="operator">=</span> dishMapper.getCountByStatus(StatusConstant.DISABLE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> DishOverViewVO.builder().sold(startCount).discontinued(stopCount).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æ€»è§ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderOverViewVO <span class="title function_">overviewOrder</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">allOrders</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.TO_BE_CONFIRMED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">waitingOrders</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.CONFIRMED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">deliveredOrders</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">completedOrders</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, Orders.CANCELLED);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">cancelledOrders</span> <span class="operator">=</span> orderMapper.countOrderByMap(map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OrderOverViewVO.builder()</span><br><span class="line">                .allOrders(allOrders)</span><br><span class="line">                .cancelledOrders(cancelledOrders)</span><br><span class="line">                .completedOrders(completedOrders)</span><br><span class="line">                .deliveredOrders(deliveredOrders)</span><br><span class="line">                .waitingOrders(waitingOrders)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ä½“æ¥è¯´è¿˜æ˜¯å¾ˆç®€å•çš„.</p>
<p><em>å°±æ˜¯å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢å°è£…æ•°æ®æŸ¥è¯¢</em></p>
<h2 id="Apache-POI"><a href="#Apache-POI" class="headerlink" title="Apache POI"></a>Apache POI</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>Apache POIæ˜¯ä¸€ä¸ªå¤„ç†Miscrosoft Officeå„ç§æ–‡ä»¶æ ¼å¼çš„å¼€æºé¡¹ç›®,æˆ‘ä»¬å¯ä»¥ç”¨POIåœ¨javaç¨‹åºä¸­å¯¹Miscrosoft Officeå„ç§æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œ</p>
<p><strong>ä¸€èˆ¬æƒ…å†µä¸‹,POIéƒ½æ˜¯ç”¨äºæ“ä½œExcelæ–‡ä»¶</strong></p>
<hr>
<p>åº”ç”¨åœºæ™¯:</p>
<ol>
<li>é“¶è¡Œç½‘é“¶ç³»ç»Ÿå¯¼å‡ºäº¤æ˜“æ˜ç»†</li>
<li>å„ç§ä¸šåŠ¡ç³»ç»Ÿå¯¼å‡ºExcelæŠ¥è¡¨</li>
<li>æ‰¹é‡å¯¼å…¥ä¸šåŠ¡æ•°æ®</li>
</ol>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>å¯¼å…¥ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- poi --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å†™æ“ä½œæµ‹è¯•ç±»,åŸºæœ¬è¯­æ³•å°±æ˜¯</p>
</blockquote>
<ol>
<li>åˆ›å»ºExcelå¯¹è±¡<code>new XSSFWorkbook</code></li>
<li>æ ¹æ®excelå¯¹è±¡åˆ›å»ºé¡µsheet</li>
<li>æ ¹æ®sheetåˆ›å»ºè¡Œ</li>
<li>æ ¹æ®rowåˆ›å»ºå•å…ƒæ ¼,å¹¶ç»™å•å…ƒæ ¼ç½®å…¥æ•°æ®</li>
<li>æ³¨æ„,è¡Œå’Œå•å…ƒæ ¼çš„ä¸‹æ ‡éƒ½æ˜¯ä»0å¼€å§‹çš„.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POITest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åœ¨å†…å­˜ä¸­åˆ›å»ºçš„æ–‡ä»¶</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.createSheet(<span class="string">&quot;info&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨sheeté¡µä¸­åˆ›å»ºè¡Œå¯¹è±¡ å‚æ•°ï¼Œä¸ºç¬¬å‡ è¡Œ ä»é›¶å¼€å§‹</span></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå•å…ƒæ ¼å¹¶å†™å…¥æ–‡ä»¶å†…å®¹</span></span><br><span class="line">        row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å§“å&quot;</span>);</span><br><span class="line">        row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŸå¸‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°çš„ä¸€è¡Œ</span></span><br><span class="line">        row = sheet.createRow(<span class="number">2</span>);</span><br><span class="line">        row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;æ¨æŸ&quot;</span>);</span><br><span class="line">        row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;æ±‰ä¸­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        row = sheet.createRow(<span class="number">3</span>);</span><br><span class="line">        row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å‘¨æŸ&quot;</span>);</span><br><span class="line">        row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;è‹å·&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å…¥åˆ°ç£ç›˜ä¸­</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\info.xlsx&quot;</span>));</span><br><span class="line">        excel.write(out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">        excel.close();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        write();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>è¯»æ“ä½œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡POIè¯»å–excelä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// è¯»å–ç£ç›˜ä¸Šçš„excelæ–‡ä»¶</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;E:\\info.xlsx&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»å–excelä¸­çš„ç¬¬ä¸€ä¸ªsheeté¡µ</span></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheetAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾—åˆ°æœ€åçš„è¡Œå·ï¼Œæœ€åæœ‰æ•°æ®çš„è¡Œå·</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">lastRowNum</span> <span class="operator">=</span> sheet.getLastRowNum();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= lastRowNum; i++) &#123;</span><br><span class="line">            <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(i);</span><br><span class="line">            <span class="comment">// è·å¾—å•å…ƒæ ¼å¯¹è±¡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cellValue1</span> <span class="operator">=</span> row.getCell(<span class="number">1</span>).getStringCellValue();</span><br><span class="line">            <span class="type">String</span> <span class="variable">cellValue2</span> <span class="operator">=</span> row.getCell(<span class="number">2</span>).getStringCellValue();</span><br><span class="line">            System.out.println(cellValue1 + <span class="string">&quot; &quot;</span> + cellValue2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ˜¯éå¸¸æ˜“æ‡‚<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230913173631.png" alt="20230913173631"></p>
<h2 id="å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"><a href="#å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨" class="headerlink" title="å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨"></a>å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</h2><p>æŠ¥è¡¨å½¢å¼:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230913191943.png" alt="20230913191943"></p>
<p>ä¸šåŠ¡è§„åˆ™</p>
<ol>
<li>å¯¼å‡ºExcelå½¢å¼çš„æŠ¥è¡¨æ–‡ä»¶</li>
<li>åˆ°å¤„æœ€è¿‘30å¤©çš„è¿è¥æ•°æ®</li>
</ol>
<p>å½“å‰æ¥å£æ˜¯æ²¡æœ‰è¿”å›æ•°æ®çš„,å› ä¸ºæŠ¥è¡¨çš„æœ¬è´¨æ˜¯æ–‡ä»¶ä¸‹è½½,æœåŠ¡ç«¯ä¼šé€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</p>
<hr>
<p>å…ˆåˆ›å»ºè¿™ä¸ªExcelæ–‡ä»¶,é‚£ä¹ˆé—®é¢˜å°±æ¥äº†,è¿™ä¸ªè¡¨æ ¼æœ‰èƒŒæ™¯,æœ‰å­—å·çš„åŒºåˆ«,è¿˜æœ‰åˆå¹¶å•å…ƒæ ¼,ç”¨POIæ˜¯å¯ä»¥å®ç°çš„,ä½†æ˜¯éå¸¸éº»çƒ¦,<strong>åœ¨çœŸæ­£çš„é¡¹ç›®ä¸­,æ˜¯å…ˆæŠŠè¡¨æ ¼çš„æ ·å¼å®šå¥½,ç„¶åè¯»å–è¿™ä¸ªè¡¨æ ¼,æœ€åä¿®æ”¹æŒ‡å®šä½ç½®çš„æ•°æ®å³å¯</strong></p>
<p>ç„¶åå°±æ˜¯æŸ¥è¯¢è¿‘30å¤©çš„æ•°æ®,é€šè¿‡POIå†™å…¥æ•°æ®,å†é€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</p>
<blockquote>
<p>Controller</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å¯¼å‡ºexcel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    reportService.exportBusiness(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Service,ä¹Ÿå°±æ˜¯åˆ†æˆä¸‰æ­¥</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å‡ºæŠ¥è¡¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportBusiness</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. æŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—åˆ°ç›¸åº”çš„æ•°æ®</span></span><br><span class="line"><span class="comment">         * æ•°æ®æœ‰ï¼Œè¥ä¸šé¢ï¼Œè®¢å•å®Œæˆç‡ï¼Œæ–°å¢ç”¨æˆ·æ•°ï¼Œæœ‰æ•ˆè®¢å•ï¼Œå¹³å‡å®¢å•ä»·</span></span><br><span class="line"><span class="comment">         * æ˜ç»†æ•°æ®å°±æ˜¯æ¯ä¸€å¤©çš„ä»¥ä¸Šæ•°æ®</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// å¾€å‰å€’30å¤©</span></span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">dateBegin</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">30</span>);</span><br><span class="line">        <span class="comment">// æˆªè‡³è‡³æ˜¨å¤©</span></span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">dateEnd</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬åŒ–ä¸ºLocalDateTime</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDateTime.of(dateBegin, LocalTime.MIN);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">end</span> <span class="operator">=</span> LocalDateTime.of(dateEnd, LocalTime.MAX);</span><br><span class="line">        <span class="comment">// voä¸­å°±æœ‰éœ€è¦çš„æ¦‚è§ˆæ•°æ®äº†</span></span><br><span class="line">        <span class="type">BusinessDataVO</span> <span class="variable">businessDataVO</span> <span class="operator">=</span> workSpaceService.businessData(begin, end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å°†æ•°æ®å†™å…¥åˆ°excelæ–‡ä»¶ä¸­ -- åŸºäºæ¨¡æ¿æ–‡ä»¶æ¥å®ç°</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;template/è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(in);</span><br><span class="line">            <span class="comment">// å¡«å……æ•°æ®-æ—¶é—´</span></span><br><span class="line">            <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheetAt(<span class="number">0</span>);</span><br><span class="line">            sheet.getRow(<span class="number">1</span>).getCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;æ—¶é—´: &quot;</span> + dateBegin + <span class="string">&quot;è‡³&quot;</span> + dateEnd);</span><br><span class="line">            <span class="comment">// å¡«å……æ¦‚è§ˆæ•°æ®</span></span><br><span class="line">            sheet.getRow(<span class="number">3</span>).getCell(<span class="number">2</span>).setCellValue(businessDataVO.getTurnover());</span><br><span class="line">            sheet.getRow(<span class="number">3</span>).getCell(<span class="number">4</span>).setCellValue(businessDataVO.getOrderCompletionRate());</span><br><span class="line">            sheet.getRow(<span class="number">3</span>).getCell(<span class="number">6</span>).setCellValue(businessDataVO.getNewUsers());</span><br><span class="line">            sheet.getRow(<span class="number">4</span>).getCell(<span class="number">2</span>).setCellValue(businessDataVO.getValidOrderCount());</span><br><span class="line">            sheet.getRow(<span class="number">4</span>).getCell(<span class="number">4</span>).setCellValue(businessDataVO.getUnitPrice());</span><br><span class="line">            <span class="comment">// æ˜ç»†æ•°æ®å‘¢.è¿˜æ˜¯é€šè¿‡ä¸Šé¢çš„workSpaceService,åªä¸è¿‡æ—¶é—´è¦å˜ä¸€å˜</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> dateBegin.plusDays(i);</span><br><span class="line">                <span class="comment">// å½“å¤©çš„æ•°æ®</span></span><br><span class="line">                begin = LocalDateTime.of(date, LocalTime.MIN);</span><br><span class="line">                end = LocalDateTime.of(date, LocalTime.MAX);</span><br><span class="line">                <span class="type">BusinessDataVO</span> <span class="variable">businessData</span> <span class="operator">=</span> workSpaceService.businessData(begin, end);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ¯ä¸€å¤©çš„æ•°æ®å°è£…ä¸€é è¿™é‡Œå€ŸåŠ©ä¸€ä¸‹i,å› ä¸ºç¬¬ä¸€æ¡æ•°æ®å°±æ˜¯åœ¨ç¬¬8è¡Œ,è€Œiçš„å€¼æœ€å¼€å§‹æ˜¯0</span></span><br><span class="line">                <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(i + <span class="number">7</span>);</span><br><span class="line">                row.getCell(<span class="number">1</span>).setCellValue(date.toString());</span><br><span class="line">                row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">                row.getCell(<span class="number">3</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">                row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">                row.getCell(<span class="number">5</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line">                row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. é€šè¿‡è¾“å‡ºæµä¸‹è½½åˆ°æµè§ˆå™¨</span></span><br><span class="line">            <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">            excel.write(outputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">            outputStream.close();</span><br><span class="line">            excel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>2023å¹´9æœˆ13æ—¥ 21ç‚¹53åˆ†</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="å¤´åƒ"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" title="å¤´åƒ" alt="å¤´åƒ"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" title="å¤´åƒ" alt="å¤´åƒ"></a><div class="post-copyright__author_name">Jimmy</div><div class="post-copyright__author_desc">æ¡ƒä¹‹å¤­å¤­ï¼Œç¼ç¼å…¶å</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®" href="https://jimmy66886.github.io/posts/4fa256c6.html">åŸåˆ›</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://jimmy66886.github.io/posts/4fa256c6.html')">è‹ç©¹å¤–å–</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="èµèµä½œè€…"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>æ‰“èµä½œè€…</div><div class="reward-main"><div class="reward-all"><span class="reward-title">æ„Ÿè°¢ä½ èµäºˆæˆ‘å‰è¿›çš„åŠ›é‡</span><ul class="reward-group"><li class="reward-item"><a href="https://img01.zzmr.club/img/chatpay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/chatpay.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://img01.zzmr.club/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/alipay.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">èµèµè€…åå•</div><div class="reward-dec">å› ä¸ºä½ ä»¬çš„æ”¯æŒè®©æˆ‘æ„è¯†åˆ°å†™æ–‡ç« çš„ä»·å€¼ğŸ™</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« "><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://jimmy66886.github.io/posts/4fa256c6.html"></div><div class="reward-dec">ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« </div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=è‹ç©¹å¤–å–&amp;url=https://jimmy66886.github.io/posts/4fa256c6.html&amp;pic=https://img01.zzmr.club/img/sky-take-out.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="å¤åˆ¶é“¾æ¥" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://jimmy66886.github.io" target="_blank">ZZMR</a>ï¼</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>è‹ç©¹å¤–å–<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img01.zzmr.club/img/logo (4).png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/ed8fc0b2.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/20230824205147.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Hexo Algoliaé…ç½®</div></div></a></div><div class="next-post pull-right"><a href="/posts/c5dbbdfe.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/å±å¹•æˆªå›¾329.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">MySqlæ­å»ºä¸»ä»å¤åˆ¶-è¯»å†™åˆ†ç¦»</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> è¯„è®º</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">åŒ¿åè¯„è®º</a><a href="/privacy" style="margin-left: 4px">éšç§æ”¿ç­–</a></div><div class="comment-tips" id="comment-tips"><span>âœ… ä½ æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¯„è®ºä»¥è·å–æœ€ä½³å±•ç¤ºæ•ˆæœ</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar" title="ç‚¹å‡»å±•å¼€"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">éƒ½æ˜¯å­¦ä¹ ç¬”è®°å’Œç”Ÿæ´»çäº‹<b style="color:#fff"></b><b style="color:#fff">è¡Œä¹‹æ‰€å‘,å³å¿ƒä¹‹æ‰€å‘</b><b style="color:#fff"></b></div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff"></b><b style="color:#fff"></b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Jimmy</h1><div class="author-info__desc">æ¡ƒä¹‹å¤­å¤­ï¼Œç¼ç¼å…¶å</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/jimmy66886/" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>æ–‡ç« ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0-amp-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">1 é¡¹ç›®æ¦‚è¿°&amp;ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">å‰ç«¯ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">åç«¯ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">æ•°æ®åº“ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">1.4.</span> <span class="toc-text">å‰åç«¯è”è°ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.</span> <span class="toc-text">Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.</span> <span class="toc-text">å®Œå–„ç™»å½•åŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger"><span class="toc-number">1.7.</span> <span class="toc-text">Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.1.</span> <span class="toc-text">Swaggerå¸¸ç”¨æ³¨è§£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">2 å‘˜å·¥ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-number">2.1.</span> <span class="toc-text">æ–°å¢å‘˜å·¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.</span> <span class="toc-text">å‘˜å·¥åˆ†é¡µæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-x2F-%E7%A6%81%E7%94%A8%E5%91%98%E5%B7%A5%E8%B4%A6%E5%8F%B7"><span class="toc-number">2.3.</span> <span class="toc-text">å¯ç”¨&#x2F;ç¦ç”¨å‘˜å·¥è´¦å·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5"><span class="toc-number">2.4.</span> <span class="toc-text">ç¼–è¾‘å‘˜å·¥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">3 åˆ†ç±»ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.1.</span> <span class="toc-text">è®¾è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.2.</span> <span class="toc-text">æ¥å£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.1.</span> <span class="toc-text">æ–°å¢åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.2.</span> <span class="toc-text">åˆ†ç±»åˆ†é¡µæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.3.</span> <span class="toc-text">æ ¹æ®idåˆ é™¤åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.4.</span> <span class="toc-text">ä¿®æ”¹åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E7%A6%81%E7%94%A8%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.5.</span> <span class="toc-text">å¯ç”¨ç¦ç”¨åˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.6.</span> <span class="toc-text">æ ¹æ®ç±»å‹æŸ¥è¯¢åˆ†ç±»</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">4 èœå“ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">4.1.</span> <span class="toc-text">å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81"><span class="toc-number">4.2.</span> <span class="toc-text">æ–°å¢èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.1.</span> <span class="toc-text">æ–‡ä»¶ä¸Šä¼ æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.</span> <span class="toc-text">æ–°å¢èœå“æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8F%9C%E5%93%81%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.3.</span> <span class="toc-text">èœå“åˆ†é¡µæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%8F%9C%E5%93%81"><span class="toc-number">4.4.</span> <span class="toc-text">åˆ é™¤èœå“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="toc-number">4.5.</span> <span class="toc-text">ä¿®æ”¹èœå“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E6%9F%A5%E8%AF%A2%E8%8F%9C%E5%93%81"><span class="toc-number">4.5.1.</span> <span class="toc-text">æ ¹æ®idæŸ¥è¯¢èœå“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">ä¿®æ”¹èœå“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">5 å¥—é¤ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="toc-number">5.1.</span> <span class="toc-text">æ–°å¢å¥—é¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E9%A4%90%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.</span> <span class="toc-text">å¥—é¤åˆ†é¡µæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="toc-number">5.3.</span> <span class="toc-text">åˆ é™¤å¥—é¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A5%97%E9%A4%90"><span class="toc-number">5.4.</span> <span class="toc-text">ä¿®æ”¹å¥—é¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A5%97%E9%A4%90%E7%8A%B6%E6%80%81"><span class="toc-number">5.5.</span> <span class="toc-text">ä¿®æ”¹å¥—é¤çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%BA%97%E9%93%BA%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.</span> <span class="toc-text">6 åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-number">6.1.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%A4%8D%E4%B9%A0"><span class="toc-number">6.1.1.</span> <span class="toc-text">Rediså¤ä¹ ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E6%93%8D%E4%BD%9CRedis"><span class="toc-number">6.1.2.</span> <span class="toc-text">Javaæ“ä½œRedis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%97%E9%93%BA%E8%90%A5%E4%B8%9A%E7%8A%B6%E6%80%81%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.2.</span> <span class="toc-text">åº—é“ºè¥ä¸šçŠ¶æ€è®¾ç½®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-%E5%95%86%E5%93%81%E9%A2%84%E8%A7%88"><span class="toc-number">7.</span> <span class="toc-text">7 å¾®ä¿¡ç™»å½•-å•†å“é¢„è§ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpClient"><span class="toc-number">7.1.</span> <span class="toc-text">HttpClient</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81GET%E8%AF%B7%E6%B1%82"><span class="toc-number">7.1.1.</span> <span class="toc-text">å‘é€GETè¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81POST%E8%AF%B7%E6%B1%82"><span class="toc-number">7.1.2.</span> <span class="toc-text">å‘é€POSTè¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">7.1.3.</span> <span class="toc-text">å°è£…çš„å·¥å…·ç±»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91"><span class="toc-number">7.2.</span> <span class="toc-text">å¾®ä¿¡å°ç¨‹åºå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">7.2.1.</span> <span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="toc-number">7.3.</span> <span class="toc-text">å¯¼å…¥å°ç¨‹åºä»£ç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-number">7.4.</span> <span class="toc-text">å¾®ä¿¡ç™»å½•æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.5.</span> <span class="toc-text">æ¥å£è®¾è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-number">7.6.</span> <span class="toc-text">ä»£ç å¼€å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E9%A2%84%E8%A7%88"><span class="toc-number">7.7.</span> <span class="toc-text">å•†å“é¢„è§ˆ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E7%BC%93%E5%AD%98-%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">8.</span> <span class="toc-text">8 ç¼“å­˜-è´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81"><span class="toc-number">8.1.</span> <span class="toc-text">ç¼“å­˜èœå“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cache"><span class="toc-number">8.2.</span> <span class="toc-text">Spring Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">8.2.1.</span> <span class="toc-text">æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%A5%97%E9%A4%90"><span class="toc-number">8.3.</span> <span class="toc-text">ç¼“å­˜å¥—é¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">8.4.</span> <span class="toc-text">è´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">8.4.1.</span> <span class="toc-text">æ·»åŠ è´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">8.4.2.</span> <span class="toc-text">æŸ¥è¯¢è´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">8.4.3.</span> <span class="toc-text">æ¸…ç©ºè´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%80%E9%A1%B9"><span class="toc-number">8.4.4.</span> <span class="toc-text">åˆ é™¤ä¸€é¡¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95-%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-number">9.</span> <span class="toc-text">9 ç”¨æˆ·ä¸‹å•-è®¢å•æ”¯ä»˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%9C%B0%E5%9D%80%E7%B0%BF"><span class="toc-number">9.1.</span> <span class="toc-text">å¯¼å…¥åœ°å€ç°¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%9C%B0%E5%9D%80%E7%B0%BF"><span class="toc-number">9.1.1.</span> <span class="toc-text">ä¿å­˜åœ°å€ç°¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%B0%BF%E5%88%97%E8%A1%A8"><span class="toc-number">9.1.2.</span> <span class="toc-text">åœ°å€ç°¿åˆ—è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9C%B0%E5%9D%80%E7%B0%BF"><span class="toc-number">9.1.3.</span> <span class="toc-text">ä¿®æ”¹åœ°å€ç°¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">9.1.4.</span> <span class="toc-text">è®¾ç½®é»˜è®¤åœ°å€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">9.1.5.</span> <span class="toc-text">æŸ¥è¯¢é»˜è®¤åœ°å€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%9C%B0%E5%9D%80%E7%B0%BF"><span class="toc-number">9.1.6.</span> <span class="toc-text">åˆ é™¤åœ°å€ç°¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95"><span class="toc-number">9.2.</span> <span class="toc-text">ç”¨æˆ·ä¸‹å•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-number">9.3.</span> <span class="toc-text">è®¢å•æ”¯ä»˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.3.1.</span> <span class="toc-text">å¾®ä¿¡æ”¯ä»˜ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">9.3.2.</span> <span class="toc-text">å†…ç½‘ç©¿é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%BF%98%E5%AF%BC%E5%85%A5%E5%90%97"><span class="toc-number">9.3.3.</span> <span class="toc-text">ä»£ç è¿˜å¯¼å…¥å—?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86"><span class="toc-number">9.4.</span> <span class="toc-text">10 è®¢å•ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AB%AF%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-number">9.4.1.</span> <span class="toc-text">ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E5%AE%B6%E7%AB%AF%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">9.4.2.</span> <span class="toc-text">å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86-%E6%9D%A5%E5%8D%95%E6%8F%90%E9%86%92%E5%92%8C%E5%AE%A2%E6%88%B7%E5%82%AC%E5%8D%95"><span class="toc-number">10.</span> <span class="toc-text">11 è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†-æ¥å•æé†’å’Œå®¢æˆ·å‚¬å•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Task"><span class="toc-number">10.1.</span> <span class="toc-text">Spring Task</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">10.1.1.</span> <span class="toc-text">cronè¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-1"><span class="toc-number">10.1.2.</span> <span class="toc-text">å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-number">10.2.</span> <span class="toc-text">è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSocket"><span class="toc-number">10.2.1.</span> <span class="toc-text">WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">10.2.1.1.</span> <span class="toc-text">æ¡ˆä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A5%E5%8D%95%E6%8F%90%E9%86%92"><span class="toc-number">10.3.</span> <span class="toc-text">æ¥å•æé†’</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E5%82%AC%E5%8D%95"><span class="toc-number">10.4.</span> <span class="toc-text">å®¢æˆ·å‚¬å•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="toc-number">11.</span> <span class="toc-text">12 æ•°æ®ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-ECharts"><span class="toc-number">11.1.</span> <span class="toc-text">Apache ECharts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1"><span class="toc-number">11.2.</span> <span class="toc-text">è¥ä¸šé¢ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1"><span class="toc-number">11.3.</span> <span class="toc-text">ç”¨æˆ·ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1"><span class="toc-number">11.4.</span> <span class="toc-text">è®¢å•ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10"><span class="toc-number">11.5.</span> <span class="toc-text">é”€é‡æ’åTop10</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1-Excel%E6%8A%A5%E8%A1%A8"><span class="toc-number">12.</span> <span class="toc-text">13 æ•°æ®ç»Ÿè®¡-ExcelæŠ¥è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8F%B0%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.1.</span> <span class="toc-text">å·¥ä½œå°æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-POI"><span class="toc-number">12.2.</span> <span class="toc-text">Apache POI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">12.2.1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.2.</span> <span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AEExcel%E6%8A%A5%E8%A1%A8"><span class="toc-number">12.3.</span> <span class="toc-text">å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F"><span class="toc-number">12.4.</span> <span class="toc-text">ç»“æŸ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>æœ€è¿‘å‘å¸ƒ</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1e320f13.html" title="æ¡†æ¶é¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/logo (4).png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ¡†æ¶é¢ç»"/></a><div class="content"><a class="title" href="/posts/1e320f13.html" title="æ¡†æ¶é¢ç»">æ¡†æ¶é¢ç»</a><time datetime="2023-10-10T03:07:31.000Z" title="å‘è¡¨äº 2023-10-10 11:07:31">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b0e1545b.html" title="Mysqlé¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/æ‹¾å…‰_è´ªé£Ÿé¬¼_6684.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mysqlé¢ç»"/></a><div class="content"><a class="title" href="/posts/b0e1545b.html" title="Mysqlé¢ç»">Mysqlé¢ç»</a><time datetime="2023-10-10T01:29:15.000Z" title="å‘è¡¨äº 2023-10-10 09:29:15">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a91f5ba1.html" title="ç´¢å¼•çš„æ•°æ®ç»“æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/DSC08725.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç´¢å¼•çš„æ•°æ®ç»“æ„"/></a><div class="content"><a class="title" href="/posts/a91f5ba1.html" title="ç´¢å¼•çš„æ•°æ®ç»“æ„">ç´¢å¼•çš„æ•°æ®ç»“æ„</a><time datetime="2023-09-30T02:44:41.000Z" title="å‘è¡¨äº 2023-09-30 10:44:41">2023-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7b3d68.html" title="Javaå…«è‚¡æ–‡"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/æ‹¾å…‰_è´ªé£Ÿé¬¼_6652.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaå…«è‚¡æ–‡"/></a><div class="content"><a class="title" href="/posts/7b3d68.html" title="Javaå…«è‚¡æ–‡">Javaå…«è‚¡æ–‡</a><time datetime="2023-09-27T13:34:22.000Z" title="å‘è¡¨äº 2023-09-27 21:34:22">2023-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4614ec31.html" title="Redisé¢ç»"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/æ‹¾å…‰_æ‹¾å…‰_1084.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redisé¢ç»"/></a><div class="content"><a class="title" href="/posts/4614ec31.html" title="Redisé¢ç»">Redisé¢ç»</a><time datetime="2023-09-26T04:33:03.000Z" title="å‘è¡¨äº 2023-09-26 12:33:03">2023-09-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜" title="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡" title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²" title="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/Hosted-Vercel.svg" alt="æœ¬ç«™ä½¿ç”¨vercelæ‰˜ç®¡éƒ¨ç½²"/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN" title="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img01.zzmr.club/img/CDN-jsDelivr.svg" alt="æœ¬ç«™ç”±jsDelivræ‰˜ç®¡CDN"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="Jimmy" target="_blank">Jimmy</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="ä¸»é¢˜">ä¸»é¢˜</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/09/02/6rUxGoewvp5hNlB.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> éš§é“</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> ç•™è¨€æ¿</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> æˆ‘çš„</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/maps/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> å¯¼èˆª</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> æ¸¸æˆäººç”Ÿ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> ç›¸å†Œé›†</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/staticIndex/test.html"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> èˆ”ç‹—æ—¥è®°</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> å…³äºæœ¬äºº</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div><span class="sidebar-menu-item-title">æ ‡ç­¾</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AOP/" style="font-size: 0.88rem;">AOP<sup>1</sup></a><a href="/tags/Ajax/" style="font-size: 0.88rem;">Ajax<sup>1</sup></a><a href="/tags/Algolia/" style="font-size: 0.88rem;">Algolia<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 0.88rem;">Axios<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/MySql/" style="font-size: 0.88rem;">MySql<sup>2</sup></a><a href="/tags/Promise/" style="font-size: 0.88rem;">Promise<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 0.88rem;">SSM<sup>3</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>1</sup></a><a href="/tags/SpingBoot/" style="font-size: 0.88rem;">SpingBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 0.88rem;">SpringCloud<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 0.88rem;">VsCode<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>1</sup></a><a href="/tags/maven/" style="font-size: 0.88rem;">maven<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 0.88rem;">ä¸»ä»å¤åˆ¶<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">å›¾åºŠ<sup>1</sup></a><a href="/tags/%E5%9F%9F%E5%90%8D/" style="font-size: 0.88rem;">åŸŸå<sup>1</sup></a><a href="/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">å¹´åº¦æ€»ç»“<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">å¼€å‘<sup>1</sup></a><a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 0.88rem;">æ—…è¡Œ<sup>5</sup></a><a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 0.88rem;">æ‚è°ˆ<sup>1</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE%E5%A4%96%E6%8C%82/" style="font-size: 0.88rem;">æ ‡ç­¾å¤–æŒ‚<sup>1</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">çº¿ç¨‹<sup>1</sup></a><a href="/tags/%E7%BE%8E%E5%8C%96/" style="font-size: 0.88rem;">ç¾åŒ–<sup>1</sup></a><a href="/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/" style="font-size: 0.88rem;">è‹ç©¹å¤–å–<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">é¢è¯•<sup>4</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶é€‰ä¸­æ–‡æœ¬</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>ç²˜è´´æ–‡æœ¬</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>å¼•ç”¨åˆ°è¯„è®º</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>å¤åˆ¶é“¾æ¥åœ°å€</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>å¤åˆ¶æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>ä¸‹è½½æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç«™å†…æœç´¢</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç™¾åº¦æœç´¢</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>æ’­æ”¾éŸ³ä¹</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>åˆ‡æ¢åˆ°ä¸Šä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶æ­Œå</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>åšå®¢åˆ†ç±»</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶åœ°å€</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">å…³é—­çƒ­è¯„</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">æ·±è‰²æ¨¡å¼</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>è½‰ç‚ºç¹é«”</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// æ¶ˆé™¤æ§åˆ¶å°æ‰“å°
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //åœ¨æ¢å¤å‰è¾“å‡ºæ—¥å¿—
  const grt = new Date("09/02/2022 00:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `æ¬¢è¿ä½¿ç”¨å®‰çŸ¥é±¼!`,
    `ç”Ÿæ´»æ˜æœ—, ä¸‡ç‰©å¯çˆ±`,
    `
        
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
      â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
      â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
      â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â•
        
        `,
    "å·²ä¸Šçº¿",
    dnum,
    "å¤©",
    "Â©2020 By å®‰çŸ¥é±¼ V1.6.1",
  ];
  const ascll2 = [`NCC2-036`, `è°ƒç”¨å‰ç½®æ‘„åƒå¤´æ‹ç…§æˆåŠŸï¼Œè¯†åˆ«ä¸ºã€å°ç¬¨è›‹ã€‘.`, `Photo captured: `, `ğŸ¤ª`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c ä½ å¥½ï¼Œå°ç¬¨è›‹.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c âš¡ Powered by å®‰çŸ¥é±¼ %c ä½ æ­£åœ¨è®¿é—® Jimmy çš„åšå®¢.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c ä½ å·²æ‰“å¼€æ§åˆ¶å°.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c ä½ ç°åœ¨æ­£å¤„äºç›‘æ§ä¸­.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.zzmr.club/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.zzmr.club/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.zzmr.club/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">é€šçŸ¥</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">ä½ å¥½å‘€</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>